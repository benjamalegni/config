"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[902],{42876:(e,t,n)=>{n.d(t,{ZP:()=>R,N_:()=>K});n(57658);var a=n(67294),o=n(480),r=n(86628),c=n(24405),i=n(41892),s=n(77657),l=n(82114),u=n(36591),h=n(90199),d=n(35840),g=n(55159),m=n(72126),p=n(149),f=n(97880),k=n(5366),x=n(54642),w=n(42631),C=n(33929),S=n(18441),y=n(80444),v=n(30874),j=n(49085),N=n(92595);class b extends j.default{getStateForBot(e){return this.state[e]??{channels:{},fetching:!1,lastRefreshed:0}}updateStateForBot(e,t){this.setState({...this.state,[e]:{...this.getStateForBot(e),...t}})}addChannelsForBot(e,t){const n=this.getStateForBot(e);this.setState({...this.state,[e]:{...n,channels:{...n.channels,...t}}})}}const I=new b;(0,N.exposeDebugValue)("ExternalNotificationChannelsStore",I);const F=I;var L=n(52275),Z=n(68894),A=n(68785),B=n(72495),M=n(33411),_=n(85893);const V=(0,k.defineMessages)({channelSearchPlaceholder:{id:"notificationRuleSettings.selectChannelView.searchInput.placeholder",defaultMessage:"Search…"}});function R(e){window.__c={n:"SlackSelectChannelView"};const{currentNotificationChannel:t,onNotificationChannelSelect:n,onClose:l,onNewSlackAccountAdded:h,renderMenu:g,channelFilter:j}=e,N=(0,o.O7)(),{isMobile:b}=(0,o.Fy)(),I=(0,r.VK)((()=>v.Z.completeSlackAuthentications.state),[]),R=e.currentExternalAuthentication??m.Ps(I);a.useEffect((()=>{R&&async function(e){const{environment:t,botId:n,spaceId:a}=e,o=F.getStateForBot(n);if(o.fetching||Date.now()-o.lastRefreshed<15e3)return;let r;F.updateStateForBot(n,{fetching:!0,lastRefreshed:Date.now()});for(;;){const e=await x.getExternalNotificationChannels(t,{botId:n,spaceId:a,cursor:r});if("success"!==e.type){console.error(e.error);break}{const t={};for(const n of e.data.channels)t[n.id]=n;if(F.addChannelsForBot(n,t),r=e.data.cursor,!r)break}}F.updateStateForBot(n,{fetching:!1})}({environment:N,botId:R.id,spaceId:R.space_id})}),[N,R]);const[O,z]=a.useState(""),{loadedChannelsForAccount:W,isLoading:q}=(0,r.VK)((()=>{if(!R)return{loadedChannelsForAccount:[],isLoading:!1};const e=F.getStateForBot(R.id);return{loadedChannelsForAccount:Object.values(e.channels),isLoading:e.fetching}}),[R]),D=(0,r.VK)((()=>v.Z.integrations.state.find((e=>e.id===s.nO))),[]),E=(0,r.VK)((()=>{var e;return null===(e=y.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),J=a.useCallback((e=>{R&&n(e,R),l()}),[n,R,l]),$=(0,c.yK)((e=>({icon:{marginLeft:8,width:12,height:12,color:e.lightTextColor},container:{backgroundColor:e.popoverBackground,marginTop:12,marginBottom:6},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:e.regularIconColor}})),[]),T=a.useCallback((e=>{const{channel:n}=e;return{key:n.id,render:e=>(0,_.jsx)(L.Z,{...e,icon:K({channel:n,styles:$.icon}),desktopIconStyle:{width:8},title:n.name,right:n.id===(null==t?void 0:t.id)&&(0,u.e)($.icon)}),action:()=>{J(n)}}}),[J,$.icon,t]),{publicChannels:Y,privateChannels:G,personalChannels:H}=a.useMemo((()=>function(e,t){const n=[],a=[],o=[];for(const r of e)t&&!t(r)||("public"===r.type?n.push(r):"private"===r.type?a.push(r):"me"===r.type?o.push(r):(0,f.t1)(r.type));return{publicChannels:n,privateChannels:a,personalChannels:o}}(W,j)),[j,W]),Q=a.useCallback((()=>Y.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[Y,T]),U=a.useCallback((()=>G.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[G,T]),X=a.useCallback((()=>H.map((e=>({menuListItem:T({channel:e}),channelName:e.name})))),[H,T]),ee=a.useCallback((()=>Q().map((e=>{let{menuListItem:t,channelName:n}=e;if(P({channelName:n,query:O}))return t})).filter(f.$K)),[Q,O]),te=a.useCallback((()=>U().map((e=>{let{menuListItem:t,channelName:n}=e;if(P({channelName:n,query:O}))return t})).filter(f.$K)),[U,O]),ne=a.useCallback((()=>X().map((e=>{let{menuListItem:t,channelName:n}=e;if(P({channelName:n,query:O}))return t})).filter(f.$K)),[X,O]),ae=a.useCallback((()=>{if(!R)return[];const e=[],t=ee(),n=te(),a=ne();return a.length>0&&e.push({key:"personal-channels",render:e=>(0,_.jsx)(B.Z,{...e,title:(0,S.jg)(R).organizationName}),items:a}),t.length>0&&e.push({key:"public-channels",render:e=>(0,_.jsx)(B.Z,{...e,topBorder:a.length>0,title:0===a.length&&(0,S.jg)(R).organizationName}),items:t}),n.length>0&&e.push({key:"private-channels",render:e=>(0,_.jsx)(B.Z,{...e,topBorder:t.length>0,title:0===a.length&&t.length>0&&(0,S.jg)(R).organizationName}),items:n}),e}),[ee,te,ne,R]);if(!R||!D)return null;const oe=[{key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,_.jsx)("div",{children:(0,_.jsx)(Z.ZP,{...e,inputLeft:(0,_.jsx)(Z.f_,{icon:d.R}),inputRight:(0,_.jsx)(M.Z,{show:q,showDelay:500,showHold:300,render:e=>e&&(0,_.jsx)(A.Z,{style:{marginRight:2}})}),showClearButton:!0,placeholder:C.default.formatMessage(V.channelSearchPlaceholder),focusInitial:!b,value:O,onChange:e=>{z(e.target.value)}})})}],render:e=>(0,_.jsx)(B.Z,{...e})},...ae()];return t||oe.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!E)return;const e=await w.hM({environment:N,integration:D,spaceId:E,from:"collection_view_settings"});p.x.isFail(e)||h()},render:e=>(0,_.jsx)(L.Z,{...e,icon:(0,_.jsx)("img",{src:i.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,_.jsx)(k.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,_.jsx)(B.Z,{...e,topBorder:!0})}),(0,_.jsx)(_.Fragment,{children:g(oe)})}function P(e){const{channelName:t,query:n}=e;return 0===n.length||t.toLocaleLowerCase().indexOf(n.trim().toLocaleLowerCase())>=0}function K(e){const{channel:t,styles:n}=e;return"private"===t.type?(0,h.b)(n):"me"===t.type?(0,l.p)(n):(0,g.J)(n)}},93364:(e,t,n)=>{n.d(t,{U:()=>v});n(30541),n(57658);var a=n(67294),o=n(480),r=n(86628),c=n(24405),i=n(41892),s=n(77657),l=n(5257),u=n(35840),h=n(5366),d=n(149),g=n(42631),m=n(33929),p=n(18441),f=n(80444),k=n(30874),x=n(52275),w=n(68894),C=n(72495),S=n(85893);const y=(0,h.defineMessages)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search…"}});function v(e){window.__c={n:"SlackSelectWorkspaceView"};const{onWorkspaceSelect:t,renderMenu:n,workspaceFilter:v,onNewSlackAccountAdded:j}=e,N=(0,o.O7)(),{isMobile:b}=(0,o.Fy)(),I=(0,r.VK)((()=>{var e;return null===(e=f.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),F=(0,r.VK)((()=>(0,p.P9)(k.Z.completeSlackAuthentications.state,v)),[v]),L=(0,r.VK)((()=>k.Z.integrations.state.find((e=>e.id===s.nO))),[]),[Z,A]=a.useState(""),B=(0,c.yK)((e=>({chevronRight:{width:12,height:"auto",color:e.lightIconColor}})),[]);if(!L)return null;const M=Object.entries((0,p.YJ)(F,Z)).map(((e,n)=>{let[a,o]=e;return{key:a,items:o.map((e=>{let{workspaceName:n,externalAuthentication:a}=e;return{key:a.id,action:()=>{t(a)},render:e=>(0,S.jsx)(x.Z,{...e,title:n??(0,S.jsx)(h.FormattedMessage,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,l.o)(B.chevronRight)})}})),render:e=>(0,S.jsx)(C.Z,{...e,title:a,topBorder:0!==n})}}));return M.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,S.jsx)("div",{children:(0,S.jsx)(w.ZP,{...e,inputLeft:(0,S.jsx)(w.f_,{icon:u.R}),showClearButton:!0,placeholder:m.default.formatMessage(y.workspaceSearchPlaceholder),focus:!b||void 0,value:Z,onChange:e=>{A(e.target.value)}})})}],render:e=>(0,S.jsx)(C.Z,{...e})}),M.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!I)return;const e=await g.hM({environment:N,integration:L,spaceId:I,from:"collection_view_settings"});d.x.isFail(e)||e.value.externalAuthentication&&(t(e.value.externalAuthentication),null==j||j())},render:e=>(0,S.jsx)(x.Z,{...e,icon:(0,S.jsx)("img",{src:i.Z.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,S.jsx)(h.FormattedMessage,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,S.jsx)(C.Z,{...e,topBorder:!0})}),(0,S.jsx)(S.Fragment,{children:n(M)})}},18441:(e,t,n)=>{n.d(t,{P9:()=>s,YJ:()=>l,jc:()=>i,jg:()=>c});n(57658);var a=n(77657),o=n(59753),r=n(32161);function c(e){if(e.integration_id!==a.nO)throw"Cannot render account for integration.";const t=/(.+) - (.+)/.exec(e.account_name);if(!t)return{accountName:e.account_name};const[,n,o]=t;return{organizationName:n,accountName:o}}function i(e){return o.kk.fromValue(r.P,e).getSlackWorkspaceId()}function s(e,t){return t?e.filter((e=>{const n=i(e);return!!n&&t(n)})):e}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n={};for(const a of e){const{accountName:e,organizationName:o}=c(a);u({query:t,accountName:e,organizationName:o})&&(n[e]||(n[e]=[]),n[e].push({externalAuthentication:a,workspaceName:o}))}return n}function u(e){const{accountName:t,organizationName:n,query:a}=e;if(0===a.length)return!0;const o=t.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())>=0,r=!!n&&n.toLocaleLowerCase().indexOf(a.trim().toLocaleLowerCase())>=0;return o||r}},82114:(e,t,n)=>{n.d(t,{Q:()=>o,p:()=>r});n(67294);var a=n(45238);const o=(0,n(85893).jsx)("path",{d:"M.911 8.034c0 4.505 3.049 7.24 7.246 7.24 1.135 0 2.215-.158 2.885-.376.472-.15.622-.397.622-.65a.44.44 0 00-.451-.444 1.3 1.3 0 00-.321.048c-.834.205-1.552.341-2.516.341-3.74 0-6.29-2.255-6.29-6.118 0-3.698 2.407-6.275 6.03-6.275 3.206 0 5.886 1.975 5.886 5.523 0 2.072-.697 3.466-1.825 3.466-.752 0-1.176-.437-1.176-1.183V4.972c0-.37-.205-.595-.554-.595-.341 0-.553.226-.553.595v.779h-.062c-.349-.84-1.203-1.374-2.222-1.374-1.77 0-3.014 1.51-3.014 3.678 0 2.187 1.237 3.712 3.042 3.712 1.06 0 1.88-.575 2.276-1.545h.062c.13.963.943 1.551 2.023 1.551 1.907 0 3.09-1.873 3.09-4.498 0-3.971-2.92-6.548-6.96-6.548C3.886.727.912 3.632.912 8.034zm6.911 2.652c-1.223 0-2.003-1.018-2.003-2.638 0-1.593.786-2.611 2.01-2.611 1.258 0 2.05.998 2.05 2.584 0 1.62-.813 2.665-2.057 2.665z"}),r=(0,a.I)("at",{viewBox:"0 0 16 16",svg:o})}}]);