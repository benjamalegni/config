"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[2215],{21269:(e,t,o)=>{o.d(t,{Z:()=>s});o(67294);var n=o(480),i=o(84169),r=o(50906),a=o(42917),l=o(16354),c=o(85893);const s=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:s}=e,u=(0,n.O7)();return(0,c.jsx)(l.Z,{href:o,onClick:()=>r.Fsx(u,{from:s}),external:!0,children:(0,c.jsx)(a.Z,{icon:i.m,title:t,isGray:!0})})}},71846:(e,t,o)=>{o.d(t,{S:()=>b,Z:()=>k});o(57658),o(67294);var n=o(83355),i=o(49085),r=o(56666),a=o(44495),l=o(6287),c=o(5366),s=o(8406),u=o(2985),d=o(33929),p=o(29798),g=o(90106),f=o(73657),m=o(52275),v=o(68894),y=o(32163),S=o(11470),h=o(77137),_=o(72495),x=o(26388),I=o(78948),C=o(85893);let b=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const R=(0,c.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}});class T extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:i.default.createClass(""),limitStore:i.default.createClass(5),menuListStore:p.Z},this.performSearchCollections=async e=>{const{query:t,limit:o}=e,{collectionContextStore:n,parentStore:i,requireEditPermissions:r}=this.props,a=null==n?void 0:n.collectionViewBlockStore(),l=await u.RT({environment:this.environment,collectionViewBlockStore:a,parentStore:i,query:t,limit:o,requireEditPermissions:r});return{results:l.results,showMore:Math.max(0,l.total-l.results.length)}}}renderComponent(){const{collectionContextStore:e,selectedCollectionStore:t,context:o,parentStore:n}=this.props,{device:i}=this.environment,{limitStore:a,inputStore:s,menuListStore:p}=this.stores,x=s.state,T="linked"===(null==e?void 0:e.getCollectionViewBlockSourceState())||o===b.Relation?R.linkedInputPlaceholder:o===b.Source?R.linkedOrSourceInputPlaceholder:R.automationInputPlaceholder;return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(_.Z,{children:(0,C.jsx)(v.ZP,{focusInitial:!i.isMobile||void 0,value:x,onChange:e=>{s.setState(e.target.value),a.setState(e.target.value?20:5),p.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:d.default.formatMessage(T),showClearButton:!0})}),(0,C.jsx)(h.Z,{request:{query:x,limit:a.state},performRequest:this.performSearchCollections,debounce:u.vp,render:(i,s,u)=>{if(!s)return(0,C.jsx)(_.Z,{children:(0,C.jsx)(I.Z,{})});const{results:d,showMore:v}=s,h=d.map((i=>{const r=g.NW.createChildStore(n,{table:l.v,id:i});return{key:i,render:n=>{var a;return(0,C.jsx)(S.Z,{...n,checkState:t&&t.id===i,store:r,right:o===b.Relation&&(null==e||null===(a=e.collectionStore())||void 0===a?void 0:a.id)===i&&this.renderSelfDatabaseIconTooltip()})},action:e=>{const{index:t}=e;this.handleAcceptExistingCollection({collectionStore:r,totalResults:d.length,clickedIndex:t})}}}));if(v>0){const e={key:"showMore",render:e=>(0,C.jsx)(m.Z,{...e,buttonStyle:{color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},icon:(0,r.o)({width:16,height:16}),title:(0,C.jsx)(c.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(v,20)}})}),action:()=>{a.setState(a.state+20)}};h.push(e)}return(0,C.jsxs)(C.Fragment,{children:[d.length>0&&(0,C.jsx)(y.Z,{type:y.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,C.jsx)(_.Z,{...e}),items:h}],store:p}),0===d.length&&(0,C.jsx)(f.Z,{caption:(0,C.jsx)(c.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})})]})}})]})}renderSelfDatabaseIconTooltip(){return(0,C.jsx)(x.Z,{renderTooltip:()=>(0,C.jsx)(c.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>(0,C.jsx)("div",{...e,children:(0,a.D)({width:14,height:14})})})}handleAcceptExistingCollection(e){const{collectionStore:t,totalResults:o,clickedIndex:n}=e,{collectionContextStore:i,searchSessionId:r,context:a}=this.props,{inputStore:l}=this.stores;i&&s.wd({environment:this.environment,collectionContextStore:i,action:"select_existing_collection"});const{onAccept:c}=this.props;c(t),s.tW({environment:this.environment,eventName:"select_search_item",totalResults:o,clickedIndex:n,sessionId:r,source:a,queryLength:l.state.length})}}T.displayName="CollectionSettingsSearchCollections";const k=(0,c.injectIntl)(T)},40863:(e,t,o)=>{o.d(t,{BO:()=>y,Ft:()=>p,Lh:()=>x,YG:()=>g,du:()=>v,y$:()=>m});o(57658);var n=o(30120),i=o(30823),r=o(40506),a=o(53877),l=o(42875),c=o(72126),s=o(59753),u=o(5366),d=o(28020);function p(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,i=o.getQuery(n);if(!i||!i.calendar_by)return;const r=t.dateRangeStart.state,c=t.dateRangeEnd.state,s=(0,a.hT)(r,(0,l.r)()),u=(0,a.hT)(c,(0,l.r)());return f({calendarBy:i.calendar_by,dateRangeStartDate:s,dateRangeEndDate:u})}function g(e){const{collectionContextStore:t,startOfDay:o}=e,i=t.collectionViewStore();if(!i)return;const r=t.normalizedSchemaStore.state,c=i.getQuery(r);if(!c||!c.calendar_by)return;const s=n.ou.fromMillis(o).endOf("day").valueOf(),u=(0,a.hT)(o,(0,l.r)()),d=(0,a.hT)(s,(0,l.r)());return f({calendarBy:c.calendar_by,dateRangeStartDate:u,dateRangeEndDate:d})}function f(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function m(e){const{collectionContextStore:t,results:o,getRecordValue:n,intl:i}=e,s=t.collectionViewStore(),u=t.normalizedQueryStore.state,p=t.normalizedSchemaStore.state,g=u?u.calendar_by:void 0,f=t.dateRangeStart.state,m=t.dateRangeEnd.state,h=d.AK.state,_=(0,l.r)(),x=t.getCurrentUserId();if(!(s&&u&&g&&p))return;const I=c.oA(o.map((e=>y({blockStore:e,calendarBy:g,schema:p,getRecordValue:n,userId:x,intl:i})))),C={};o.forEach(((e,t)=>{C[e.id]=t}));0===(u.sort||[]).length&&I.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return C[e.id]-C[t.id]}return o-n}));const b=(0,a.em)(f,h,_),R=(0,a.gQ)(m,h,_);let T=b;const k=[];do{const e=(0,a.gQ)(T.valueOf(),h,_),t={},o=I.filter((t=>(0,r.b8)(T.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:i,end:r,includeTime:a,timeZone:l}=o,{startColumn:c,columnCount:s}=v({startUnixTimestampMS:i.valueOf(),endUnixTimestampMS:r?r.valueOf():void 0,startOfWeekUnixTimestampMS:T.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),u=S(c,s,t);return{id:n,start:i.valueOf(),end:r?r.valueOf():void 0,row:u,includeTime:a,timeZone:l}}));k.push({start:T.valueOf(),end:e.valueOf(),items:o}),T=(0,a.em)(T.plus({week:1}).plus({hour:25}).valueOf(),h,_)}while(T<R);return k}function v(e){const t=n.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n.ou.fromMillis(e.endUnixTimestampMS):void 0,i=n.ou.fromMillis(e.startOfWeekUnixTimestampMS),r=n.ou.fromMillis(e.endOfWeekUnixTimestampMS),a=t.startOf("day"),l=n.ou.max(i,a),c=l.diff(i,"days").get("days");let s=1;if(o){const e=o.endOf("day"),t=n.ou.min(r,e);s=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:i,endOfWeek:r,startColumn:c,columnCount:s}}function y(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:r,intl:c,userId:u}=e,d=t.getModel();if(!d)return;const p=(0,i.FT)({property:o,schema:n,block:d,getRecordModel:s.om.fromGetRecordValueFn(r),propertyMapping:void 0,collectionRequestContext:{userId:u,userTimeZone:(0,l.r)(),depth:0,intl:c,visitedProperties:new Set,resultCache:{}}}).next().value;if("date"!==p.type)return;const g=p.value,f=g&&(0,a.NK)(g,(0,l.r)());if(!g||!f)return;return{id:d.id,start:f.start,end:f.end,includeTime:"datetime"===g.type||"datetimerange"===g.type,timeZone:"datetime"===g.type||"datetimerange"===g.type?g.time_zone:void 0}}function S(e,t,o){let n=0;for(;;){let i=!1;for(let r=0;r<t;r++)h(o,e+r,n)&&(i=!0);if(!i)break;n++}for(let i=0;i<t;i++)_(o,e+i,n);return n}function h(e,t,o){return Boolean(e[o]&&e[o][t])}function _(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}const x=(0,u.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},11335:(e,t,o)=>{o.d(t,{EE:()=>A,EF:()=>$,Li:()=>j,P$:()=>Y,R4:()=>Q,WM:()=>D,Xd:()=>O,cB:()=>W,i1:()=>B,j_:()=>H,qM:()=>K,qk:()=>E,rU:()=>N,sA:()=>X,tk:()=>z,vM:()=>U,wB:()=>Z});o(21703),o(57658);var n=o(43261),i=o.n(n),r=o(67294),a=o(86628),l=o(3865),c=o(80700),s=o(23290),u=o(76205),d=o(1274),p=o(84116),g=o(78106),f=o(76218),m=o(72126),v=o(26825),y=o(4615),S=o(149),h=o(98963),_=o(18844),x=o(77420),I=o(6287),C=o(13493),b=o(97880),R=o(77080),T=o(30874),k=o(90106),M=o(35057),V=o(82343),w=o(52821),P=o(33929);function O(e){return e.isTriggerType("event")||e.isTriggerType("notification_event")}function F(e){const{action:t,actionValue:o,automationValue:n}=e;var i,r,a,l,c,s,u;if("create_page"===t.action.type){if(!o||"create_page"===o.type)return function(e){const{actionId:t,automationId:o,collectionPointer:n,properties:i,values:r,spaceId:a,templatePageId:l}=e;return{...G({actionId:t,actionType:"create_page",automationId:o,spaceId:a}),config:{collection:n,properties:i,values:r,template_page_id:l}}}({actionId:t.action.id,automationId:n.id,collectionPointer:(null===(i=t.action.config)||void 0===i?void 0:i.collection)??(null==o||null===(r=o.config)||void 0===r?void 0:r.collection),properties:(null===(a=t.action.config)||void 0===a?void 0:a.properties)??(null==o||null===(l=o.config)||void 0===l?void 0:l.properties),spaceId:n.space_id,values:(null===(c=t.action.config)||void 0===c?void 0:c.values)??(null==o||null===(s=o.config)||void 0===s?void 0:s.values),templatePageId:null===(u=t.action.config)||void 0===u?void 0:u.template_page_id})}else if("update_pages"===t.action.type){var d,p,g,f,m,v;if(!o||"update_pages"===o.type)return function(e){const{actionId:t,automationId:o,properties:n,spaceId:i,target:r,values:a}=e;return{...G({actionId:t,actionType:"update_pages",automationId:o,spaceId:i}),config:{target:r,properties:n,values:a}}}({actionId:t.action.id,automationId:n.id,properties:(null===(d=t.action.config)||void 0===d?void 0:d.properties)??(null==o||null===(p=o.config)||void 0===p?void 0:p.properties),spaceId:n.space_id,target:(null===(g=t.action.config)||void 0===g?void 0:g.target)??(null==o||null===(f=o.config)||void 0===f?void 0:f.target),values:(null===(m=t.action.config)||void 0===m?void 0:m.values)??(null==o||null===(v=o.config)||void 0===v?void 0:v.values)})}else if("slack_notification"===t.action.type){var y,S,h,_;if(!o||"slack_notification"===o.type)return function(e){const{actionId:t,automationId:o,externalBotId:n,spaceId:i,target:r}=e;return{...G({actionId:t,actionType:"slack_notification",automationId:o,spaceId:i}),config:{target:r,external_bot_id:n}}}({actionId:t.action.id,automationId:n.id,externalBotId:(null===(y=t.action.config)||void 0===y?void 0:y.external_bot_id)??(null==o||null===(S=o.config)||void 0===S?void 0:S.external_bot_id),spaceId:n.space_id,target:(null===(h=t.action.config)||void 0===h?void 0:h.target)??(null==o||null===(_=o.config)||void 0===_?void 0:_.target)})}else{if("duplicate_blocks"===t.action.type||"modal_confirmation"===t.action.type||"open_page"===t.action.type||"query_collection"===t.action.type)return;(0,b.t1)(t.action)}}function A(e){const{automationStore:t,currentUserId:o,inMemoryRecordCache:n}=e;return(0,a.VK)((()=>{const e=null==t?void 0:t.getRole(),i=null==t?void 0:t.getValue(),r=(null==t?void 0:t.getActionStores().map((e=>e.getValue())).filter(b.$K))??[],a=null==t?void 0:t.pointer;return s=>{if(o&&e&&i&&a){if(!(0,l.Vd)(i)&&!(0,l.nl)(i))return i;if("update_name"===s.type){const t=function(e){var t;const{action:o,automationValue:n}=e;return(null===(t=n.properties)||void 0===t?void 0:t.name)!==o.name?{...n,properties:{...n.properties,name:o.name}}:n}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_source"===s.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.pointer,i=n.table===I.v?{pointer:n,type:I.v}:{pointer:n,type:C.n};return{...o,trigger:{...o.trigger,event:{...o.trigger.event,source:i}}}}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_trigger"===s.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?o:{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!0}}};if("any_page_property_edited"===n.type)return"any"!==o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"any"}}}}:o;if("property_changed"===n.type){const e="some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[],t=m.cx(e,(e=>e.property===n.property)),i={filter:n.filter,property:n.property},r=-1===t?[...e,i]:e.map((e=>e.property===n.property?i:e));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{some:r,type:"some"}}}}}(0,b.t1)(n)}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_action"===s.type){var u;const t=r.find((e=>e.id===s.action.id)),l=F({action:s,actionValue:t,automationValue:i});if(!l)return;if(n.setRecord({pointer:{id:l.id,spaceId:i.space_id,table:_.Xj},userId:o},{role:"editor",value:l}),null===(u=i.action_ids)||void 0===u||!u.includes(l.id)){const t={...i,action_ids:[...i.action_ids??[],l.id]};n.setRecord({pointer:a,userId:o},{role:e,value:t})}n.emitAll()}else if("remove_action"===s.type){const r=s.action.id;n.deleteRecord({pointer:{id:r,spaceId:i.space_id,table:_.Xj},userId:o});const l={...i,action_ids:(i.action_ids??[]).filter((e=>e!==r))};n.setRecord({pointer:a,userId:o},{role:e,value:l}),function(e){const{automationStore:t,newAutomationValue:o,currentUserId:n,inMemoryRecordCache:i}=e,r=t.getParentStore();if((null==r?void 0:r.table)!==I.v)return;const a={automationStore:t,parentPointer:r.getSpaceShardedPointer(),type:"event",persisted:!0,intl:P.default.getIntl(),parentRecordStore:r},l=(0,V.pt)({context:a,automationValue:o});if(S.x.isFail(l))return;const s=(o.action_ids??[]).map((e=>({pointer:{id:e,spaceId:o.space_id,table:_.Xj},userId:n})));for(const d of s){const e=i.getRecordModel(d),t=i.getRecord(d);if(!e||!t||!t.value||"create_page"!==t.value.type&&"update_pages"!==t.value.type)continue;const o=new Set(l.value.actionInputValueTypes[e.id].map((e=>{if(e.kind===p.yp.ContextValue)return e.id;e.kind!==p.yp.ThisRow&&e.kind!==p.yp.Binding&&(0,b.t1)(e)})).filter(b.$K)),n=(0,c.z)(e.type).acceptFormulaVisitor({action:e,visitor:{visitVariableOutsideOfFormula:e=>o.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:e=>e.value&&(0,f.UB)(e).some((e=>!o.has(e)))?{type:"replace",value:void 0}:{type:"keep"}}});let r=t.value;for(const i of n)if("update"===i.command)if(1===i.path.length&&"config"===i.path[0]&&Object.keys(i.args).includes("target")&&"update_pages"===r.type)r={...r,config:{target:void 0,properties:[],values:{}}};else if(2===i.path.length&&"config"===i.path[0]&&"values"===i.path[1]){var u;const e=Object.keys(i.args)[0];r={...r,config:{...r.config,values:{...null===(u=r.config)||void 0===u?void 0:u.values,[e]:void 0}}}}i.setRecord(d,{value:r,role:t.role})}}({automationStore:t,newAutomationValue:l,currentUserId:o,inMemoryRecordCache:n}),n.emitAll()}else if("remove_trigger"===s.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!1}}}:o;if("any_page_property_edited"===n.type)return"any"===o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"none"}}}}:o;if("property_changed"===n.type){const e=("some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[]).filter((e=>e.property!==n.property));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:e.length>0?{some:e,type:"some"}:{type:"none"}}}}}(0,b.t1)(n)}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else(0,b.t1)(s)}}}),[t,o,n])}function E(e){const{automationContextStore:t,automationStore:o,collectionStore:n}=e,i=n.getSchema(),r=o.getKeyStore("properties").getKeyStore("name").getValue();if(null==r||!r.trim())return!1;const a=o.getTrigger(),l="event"===(null==a?void 0:a.type),c="notification_event"===(null==a?void 0:a.type);if(!l&&!c)return!1;const{pagesAdded:s,pagePropertiesEdited:u,source:d}=a.event;if(void 0===d)return!1;if("some"===u.type&&u.some.some((e=>q({collectionSchema:i,property:e.property})||L({collectionSchema:i,property:e.property,type:"trigger"}))))return!1;if(!s&&("none"===u.type||"some"===u.type&&0===u.some.length))return!1;const p=o.getActionStores().filter((e=>e.isDefined()));return 0!==p.length&&p.every((e=>function(e){const{actionStore:t,automationContextStore:o,collectionStore:n}=e;if(t.isType("slack_notification"))return(0,b.$K)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,b.$K)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),i=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,b.$K)(e)||0===i.length)return!1;if("collection"===e.type){const t=k.NW.createChildStore(n,e.collection).getSchema();if(i.some((e=>q({property:e,collectionSchema:t})||L({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const t=(0,g.MY)(e.id);if("global"===t.source&&"button_page"===t.global){const e=n.getSchema();if(i.some((t=>q({property:t,collectionSchema:e})||L({collectionSchema:e,property:t,type:"action"}))))return!1}else{const t=null==o?void 0:o.compilationResultStore.state;if(!t||S.x.isFail(t))return!1;const n=(0,g.vx)(t.value.valueTypes,e.id),r=n?Z(n,o.context.parentRecordStore):void 0;if(!r)return!1;const a=r.getSchema();if(i.some((e=>q({property:e,collectionSchema:a})||L({collectionSchema:a,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,b.t1)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,b.$K)(e))return!1;const o=k.NW.createChildStore(n,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>q({property:e,collectionSchema:o})||L({collectionSchema:o,property:e,type:"action"})))}throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}({actionStore:e,automationContextStore:t,collectionStore:n})))}function Z(e,t){let o;return"block"===e.type.type&&e.type.collection?o=k.NW.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=k.NW.createChildStore(t,e.type.of.collection)),o}function j(e){const{collectionStore:t}=e;if(!t)return!1;if((t.getFormat().automation_ids??[]).length>=s.ss&&!(0,M.sX)())return!1;const o=t.pointer,n=t.getSpaceId();return(0,d.IC)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,v.yY)(i,n)}))}function B(e){const{automationStore:t,actionStores:o}=e,n=t.getMinimumFieldsForPermissions();if(!n)return!1;if(!o.every((e=>e.isDefined())))return!1;const i=o.some((e=>!e.isType("slack_notification")));if(!(0,M.sX)()&&i)return!1;return(0,d.fz)({automationValue:n,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,v.yY)(i,n)}))}function K(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,d.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,v.yY)(i,n)}))}function D(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:n,updateCurrentState:i}=e;!0===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):!1===t?i({type:"remove_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):"partial"===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:o}}):(0,b.t1)(t)}function q(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function L(e){const{collectionSchema:t,property:o,type:n}=e,i=null==t?void 0:t[o];return!i||("action"===n?!(0,l.SF)(i):!l.Ym[i.type])}function U(e){const{automationStore:t,collectionStore:o}=e;if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!1;const n=t.getEventConfiguration();if(!n||void 0===n.source||n.source.type===I.v||"filter"===n.source.type)return!1;const i=k.Xr.createChildStore(o,n.source.pointer);return function(e){const t=N(e);return(0,b.$K)(t)}({collectionSchema:o.getSchema(),collectionViewStore:i})}function N(e){var t;const{collectionViewStore:o,collectionSchema:n}=e,i=o.getPropertyFiltersStore().getValue()??[],r=null===(t=o.getQuery(n))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,u.OH)({propertyFilters:i,combinatorFilter:r,schema:n})},c=(0,u.SH)(a,(e=>{if((0,u.aN)(e)){const t=n[e.property];return!!t&&!(0,l.TX)(t)}return!1}));if(c)return(0,u.aN)(c)?c.property:(0,u.Mm)(c)?c.timestamp:void 0}function W(e){if("collectionTypedView"===e.contextType)return!1;const t=e.collectionStore();return!!t&&!(t.isSyncedCollection()&&!R.default.checkGate("support_synced_database_automations"))}function $(e){const{collectionSchema:t,propertyIds:o,searchTerm:n}=e;if(!n)return o.slice(0);const r=new Map,a=o.map((e=>{const o=t[e],n=o?`${o.name} ${w.SO[o.type]}`:"";return r.set(e,n),n})),l=i().filter(n,a).map((e=>{let{original:t}=e;return t}));return o.filter((e=>l.includes(r.get(e)??"")))}function z(e){return S.x.isFail(e.compilationResultStore.state)?[]:e.compilationResultStore.state.value.valueTypes}function X(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,c=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:c,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??c,parent_id:n.id,parent_table:I.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,y.ZP)(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:I.v}},properties:{name:o},userId:i})}function G(e){const{actionId:t,actionType:o,automationId:n,spaceId:i}=e;return{alive:!0,id:t??(0,y.ZP)(),parent_id:n,parent_table:h.cv,space_id:i,type:o,version:1}}function Q(e){const t=e.getActionStores().filter((0,b.AO)((e=>e.isType("slack_notification")?{true:e}:{false:e}))),o={};for(const n of t){const e=n.getConfig(),t=null==e?void 0:e.external_bot_id;if(!t)continue;const i=k.Qx.createChildStore(n,{id:t,spaceId:n.getSpaceId(),table:x.cZ}).getCreatedByStore();i&&(o[n.id]=i.getDisplayName(P.default.getIntl()))}return o}async function Y(e){const{automationAvailabilityContext:t}=e;let o=t.automation.getTriggerType();"notification_event"===o&&(o="event");const n=s.Gl[o],i="default_bound"===n.max?s.xZ:n.max;if(t.automationActions.length>=i)return[];const r=(0,c.P)("display"),a=[];for(const l of r)await l.isAvailableForContext(t)&&a.push(l);return a}function H(){const e=(0,a.VK)((()=>T.Z.completeSlackAuthentications.state),[]);return(0,r.useMemo)((()=>0===e.length?{type:"connectToSlackDefault"}:1===e.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[e.length])}},68910:(e,t,o)=>{o.d(t,{L:()=>c});var n=o(14577),i=o(78106),r=o(72126),a=o(149),l=o(82343);class c{constructor(e){this.context=void 0,this.compilationResultStore=new n.Z((()=>(0,l.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return a.x.isFail(e)?[]:r.d9(e.value.valueTypes)}getContextValuesForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,i.vx)(o,t)}}},22109:(e,t,o)=>{o.d(t,{T:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("arrowsUpDown",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M4.11 2.385a.61.61 0 01.48-.211c.191 0 .353.07.486.21L8.03 5.409a.66.66 0 01.2.475c0 .191-.061.347-.182.469a.627.627 0 01-.463.181.59.59 0 01-.451-.187L5.926 5.098l-.72-.844.04 1.219v7.242a.624.624 0 01-.187.469.624.624 0 01-.47.187.636.636 0 01-.468-.187.635.635 0 01-.182-.47V5.474l.041-1.22-.726.845-1.201 1.248a.61.61 0 01-.457.187.627.627 0 01-.463-.181.634.634 0 01-.182-.47.66.66 0 01.2-.474l2.958-3.023zm7.786 10.781a.636.636 0 01-.486.205.665.665 0 01-.486-.205l-2.947-3.035a.64.64 0 01-.206-.475c0-.191.061-.345.182-.463a.634.634 0 01.469-.181c.18 0 .33.06.451.181l1.201 1.248.727.85-.041-1.219V2.824c0-.187.06-.342.181-.463a.636.636 0 01.47-.187.627.627 0 01.65.65v7.248l-.041 1.219.726-.85 1.207-1.248a.6.6 0 01.451-.181c.188 0 .342.06.463.181a.615.615 0 01.182.463.648.648 0 01-.2.475l-2.953 3.035z"})})},78807:(e,t,o)=>{o.d(t,{l:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("statusCompleteGroup",{viewBox:"0 0 17 17",svg:(0,i.jsx)("path",{d:"M8.54688 16.5078C13.0156 16.5078 16.6953 12.8281 16.6953 8.35938C16.6953 3.89844 13.0078 0.210938 8.53906 0.210938C4.07812 0.210938 0.398438 3.89844 0.398438 8.35938C0.398438 12.8281 4.07812 16.5078 8.54688 16.5078ZM8.54688 14.7188C5.02344 14.7188 2.19531 11.8828 2.19531 8.35938C2.19531 4.83594 5.01562 2 8.53906 2C12.0703 2 14.8984 4.83594 14.9062 8.35938C14.9141 11.8828 12.0703 14.7188 8.54688 14.7188ZM7.71094 12.0781C8.00781 12.0781 8.27344 11.9219 8.44531 11.6562L11.8828 6.32031C11.9922 6.14844 12.0781 5.95312 12.0781 5.77344C12.0781 5.35156 11.7109 5.07031 11.3125 5.07031C11.0547 5.07031 10.8281 5.21094 10.6562 5.49219L7.6875 10.2578L6.29688 8.51562C6.10938 8.27344 5.91406 8.17969 5.67188 8.17969C5.25781 8.17969 4.92188 8.50781 4.92188 8.92969C4.92188 9.125 5 9.30469 5.14062 9.48438L6.94531 11.6641C7.16406 11.9375 7.40625 12.0781 7.71094 12.0781Z"})})}}]);