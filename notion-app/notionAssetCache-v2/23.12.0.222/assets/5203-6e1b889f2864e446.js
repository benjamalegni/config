"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5203],{73657:(e,t,r)=>{r.d(t,{Z:()=>p});r(67294);var i=r(83355),o=r(28992),n=r(85893);class s extends i.Z{renderComponent(){return(0,n.jsx)(o.Z,{...this.props,style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...this.props.style}})}}s.displayName="CaptionMenuItem";const p=s},75203:(e,t,r)=>{r.r(t),r.d(t,{default:()=>L});r(67294);var i=r(83355),o=r(39068),n=r(56666),s=r(39132),p=r(61061),l=r(72126),d=r(82990),a=r(5366),h=r(50906),c=r(31869),y=r(96802),m=r(39699),u=r(87279),g=r(29376),P=r(4023),b=r(29798),x=r(73657),v=r(52275),S=r(31945),f=r(79131),j=r(73063),T=r(78140),Z=r(32163),k=r(53437),C=r(72495),w=r(26388),M=r(85893);class I extends i.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:b.Z},this.renderRelationPropertyMenuPopup=e=>{const t=this.allRelatedTargetProperties.state;if(!t)return;const r=t.filter((e=>e.visible)),i=t.filter((e=>!e.visible));return(0,M.jsxs)(T.Z,{menuType:u.og.Popup,maxWidth:240,maxHeight:500,children:[0===t.length&&(0,M.jsx)(C.Z,{children:(0,M.jsx)(x.Z,{caption:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"No properties",id:"database.relationMenu.noProperties"})})}),t.length>0&&(0,M.jsx)(Z.Z,{type:Z.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:l.oA([r.length>0&&{key:"visible_and_hidden_properties",render:e=>(0,M.jsx)(C.Z,{...e,noTextOverflow:!0,isTitleUppercase:!1,title:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"Shown in relation",id:"database.relationMenu.shownInRelationTitle"}),desktopTitleStyle:{height:18},children:this.renderPropertyDraggableList({visibleProperties:r,hiddenProperties:i,children:e.children})}),items:l.oA([...this.renderPropertySortListItems({properties:r,visibility:!0}),i.length>0&&{key:"group-header-hidden-property",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:(0,M.jsx)(M.Fragment,{})}),action:()=>{}},...this.renderPropertySortListItems({properties:i,visibility:!1})])},0===r.length&&i.length>0&&{key:"hidden_properties",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:this.renderPropertyDraggableList({visibleProperties:r,hiddenProperties:i,children:e.children})}),items:this.renderPropertySortListItems({properties:i,visibility:!1})}])})]})},this.handlePropertyReorder=e=>{const{newPropertyKeys:t}=e,{collectionStore:r,property:i}=this.props,o=g.U1({collectionStore:r,property:i}),n=t.indexOf("group-header-hidden-property"),s=l.oA(t.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const r=o.find((t=>t.property===e));return r?n>0?"title"===e&&t>=n?r:{...r,visible:Boolean(t<n)}:r:{property:e,visible:!(n>0)||Boolean(t<n)}}))),p=o.filter((e=>!t.includes(e.property))),d={...g.ZI(r)};d[i]||(d[i]={}),d[i].related_properties=[...s,...p],m.createAndCommit({userAction:"RelationPropertyCustomizeLayoutMenu.handlePropertyReorder",environment:this.environment,perform:e=>{y.FH({stores:[r],update:{collection_relation_options:d},transaction:e})}}),this.stores.menuListStore.reset()},this.allRelatedTargetProperties=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:r}=this.props,i=g.U1({collectionStore:e,property:r}),o=Object.keys(t.getSchema()).map((e=>i.find((t=>t.property===e))??{property:e,visible:!1})),n=i.map((e=>e.property)),s=e=>{const t=n.indexOf(e);return-1!==t?t:1/0};return o.sort(((e,t)=>s(e.property)-s(t.property))),o}),!0)}renderComponent(){const{device:e}=this.environment;if(!e.isPhone||"section"===this.props.rowType)return(0,M.jsx)(w.Z,{renderTooltip:()=>(0,M.jsx)(a.FormattedMessage,{id:"database.RelationCustomizeLayoutMenu.tooltip.button.message",defaultMessage:"Customize shown properties"}),placement:"section"===this.props.rowType?P.u.Top:P.u.Right,render:e=>(0,M.jsx)(S.ZP,{popupType:k.kQ.Popup,alignmentToOrigin:P.v.Start,...e,renderOrigin:t=>(0,M.jsx)(j.Z,{icon:n.o,iconStyle:{width:16,color:this.theme.mediumIconColor,fill:this.theme.mediumIconColor},...t,...e}),onClick:()=>{h.gP4(this.environment,{from:"section"===this.props.rowType?"relation_section":"configure_relation_modal"})},originGap:16,render:this.renderRelationPropertyMenuPopup})})}renderPropertySortListItems(e){const{properties:t,visibility:r}=e;return l.oA(t.map((e=>this.renderPropertySortListItem({propertyFormat:e,visibility:r}))))}renderPropertyDraggableList(e){const{visibleProperties:t,hiddenProperties:r,children:i}=e,o=l.oA([...t.map((e=>e.property)),t.length>0&&r.length>0&&{key:"group-header-hidden-property",draggable:!1},...r.map((e=>e.property))]);return(0,M.jsx)(f.ZP,{direction:"vertical",keys:o,renderKey:(e,t)=>i[t],onDrop:e=>{this.handlePropertyReorder({newPropertyKeys:e})},disabled:this.props.disabled})}renderPropertySortListItem(e){const{propertyFormat:t,visibility:r}=e,i=!r,{collectionStore:n,targetCollectionStore:l,property:a,disabled:h}=this.props,y=this.environment,m=l.getSchema();if(!m)return;const u=m[t.property];if(!u)return;const{theme:g}=this;return{key:t.property,render:e=>(0,M.jsx)(v.Z,{...e,showDragHandle:!h,title:(0,M.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,M.jsx)(o.ZP,{icon:u.icon,type:u.type,size:16,theme:g,style:{fill:g.regularIconColor}}),(0,M.jsx)("span",{style:{marginLeft:8,...d.Z.textOverflowStyle},children:u.name})]}),right:(0,M.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,M.jsx)(j.Z,{icon:i?p.B:s.c,iconStyle:{width:16,height:16},isDarkIconColor:!i,onClick:()=>{c.qK({propertyFormat:t,visibility:r,collectionStore:n,property:a,environment:y})},disabled:h||"title"===t.property})})}),action:()=>{}}}renderHiddenPropertySectionHeader(e){const{props:t,children:r}=e;return(0,M.jsx)(C.Z,{...t,noTextOverflow:!0,isTitleUppercase:!1,title:(0,M.jsx)(a.FormattedMessage,{defaultMessage:"Hidden in relation",id:"database.relationMenu.hiddenInRelationTitle"}),desktopTitleStyle:{height:19},children:r,disableDesktopPadding:!0})}}I.displayName="RelationPropertyCustomizeLayoutMenu";const L=I}}]);