"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6212],{27784:(e,t,i)=>{i.r(t),i.d(t,{BlockSkillButton:()=>F});var n=i(67294),o=i(480),r=i(86628),l=i(24405),a=i(69104),s=i(36591),c=i(20669),d=i(18442),p=i(5366),u=i(4615),k=i(21202),S=i(70203),g=i(96802),m=i(19785),y=i(9953),v=i(39699),b=i(57819),_=i(63737),h=i(44500),w=i(12921),P=i(87279),x=i(82375),f=i(90106),C=i(52275),j=i(31945),I=i(91839),T=i(78140),Z=i(32163),A=i(89728),B=i(72495),K=i(85893);function F(e){window.__c={n:"BlockSkillButton"};const{blockStore:t}=e,i=(0,o.O7)(),[s,p]=n.useState(!1),g=(0,r.VK)((()=>{var e,i;const n=t.getFormatStore().getKeyStore("ai_skill").getKeyStore("ai_skill_type").getValue();if(!n)return;const o=null===(e=a.n[n])||void 0===e||null===(i=e.getLocalInEditorSkillTrigger)||void 0===i?void 0:i.call(e,{positionBlockId:t.id});return o?{key:n,type:"local",skillType:n,inEditorSkillTrigger:o}:void 0}),[t]),h=(0,r.VK)((()=>{const e=t.getFormatStore().getKeyStore("ai_skill").getKeyStore("ai_show_skill_picker").getValue();return Boolean(e)}),[t]),P=(0,r.VK)((()=>w.fG.shouldShowAIHeaders()),[]),C=(0,n.useCallback)((async()=>{const e=t.getNavigableBlockStore(),n=t.getRecordStoreUIRoot(),o=(0,b.Dj)(n);e&&n&&n instanceof f.G&&(p(!0),await _.resetAssistantStore({environment:i,completionContext:{type:"blockSelection",stores:[t],currentPage:e,origin:t,scrollerStore:o},clientSkill:g}),await _.sampleNextAssistantSteps({environment:i,inferenceId:(0,u.ZP)()}),await _.commitPreviewAssistantStep({environment:i}),await _.applyUncommittedOperations({environment:i}),function(e){var t;const{environment:i,currentPageStore:n,blockStore:o}=e,r=(0,u.ZP)(),l={id:r,version:0,alive:!0,type:"toggle",properties:{title:S.TPx("ðŸ“œ Assistant transcript")},space_id:n.getSpaceId(),parent_id:o.getParentId()??n.id,parent_table:k.iU},a={id:(0,u.ZP)(),version:0,alive:!0,type:"code",properties:{title:S.TPx(JSON.stringify(null===(t=x.XN.state)||void 0===t?void 0:t.evaluator.getTranscript(),null,2)??"no transcript"),language:S.TPx("JSON")},format:{code_wrap:!0},space_id:n.getSpaceId(),parent_id:r,parent_table:k.iU};v.createAndCommit({userAction:"assistant.runAiSkillFromHeader",environment:i,perform:e=>{const t=y.ae({environment:i,table:k.iU,value:l,inMemoryRecordCache:n.inMemoryRecordCache,transaction:e}),r=y.ae({environment:i,table:k.iU,value:a,inMemoryRecordCache:n.inMemoryRecordCache,transaction:e}),s=o.getParentBlockStore();s&&(m.jG({parentStore:s,childStore:t,transaction:e}),m.jG({parentStore:t,childStore:r,transaction:e}))}})}({environment:i,currentPageStore:e,blockStore:t}),p(!1))}),[i,t,g]),T=function(e){const{botIsWriting:t}=e;return(0,l.yK)((e=>({container:{display:"flex"},button:{marginLeft:8,marginTop:3,color:t?e.lightIconColor:e.aiPurpleColor}})),[t])}({botIsWriting:s});return h&&P?(0,K.jsxs)("div",{style:T.container,children:[(0,K.jsx)(A.Z,{style:T.button,disabled:!g||s,disabledFeedback:!g||s,onClick:async()=>{await C()},children:s?(0,K.jsx)(I.Z,{}):(0,c.y)({width:16})}),(0,K.jsx)(j.ZP,{popupType:j.Z4.Popup,render:e=>(0,K.jsx)(V,{blockStore:t,buttonPopupParent:e,selectedClientSkill:g}),renderOrigin:e=>(0,K.jsx)(A.Z,{...e,style:T.button,disabled:s,disabledFeedback:s,children:(0,d.H)({width:16})})})]}):null}function V(e){window.__c={n:"SkillSelectMenu"};const{blockStore:t,buttonPopupParent:i,selectedClientSkill:l}=e,a=(0,o.O7)(),c=(0,p.useIntl)(),d=(0,r.VK)((()=>(0,h.e0)({positionBlockId:t.id})),[t]),u=(0,n.useCallback)((e=>{v.createAndCommit({userAction:"assistant.setHeaderBlockSkillType",environment:a,perform:i=>{g.FH({stores:[t],update:{ai_skill:{ai_show_skill_picker:!0,ai_skill_type:e}},transaction:i})}}),i.close()}),[a,t,i]),k=[{key:"skills",render:e=>(0,K.jsx)(B.Z,{...e}),items:d.map((e=>({key:e.key,render:t=>(0,K.jsx)(C.Z,{...t,title:c.formatMessage(h.jo[e.skillType]),right:(null==l?void 0:l.key)===e.key&&(0,s.e)({width:12})}),action:()=>{u(e.skillType)}})))}],S={menuType:P.og.Popup,width:280,maxWidth:360};return(0,K.jsx)(T.Z,{...S,children:(0,K.jsx)(Z.Z,{type:Z.i.Vertical,initialFocus:0,sections:k})})}}}]);