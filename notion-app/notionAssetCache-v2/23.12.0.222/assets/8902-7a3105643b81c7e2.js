"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8902],{78902:(e,t,s)=>{s.d(t,{Z:()=>ne});var r=s(67294),i=s(83355),n=s(45238),a=s(85893);const o=(0,n.I)("sidebarTrash",{viewBox:"0 0 14 14",svg:(0,a.jsx)("path",{d:"M13.5000308,3.23952 C13.5000308,4.55848168 11.9230308,12.0493 11.9230308,12.0782 C11.9230308,12.6571 9.73825083,14 7.04165083,14 C4.34504083,14 2.16025083,12.6571 2.16025083,12.0782 C2.16025083,12.0541 0.5,4.55799105 0.5,3.23952 C0.5,1.91780104 3.02713083,0 7.03525083,0 C11.0433308,0 13.5000308,1.9178004 13.5000308,3.23952 Z M7,2 C3.625,2 2.5,3.25 2.5,4 C2.5,4.75 3.625,6 7,6 C10.375,6 11.5,4.75 11.5,4 C11.5,3.25 10.375,2 7,2 Z"})});var l=s(5366),d=s(50906),h=s(42858),c=s(39699),u=s(98742),m=s(36896),p=s(44604),g=s(80444),b=s(64921),f=s(31945),x=s(79954),Z=s(14694),S=s(15145),v=s(1800),T=s(35840),M=s(37612),C=s(55863),y=s(21202),j=s(34602),k=s(2985),w=s(39865),P=s(95477),B=s(43250),F=s(33929),I=s(87279),O=s(18514),R=s(74948),H=s(88632),D=s(90106),N=s(72087),L=s(68894),_=s(68785),q=s(78140),U=s(32163),E=s(43765),Y=s(40721),A=s(89728),G=s(11470),V=s(77137),W=s(43145),$=s(72495),K=s(30506),z=s(33411),J=s(26388),Q=s(83182),X=s(46247),ee=s(66957);const te=(0,l.defineMessages)({filterByPlaceholder:{id:"sidebarTrash.filterBy.placeholder",defaultMessage:"Filter by page titleâ€¦"}});class se extends i.Z{constructor(){super(...arguments),this.storeTypes={requestStore:N.Z},this.renderTrashPages=(e,t)=>{const{device:s}=this.environment,i=t?t.results:[],{mainEditorCurrentBlockStore:n}=g.default.state;if(!n)return;const o=i.map((e=>D.G.createChildStore(n,{table:y.iU,id:e}))).filter((e=>e.isDefined()&&!p.Z.state.excludePages.has(e.id))).map((e=>({key:e.id,action:t=>{let{event:r}=t;if("metaKey"in r&&r.metaKey){const t=(0,v.Z)({baseUrl:P.default.domainBaseUrl,pageId:e.id,pageVisitSource:S.tY.SidebarTrash});j.navigateToExternalURL({environment:this.environment,url:t})}else j.navigateToBlock({environment:this.environment,store:e,pageVisitSource:S.tY.SidebarTrash}),m.Z.setState({...m.Z.state,open:!1});s.isMobile&&R.close()},render:t=>(0,a.jsx)(G.Z,{...t,dontShrinkRight:!0,store:e,right:(0,a.jsxs)("div",{style:{display:"flex"},children:[(0,a.jsx)(J.Z,{placement:J.Z.Placement.Bottom,renderTooltip:()=>(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Restore",id:"sidebarTrash.restorePageButton.tooltip"}),render:t=>(0,a.jsx)(A.Z,{isGray:!0,onClick:()=>this.handleRestoreClick(e),...t,children:(0,C.s)({width:18,height:18})})}),(0,a.jsx)(J.Z,{placement:J.Z.Placement.Bottom,renderTooltip:()=>(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Delete permanently",id:"sidebarTrash.deletePagePermanentlyButton.tooltip"}),render:t=>(0,a.jsx)(A.Z,{isGray:!0,onClick:()=>this.handleDeleteClick(e),...t,children:(0,M.y)({width:18,height:18})})})]})})})));return 0===o.length?(0,a.jsx)($.Z,{children:s.isMobile?(0,a.jsx)(E.Z,{title:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"No matches found.",id:"sidebarTrash.mobileFilterBy.noMatchesPrompt"})}):(0,a.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,textAlign:"center"},children:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"No matches found.",id:"sidebarTrash.filterBy.noMatchesPrompt"})})}):(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(U.Z,{type:U.i.Vertical,initialFocus:void 0,sections:[{key:0,items:o,render:e=>(0,a.jsx)($.Z,{...e})}]}),(0,a.jsx)(z.Z,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>{if(e)return(0,a.jsx)("div",{style:{height:44,display:"flex",flex:1,alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(_.Z,{})})}}),(0,a.jsx)(W.Z,{onChange:this.handleScrollOffsetChange})]})},this.handleSwipeLeft=()=>{const e=se.tabs.indexOf(p.Z.state.currentTab)+1,t=se.tabs[e];void 0!==t&&this.changeTab(t)},this.handleSwipeRight=()=>{const e=se.tabs.indexOf(p.Z.state.currentTab)-1,t=se.tabs[e];void 0!==t&&this.changeTab(t)},this.handleTabChange=e=>{const t=se.tabs[e];this.changeTab(t)},this.handleRestoreClick=e=>{const{currentSpaceStore:t}=g.default.state;t&&w.DV({environment:this.environment,block:e,spaceId:e.pointer.spaceId||t.id})},this.handleDeleteClick=e=>{w.Rn({environment:this.environment,blocks:[e]})},this.handleSearchInputChange=e=>{p.Z.setState({...p.Z.state,filter:e.target.value,limit:p.Z.startLimit})},this.handleClose=()=>{const{mobileNative:e}=this.environment,t=()=>{m.Z.setState({...m.Z.state,open:!1})};null!=e&&e.supportsNativeHomeOnPhone()?j.navigateToHomeTab(this.environment,t):t()},this.handleScrollOffsetChange=e=>{const{requestStore:t}=this.stores,{ready:s,loading:r,result:i}=t.state,n=i;e<=p.Z.loadMoreOffset&&n&&s&&!r&&!n.endOfResultsReached&&p.Z.setState({...p.Z.state,limit:p.Z.state.limit+p.Z.limitIncrement})},this.performSearchRequest=async e=>{const{currentSpaceStore:t,mainEditorCurrentBlockStore:s,currentUserStore:r}=g.default.state;if(!t||!s||!r)return;const{limit:i,filter:n,currentTab:a}=p.Z.state;let o,l;if("in_current_page"===a)if(s.isCollectionView()){if(!s.isDefined())return;const e=s.getCollectionPointer();if(!e)return;l=e.id}else l=s.id;else"last_edited_by_me"===a&&(o=r.id);return await k.bI({environment:this.environment,query:n,limit:i,ancestorId:l,spaceId:t.id,editedById:o})}}willMount(e){super.willMount(e),p.Z.setState({...p.Z.state,limit:p.Z.startLimit,excludePages:new Set})}willUnmount(){p.Z.setState({...p.Z.state,filter:""})}renderComponent(){const{mobileNative:e}=this.environment;return null!=e&&e.supportsNativeHomeOnPhone()?this.renderNativeHomeEnabledLayout():this.renderLayout()}renderLayout(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:I.og.Modal,title:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:(0,a.jsx)(Y.DoneMenuText,{}),onClickRight:this.handleClose,onCancel:this.handleClose,header:this.renderHeaderWithTabs()}:{menuType:I.og.Popup,height:"50vh",width:414,header:this.renderHeaderWithTabs(),footer:this.renderFooter()},(0,a.jsx)(K.Z,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>(0,a.jsx)(q.Z,{...t,...e,className:B.TYv,children:this.renderPages()})})}renderNativeHomeEnabledLayout(){const e={menuType:I.og.Modal,title:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:(0,a.jsx)(Y.DoneMenuText,{}),onClickRight:this.handleClose,onCancel:this.handleClose,header:this.renderSearchInput()};return(0,a.jsx)(q.Z,{...e,className:B.TYv,children:this.renderPages()})}renderHeaderWithTabs(){const{device:e}=this.environment,t=p.Z.state.currentTab,s=se.tabs.indexOf(t);return(0,a.jsxs)(r.Fragment,{children:[(0,a.jsx)(ee.Z,{tabs:[(0,a.jsx)(l.FormattedMessage,{defaultMessage:"All pages",id:"sidebarTrash.allPages.tabHeader"},"allPages"),(0,a.jsx)(l.FormattedMessage,{defaultMessage:"In current page",id:"sidebarTrash.inCurrentPage.tabHeader"},"currentPage"),(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Last edited by me",id:"sidebarTrash.lastEditedByMe.tabHeader"},"lastEditedByMe")],selectedIndex:s,onChange:this.handleTabChange}),(0,a.jsx)("div",{style:{margin:e.isMobile?0:"10px 0"},children:this.renderSearchInput()})]})}renderSearchInput(){const{device:e}=this.environment;return(0,a.jsx)(L.ZP,{left:(0,a.jsx)(z.Z,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>e?(0,a.jsx)(_.Z,{style:this.getSearchIconStyle()}):(0,T.R)(this.getSearchIconStyle())}),style:{...e.isAndroid&&{borderBottom:"none"}},showClearButton:!0,placeholder:F.default.formatMessage(te.filterByPlaceholder),focus:!e.isMobile||void 0,value:p.Z.state.filter,onChange:this.handleSearchInputChange})}renderFooter(){return(0,a.jsx)($.Z,{topBorder:!0,disableDesktopPadding:!0,children:(0,a.jsx)(Q.Z,{title:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Learn about deleting and restoring pages",id:"sidebarTrash.learnMore.prompt"}),href:(0,O.UY)("guides.trash"),analyticsFrom:"trash"})})}renderMobileHelpButton(){return(0,a.jsx)(X.Z,{href:(0,O.UY)("guides.trash"),analyticsFrom:"trash"})}renderPages(){if(!H.Z.state.online)return(0,a.jsx)($.Z,{children:(0,a.jsx)(E.Z,{title:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Please go online to view the Trash.",id:"sidebarTrash.goOnline.prompt"})})});{const{filter:e,limit:t,currentTab:s}=p.Z.state,r=`${e}:${t}${s}`;return(0,a.jsx)(V.Z,{requestStore:this.stores.requestStore,request:r,performRequest:this.performSearchRequest,render:this.renderTrashPages,debounce:k.vp})}}changeTab(e){p.Z.setState({...p.Z.state,currentTab:e,limit:p.Z.startLimit}),this.stores.requestStore.setState({...this.stores.requestStore.state,result:null}),d.vqh(this.environment,{tab:e})}getSearchIconStyle(){return{width:14,height:14,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}}se.displayName="SidebarTrash",se.tabs=["all_pages","in_current_page","last_edited_by_me"];const re=se;class ie extends i.Z{constructor(){super(...arguments),this.renderOrigin=e=>{const{onClick:t,...s}=(0,u.Z)(e,{onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave});return(0,a.jsx)(x.Z,{store:this.clonedStore,canDropOnto:!0,onSelectableDrop:this.handleDrop,analyticsName:"sidebar_trash",shouldShowDropZone:!0,children:(0,a.jsx)(b.Z,{...s,style:this.props.buttonStyle,onClick:t||this.handleClick,mobileFeedback:this.props.isMobile,children:(0,a.jsx)(Z.Z,{left:this.renderIcon(),style:{...m.Z.state.open&&{background:this.theme.buttonHoveredBackground}},disableMobileBorder:!0,children:(0,a.jsx)(l.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrashButton.text"})})})})},this.renderSidebarTrash=()=>{const{currentSpaceStore:e}=g.default.state;if(e)return(0,a.jsx)(re,{spaceStore:e})},this.handleClick=e=>{p.Z.setState({...p.Z.state,currentTab:"all_pages"}),d.YFJ(this.environment)},this.handleDrop=e=>{const{droppedStores:t,duplicate:s}=e;s||c.createAndCommit({userAction:"SidebarTrashButton.handleDrop",environment:this.environment,perform:e=>{h.Cl({environment:this.environment,blocks:t,transaction:e})}})}}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){const{device:e,mobileNative:t}=this.environment,s=(null==t?void 0:t.supportsNativeHomeOnPhone())||!1;return(0,a.jsx)(f.ZP,{popupType:e.isMobile?f.Z4.SlideUp:f.Z4.Popup,hidesMobileNativeBottomBar:s,preventSlideUpTransition:s,buttonPopupStore:m.Z,alignmentToOrigin:f.vR.Start,placementToOrigin:f.pO.Right,originGap:0,onClick:this.handleClick,isFullWidthOnMobile:!0,render:this.renderSidebarTrash,preventScaleTransition:!0,renderOrigin:this.renderOrigin})}renderIcon(){const{device:e}=this.environment,t=this.theme.mediumIconColor;return e.isMobile?o({fill:t,height:16}):o({fill:t,width:14})}}ie.displayName="SidebarTrashButton";const ne=ie}}]);