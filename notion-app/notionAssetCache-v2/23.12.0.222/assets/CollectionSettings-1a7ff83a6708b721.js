"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4544],{48146:(e,t,o)=>{o.r(t),o.d(t,{default:()=>uu});var n=o(67294),i=o(83355),r=o(4615),a=o(5366),s=o(50906),l=o(5149),c=o(96802),d=o(39699),u=(o(57658),o(43261)),p=o.n(u),g=o(480),m=o(86628),y=o(24405),h=o(66897),S=o(63362),f=o(3865),x=o(80700),v=o(76205),C=o(99036),b=o(80951),w=o(84619),j=o(76218),M=o(88607),_=o(91856),T=o(65422),k=o(84169),P=o(20669),A=o(25651),V=o(47453),F=o(24600),B=o(42283),I=o(63030),Z=o(69196),D=o(53016),K=o(48524),R=o(43393),N=o(32426),O=o(71500),E=o(73201),L=o(72050),W=o(55159),G=o(26774),H=o(34093),z=o(92607),U=o(32623),$=o(53866),q=o(3729),Q=o(108),Y=o(83303),X=o(56505),J=o(8938),ee=o(94308),te=o(606),oe=o(97880),ne=o(82990),ie=o(65628),re=o(96711),ae=o(26388),se=o(85567),le=o(56812),ce=o(6740),de=o(37989),ue=o(56666),pe=o(37612),ge=o(77744),me=o(64921),ye=o(52275),he=o(31945),Se=o(73063),fe=o(78140),xe=o(32163),ve=o(53437),Ce=o(72495),be=o(61766),we=o(95193),je=o(85893);const Me=(0,a.defineMessages)({moreLabel:{id:"automationBaseStepElement.moreActionsMenu.title",defaultMessage:"More"}});function _e(e){window.__c={n:"AutomationBaseStepElement"};const{icon:t,onBlur:o,onClick:i,onFocus:r,onMouseDown:a,onMouseEnter:s,onMouseLeave:l,title:c,caption:d,onEdit:u,onDelete:p,disabled:h}=e,{isMobile:S}=(0,g.Fy)(),[f,x]=(0,ce.Z)(),[v,C]=(0,de.Z)(),[b,w]=(0,n.useState)(!1),j=b||x||C,M=(0,ge.lq)(f,v),_=(0,m.qz)(void 0,be.Z),T=(0,y.yK)((e=>({button:{position:"relative"},moreButtonWrap:{display:j||S?"block":"none",position:"absolute",right:12,top:14},container:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:8,justifyContent:"center",paddingBlock:16,paddingInline:12},title:{alignItems:"center",display:"flex",flexDirection:"row",gap:6},iconWrap:{flexShrink:0,alignSelf:"baseline",height:"24px",display:"flex",alignItems:"center"},iconStyle:{width:16,height:16,color:e.mediumIconColor},body:{flex:"1 1 auto",fontSize:14,lineHeight:1.3,minWidth:0,whiteSpace:"pre"}})),[j,S]),k=(0,n.useCallback)((e=>{w(!0),s&&s(e)}),[s]),P=(0,n.useCallback)((e=>{w(!1),l&&l(e)}),[l]);return(0,je.jsxs)(me.Z,{onBlur:o,onClick:()=>{null==i||i(_)},onFocus:r,onMouseDown:a,onMouseEnter:k,onMouseLeave:P,style:T.button,disabled:h,disabledFeedback:h,ref:M,focused:j,children:[!h&&(u||p)&&(0,je.jsx)("div",{style:T.moreButtonWrap,children:(0,je.jsx)(Te,{onEdit:u,onDelete:p,disabled:h,buttonPopupStore:_})}),(0,je.jsxs)("div",{style:T.container,children:[(0,je.jsxs)("div",{style:T.title,children:[t&&(0,je.jsx)("div",{"aria-hidden":"true",style:T.iconWrap,children:t(T.iconStyle)}),(0,je.jsx)("div",{style:T.body,children:c})]}),d]})]})}function Te(e){window.__c={n:"MoreActionsButton"};const{onDelete:t,onEdit:o,disabled:n,buttonPopupStore:i}=e,r=(0,g.O7)(),{device:s}=r,l=(0,a.useIntl)(),c=(0,y.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26},iconButtonIcon:{width:14,height:14}})),[]);return(0,je.jsx)(he.ZP,{buttonPopupStore:i,popupType:s.isMobile?ve.kQ.SlideUp:ve.kQ.Popup,alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,originGap:0,renderOrigin:e=>(0,je.jsx)(Se.Z,{...e,disabled:n,ariaLabel:l.formatMessage(Me.moreLabel),icon:ue.o,hasBackground:!0,iconStyle:c.iconButtonIcon,style:c.iconButton}),render:e=>(0,je.jsx)(ke,{onClose:()=>e.close(),onEdit:o,onDelete:t})})}function ke(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n}=e,i=(0,we.F)(),r=[o?{action:()=>{t(),o()},key:"edit",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,A.R)({height:16,width:16}),title:(0,je.jsx)(a.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.edit",defaultMessage:"Edit"})})}:void 0,n?{action:()=>{t(),n()},key:"delete",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,pe.y)({height:16,width:16}),title:(0,je.jsx)(a.FormattedMessage,{id:"automationBaseStepElement.moreActionsMenu.delete",defaultMessage:"Delete"})})}:void 0].filter(oe.$K);return(0,je.jsx)(fe.Z,{...i,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:[{items:r,key:"items",render:e=>(0,je.jsx)(Ce.Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}function Pe(e){window.__c={n:"AutomationTriggerActionTooltip"};const{caption:t,renderOrigin:o,title:i,tooltipAlignment:r,tooltipPlacement:a}=e,s=(0,y.yK)((e=>({tooltipTitle:{margin:0},tooltipCaption:{color:e.mediumInvertedTextColor,margin:0}})),[]),l=(0,n.useCallback)((()=>(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("p",{style:s.tooltipTitle,children:i}),(0,je.jsx)("p",{style:s.tooltipCaption,children:t})]})),[t,i,s.tooltipCaption,s.tooltipTitle]);return(0,je.jsx)(ae.Z,{alignment:r,delayThreshold:800,placement:a,render:o,renderTooltip:l,textWrap:!0})}function Ae(e){window.__c={n:"UpdateCheckboxPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:s,value:l}=e,c=(0,y.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]),d=function(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,j.A6)(null==n?void 0:n.value)[0],r=t.name,s=!0===i?(0,je.jsxs)(je.Fragment,{children:[(0,re.V)({display:"inline-block",marginInlineEnd:4,verticalAlign:"middle",width:12}),(0,je.jsx)(a.FormattedMessage,{...le.Bo.actionCheckboxPropertyChecked})]}):(0,je.jsxs)(je.Fragment,{children:[(0,ie.z)({display:"inline-block",marginInlineEnd:4,verticalAlign:"middle",width:10}),(0,je.jsx)(a.FormattedMessage,{...le.Bo.actionCheckboxPropertyUnchecked})]});return(0,je.jsx)(a.FormattedMessage,{...le.hW({propertyName:(0,je.jsx)("span",{style:o.propertyName,children:r}),propertyValue:(0,je.jsx)(se.Z,{format:w.l.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:s})})})}({propertySchema:s,styles:c,value:l}),u=Ve({propertySchema:s,value:l}),p=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,icon:B.r,onClick:o,onDelete:i,onEdit:r,title:(0,je.jsx)("div",{style:c.content,children:d})})),[t,o,i,r,c.content,d]);return(0,je.jsx)(Pe,{renderOrigin:p,title:u,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function Ve(e){const{propertySchema:t,value:o}=e,n=!0===(0,j.A6)(null==o?void 0:o.value)[0]?(0,je.jsx)(a.FormattedMessage,{...le.Bo.actionCheckboxPropertyChecked}):(0,je.jsx)(a.FormattedMessage,{...le.Bo.actionCheckboxPropertyUnchecked});return(0,je.jsx)(a.FormattedMessage,{...le.hW({propertyName:t.name,propertyValue:n})})}var Fe=o(7057),Be=o(78106),Ie=o(42875),Ze=o(70203),De=o(21396),Ke=o(75311),Re=o(11335),Ne=o(33929),Oe=o(68910);function Ee(e){const{automationStore:t,collectionStore:o}=e;return(0,m.VK)((()=>{if(!o||!t)return;const e=o.getSpaceShardedPointer();return new Oe.L({automationStore:t,parentPointer:e,type:"event",persisted:!0,intl:Ne.default.getIntl(),parentRecordStore:o})}),[o,t])}function Le(e){window.__c={n:"UpdateDatePropertyAction"};const{automationStore:t,collectionStore:o,disabled:i,onClick:r,onDelete:s,onEdit:l,propertySchema:c,value:d,valueContext:u}=e,p=(0,a.useIntl)(),g=(0,y.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]),h=Ee({automationStore:t,collectionStore:o}),S=(0,m.VK)((()=>h?function(e){const{automationContextStore:t,intl:o,propertySchema:n,styles:i,value:r,valueContext:s}=e,l=(0,je.jsx)("span",{style:i.propertyName,children:n.name});if(void 0===(null==r?void 0:r.value))return(0,je.jsx)(a.FormattedMessage,{...le.xf({propertyName:l})});let c;const d=Re.tk(t),u=(0,Ke._)(s),p=(0,j.A6)(null==r?void 0:r.value)[0];if("string"==typeof p||"boolean"==typeof p||(0,Ze.IWo)(p)||(0,Ze.STW)(p))return;if((0,Ze.wjk)(p)){const e=(0,Ze.vmO)(p).id,t=(0,Be.vx)(d,e);c=t?(0,je.jsx)(De.F,{value:t,format:w.l.Medium,isSingle:!1,shouldShrink:!0}):void 0}else if((0,Ze.fpG)(p)){const e=(0,Ze.zyO)(p);c=e?(0,Fe.OB)({value:e,date_format:u.dateFormat,time_format:u.timeFormat,userTimeZone:(0,Ie.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:e=>{let{endDate:t,endTime:o,startDate:n}=e;return(0,oe.$K)(o)?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ge,{value:n})," → ",(0,je.jsx)(Ge,{value:o})]}):(0,oe.$K)(t)?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ge,{value:n})," → ",(0,je.jsx)(Ge,{value:t})]}):(0,je.jsx)(Ge,{value:n})}}):null}else(0,oe.t1)(p);return void 0===c?void 0:(0,je.jsx)(a.FormattedMessage,{...le.zU({propertyName:l,propertyValue:c})})}({automationContextStore:h,intl:p,propertySchema:c,styles:g,value:d,valueContext:u}):void 0),[h,p,c,g,d,u]),f=(0,m.VK)((()=>h?We({automationContextStore:h,intl:p,propertySchema:c,value:d,valueContext:u}):void 0),[h,p,c,d,u]),x=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:i,icon:D.V,onClick:r,onDelete:s,onEdit:l,title:(0,je.jsx)("div",{style:g.content,children:S})})),[i,r,s,l,g.content,S]);return h&&S&&f?(0,je.jsx)(Pe,{renderOrigin:x,title:f,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left}):null}function We(e){const{automationContextStore:t,intl:o,propertySchema:n,value:i,valueContext:r}=e,s=n.name;if(void 0===(null==i?void 0:i.value))return(0,je.jsx)(a.FormattedMessage,{...le.xf({propertyName:s})});let l;const c=Re.tk(t),d=(0,Ke._)(r),u=(0,j.A6)(null==i?void 0:i.value)[0];if("string"!=typeof u&&"boolean"!=typeof u&&!(0,Ze.IWo)(u)&&!(0,Ze.STW)(u)){if((0,Ze.wjk)(u)){const e=(0,Ze.vmO)(u).id,t=(0,Be.vx)(c,e);l=t?(0,De.e)(t):void 0}else if((0,Ze.fpG)(u)){const e=(0,Ze.zyO)(u);l=e?(0,Fe.ZV)({value:e,date_format:d.dateFormat,time_format:d.timeFormat,userTimeZone:(0,Ie.r)(),allowRelativeDates:!0,intl:o,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,oe.t1)(u);return void 0===l?void 0:(0,je.jsx)(a.FormattedMessage,{...le.zU({propertyName:s,propertyValue:l})})}}function Ge(e){window.__c={n:"AutomationDateToken"};const{value:t}=e,o=(0,y.Fg)();return(0,je.jsx)(se.Z,{backgroundColor:o.accentColors.gray[75],format:w.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:{marginBlockEnd:4},value:t})}var He=o(72126),ze=o(22084),Ue=o(37867),$e=o(39068);function qe(e){window.__c={n:"AutomationAnyEditPropertyTrigger"};const{disabled:t,onDelete:o,onClick:i,propertySchema:r,onEdit:s}=e,l=(0,a.useIntl)(),c=(0,y.Fg)(),d=(0,y.yK)((()=>({propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold},wrap:{display:"inline-flex",width:"100%"}})),[]),u=(0,je.jsx)("span",{style:d.propertyName,children:r.name}),p=(0,le.$G)(l,{propertyName:u}),g=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,onClick:i,icon:e=>(0,je.jsx)($e.ZP,{size:16,theme:c,icon:r.icon,style:e,type:r.type}),title:(0,je.jsx)("span",{style:d.wrap,children:p}),onEdit:s,onDelete:o})),[t,i,o,s,r.icon,r.type,d.wrap,c,p]);return(0,je.jsx)(Pe,{renderOrigin:g,title:p,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}const Qe=5;function Ye(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;return"changes_to_any"===t.operator?(0,je.jsx)(qe,{disabled:r,propertySchema:o,onClick:n,onDelete:i,onEdit:n}):(0,je.jsx)(Xe,{...e,filter:t})}function Xe(e){window.__c={n:"ParametrizableStatusPropertyTriggerFilter"};const{filter:t,limit:o=Qe,propertySchema:i,onEdit:r,onDelete:s,disabled:l}=e,c=(0,a.useIntl)(),d=(0,y.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]);let u,p;if((0,v.vR)(t)){const e=i.name,n=(0,v.wB)(t),r=n.map((e=>"is_group"===e.type?e.value:void 0)).filter(oe.$K),a=n.map((e=>"is_option"===e.type?e.value:void 0)).filter(oe.$K),s=Je({intl:c,groupValues:r,limit:o,optionValues:a,propertySchema:i}),l=c.formatList(s,{style:"long",type:"disjunction"}),g=Je({intl:c,isText:!0,groupValues:r,limit:o,optionValues:a,propertySchema:i}),m=c.formatList(g,{style:"long",type:"disjunction"});u=(0,le.VO)(c,{propertyName:(0,je.jsx)("span",{style:d.propertyName,children:e}),propertyValues:et(l)}),p=(0,le.VO)(c,{propertyName:(0,je.jsx)("span",{style:d.propertyName,children:e}),propertyValues:et(m)})}const g=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:l,icon:q.T,title:(0,je.jsx)("div",{style:d.content,children:u}),onEdit:r,onDelete:s,onClick:r})),[l,s,r,d.content,u]);return u&&p?(0,je.jsx)(Pe,{renderOrigin:g,title:p,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left}):null}function Je(e){let{groupValues:t,intl:o,isText:n,limit:i,optionValues:r,propertySchema:a,tokenFormat:s=w.l.Medium}=e;const l=a.groups||[],c=a.options||[],d=t.map((e=>{const t=l.find((t=>t.name===e));if(t)return n?t.name:(0,je.jsx)("span",{children:t.name},t.id)})).filter(oe.$K),u=r.map((e=>{const t=(0,b.i7)(c,e);if(void 0===t)return n?(0,le.ST)(o):(0,je.jsx)(Ue.Z,{tokenFormat:s},`missing_option_value_${e}`);if(n)return t.value;const i=l.find((e=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return(0,je.jsx)(ze.F,{format:s,isSingle:!0,value:t.value,color:t.color,groupColor:null==i?void 0:i.color,showRemoveButton:!1,showEllipsis:!0},t.id)})),p=[...d,...u];let g=[];if(void 0!==i&&p.length>i){const e=u.length-i,t=n?`+${e}`:(0,je.jsx)(se.Z,{format:w.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");g=[...u.slice(0,i),t]}else g=p;return g}function et(e){if(!Array.isArray(e))return[e];const t=[];for(const o of e)if("string"==typeof o&&" "!==o[0]){const e=t.pop();t.push((0,je.jsxs)("div",{children:[e,o]}))}else t.push(o);return t}function tt(e){window.__c={n:"UpdateSelectPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:s,value:l}=e,c=(0,a.useIntl)(),d=(0,y.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]),u=null!=l&&l.value?(0,j.A6)(null==l?void 0:l.value)[0]:void 0,p=le.oJ({propertySchema:s,optionValues:(0,He.HD)(u)?[u]:[]}),g=(0,m.VK)((()=>ot({intl:c,propertySchema:s,styles:d,values:p})),[c,p,s,d]),h=(0,m.VK)((()=>nt({intl:c,propertySchema:s,values:p})),[c,p,s]),S=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,icon:$.w,onClick:o,onDelete:i,onEdit:r,title:(0,je.jsx)("div",{style:d.content,children:g})})),[t,o,i,r,d.content,g]);return(0,je.jsx)(Pe,{renderOrigin:S,title:h,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function ot(e){const{intl:t,propertySchema:o,styles:n,tokenFormat:i,values:r}=e,s=i??w.l.Medium,l=(0,je.jsx)("span",{style:n.propertyName,children:o.name}),c=r.map((e=>"deleted"===e.type?(0,je.jsx)(Ue.Z,{tokenFormat:s},`missing_option_value_${e.value}`):"option"===e.type?(0,je.jsx)(ze.a,{color:e.value.color,format:s,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,je.jsx)(se.Z,{format:s,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,oe.t1)(e)));return 0===c.length?(0,je.jsx)(a.FormattedMessage,{...le.Mw({propertyName:l})}):1===c.length?(0,je.jsx)(a.FormattedMessage,{...le.rf({propertyName:l,propertyValue:c[0]})}):(0,je.jsx)(a.FormattedMessage,{...le.Sj({propertyName:l,propertyValue:et(t.formatList(c,{style:"long",type:"conjunction"}))})})}function nt(e){const{intl:t,propertySchema:o,values:n}=e,i=o.name,r=n.map((e=>"deleted"===e.type?le.ST(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,oe.t1)(e)));return 0===r.length?(0,je.jsx)(a.FormattedMessage,{...le.Mw({propertyName:i})}):1===r.length?(0,je.jsx)(a.FormattedMessage,{...le.rf({propertyName:i,propertyValue:r[0]})}):(0,je.jsx)(a.FormattedMessage,{...le.Sj({propertyName:i,propertyValue:et(t.formatList(r,{style:"long",type:"conjunction"}))})})}const it=5;function rt(e){window.__c={n:"UpdateMultiSelectPropertyAction"};const{disabled:t,limit:o=it,onClick:i,onDelete:r,onEdit:s,propertySchema:l,value:c}=e,d=(0,a.useIntl)(),u=null!=c&&c.value?(0,j.A6)(null==c?void 0:c.value):[],p=le.oJ({limit:o,optionValues:u.map((e=>"string"==typeof e?e:void 0)).filter(oe.$K),propertySchema:l}),g=(0,y.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:p.length<=1?"nowrap":"wrap",whiteSpace:"pre"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[p.length]),h=(0,m.VK)((()=>ot({intl:d,propertySchema:l,styles:g,values:p})),[d,p,l,g]),S=(0,m.VK)((()=>nt({intl:d,propertySchema:l,values:p})),[d,p,l]),f=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,icon:L.A,onClick:i,onDelete:r,onEdit:s,title:(0,je.jsx)("div",{style:g.content,children:h})})),[t,i,r,s,g.content,h]);return(0,je.jsx)(Pe,{renderOrigin:f,title:S,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}var at=o(92864);function st(e){window.__c={n:"UpdatePersonPropertyAction"};const{collectionStore:t,disabled:o,onClick:i,onDelete:r,onEdit:s,propertySchema:l,value:c}=e,d=(0,a.useIntl)(),u=(0,m.VK)((()=>lt({getRecordModel:t.getRecordModel,propertySchema:l,value:c})),[t.getRecordModel,l,c]),p=(0,y.yK)((()=>({content:{alignItems:"center",display:"flex",flexWrap:u.length>1?"wrap":"nowrap",whiteSpace:"pre"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold},propertyValue:{...ne.Z.textOverflowStyle,paddingBlockStart:4},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:4}})),[u.length]),g=(0,m.VK)((()=>function(e){const{actors:t,propertySchema:o,styles:n}=e,i=(0,je.jsx)("span",{style:n.propertyName,children:o.name}),r=function(e){const{actors:t,styles:o}=e;return 1===t.length?(0,je.jsx)("div",{style:o.propertyValue,children:(0,je.jsx)(at.ZP,{actor:t[0],showRemoveButton:!1,format:at.ZP.Format.Medium,isSingle:!1})}):(0,je.jsx)("ul",{style:o.propertyValueList,children:t.map(((e,t)=>(0,je.jsx)("li",{children:(0,je.jsx)("div",{style:o.propertyValue,children:(0,je.jsx)(at.ZP,{actor:e,showRemoveButton:!1,format:at.ZP.Format.Medium,isSingle:!1})},t)},t)))})}({actors:t,styles:n});let s;s=0===t.length?le.ht({propertyName:i}):1===t.length?le.wE({propertyName:i,propertyValue:r}):le.Oq({propertyName:i,propertyValue:r});return(0,je.jsx)(a.FormattedMessage,{...s})}({actors:u,propertySchema:l,styles:p})),[u,l,p]),h=(0,m.VK)((()=>ct({actors:u,intl:d,propertySchema:l})),[u,d,l]),S=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:o,icon:G.O,onClick:i,onDelete:r,onEdit:s,title:(0,je.jsx)("div",{style:p.content,children:g})})),[o,i,r,s,p.content,g]);return(0,je.jsx)(Pe,{renderOrigin:S,title:h,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function lt(e){const{getRecordModel:t,propertySchema:o,value:n}=e;return(0,b.DW)({textValue:null==n?void 0:n.value,propertySchema:o}).map((e=>(0,h.Hl)({getRecordModel:t,pointer:e}))).filter(oe.$K)}function ct(e){const{actors:t,intl:o,propertySchema:n}=e,i=t.map((e=>(0,h.$4)(o,e))),r=n.name,s=o.formatList(i,{style:"long",type:"conjunction"});let l;return l=0===t.length?le.ht({propertyName:r}):1===t.length?le.wE({propertyName:r,propertyValue:s}):le.Oq({propertyName:r,propertyValue:s}),(0,je.jsx)(a.FormattedMessage,{...l})}var dt=o(21202),ut=o(10009),pt=o(37034),gt=o(90106);function mt(e){window.__c={n:"UpdateRelationPropertyAction"};const{automationStore:t,collectionStore:o,disabled:i,onClick:r,onDelete:s,onEdit:l,propertySchema:c,value:d}=e,u=(0,g.O7)(),p=(0,a.useIntl)(),h=Ee({automationStore:t,collectionStore:o}),S=(0,m.VK)((()=>(null==h?void 0:h.getAllContextValues())??[]),[h]),f=(0,y.yK)((()=>({content:{alignItems:"center",display:"flex",flex:"1 1 auto",minWidth:0,whiteSpace:"pre"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold,minWidth:20},propertyValue:{...ne.Z.textOverflowStyle,minWidth:40},propertyValueList:{display:"flex",flexBasis:"100%",flexDirection:"column",listStyle:"none",margin:0,marginBlockStart:10,padding:0,rowGap:10},propertyValueListItem:{display:"flex"}})),[]),x=(0,m.VK)((()=>function(e){const{automationContextValues:t,collectionStore:o,propertySchema:n,styles:i,value:r}=e,s=r?St({automationContextValues:t,limit:n.limit,value:r}):[],l=(0,je.jsx)("span",{style:i.propertyName,children:n.name});let c;c=0===s.length?(0,je.jsx)("div",{style:i.content,children:(0,je.jsx)(a.FormattedMessage,{...le.Iu({propertyName:l})})}):1===s.length?(0,je.jsx)("div",{style:i.content,children:(0,je.jsx)(a.FormattedMessage,{...le.S0({propertyName:l,propertyValue:(0,je.jsx)("span",{style:i.propertyValue,children:(0,je.jsx)(yt,{collectionStore:o,value:s[0]})})})})}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:i.content,children:(0,je.jsx)(a.FormattedMessage,{...le.om({propertyName:l,propertyValue:[]})})}),(0,je.jsx)("ul",{style:i.propertyValueList,children:s.map(((e,t)=>(0,je.jsx)("li",{style:i.propertyValueListItem,children:(0,je.jsx)(yt,{collectionStore:o,value:e})},t)))})]});return c}({automationContextValues:S,collectionStore:o,propertySchema:c,styles:f,value:d})),[S,o,c,f,d]),v=(0,m.VK)((()=>ht({automationContextValues:S,collectionStore:o,environment:u,intl:p,propertySchema:c,value:d})),[S,o,u,p,c,d]),C=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:i,icon:z.v,onClick:r,onDelete:s,onEdit:l,title:x})),[i,r,s,l,x]);return(0,je.jsx)(Pe,{renderOrigin:C,title:v,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function yt(e){const{collectionStore:t,value:o}=e;return"string"==typeof o?(0,je.jsx)(ut.Z,{blockId:o,format:w.l.Medium,isSingle:!0,noUnderline:!0,parentStore:t,shouldShrink:!0}):(0,je.jsx)(De.F,{format:w.l.Medium,isSingle:!0,shouldShrink:!0,value:o})}function ht(e){const{automationContextValues:t,collectionStore:o,environment:n,intl:i,propertySchema:r,value:s}=e,l=(s?St({automationContextValues:t,limit:r.limit,value:s}):[]).map((e=>{if("string"==typeof e){const t=gt.G.createChildStore(o,{id:e,table:dt.iU});return(0,pt.vU)({environment:n,intl:i,store:t})}return(0,De.e)(e)})).filter(oe.$K),c=r.name;let d;return d=0===l.length?le.Iu({propertyName:c}):1===l.length?le.S0({propertyName:c,propertyValue:l[0]}):le.om({propertyName:c,propertyValue:i.formatList(l,{style:"long",type:"conjunction"})}),(0,je.jsx)(a.FormattedMessage,{...d})}function St(e){const{automationContextValues:t,limit:o,value:n}=e;return(0,j.A6)(n.value).slice(0,o).map((e=>{if("string"!=typeof e&&"boolean"!=typeof e){if((0,Ze.wjk)(e)){const o=(0,Ze.vmO)(e).id,n=(0,Be.vx)(t,o);if(!n)return;return n}if((0,Ze.STW)(e)){const t=(0,Ze.TOT)(e);if(!t)return;return t}}})).filter(oe.$K)}function ft(e){window.__c={n:"UpdateStatusPropertyAction"};const{disabled:t,onClick:o,onDelete:i,onEdit:r,propertySchema:s,value:l}=e,c=(0,a.useIntl)(),d=(0,j.A6)(null==l?void 0:l.value)[0],u=(0,y.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"nowrap",whiteSpace:"pre"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]),p=(0,m.VK)((()=>function(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i||"string"!=typeof i)return;const r=(0,je.jsx)("span",{style:n.propertyName,children:o.name}),s=Je({intl:t,groupValues:[],optionValues:[i],propertySchema:o});if(0===s.length)return;return(0,je.jsx)(a.FormattedMessage,{...(0,le.Ig)({propertyName:r,propertyValue:s})})}({intl:c,propertySchema:s,styles:u,value:d})),[c,s,d,u]),g=(0,m.VK)((()=>xt({intl:c,propertySchema:s,value:d})),[c,s,d]),h=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,icon:q.T,onClick:o,onDelete:i,onEdit:r,title:(0,je.jsx)("div",{style:u.content,children:p})})),[t,o,i,r,u.content,p]);return p&&g?(0,je.jsx)(Pe,{renderOrigin:h,title:g,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left}):null}function xt(e){const{intl:t,propertySchema:o,value:n}=e;if(!n||"string"!=typeof n)return;const i=o.name,r=Je({intl:t,isText:!0,groupValues:[],optionValues:[n],propertySchema:o});return 0!==r.length?(0,je.jsx)(a.FormattedMessage,{...(0,le.Ig)({propertyName:i,propertyValue:r})}):void 0}var vt=o(23867),Ct=o(60682),bt=o(14976);function wt(e){window.__c={n:"UpdateBaseTextPropertyAction"};const{automationStore:t,disabled:o,icon:i,onClick:r,onDelete:s,onEdit:l,propertySchema:c,value:d}=e,u=(0,g.O7)(),p=(0,y.Fg)(),h=(0,y.yK)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]),S=(0,m.VK)((()=>function(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:r,value:s}=e,l=void 0===(null==s?void 0:s.value),c=null!=s&&s.value?(0,bt.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,emojiType:(0,Ct.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==s?void 0:s.value,spaceId:(0,vt.C)(t.pointer.spaceId)},theme:r}):null,d=(0,je.jsx)("span",{style:i.propertyName,children:n.name}),u=(0,je.jsx)(se.Z,{format:w.l.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,je.jsx)("span",{style:ne.Z.textOverflowStyle,children:c})}),p=l?le.NZ({propertyName:d}):le.vE({propertyName:d,propertyValue:u});return(0,je.jsx)(a.FormattedMessage,{...p})}({automationStore:t,environment:u,propertySchema:c,styles:h,theme:p,value:d})),[t,u,c,h,p,d]),f=(0,m.VK)((()=>jt({automationStore:t,environment:u,propertySchema:c,theme:p,value:d})),[t,u,c,p,d]),x=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:o,icon:i,onClick:r,onDelete:s,onEdit:l,title:(0,je.jsx)("div",{style:h.content,children:S})})),[o,i,r,s,l,h.content,S]);return S&&f?(0,je.jsx)(Pe,{renderOrigin:x,title:f,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left}):null}function jt(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,value:r}=e,s=void 0===(null==r?void 0:r.value),l=null!=r&&r.value?(0,bt.IY)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,emojiType:(0,Ct.e_)(o),environment:o,formulaValueTypes:[],katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:null==r?void 0:r.value,spaceId:(0,vt.C)(t.pointer.spaceId)},theme:i}):null,c=n.name,d=l,u=s?le.NZ({propertyName:c}):le.vE({propertyName:c,propertyValue:d});return(0,je.jsx)(a.FormattedMessage,{...u})}function Mt(e){return(0,je.jsx)(wt,{...e,icon:Y.c})}function _t(e){return(0,je.jsx)(wt,{...e,icon:Q.p})}function Tt(e){return(0,je.jsx)(wt,{...e,icon:K.n})}function kt(e){return(0,je.jsx)(wt,{...e,icon:J.O})}function Pt(e){return(0,je.jsx)(wt,{...e,icon:W.J})}function At(e){return(0,je.jsx)(wt,{...e,icon:H.u})}var Vt=o(90199),Ft=o(54497),Bt=o(67669),It=o(30874),Zt=o(35294),Dt=o(49085);class Kt extends Dt.default{getInitialState(){return{stack:[]}}getCurrentTab(){return He.Z$(this.getState().stack)}pushSettingsItem(e){this.update((t=>({...t,stack:[...t.stack,e]})))}popSettingsItem(){this.update((e=>({stack:e.stack.slice(0,e.stack.length-1)})))}replaceSettingsItem(e){this.update((t=>{const o=[...t.stack.slice(0,t.stack.length-1),e];return{...t,stack:o}}))}}class Rt extends Kt{}class Nt extends Kt{}var Ot=o(8406),Et=o(71846),Lt=o(87279),Wt=o(80721),Gt=o(12392),Ht=o(40721),zt=o(89728);const Ut=(0,a.defineMessages)({backButtonAriaLabel:{id:"notificationRuleSettingsMenu.backButton.ariaLabel",defaultMessage:"Back to previous step"}});function $t(e){window.__c={n:"AutomationTriggerActionMenu"};const{type:t,automationTriggerActionMenuStore:o,headerTitle:n,onClose:i,width:r,onDone:a}=e,s=Xt({automationTriggerActionMenuStore:o,onClose:i,onDone:a,title:n,width:r});return"custom"===t?(0,je.jsx)(Qt,{...e,menuProps:s}):(0,je.jsx)(qt,{...e,menuProps:s})}function qt(e){const{sections:t,menuProps:o}=e;return(0,je.jsx)(fe.Z,{...o,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:0,sections:t})})}function Qt(e){const{children:t,menuProps:o}=e;return(0,je.jsx)(fe.Z,{...o,children:t})}function Yt(e){window.__c={n:"BackToPreviousStepButton"};const{automationActionMenuStore:t,menuHeaderTitle:o,onDone:n}=e,i=(0,a.useIntl)(),r=(0,m.VK)((()=>t.state.stack.length>1),[t]),s=(0,y.yK)((e=>({header:{display:"flex",alignItems:"center",margin:8,color:e.mediumTextColor,fontWeight:ne.Z.fontWeight.medium,fontSize:ne.Z.fontSize.UISmall.desktop},iconButtonStyle:{marginRight:8,marginLeft:-2,height:22},iconButtonIconStyle:{width:16,height:16},doneButtonStyle:{marginLeft:"auto"}})),[]);return void 0!==o||r?(0,je.jsxs)("div",{style:s.header,children:[r&&(0,je.jsx)(Se.Z,{ariaLabel:i.formatMessage(Ut.backButtonAriaLabel),icon:Wt.W,style:s.iconButtonStyle,iconStyle:s.iconButtonIconStyle,onClick:()=>{t.popSettingsItem()}}),o,n&&(0,je.jsx)(zt.Z,{onClick:n,isBlue:!0,style:s.doneButtonStyle,children:(0,je.jsx)(a.FormattedMessage,{id:"automationTriggerActionMenu.doneButton.title",defaultMessage:"Done"})})]}):null}function Xt(e){const{automationTriggerActionMenuStore:t,leftStyle:o,onClose:i,onDone:r,rightStyle:s,title:l,titleStyle:c,width:d}=e,{isMobile:u}=(0,g.Fy)(),p=(0,a.useIntl)(),m=(0,n.useCallback)((()=>{1===t.getState().stack.length?i():t.popSettingsItem()}),[t,i]);return(0,n.useMemo)((()=>{let e;return e=u?{leftOuterStyle:o,menuType:Lt.og.Modal,title:l,titleOuterStyle:c,left:(0,je.jsx)(Se.Z,{ariaLabel:p.formatMessage(Ut.backButtonAriaLabel),icon:Gt.S,onClick:m}),right:(0,je.jsx)(Ht.DoneMenuText,{}),rightOuterStyle:s,onClickRight:()=>{null==r||r(),i()}}:{width:d??266,menuType:Lt.og.Popup,maxHeight:"50vh",header:(0,je.jsx)(Yt,{automationActionMenuStore:t,menuHeaderTitle:l,onDone:r})},e}),[t,p,u,o,i,r,m,s,l,c,d])}function Jt(e){window.__c={n:"AutomationEventActionCreatePage"};const{automationActionMenuStore:t,automationStore:o,collectionStore:i,onClose:s,updateCurrentState:l}=e,c=(0,r.ZP)(),d=(0,g.O7)(),u=Xt({automationTriggerActionMenuStore:t,leftStyle:{flexGrow:0},onClose:s,rightStyle:{flexGrow:0},title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Add page to…",id:"automationEventActionCreatePage.menu.title"})}),p=(0,n.useCallback)((()=>{Ot.tW({environment:d,eventName:"abandoned_search",sessionId:c,source:Et.S.Automation})}),[d,c]);u.menuType===Lt.og.Popup&&(u.onClickOutside=p);const m=Ee({automationStore:o,collectionStore:i}),y=(0,n.useCallback)((e=>{l({action:{id:(0,r.ZP)(),config:{collection:{...e.pointer,spaceId:(0,vt.C)(e.pointer.spaceId)},properties:["title"],values:{}},type:"create_page"},type:"update_action"}),s()}),[s,l]);return m?(0,je.jsx)(fe.Z,{...u,children:(0,je.jsx)(Et.Z,{context:Et.S.Automation,onAccept:y,parentStore:m.context.parentRecordStore,requireEditPermissions:!0,searchSessionId:c})}):null}var eo=o(9999),to=o(5257),oo=o(1865),no=o(68894),io=o(82343),ro=o(52821),ao=o(35057);const so=(0,a.defineMessages)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search for action…"}});function lo(e){window.__c={n:"AutomationEventActionMenu"};const{availableActions:t,automationActionMenuStore:o,automationStore:i,collectionStore:r,updateCurrentState:s,onClose:l}=e,c=(0,y.Fg)(),d=(0,a.useIntl)(),{isMobile:u}=(0,g.Fy)(),h=(0,g.O7)(),[S,x]=n.useState(""),v=(0,m.VK)((()=>r.getSchema()),[r]),C=(0,Re.j_)(),b=(0,m.VK)((()=>function(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),r=o.getFormat(),a=o.getSchema(),s=(0,f.cO)({collectionFormat:r,collectionSchema:a,filter:e=>{let[t]=e;return!i.has(t)}}),l=new Map,c=s.map((e=>{const t=a[e];if(t){const o=`${t.name} ${ro.SO[t.type]}`;return l.set(e,o),o}})).filter(oe.$K),d=new Set(p().filter(n,c).map((e=>{let{original:t}=e;return t})));return s.filter((e=>{const t=l.get(e);return t&&d.has(t)}))}({automationStore:i,collectionStore:r,searchInput:S})),[i,r,S]),w=(0,m.VK)((()=>function(e){const{availableActions:t,searchInput:o}=e;if(0===t.length)return[];const n=new Map,i=t.map((e=>{const t=Ne.default.formatMessage(e.display.name);return n.set(e.type,t),t})),r=new Set(p().filter(o,i).map((e=>{let{original:t}=e;return t})));return t.filter((e=>{const t=n.get(e.type);return t&&r.has(t)}))}({availableActions:t,searchInput:S})),[t,S]),j=(0,io.Rr)({environment:h}),M=(0,m.VK)((()=>!(0,ao.sX)()),[]),_=0===t.length&&M,k=(0,n.useCallback)((()=>{l(),oo.y(h,{for:"plus",from:"database_automation_action_item"})}),[h,l]),P=w.length>0?function(e){const{automationActionMenuStore:t,actions:o,initialSlackActionSelectMenuState:n,showTopBorder:i,theme:r}=e,s=o.map((e=>function(e){const{automationActionMenuStore:t,action:o,initialSlackActionSelectMenuState:n,theme:i}=e;if("slack_notification"===o.type)return{key:"slack_action",action:()=>{t.pushSettingsItem(n)},render:e=>(0,je.jsx)(ye.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginLeft:2,marginRight:8,width:12,height:"auto"}),right:(0,to.o)({marginInlineStart:6,width:12,height:"auto"}),title:(0,je.jsx)(a.FormattedMessage,{...o.display.name})})};if("create_page"===o.type)return{key:"create_page",action:()=>{t.pushSettingsItem({actionId:void 0,type:"eventActionCreatePage"})},render:e=>(0,je.jsx)(ye.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,to.o)({marginInlineStart:6,width:12}),title:(0,je.jsx)(a.FormattedMessage,{...o.display.name})})};if("update_pages"===o.type)return{key:"update_pages",action:()=>{t.pushSettingsItem({actionId:void 0,automationId:"",type:"eventActionUpdatePages"})},render:e=>(0,je.jsx)(ye.Z,{...e,icon:o.display.icon({fill:i.regularIconColor,marginInline:"2px 8px",width:14}),right:(0,to.o)({marginInlineStart:6,width:12}),title:(0,je.jsx)(a.FormattedMessage,{...o.display.name})})}}({automationActionMenuStore:t,action:e,initialSlackActionSelectMenuState:n,theme:r}))).filter(oe.$K);if(0===s.length)return;return{key:"other_actions_section",items:s,render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:i})}}({automationActionMenuStore:o,actions:w,initialSlackActionSelectMenuState:C,theme:c}):void 0,A=b.length>0&&!M?function(e){const{automationActionMenuStore:t,properties:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:s,showTopBorder:l}=e,c=o.map((e=>function(e){const{automationActionMenuStore:t,propertyId:o,collectionSchema:n,theme:i}=e,r=n[o];if(!r)return;return{key:o,action:()=>{t.pushSettingsItem({propertyId:o,actionId:void 0,type:"eventActionProperty"})},render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,je.jsx)($e.ZP,{icon:r.icon,size:16,style:{fill:i.regularIconColor,marginRight:6},theme:i,type:r.type}),right:(0,to.o)({marginInlineStart:6,width:12,height:"auto"}),title:r.name})}}({propertyId:e,collectionSchema:n,theme:i,updateCurrentState:r,automationActionMenuStore:t,onClose:s}))).filter(oe.$K);if(0===c.length)return;return{key:"page_properties_edited_section",items:c,render:e=>(0,je.jsx)(Ce.Z,{...e,title:(0,je.jsx)(a.FormattedMessage,{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}),topBorder:l})}}({automationActionMenuStore:o,properties:b,collectionSchema:v,showTopBorder:(0,oe.$K)(P),theme:c,updateCurrentState:s,onClose:l}):void 0,V=M&&j?function(e){const{onUpsellClick:t,showTopBorder:o,theme:n}=e;return{key:"upsell_section",items:[{action:()=>t(),key:"upsell_item",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,je.jsx)("div",{style:{background:n.accentColors.yellow[50],borderRadius:3,height:20,padding:3,width:20},children:(0,T.K)({fill:n.icon.yellow,height:"100%",width:"100%"})}),right:(0,eo.J)({height:"auto",marginBlockStart:2,width:12}),rightStyle:{alignSelf:"start"},caption:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Automatically set properties, create new pages, and more with automations.",id:"automationEventActionMenu.upsellSection.caption"}),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Upgrade for more actions",id:"automationEventActionMenu.upsellSection.title"}),shouldWrapCaption:!0})}],render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:o})}}({onUpsellClick:k,showTopBorder:!_,theme:c}):void 0,F=[P,A].filter(oe.$K),B={key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,je.jsx)(ye.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e})},I=(_?[V]:0===F.length?[B,V]:[...F,V]).filter(oe.$K),Z=(0,we.F)({width:266,paddingBottom:2});return Z.header=_?void 0:(0,je.jsx)(no.ZP,{onChange:e=>{x(e.target.value)},placeholder:d.formatMessage(so.searchInputPlaceholder),style:{marginBlock:"12px 2px"},value:S}),u||(Z.maxHeight="50vh"),(0,je.jsx)(fe.Z,{...Z,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:I,initialFocus:0})})}var co=o(10450),uo=o(30823),po=o(6287),go=o(53498),mo=o(32984);const yo=(0,a.defineMessages)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"}});function ho(e){var t;window.__c={n:"AutomationEventActionProperty"};const{actionId:o,automationActionMenuStore:i,automationStore:s,collectionStore:l,onClose:c,propertyId:d,updateCurrentState:u}=e,p=(0,a.useIntl)(),g=Ee({automationStore:s,collectionStore:l}),y=o??(0,r.ZP)(),h=(0,m.VK)((()=>l.getSchema()[d]),[l,d]),S=(0,n.useMemo)((()=>!!h&&("multi_select"===h.type||(0,C.en)(h)&&1!==h.limit)),[h]),f=Boolean(h&&"button"!==h.type&&"rollup"!==h.type&&"formula"!==h.type&&"text"===(0,uo.vc)(h.type)),x=Boolean(h&&"button"!==h.type&&"rollup"!==h.type&&"formula"!==h.type&&"number"===(0,uo.vc)(h.type)),v=Boolean(h&&"date"===h.type),b=Boolean(h&&"status"===h.type),w=(0,m.VK)((()=>{if(h)return(0,j.qW)({table:po.v,id:l.id,spaceId:l.getSpaceId()},d,h)}),[l,h,d]),M=(0,m.VK)((()=>{const e=s.getActionStores();if(y&&e.length>0){const t=e.find((e=>e.id===y));if(t&&t.isType("update_pages"))return t.getConfigStore().getKeyStore("values").getKeyStore(d).getValue()}}),[s,y,d]),[_,T]=(0,n.useState)(M),k=(0,n.useRef)(null==M?void 0:M.value),P=(0,j.A6)(null==_||null===(t=_.value)||void 0===t?void 0:t.value),A=(0,m.VK)((()=>{if(!g)return[];return g.context.automationStore.getActionIds().some((e=>e===y))?g.getContextValuesForAction(y):g.getAllContextValues()}),[g,y]),V=(0,n.useCallback)((e=>{u({action:{id:y,config:{properties:[d],target:{id:(0,co.J0)(),type:"variable"},values:{[d]:{action:"replace",value:e}}},type:"update_pages"},type:"update_action"})}),[y,d,u]),F=(0,n.useCallback)((()=>{V(k.current),c()}),[V,c]),B=(0,n.useCallback)((e=>{if(k.current=e,f||x||S)T({action:"replace",value:e});else if(v){const t=(0,j.A6)(null==e?void 0:e.value);0===t.length?F():(0,j.S3)(t[0])&&(0,Ze.fpG)(t[0])&&T({action:"replace",value:e})}}),[v,f,x,S,F]),I=Xt({automationTriggerActionMenuStore:i,leftStyle:{flexGrow:0},onClose:F,onDone:S||f||x?F:void 0,rightStyle:{flexGrow:0},title:(0,je.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:p.formatMessage(yo.menuHeaderTitle,{propertyName:(0,je.jsx)("div",{style:{...ne.Z.textOverflowStyle},children:(null==h?void 0:h.name)??""})})}),titleStyle:{minWidth:0}});if(!h||!w||!g)return null;const Z={type:"collection",collectionStore:l,property:d},D=(0,mo.li)(h.type);return(0,je.jsx)(go.a,{context:Z,contextStore:g,currentSimpleFormulaValueTokens:P,disabled:!1,formulaTypecheckContextValues:A,menuProps:I,onChange:B,onClose:F,showClearButton:!b,type:w,value:null==_?void 0:_.value,...D})}var So=o(8808);function fo(e){window.__c={n:"AutomationEventActionUpdatePagesMenu"};const{actionId:t,automationActionMenuStore:o,automationStore:i,collectionStore:s,onClose:l,updateCurrentState:c}=e,d=(0,x.z)("update_pages"),u=Ee({automationStore:i,collectionStore:s}),p=Xt({automationTriggerActionMenuStore:o,leftStyle:{flexGrow:0},onClose:l,rightStyle:{flexGrow:0},title:(0,je.jsx)(a.FormattedMessage,{...d.display.name})}),g=(0,n.useCallback)((e=>{c({action:{id:(0,r.ZP)(),config:{properties:[],target:e,values:{}},type:"update_pages"},type:"update_action"}),l()}),[l,c]);return u?(0,je.jsx)(fe.Z,{...p,children:(0,je.jsx)(So.H,{actionId:t,automationContextStore:u,onChange:g,onClose:l,skipPages:!0})}):null}var xo=o(41892),vo=o(77657),Co=o(149),bo=o(32161),wo=o(42631),jo=o(42922),Mo=o(18441),_o=o(80444);function To(e){window.__c={n:"AutomationSlackConnectToSlackView"};const{type:t,automationActionMenuStore:o,onClose:n}=e,i=Fo(),r=(0,m.VK)((()=>{var e;return null===(e=_o.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),a=(0,m.VK)((()=>_o.default.state.currentUserStore),[]),s=(0,m.VK)((()=>{if("connectToSlackReconnect"===t&&a)return(0,gt.Kv)(a,{table:bo.P,id:e.externalBotId,spaceId:r}).getValue()}),[r,a,e,t]);let l,c=Vo({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!s)return null;const{accountName:e,organizationName:t}=(0,Mo.jg)(s);l=(0,Mo.jc)(s),c=Vo({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,je.jsx)($t,{type:"custom",automationTriggerActionMenuStore:o,onClose:n,children:(0,je.jsx)(Ce.Z,{children:(0,je.jsxs)("div",{style:i.container,children:[(0,je.jsx)(Po,{}),(0,je.jsxs)("div",{style:i.connectToSlackBody,children:[(0,je.jsx)("div",{style:i.connectToSlackTitleText,children:Ao(t)}),(0,je.jsx)("div",{style:i.connectToSlackDescriptionText,children:c})]}),(0,je.jsx)(ko,{...e,slackWorkspaceId:l})]})})})}function ko(e){window.__c={n:"AuthActionButtons"};const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,g.O7)(),i=Fo(),r=(0,m.VK)((()=>{var e;return null===(e=_o.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),s=(0,m.VK)((()=>It.Z.integrations.state.find((e=>e.id===vo.nO))),[]);return s&&r?(0,je.jsxs)("div",{style:i.buttonGroup,children:[(0,je.jsx)(jo.Z,{style:i.connectToSlackButton,isLarge:!0,onClick:async()=>{const i=await wo.hM({environment:n,integration:s,spaceId:r,from:"collection_view_settings",options:{slackWorkspaceId:o}});Co.x.isFail(i)?t.replaceSettingsItem({type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?i.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:i.value.externalAuthentication}):t.replaceSettingsItem({type:"selectWorkspace"}):(0,oe.t1)(e))},children:(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,je.jsx)(zt.Z,{style:i.cancelButton,isLarge:!0,onClick:()=>{t.popSettingsItem()},children:(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function Po(){window.__c={n:"SlackIcon"};const e=Fo();return(0,je.jsx)("div",{children:(0,je.jsx)("img",{src:xo.Z.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function Ao(e){return"connectToSlackDefault"===e?(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,oe.t1)(e)}function Vo(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,je.jsx)(a.FormattedMessage,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:'Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {"{organizationName}"} other {your Slack workspace}} to resume your notifications.',values:{accountName:e.accountName,hasOrganizationName:(0,oe.$K)(e.organizationName),organizationName:e.organizationName}}):void(0,oe.t1)(t)}function Fo(){return(0,y.yK)((e=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:ne.Z.fontWeight.semibold},connectToSlackDescriptionText:{fontSize:13,color:e.mediumTextColor},slackIcon:{width:23,height:"auto"},buttonGroup:{margin:"10px 10px 0px 10px"},connectToSlackButton:{width:"100%"},cancelButton:{color:e.mediumTextColor,width:"100%",justifyContent:"center",fontWeight:ne.Z.fontWeight.medium,fontSize:13,marginTop:8}})),[])}var Bo=o(42876);function Io(e){window.__c={n:"AutomationSlackSelectChannelView"};const{automationActionMenuStore:t,updateCurrentAutomationState:o,onClose:i}=e,s="selectChannelUpdate"===e.type?e.actionId:void 0,l=n.useCallback(((e,t)=>{o({type:"update_action",action:{id:s??(0,r.ZP)(),type:"slack_notification",config:{target:e,external_bot_id:t.parent_id}}}),i()}),[s,i,o]),c=(0,n.useCallback)((()=>{const e=t.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?t.popSettingsItem():t.replaceSettingsItem({type:"selectWorkspace"}))}),[t]);return(0,je.jsx)(Bo.ZP,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannel:"selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,oe.t1)(e),onClose:i,onNotificationChannelSelect:l,onNewSlackAccountAdded:c,renderMenu:e=>(0,je.jsx)($t,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}var Zo=o(93364);function Do(e){const{automationActionMenuStore:t,onClose:o}=e,i=n.useCallback((e=>{t.pushSettingsItem({type:"selectChannelNew",currentExternalAuthentication:e})}),[t]);return(0,je.jsx)(Zo.U,{onWorkspaceSelect:i,renderMenu:e=>(0,je.jsx)($t,{type:"default",automationTriggerActionMenuStore:t,headerTitle:(0,je.jsx)(a.FormattedMessage,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}function Ko(e){window.__c={n:"AutomationActionMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:r,buttonPopupParent:a}=e,s=(0,m.VK)((()=>{const e=new Nt;return e.setState({stack:[i]}),e}),[i]),l=(0,m.VK)((()=>s.getCurrentTab()),[s]),c=(0,n.useCallback)((()=>a.close()),[a]);if(!l)return null;if("connectToSlackDefault"===l.type)return(0,je.jsx)(To,{type:"connectToSlackDefault",automationActionMenuStore:s,onClose:c});if("connectToSlackReconnect"===l.type)return(0,je.jsx)(To,{type:"connectToSlackReconnect",externalBotId:l.externalBotId,notificationActionConfigStore:l.notificationActionConfigStore,automationActionMenuStore:s,onClose:c});if("selectWorkspace"===l.type)return(0,je.jsx)(Do,{automationActionMenuStore:s,onClose:c});if("selectChannelNew"===l.type)return(0,je.jsx)(Io,{type:"selectChannelNew",updateCurrentAutomationState:r,currentExternalAuthentication:l.currentExternalAuthentication,automationActionMenuStore:s,onClose:c});if("selectChannelUpdate"===l.type)return(0,je.jsx)(Io,{type:"selectChannelUpdate",updateCurrentAutomationState:r,actionId:l.actionId,currentExternalAuthentication:l.currentExternalAuthentication,currentNotificationChannel:l.currentNotificationChannel,automationActionMenuStore:s,onClose:c});if("eventActions"===l.type)return(0,je.jsx)(lo,{availableActions:l.availableActions,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:c,updateCurrentState:r});if("eventActionProperty"===l.type){const{propertyId:e,actionId:n}=l;return(0,je.jsx)(ho,{actionId:n,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:c,propertyId:e,updateCurrentState:r})}return"eventActionCreatePage"===l.type?(0,je.jsx)(Jt,{automationStore:t,automationActionMenuStore:s,collectionStore:o,onClose:c,updateCurrentState:r}):"eventActionUpdatePages"===l.type?(0,je.jsx)(fo,{actionId:l.actionId,automationActionMenuStore:s,automationStore:t,collectionStore:o,onClose:c,updateCurrentState:r}):(0,oe.t1)(l)}const Ro=(0,a.defineMessages)({slackNonOwnerPrivateChannel:{id:"slackNotificationAction.slackTargetPersonalChannel.displayName",defaultMessage:"Private channel"}});function No(e){window.__c={n:"SlackNotificationAction"};const{actionStore:t,automationStore:o,collectionStore:n,currentUserIsOwner:i,disabled:r,updateCurrentAutomationState:s}=e,l=(0,Zt.d)(),c=(0,m.VK)((()=>t.getConfig()),[t]),d=(0,m.VK)((()=>It.Z.completeSlackAuthentications.state.find((e=>(null==c?void 0:c.external_bot_id)===e.id))),[c]),u=(0,m.VK)((()=>"disabled_auth"===(null==o?void 0:o.getStatus())),[o]),p=(0,m.VK)((()=>c&&d&&c.target?o&&t&&c.external_bot_id&&u?{type:"connectToSlackReconnect",externalBotId:c.external_bot_id,notificationActionConfigStore:t}:{type:"selectChannelUpdate",actionId:t.id,currentExternalAuthentication:d,currentNotificationChannel:c.target}:{type:"connectToSlackDefault"}),[c,t,o,d,u]),g=Eo();return i?(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,popupType:l,render:e=>(0,je.jsx)(Ko,{automationStore:o,initialState:p,updateCurrentAutomationState:s,buttonPopupParent:e,collectionStore:n}),renderOrigin:e=>(0,je.jsx)(_e,{...e,disabled:r,onClick:()=>{e.onClick()},title:(0,je.jsx)(Oo,{actionStore:t,currentUserIsOwner:i}),icon:F.P,caption:u&&(0,je.jsxs)("div",{style:g.container,children:[(0,Ft.t)(g.warningIcon),(0,je.jsx)("div",{style:g.caption,children:(0,je.jsx)(a.FormattedMessage,{id:"SlackNotificationAction.caption.reconnectNeeded",defaultMessage:"Reconnect Slack to resume"})})]}),onEdit:()=>{e.onClick()},onDelete:()=>{s({type:"remove_action",action:{id:t.id,type:"slack_notification"}})}})}):(0,je.jsx)(_e,{disabled:!0,icon:F.P,title:(0,je.jsxs)("div",{style:g.container,children:[(0,je.jsx)("div",{style:{fontWeight:500,marginRight:4},children:(0,je.jsx)(a.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})}),(0,je.jsx)(Wo,{actionStore:t,isUserAutomationOwner:i})]})})}function Oo(e){window.__c={n:"SlackActionTitle"};const{actionStore:t,currentUserIsOwner:o}=e,n=Eo(),i=(0,m.VK)((()=>t.getConfig()),[t]);return i&&i.external_bot_id&&i.target?(0,je.jsxs)("div",{style:n.container,children:[(0,je.jsx)("div",{style:{fontWeight:500,marginRight:4},children:(0,je.jsx)(a.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotification",defaultMessage:"Notify"})}),(0,je.jsx)(Wo,{actionStore:t,isUserAutomationOwner:o})]}):(0,je.jsx)("div",{style:n.container,children:(0,je.jsx)(a.FormattedMessage,{id:"slackNotificationAction.actionTitle.slackNotificationPlaceholder",defaultMessage:"Send Slack notification to…"})})}function Eo(){return(0,y.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},caption:{fontSize:12,fontWeight:400,color:e.mediumTextColor},warningIcon:{width:12,height:"auto",color:e.accentColors.orange[400]}})),[])}function Lo(e){const{isMobile:t}=e,o=t?ne.Z.fontSize.UISmall.mobile:ne.Z.fontSize.UISmall.desktop;return(0,y.yK)((()=>({overflow:{...ne.Z.textOverflowStyle},container:{display:"inline-flex",alignItems:"baseline",gap:2},lockIcon:{width:o,height:"auto",alignSelf:"center"}})),[o])}function Wo(e){window.__c={n:"SlackChannelWithIcon"};const{actionStore:t,isUserAutomationOwner:o}=e,n=(0,g.O7)(),i=(0,m.VK)((()=>Boolean((0,Bt.IJ)(n,t))),[t,n]),r=(0,m.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]);return!r||i?(0,je.jsx)(Uo,{}):"public"===r.type?(0,je.jsx)(Go,{channelName:r.name}):"private"===r.type?(0,je.jsx)(Ho,{channelName:r.name,isUserAutomationOwner:o}):"me"===r.type?(0,je.jsx)(zo,{channelName:r.name,isUserAutomationOwner:o}):(0,oe.t1)(r.type)}function Go(e){window.__c={n:"PublicSlackChannel"};const{isMobile:t}=(0,g.Fy)(),o=Lo({isMobile:t});return(0,je.jsx)("span",{style:o.overflow,children:`#${e.channelName}`})}function Ho(e){window.__c={n:"PrivateSlackChannel"};const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:n}=(0,g.Fy)(),i=Lo({isMobile:n});return o?(0,je.jsxs)("span",{style:{...i.overflow,...i.container},children:[(0,Vt.b)(i.lockIcon),t]}):(0,je.jsx)(Uo,{})}function zo(e){window.__c={n:"MeSlackChannel"};const{channelName:t,isUserAutomationOwner:o}=e,{isMobile:n}=(0,g.Fy)(),i=Lo({isMobile:n});return o?(0,je.jsx)("span",{style:i.overflow,children:`@${t}`}):(0,je.jsx)(Uo,{})}function Uo(){window.__c={n:"NonOwnerPrivateChannel"};const e=(0,a.useIntl)(),{isMobile:t}=(0,g.Fy)(),o=Lo({isMobile:t}),n=e.formatMessage(Ro.slackNonOwnerPrivateChannel);return(0,je.jsxs)("span",{style:{...o.overflow,...o.container},children:[(0,Vt.b)(o.lockIcon),n]})}function $o(e){window.__c={n:"UnsupportedPropertyTriggerAction"};const{disabled:t,onClick:o,onDelete:i,propertySchema:r}=e,a=(0,y.Fg)(),s="light"===a.mode?50:200,l="light"===a.mode?700:900,c=(0,y.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]},title:{flexShrink:1,fontSize:12,fontWeight:ne.Z.fontWeight.medium},titleWrap:{display:"flex"}}}),[]),d=qo({propertySchema:r}),u=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,icon:e=>(0,Ft.t)({...e,...c.warning}),onClick:o,onDelete:i,title:(0,je.jsx)("div",{style:c.titleWrap,children:(0,je.jsx)(w.Z,{backgroundColor:a.accentColors.yellow[s],color:a.accentColors.yellow[l],format:w.l.Medium,isSingle:!0,shouldShrink:!0,style:c.title,theme:a,value:d})})})),[s,t,o,i,c.title,c.titleWrap,c.warning,l,a,d]);return(0,je.jsx)(Pe,{renderOrigin:u,title:d,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function qo(e){const{propertySchema:t}=e,o=ro.SO[t.type];return(0,je.jsx)(a.FormattedMessage,{id:"UnsupportedPropertyTriggerAction.unsupportedProperty.title",defaultMessage:"{propertyType} property not supported",values:{propertyType:o}})}function Qo(e){const{filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r}=e;if("changes_to_any"===t.operator)return(0,je.jsx)(qe,{disabled:r,propertySchema:o,onClick:n,onEdit:n,onDelete:i});{const e={filter:t,propertySchema:o,onEdit:n,onDelete:i,disabled:r};return(0,je.jsx)(Yo,{...e})}}function Yo(e){window.__c={n:"ParametrizableSelectPropertyTriggerFilter"};const{filter:t,propertySchema:o,onEdit:i,onDelete:r,disabled:s}=e,l=(0,a.useIntl)(),c=(0,y.yK)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:"24px"},propertyName:{...ne.Z.textOverflowStyle,fontWeight:ne.Z.fontWeight.semibold}})),[]);let d,u;if((0,v.vR)(t)){const e=t.value,n=o.name,i=(Array.isArray(e)?e:[e]).map((e=>e.value)).filter(oe.$K),r=Xo({intl:l,limit:5,optionValues:i,propertySchema:o}),a=l.formatList(r,{style:"long",type:"disjunction"}),s=Xo({intl:l,isText:!0,limit:5,optionValues:i,propertySchema:o}),p=l.formatList(s,{style:"long",type:"disjunction"});d=(0,le.XJ)(l,{propertyName:(0,je.jsx)("span",{style:c.propertyName,children:n}),propertyValues:et(a)}),u=(0,le.XJ)(l,{propertyName:(0,je.jsx)("span",{style:c.propertyName,children:n}),propertyValues:et(p)})}const p=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:s,icon:$e.wG[o.type],onClick:i,onDelete:r,onEdit:i,title:(0,je.jsx)("div",{style:c.content,children:d})})),[s,r,i,o.type,c.content,d]);return d&&u?(0,je.jsx)(Pe,{renderOrigin:p,title:u,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left}):null}function Xo(e){let{intl:t,isText:o,limit:n,optionValues:i,propertySchema:r,tokenFormat:a=w.l.Medium}=e;const s=r.options??[],l=i.map((e=>{const n=(0,b.i7)(s,e);return n?o?n.value:(0,je.jsx)(ze.a,{value:n.value,color:n.color,format:a,isSingle:!0,showRemoveButton:!1},n.id):o?(0,le.ST)(t):(0,je.jsx)(Ue.Z,{tokenFormat:a},`missing_option_value_${e}`)}));let c;if(void 0!==n&&l.length>n){const e=l.length-n,t=o?`+${e}`:(0,je.jsx)(se.Z,{format:w.l.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,value:`+${e}`},"More tokens");c=[...l.slice(0,n),t]}else c=l;return c}var Jo=o(13005),en=o(42917),tn=o(16354),on=o(62385),nn=o(63474),rn=o(98963),an=o(47307),sn=o(9953),ln=o(2553),cn=o(24215);const dn=(0,a.defineMessages)({automationDeleteConfirmationMessage:{id:"slackAutomations.remove.confirmation.message",defaultMessage:"Are you sure you want to delete {automationName}?"},automationDeleteAcceptLabel:{id:"slackAutomations.remove.confirmation.acceptLabel",defaultMessage:"Delete"}});async function un(e){const{intl:t,environment:o,collectionStore:n,existingAutomationStore:i,triggerType:r,onDelete:a}=e,l=i.getNameWithDefault(t);(await an.confirmUserActionV2({message:t.formatMessage(dn.automationDeleteConfirmationMessage,{automationName:l}),acceptLabel:t.formatMessage(dn.automationDeleteAcceptLabel)})).accept&&(!function(e){const{environment:t,triggerType:o,collectionStore:n,existingAutomationStore:i}=e;d.createAndCommit({environment:t,userAction:"collectionSettingsAutomationsActions.deleteAutomation",perform:e=>{const t=n.getFormatStore().getKeyStore("automation_ids"),o=gt.Mz.createChildStore(n,i.pointer);d.applyOperation({store:t,operation:{pointer:t.pointer,path:t.path,command:"listRemove",args:{id:o.id}},transaction:e}),sn.sW({store:o,data:{alive:!1},transaction:e})}});const r=(0,cn.mc)(t),a=yn({automationStore:i,collectionStore:n});S.uO(r,a),"notification_event"===o&&s.xim(t,{type:"granular",source:"collection_view_settings",collection_id:n.id})}({environment:o,triggerType:r,collectionStore:n,existingAutomationStore:i}),null==a||a())}function pn(e){const{automationStore:t,collectionStore:o,environment:n}=e;d.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.disableAutomation",perform:e=>{const n=gt.Mz.createChildStore(o,t.pointer);sn.sW({store:n,data:{status:"disabled"},transaction:e})}});const i=(0,cn.mc)(n),r=yn({automationStore:t,collectionStore:o});S.ai(i,r)}function gn(e){const{automationStore:t,collectionStore:o,environment:n}=e;d.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.enableAutomation",perform:e=>{const n=gt.Mz.createChildStore(o,t.pointer);sn.sW({store:n,data:{status:"active"},transaction:e})}});const i=(0,cn.mc)(n),r=yn({automationStore:t,collectionStore:o});S.Rt(i,r)}function mn(e){return 1===e.length&&e[0].isType("slack_notification")?"notification_event":"event"}function yn(e){const{automationStore:t,collectionStore:o}=e,n=o.getSchema(),i=t.getActionStores().map((e=>{return e.isType("slack_notification")?{type:"slack_notification"}:e.isType("update_pages")?{property_types:((null===(t=e.getConfig())||void 0===t?void 0:t.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(oe.$K),type:"update_pages"}:e.isType("create_page")?{property_types:((null===(o=e.getConfig())||void 0===o?void 0:o.properties)??[]).map((e=>{var t;return null===(t=n[e])||void 0===t?void 0:t.type})).filter(oe.$K),type:"create_page"}:void 0;var t,o})).filter(oe.$K),r=t.getTriggerStore().getValue(),a=[];if("event"===(null==r?void 0:r.type)||"notification_event"===(null==r?void 0:r.type)){const{pagesAdded:e,pagePropertiesEdited:t}=r.event;e&&a.push({type:"page"}),"any"===t.type?a.push({condition:"any",type:"property"}):"none"===t.type?a.push({condition:"none",type:"property"}):a.push({condition:"some",property_types:t.some.map((e=>{var t;return null===(t=n[e.property])||void 0===t?void 0:t.type})).filter(oe.$K),type:"property"})}let s;if(t.isTriggerType("event")||t.isTriggerType("notification_event")){const e=t.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();e&&"collection_view"===e.type&&(s=e.pointer.id)}return{automation_actions:i,automation_id:t.id,automation_triggers:a,collection_id:o.id,collection_view_id:s}}var hn=o(33907),Sn=o(45238);const fn=(0,Sn.I)("bolt",{svg:(0,je.jsx)("path",{d:"M4.629 21.418l8.877-11.416c.166-.205.254-.4.254-.625 0-.371-.293-.654-.703-.654H7.539l2.91-7.598C10.84.12 9.766-.428 9.131.412L.254 11.818c-.166.215-.254.41-.254.626 0 .38.293.663.703.663h5.518l-2.91 7.588c-.391 1.006.683 1.553 1.318.723zm.576-2.627l3.272-7.139H2.44l6.377-8.466-.273-.147-3.262 7.139h6.026l-6.377 8.467z"}),viewBox:"0 0 14 22"}),xn=(0,Sn.I)("boltSlash",{svg:(0,je.jsx)("path",{d:"M1.248 12.444c0 .38.293.663.703.663h5.517l-2.91 7.588c-.39 1.006.684 1.553 1.318.723l4.405-5.664-1.094-1.094-3.008 3.985.274.146 2.129-4.746-2.413-2.393H3.69l1.074-1.416-1.142-1.142-2.12 2.725c-.166.214-.253.41-.253.624zm4.716-6.368L7.058 7.17l3.008-3.984-.274-.147-2.128 4.746 2.392 2.393h2.5l-1.074 1.416 1.143 1.142 2.128-2.734c.166-.205.254-.4.254-.625 0-.371-.293-.654-.703-.654H8.787l2.91-7.598c.39-1.006-.684-1.553-1.319-.713zm8.995 12.735a.754.754 0 001.064 0 .754.754 0 000-1.065L1.287 3.01a.766.766 0 00-1.075 0 .773.773 0 000 1.064z"}),viewBox:"0 0 17 22"});var vn=o(88437);const Cn=(0,a.defineMessages)({automationSummaryCardMoreButtonAriaLabel:{defaultMessage:"More",id:"automations.AutomationSummaryCard.MoreActionsButton.ariaLabel"},automationSummaryCardMoreMenuEditTitle:{defaultMessage:"Edit",id:"automations.AutomationSummaryCard.MoreActionsMenu.Edit.title"},automationSummaryCardMoreMenuDuplicateTitle:{defaultMessage:"Duplicate",id:"automations.AutomationSummaryCard.MoreActionsMenu.Duplicate.title"},automationSummaryCardMoreMenuPauseTitle:{defaultMessage:"Pause",id:"automations.AutomationSummaryCard.MoreActionsMenu.Pause.title"},automationSummaryCardMoreMenuResumeTitle:{defaultMessage:"Resume",id:"automations.AutomationSummaryCard.MoreActionsMenu.Resume.title"},automationSummaryCardMoreMenuDeleteTitle:{defaultMessage:"Delete",id:"automations.AutomationSummaryCard.MoreActionsMenu.Delete.title"}});function bn(e){window.__c={n:"AutomationSummaryMoreActionsButton"};const{focused:t,style:o,onEdit:i,onDelete:r,onDuplicate:s,onDisable:l,onEnable:c}=e,d=(0,a.useIntl)(),u=(0,m.qz)(void 0,be.Z),p=(0,Zt.d)();(0,n.useEffect)((()=>{t||u.setState({open:!1})}),[t,u]);const g=(0,y.yK)((e=>({iconButton:{border:`1px solid ${e.regularDividerColor}`,height:26,width:26,...o},iconButtonIcon:{width:16}})),[o]);return(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(he.ZP,{stopClickPropagation:!0,popupType:p,alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,originGap:0,renderOrigin:e=>(0,je.jsx)(Se.Z,{ariaLabel:d.formatMessage(Cn.automationSummaryCardMoreButtonAriaLabel),icon:ue.o,iconStyle:g.iconButtonIcon,style:g.iconButton,hasBackground:!0,...e}),render:e=>(0,je.jsx)(wn,{onClose:()=>e.close(),onEdit:i,onDelete:r,onDuplicate:s,onDisable:l,onEnable:c}),buttonPopupStore:u})})}function wn(e){window.__c={n:"MoreActionsMenu"};const{onClose:t,onEdit:o,onDelete:n,onDuplicate:i,onDisable:r,onEnable:s}=e,l=(0,a.useIntl)(),c=(0,we.F)(),d=o?{action:()=>{t(),o()},key:"edit",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,A.R)({height:16,width:16}),title:l.formatMessage(Cn.automationSummaryCardMoreMenuEditTitle)})}:void 0,u=i?{action:()=>{t(),i()},key:"duplicate",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,vn.a)({height:16,width:16}),title:l.formatMessage(Cn.automationSummaryCardMoreMenuDuplicateTitle)})}:void 0,p=r?{action:()=>{t(),r()},key:"disable",render:e=>(0,je.jsx)(ye.Z,{...e,icon:xn({height:16,width:16}),title:l.formatMessage(Cn.automationSummaryCardMoreMenuPauseTitle)})}:void 0,g=s?{action:()=>{t(),s()},key:"enable",render:e=>(0,je.jsx)(ye.Z,{...e,icon:fn({height:16,width:16}),title:l.formatMessage(Cn.automationSummaryCardMoreMenuResumeTitle)})}:void 0,m=n?{action:()=>{t(),n()},key:"delete",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,pe.y)({height:16,width:16}),title:l.formatMessage(Cn.automationSummaryCardMoreMenuDeleteTitle)})}:void 0;return(0,je.jsx)(fe.Z,{...c,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:[{items:[d,u,p,g,m].filter(oe.$K),key:"items",render:e=>(0,je.jsx)(Ce.Z,{enableActionSheetTitle:!0,topBorder:!0,...e})}],initialFocus:0})})}var jn=o(75024);function Mn(e){window.__c={n:"AutomationSummaryCard"};const{actions:t,caption:o,focused:i,hasWarning:r,maxIcons:a,onBlur:s,onClick:l,onDelete:c,onDisable:d,onDuplicate:u,onEdit:p,onEnable:m,onFocus:h,onMouseDown:S,onMouseEnter:f,onMouseLeave:x,title:v,triggers:C}=e,{isMobile:b}=(0,g.Fy)(),w=(0,n.useRef)(null),[j,M]=(0,ce.Z)(),[_,T]=(0,de.Z)(),[k,P]=(0,n.useState)(!1),A=b||k||M||T,V=(0,y.yK)((e=>({wrap:{background:e.cardContentBackground,border:`1px solid ${e.regularDividerColor}`,borderRadius:8,display:"flex",flexDirection:"column",gap:15,padding:15,position:"relative"},moreButtonWrap:{display:A?"block":"none",position:"absolute",right:8,top:8},iconList:{display:"flex",flexWrap:"wrap",gap:5,listStyle:"none",margin:"0 30px 0 0",padding:0},body:{display:"flex",flexDirection:"column",gap:b?4:2},titleWrap:{...r?{alignItems:"center",display:"inline-flex",gap:4}:(0,jn.pd)(2),fontSize:b?16:14,fontWeight:ne.Z.fontWeight.medium,lineHeight:"130%"},title:{...r?ne.Z.textOverflowStyle:{}},warning:{color:e.accentColors.orange[400],height:"auto",width:b?16:14},caption:{...(0,jn.pd)(2),color:e.lightTextColor,fontSize:b?14:12,fontWeight:ne.Z.fontWeight.regular,lineHeight:"130%",margin:0}})),[r,A,b]),F=(0,n.useCallback)((e=>{P(!0),f&&f(e)}),[f]),B=(0,n.useCallback)((e=>{P(!1),x&&x(e)}),[x]);(0,n.useEffect)((()=>{i&&null!==w.current&&w.current.focus()}),[i]);const I=(0,ge.lq)(w,j,_),Z=function(e){const{actionIcons:t,maxIcons:o,triggerIcons:n}=e,i=n.length,r=t.length,a=i>0&&r>0,s=Math.max(o,3),l=a?s-1:s;let c=Math.max(Math.floor(l/2),1),d=Math.max(Math.ceil(l/2),1);if(i<c&&r>d){d+=c-i,c=i}else if(r<d&&i>c){c+=d-r,d=r}const u=[];if(i>0)if(i>c)if(1===c)u.push({color:"gray",type:"truncate",value:i});else{const e=i-(c-1);u.push(...n.slice(0,c-1)),u.push({color:"gray",type:"truncate",value:e})}else u.push(...n);a&&u.push({type:"arrow"});if(r>0)if(r>d)if(1===d)u.push({color:"gray",type:"truncate",value:r});else{const e=r-(d-1);u.push(...t.slice(0,d-1)),u.push({color:"gray",type:"truncate",value:e})}else u.push(...t);return u}({actionIcons:t,maxIcons:Fn(a),triggerIcons:C}),D=Boolean(c||d||m||u||p);return(0,je.jsxs)(me.Z,{onBlur:s,onClick:l,onFocus:h,onMouseDown:S,onMouseEnter:F,onMouseLeave:B,ref:I,style:V.wrap,children:[(0,je.jsxs)("header",{children:[D&&(0,je.jsx)("div",{style:V.moreButtonWrap,children:(0,je.jsx)(bn,{focused:A,onDelete:c,onDisable:d,onEnable:m,onDuplicate:u,onEdit:p})}),(0,je.jsx)("ul",{"aria-hidden":"true",style:V.iconList,children:Z.map(((e,t)=>(0,je.jsx)("li",{children:(0,je.jsx)(_n,{icon:e})},t)))})]}),(0,je.jsxs)("div",{style:V.body,children:[(0,je.jsxs)("div",{style:V.titleWrap,children:[(0,je.jsx)("span",{style:V.title,children:v}),r&&(0,Ft.t)(V.warning)]}),o&&(0,je.jsx)("p",{style:V.caption,children:o})]})]})}function _n(e){const{icon:t}=e;return"property"===t.type||"page"===t.type||"misc"===t.type?(0,je.jsx)(Tn,{color:t.color,icon:t.icon}):"person"===t.type?(0,je.jsx)(Vn,{actor:t.actor}):"app"===t.type?(0,je.jsx)(Pn,{color:"default",icon:t.icon}):"arrow"===t.type?(0,je.jsx)(kn,{}):"truncate"===t.type?(0,je.jsx)(An,{color:t.color,value:t.value}):void(0,oe.t1)(t.type)}function Tn(e){window.__c={n:"StandardIcon"};const{color:t,icon:o}=e,n=Bn(t);return(0,je.jsx)("div",{"aria-hidden":"true",style:n.iconWrap,children:o(n.icon)})}function kn(){window.__c={n:"ArrowIcon"};const e=Bn("default");return(0,je.jsx)("div",{style:{...e.iconWrap,...e.iconArrowWrap},children:(0,hn.n)({...e.icon,...e.iconArrow})})}function Pn(e){window.__c={n:"AppIcon"};const{icon:t}=e,o=Bn("default");return(0,je.jsx)("div",{"aria-hidden":"true",style:o.iconAppWrap,children:t(o.iconApp)})}function An(e){window.__c={n:"TruncateIcon"};const{color:t,value:o}=e,n=Bn(t);return(0,je.jsxs)("div",{style:{...n.iconWrap,...n.truncateWrap},children:["+",o]})}function Vn(e){window.__c={n:"PersonIcon"};const{actor:t}=e,o=Bn("default");return(0,je.jsx)("div",{"aria-hidden":"true",style:o.iconPersonWrap,children:(0,je.jsx)(at.ZP,{actor:t,avatarSize:26,format:at.ZP.Format.Inline,isSingle:!1,showRemoveButton:!1,style:{margin:0}})})}function Fn(e){return void 0===e||e<0?6:e}function Bn(e){const t="default"===e?"gray":e;return(0,y.yK)((e=>{const o="light"===e.mode?400:800,n="light"===e.mode?100:400;return{icon:{fill:e.accentColors[t][o],width:16},iconWrap:{background:e.accentColors[t][n],borderRadius:6,padding:6},iconApp:{width:14},iconAppWrap:{borderRadius:6,borderWidth:1,borderStyle:"solid",borderColor:e.accentColors.gray[n],padding:6},iconPerson:{display:"block",width:"100%"},iconPersonWrap:{alignItems:"center",display:"flex",height:28,justifyContent:"center",width:28},iconArrow:{fill:e.accentColors.gray[600]},iconArrowWrap:{background:void 0},truncateWrap:{alignItems:"center",background:e.accentColors.gray[n],color:e.accentColors[t][o],display:"inline-flex",fontSize:12,fontWeight:ne.Z.fontWeight.semibold,height:28,justifyContent:"center",padding:3,width:28}}}),[t])}const In=(0,a.defineMessages)({automationTabTitle:{defaultMessage:"Automations",id:"database.viewSettings.automationTab.title"},automationTabFilterButton:{defaultMessage:"Filter",id:"database.viewSettings.automationTab.filterButton"},automationTabAddFilterButton:{defaultMessage:"Add filter",id:"database.viewSettings.automationTab.addFilterButton"},automationTabFilterMenuSearchInputPlaceholder:{defaultMessage:"Filter by…",id:"database.viewSettings.automationTab.filterMenuSearchInputPlaceholder"},automationTabFilterMenuNoResults:{defaultMessage:"No results",id:"database.viewSettings.automationTab.filterMenuNoResults"},automationNewAutomationTitle:{defaultMessage:"New automation",id:"database.viewSettings.automationTab.newAutomationTitle"},automationLearnAutomationTitle:{defaultMessage:"Learn about automations",id:"database.viewSettings.automationTab.learnAutomationTitle"},automationDisabledCaption:{defaultMessage:"Paused",id:"database.viewSettings.automationTab.disabledCaption"},automationEmptyViewEditorPublic:{defaultMessage:"Automatically set status, assignees, property values and more with automations",id:"database.viewSettings.automationTab.automationEmptyViewEditorPublic"},automationEmptyViewReadOnly:{defaultMessage:"You're a content viewer. Content viewers cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewReadOnly"},automationEmptyViewContentOnly:{defaultMessage:"You're a content editor. Content editors can edit pages, but cannot create automations.",id:"database.viewSettings.automationTab.automationEmptyViewContentOnly"},automationSearchPlaceholder:{defaultMessage:"Search for an automation…",id:"database.viewSettings.automationTab.automationSearchPlaceholder"}});function Zn(e){window.__c={n:"CollectionSettingsAutomationsView"};const{collectionContextStore:t,collectionSettingsStore:o,tabSettings:i}=e,r=(0,a.useIntl)(),s=(0,nn.D)(),{isMobile:c}=(0,g.Fy)(),[d,u]=(0,n.useState)(""),h=(0,m.VK)((()=>t.collectionStore()),[t]),f=(0,m.VK)((()=>t.collectionViewBlockStore()),[t]),v=(0,m.VK)((()=>h&&h.id),[h]),C=(0,m.VK)((()=>null==h?void 0:h.getSchema()),[h]),b=(0,m.VK)((()=>null==h?void 0:h.getFormat()),[h]),w=(0,m.VK)((()=>function(e){const{collectionStore:t,collectionViewBlockStore:o}=e;if(!t||!o)return[];const n=t.getAutomationStores(),i=[];for(const r of n){const e=r.getModel();null!=e&&e.getAlive()&&((r.isTriggerType("event")||r.isTriggerType("notification_event"))&&i.push(r))}return i}({collectionStore:h,collectionViewBlockStore:f})),[h,f]),j=(0,m.VK)((()=>function(e){const{automationStores:t,collectionSchema:o,intl:n}=e,i=new Map,r=[];for(const l of t){var a;if(!l.isDefined())continue;const e=[],t=l.getName();void 0!==t&&e.push(t);const c=null===(a=l.getOwnerStore())||void 0===a?void 0:a.getDisplayName(n);if(void 0!==c&&e.push(c),l.isTriggerType("event")||l.isTriggerType("notification_event")){const t=l.getEventConfiguration(),i=null==t?void 0:t.pagePropertiesEdited;if("some"===(null==i?void 0:i.type))for(const n of i.some){const t=null==o?void 0:o[n.property];t&&e.push(`${t.name} ${ro.SO[t.type]}`)}const r=l.getActionStores();for(const a of r){const t=a.getType();if(t){const o=(0,x.z)(t);e.push(n.formatMessage(o.display.name))}if(a.isType("create_page")||a.isType("update_pages")){var s;const t=a.getConfig();null==t||null===(s=t.properties)||void 0===s||s.forEach((t=>{const n=null==o?void 0:o[t];n&&e.push(`${n.name} ${ro.SO[n.type]}`)}))}}}const d=e.join(" ");i.set(l.id,d),r.push(d)}return function(e){const o=new Set(p().filter(e,r).map((e=>{let{original:t}=e;return t})));return t.filter((0,oe.AO)((e=>{if(!e.isTriggerType("event")&&!e.isTriggerType("notification_event"))return{false:e};const t=i.get(e.id);return t&&o.has(t)?{true:e}:{false:e}})))}}({automationStores:w,collectionSchema:C,intl:r})),[w,C,r]),M=(0,m.VK)((()=>j(d)),[j,d]),_=(0,m.VK)((()=>Re.Li({collectionStore:h})),[h]),T=(0,n.useCallback)((()=>{l.H4({collectionSettingsStore:o,item:{type:"automationCreateSettings"}})}),[o]),P=(0,n.useCallback)((e=>u(e.target.value)),[]),A=(0,n.useCallback)((()=>{s&&v&&S.qu(s,{collection_id:v})}),[s,v]);(0,n.useEffect)((()=>{if(!s||!v)return;const e="collection_table_header"===i.source?{property_type:i.propertyType,source:i.source}:{source:i.source};S.d(s,{...e,collection_id:v})}),[s,v,i]);const[F,B]=n.useState(!1),I=(0,m.VK)((()=>function(e){var t;const o=null===(t=_o.default.state.currentUserStore)||void 0===t?void 0:t.pointer,n=[],i=[];for(const r of e){const e=r.getCreatedByPointer();o&&e&&te.dr.isEqual(o,e)?n.push(r):i.push(r)}return n.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),i.sort(((e,t)=>t.getLastEditedTime()-e.getLastEditedTime())),{currentUserAutomations:n,otherUserAutomations:i}}(M)),[M]),Z=(0,n.useMemo)((()=>{const{currentUserAutomations:e,otherUserAutomations:t}=I;return F?[...e,...t]:e.length>0?e:t}),[I,F]),D=M.length-Z.length,K=!F&&D>0,R=Z.length>0,N=!R&&!(""!==d),O=(0,y.yK)((e=>({buttonList:{display:"flex",flexDirection:"column",flexShrink:1,gap:12,overflow:"hidden auto",paddingBlockEnd:c?0:12,paddingBlockStart:c?12:0,paddingInline:12},emptyViewWrap:{paddingBlockEnd:42,paddingInline:12},menuScrollerStyle:{marginBlockStart:c?12:8},wrap:{display:"flex",flexDirection:"column"},showMoreButtonContainer:{marginLeft:12,marginBottom:12,marginRight:"auto"},showMoreButtonContent:{fontSize:12},noResultsTitle:{color:e.text.secondary,fontSize:12,margin:0}})),[c]);return h&&C&&b&&f?(0,je.jsx)(Jo.ZP,{...e,header:!N&&(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(no.ZP,{focusInitial:!c,onChange:P,placeholder:r.formatMessage(In.automationSearchPlaceholder),showClearButton:!0,value:d})}),footer:(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[_&&(0,je.jsx)(en.Z,{icon:V.R,onClick:T,title:r.formatMessage(In.automationNewAutomationTitle),isGray:!0}),(0,je.jsx)(tn.Z,{href:"https://www.notion.so/help/database-automations",external:!0,onClick:A,children:(0,je.jsx)(en.Z,{icon:k.m,title:r.formatMessage(In.automationLearnAutomationTitle),isGray:!0})})]}),menuScrollerStyle:O.menuScrollerStyle,title:R||d?r.formatMessage(In.automationTabTitle):null,children:(0,je.jsx)("div",{style:O.wrap,children:N?(0,je.jsx)("div",{style:O.emptyViewWrap,children:(0,je.jsx)(Dn,{collectionStore:h})}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:O.buttonList,children:Z.length>0?Z.map(((e,n)=>(0,je.jsx)(Rn,{collectionContextStore:t,collectionStore:h,collectionSettingsStore:o,focused:!1,schema:C,automationStore:e},e.id))):(0,je.jsx)("p",{style:O.noResultsTitle,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"collectionSettings.automationsView.noResults"})})}),K&&(0,je.jsx)(on.Z,{style:O.showMoreButtonContainer,onClick:e=>{e.stopPropagation(),B(!0)},children:(0,je.jsx)("div",{style:O.showMoreButtonContent,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.automationsView.showMore",defaultMessage:"Show {number} more",values:{number:D}})})})]})})}):null}function Dn(e){window.__c={n:"EmptyView"};const{collectionStore:t}=e,o=(0,g.O7)(),n=(0,y.yK)((e=>({wrap:{alignItems:"center",display:"flex",flexDirection:"column",gap:7.5,justifyContent:"center",minHeight:250,textAlign:"center"},icon:{fill:e.icon.yellow,height:24,width:24},title:{fontSize:17,fontWeight:ne.Z.fontWeight.medium,margin:0},copy:{color:e.text.secondary,fontSize:14,margin:0,lineHeight:1.5}})),[]),i=(0,m.VK)((()=>t.getRole()),[t]);let r;return r=(0,m.VK)((()=>Boolean((0,Bt.IJ)(o,t))),[t,o])||!i||"editor"===i?In.automationEmptyViewEditorPublic:"reader"===i||"comment_only"===i?In.automationEmptyViewReadOnly:"content_only_editor"===i||"read_and_write"===i?In.automationEmptyViewContentOnly:In.automationEmptyViewEditorPublic,(0,je.jsxs)("div",{style:n.wrap,children:[(0,je.jsx)("div",{"aria-hidden":!0,children:(0,T.K)(n.icon)}),(0,je.jsx)("p",{style:n.title,children:(0,je.jsx)(a.FormattedMessage,{...In.automationTabTitle})}),(0,je.jsx)("p",{style:n.copy,children:(0,je.jsx)(a.FormattedMessage,{...r})})]})}const Kn={text:Q.p,number:W.J,url:J.O,file:R.Z,date:D.V,person:G.O,email:K.n,phone_number:H.u,checkbox:B.r,select:$.w,multi_select:L.A,status:q.T,relation:z.v,rollup:U.G,formula:N.D,created_time:I.I,created_by:Z.H,title:Y.c,last_edited_time:I.I,last_edited_by:Z.H,last_visited_time:I.I,button:q.T,auto_increment_id:O.A,location:E.w,verification:ee.f,ai_summary:_.Y,ai_custom_prompt:P.y,ai_extract:L.A,ai_translate:M.Q};function Rn(e){window.__c={n:"AutomationSummaryCardWrapper"};const{automationStore:t,collectionContextStore:o,collectionStore:i,collectionSettingsStore:r,focused:s,schema:c}=e,d=(0,a.useIntl)(),u=(0,g.O7)(),p=Ee({automationStore:t,collectionStore:i}),y=(0,m.VK)((()=>!!(i&&t&&p)&&Re.qk({automationContextStore:p,automationStore:t,collectionStore:i})),[p,t,i]),S=(0,m.VK)((()=>t.getActionStores()),[t]),x=(0,m.VK)((()=>t.getTriggerStore().getValue()),[t]),M=(0,m.VK)((()=>t.getNameWithDefault(d)),[d,t]),_=(0,m.VK)((()=>"active"===t.getStatus()),[t]),T=(0,m.VK)((()=>o.aliveAutomationCount.state),[o]),k=(0,m.VK)((()=>Re.i1({actionStores:S,automationStore:t})),[S,t]),P=(0,m.VK)((()=>Re.qM({automationStore:t})),[t]),B=(0,n.useCallback)((async()=>{await un({collectionStore:i,environment:u,existingAutomationStore:t,intl:d,triggerType:"event",onDelete:()=>{1===T&&l.wl({collectionSettingsStore:r,item:{type:"main"}})}})}),[d,u,i,r,t,T]),I=(0,n.useCallback)((()=>{pn({automationStore:t,collectionStore:i,environment:u})}),[i,u,t]),Z=(0,n.useCallback)((()=>{l.H4({collectionSettingsStore:r,item:{type:"automationEditSettings",automationId:t.id}})}),[r,t]),D=(0,n.useCallback)((()=>{gn({automationStore:t,collectionStore:i,environment:u})}),[i,u,t]),K=(0,n.useMemo)((()=>x?function(e){const{schema:t,triggerConfig:o}=e;if("notification_event"!==o.type&&"event"!==o.type)return[];const n=[];o.event.pagesAdded&&n.push({color:"blue",icon:V.R,type:"page"});const i=o.event.pagePropertiesEdited;if("any"===i.type)n.push({color:"blue",icon:A.R,type:"misc"});else if("some"===i.type)for(const r of i.some){const e=t[r.property],o=r.filter;if(!e)continue;if(!f.Ym[e.type]){n.push({color:"gray",icon:zn(e.type),type:"property"});continue}const i=C.gB(e),a=C.cu(e);if("changes_to_any"===o.operator)n.push({color:i||a?"gray":"blue",icon:zn(e.type),type:"property"});else if(i&&!v.mv(o)&&v.r2(o)){const t=v.wB(o);if(t.length>1)n.push({color:"gray",icon:zn(e.type),type:"property"});else if(1===t.length){const o=t[0];if("is_group"===o.type){const t=(e.groups??[]).find((e=>e.name===o.value));t&&n.push({color:t.color??"gray",icon:zn(e.type),type:"property"})}else{const t=(e.options??[]).find((e=>e.value===o.value));t&&n.push({color:t.color??"gray",icon:zn(e.type),type:"property"})}}}else if(a&&!v.mv(o)&&(v.dx(o)||v.NU(o))){const t=v.dx(o)?v.mg(o):v.qC(o);if(1===t.length){const o=t[0],i=(e.options??[]).find((e=>e.value===o.value));i&&n.push({color:i.color??"gray",icon:zn(e.type),type:"property"})}else t.length>1&&n.push({color:"gray",icon:zn(e.type),type:"property"})}}return n}({schema:c,triggerConfig:x}):[]),[c,x]),R=(0,m.VK)((()=>function(e){const{actionStores:t,collectionStore:o,schema:n}=e,i=[];for(const c of t)if(c.isType("slack_notification"))i.push({icon:F.P,type:"app"});else if(c.isType("update_pages")){const e=c.getConfig(),t=(null==e?void 0:e.properties)??[];if(1===t.length){var r,a;const l=t[0],c=n[l],d=null==e||null===(r=e.values)||void 0===r?void 0:r[l];if(!c||!d)continue;if(!f.SF(c)){i.push({color:"gray",icon:zn(c.type),type:"property"});continue}const u=(0,j.A6)(null===(a=d.value)||void 0===a?void 0:a.value);if(C.gB(c)){const e=(c.options||[]).find((e=>e.value===u[0]));e&&i.push({color:e.color??"gray",icon:zn(c.type),type:"property"})}else if(C.cu(c))if(1===u.length){const e=(c.options||[]).find((e=>e.value===u[0]));e&&i.push({color:e.color??"gray",icon:zn(c.type),type:"property"})}else u.length>1&&i.push({color:"gray",icon:zn(c.type),type:"property"});else if(C.KR(c)){var s;const e=(0,b.DW)({textValue:null===(s=d.value)||void 0===s?void 0:s.value,propertySchema:c}).map((e=>(0,h.Hl)({pointer:e,getRecordValue:o.getRecordValue})));1===e.length?i.push({actor:e[0],type:"person"}):i.push({color:"gray",icon:zn(c.type),type:"property"})}else i.push({color:"gray",icon:zn(c.type),type:"property"})}else t.length>1&&i.push({color:"gray",icon:A.R,type:"misc"})}else if(c.isType("create_page")){var l;(null===(l=c.getConfig())||void 0===l?void 0:l.collection)&&i.push({color:"blue",icon:V.R,type:"page"})}return i}({actionStores:S,collectionStore:i,schema:c})),[c,i,S]),N=(0,m.VK)((()=>_?p&&function(e){const{environment:t,actionStores:o,automationContextStore:n,collectionStore:i,canUserManageAutomation:r,intl:s,schema:l,triggerConfig:c}=e;if(!c||"event"!==c.type&&"notification_event"!==c.type)return;const{event:d}=c,u=[];d.pagesAdded&&u.push(le.Mz(s));if("none"===d.pagePropertiesEdited.type);else if("any"===d.pagePropertiesEdited.type)u.push(le.c5(s));else if("some"===d.pagePropertiesEdited.type)for(const a of d.pagePropertiesEdited.some){const e=l[a.property];if(!e){u.push(le.nf(s));continue}if(!f.Ym[e.type]){u.push(qo({propertySchema:e}));continue}const{filter:t}=a;if("changes_to_any"===t.operator)u.push(le.$G(s,{propertyName:e.name}));else if(f.bD(e))if("status"===e.type){if(!v.r2(t)||!v.vR(t))continue;const o=v.wB(t),n=Je({intl:s,groupValues:o.map((e=>"is_group"===e.type?e.value:void 0)).filter(oe.$K),isText:!0,optionValues:o.map((e=>"is_option"===e.type?e.value:void 0)).filter(oe.$K),propertySchema:e,tokenFormat:w.l.Small}),i=s.formatList(n,{style:"long",type:"disjunction"});u.push(le.VO(s,{propertyName:e.name,propertyValues:i}))}else if("select"===e.type||"multi_select"===e.type){if(v.mv(t)||!v.dx(t)&&!v.NU(t))continue;const o=Xo({intl:s,isText:!0,optionValues:(Array.isArray(t.value)?t.value:[t.value]).map((e=>e.value)).filter(oe.$K),propertySchema:e,tokenFormat:w.l.Small}),n=s.formatList(o,{style:"long",type:"disjunction"});u.push(le.XJ(s,{propertyName:e.name,propertyValues:n}))}else(0,oe.t1)(e)}const p=s.formatList(u,{style:"long",type:"disjunction"}),g=[];for(const h of o)if(h.isType("slack_notification"))g.push((0,je.jsx)(a.FormattedMessage,{defaultMessage:"notify {channel}",id:"CollectionSettingsAutomationsView.summaryCard.slackAction",values:{channel:(0,je.jsx)(Wo,{actionStore:h,isUserAutomationOwner:r})}}));else if(h.isType("update_pages")){const e=h.getConfig(),o=null==e?void 0:e.properties,r=null==e?void 0:e.values,c=null==e?void 0:e.target;if(!o||0===o.length||!c)continue;if("collection"===c.type)if((0,te.qo)(c.collection,i.pointer))g.push((0,je.jsx)(a.FormattedMessage,{defaultMessage:"edit pages in this collection",id:"automation.summaryCard.updatePages.sameCollection"}));else{const e=gt.NW.createChildStore(i,c.collection),o=(0,pt.vU)({environment:t,intl:s,store:e});g.push((0,je.jsx)(a.FormattedMessage,{defaultMessage:"edit pages in {collectionTitle}",id:"automation.summaryCard.updatePages.differentCollection",values:{collectionTitle:o}}))}else if("variable"===c.type){const e=o[0],t=l[e],a=null==r?void 0:r[e];if(!t){g.push(le.aD(s));continue}if(!a)continue;if(f.SF(t))if("person"===t.type)g.push((0,je.jsx)(Nn,{collectionStore:i,propertyActionValue:a,propertySchema:t}));else if("status"===t.type){const e=(0,je.jsx)(On,{propertyActionValue:a,propertySchema:t});e&&g.push(e)}else if("select"===t.type||"multi_select"===t.type)g.push((0,je.jsx)(En,{propertyActionValue:a,propertySchema:t}));else if("checkbox"===t.type)g.push((0,je.jsx)(Ln,{propertyActionValue:a,propertySchema:t}));else if("relation"===t.type)g.push((0,je.jsx)(Wn,{automationContextStore:n,collectionStore:i,propertyActionValue:a,propertySchema:t}));else if("date"===t.type){const o=(0,je.jsx)(Gn,{automationContextStore:n,collectionStore:i,propertyActionValue:a,propertyId:e,propertySchema:t});o&&g.push(o)}else"number"===t.type||"phone_number"===t.type||"text"===t.type||"title"===t.type||"email"===t.type||"url"===t.type?g.push((0,je.jsx)(Hn,{automationStore:n.context.automationStore,propertyActionValue:a,propertySchema:t})):(0,oe.t1)(t);else g.push(qo({propertySchema:t}))}}else if(h.isType("create_page")){var m;const e=null===(m=h.getConfig())||void 0===m?void 0:m.collection;if(!e)continue;e.id===i.pointer.id?g.push((0,je.jsx)(a.FormattedMessage,{defaultMessage:"create a page in this database",id:"automation.summaryCard.createPageThisDatabase"})):g.push((0,je.jsx)(a.FormattedMessage,{defaultMessage:"create a page in another database",id:"automation.summaryCard.createPageAnotherDatabase"}))}const y=s.formatList(g,{style:"long",type:"conjunction"});return s.formatMessage({defaultMessage:"When {triggers}, {actions}.",id:"automation.summaryCard.caption"},{actions:y,triggers:p})}({environment:u,actionStores:S,automationContextStore:p,canUserManageAutomation:k,collectionStore:i,intl:d,schema:c,triggerConfig:x}):d.formatMessage(In.automationDisabledCaption)),[_,p,u,S,k,i,d,c,x]),O=(0,m.VK)((()=>{if(!t.isTriggerType("event")&&!t.isTriggerType("notification_event"))return!0;return!t.getTrigger()||Re.vM({automationStore:t,collectionStore:i})}),[t,i]),E=!_||O,L=(0,n.useCallback)((e=>(0,n.createElement)(Mn,{...e,key:t.id,actions:R,caption:N,focused:s,hasWarning:E,onClick:Z,onDelete:P?B:void 0,onDisable:_&&P&&y?I:void 0,onEdit:k?Z:void 0,onEnable:!_&&P&&y?D:void 0,title:M,triggers:K})),[R,t.id,k,P,N,s,E,_,y,B,I,Z,D,M,K]);return(0,je.jsx)(Pe,{caption:N,renderOrigin:L,title:M,tooltipAlignment:ae.Z.Alignment.Start,tooltipPlacement:ae.Z.Placement.Bottom})}function Nn(e){window.__c={n:"PersonActionTitle"};const{collectionStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,a.useIntl)(),r=(0,m.VK)((()=>lt({getRecordModel:t.getRecordModel,propertySchema:n,value:o.value})),[t.getRecordModel,o.value,n]),s=(0,m.VK)((()=>ct({actors:r,intl:i,propertySchema:n})),[r,i,n]);return s||null}function On(e){var t;window.__c={n:"StatusActionTitle"};const{propertyActionValue:o,propertySchema:n}=e,i=(0,j.A6)(null===(t=o.value)||void 0===t?void 0:t.value)[0],r=xt({intl:(0,a.useIntl)(),propertySchema:n,value:i});return r||null}function En(e){var t,o;window.__c={n:"MultiSelectActionTitle"};const{propertyActionValue:n,propertySchema:i}=e,r=(0,a.useIntl)(),s=null!==(t=n.value)&&void 0!==t&&t.value?(0,j.A6)(null===(o=n.value)||void 0===o?void 0:o.value):[],l=le.oJ({limit:it,propertySchema:i,optionValues:s.map((e=>"string"==typeof e?e:void 0)).filter(oe.$K)});return(0,m.VK)((()=>nt({intl:r,propertySchema:i,values:l})),[r,l,i])}function Ln(e){const{propertyActionValue:t,propertySchema:o}=e;return Ve({propertySchema:o,value:t.value})}function Wn(e){window.__c={n:"RelationActionTitle"};const{automationContextStore:t,collectionStore:o,propertyActionValue:n,propertySchema:i}=e,r=(0,a.useIntl)(),s=(0,g.O7)(),l=n.value,c=(0,m.VK)((()=>t.getAllContextValues()),[t]);return(0,m.VK)((()=>ht({automationContextValues:c,collectionStore:o,environment:s,intl:r,propertySchema:i,value:l})),[c,o,s,r,i,l])}function Gn(e){window.__c={n:"DateActionTitle"};const{automationContextStore:t,collectionStore:o,propertyActionValue:i,propertyId:r,propertySchema:s}=e,l=(0,a.useIntl)(),c=i.value,d=(0,n.useMemo)((()=>({type:"collection",collectionStore:o,property:r})),[o,r]),u=(0,m.VK)((()=>We({automationContextStore:t,intl:l,propertySchema:s,value:c,valueContext:d})),[t,l,s,c,d]);return u||null}function Hn(e){window.__c={n:"TextActionTitle"};const{automationStore:t,propertyActionValue:o,propertySchema:n}=e,i=(0,g.O7)(),r=(0,y.Fg)(),a=(0,m.VK)((()=>jt({automationStore:t,environment:i,propertySchema:n,theme:r,value:o.value})),[t,i,o.value,n,r]);return a||null}function zn(e){return(0,oe.$K)(e)?Kn[e]??X.S:X.S}var Un=o(64964);function $n(e){window.__c={n:"AutomationEmptyStepButton"};const{icon:t,onClick:o,title:n}=e,i=(0,y.yK)((e=>({button:{alignItems:"center",border:`1px dashed ${e.stroke.regular}`,borderRadius:6,display:"flex",color:e.accentColors.gray[900],gap:6,justifyContent:"center",padding:16},iconWrap:{fill:e.accentColors.gray[600]},title:{fontSize:14,lineHeight:1.3}})),[]);return(0,je.jsxs)(me.Z,{onClick:o,style:i.button,children:[t&&(0,je.jsx)("div",{"aria-hidden":"true",style:i.iconWrap,children:t}),(0,je.jsx)("div",{style:i.title,children:n})]})}function qn(e){window.__c={n:"AutomationActionSelectButton"};const{automationStore:t,initialState:o,updateCurrentAutomationState:n,collectionStore:i}=e,r=(0,Zt.d)();return i?(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,popupType:r,render:e=>(0,je.jsx)(Ko,{automationStore:t,buttonPopupParent:e,collectionStore:i,initialState:o,updateCurrentAutomationState:n}),renderOrigin:e=>(0,je.jsx)(Qn,{...e})}):(0,je.jsx)(Qn,{onClick:()=>{}})}function Qn(e){return(0,je.jsx)($n,{...e,icon:(0,V.R)({height:24,width:12}),title:(0,je.jsx)(a.FormattedMessage,{id:"AutomationActionSelectButton.actionSection.addAction",defaultMessage:"Add action"})})}var Yn=o(36591),Xn=o(73657),Jn=o(1136),ei=o(45669),ti=o(31278),oi=o(78316);function ni(e){window.__c={n:"AutomationCollectionSelectMenu"};const{selectedSourcePointer:t,collectionContextStore:o,onSelect:i,disabled:r}=e,{isMobile:s}=(0,g.Fy)(),l=(0,a.useIntl)(),c=(0,g.O7)(),[d,u]=n.useState(""),p=(0,m.VK)((()=>o.collectionStore()),[o]),h=(0,m.VK)((()=>o.collectionViewBlockStore()),[o]),S=(0,m.VK)((()=>h&&p?h.getCollectionViewStores().filter((e=>{var t;const o=null===(t=e.getCollectionStore())||void 0===t?void 0:t.pointer;return(null==o?void 0:o.id)===p.id})):[]),[h,p]),f=(0,m.VK)((()=>{if(!p)return[];let e;t&&"collection_view"===t.table&&(e=gt.Xr.createChildStore(p,t));return He.mN([...S,e].filter(oe.$K),(e=>{let{id:t}=e;return t})).filter((e=>(0,oi.D)(e,d)))}),[p,S,d,t]),x=(0,m.VK)((()=>{if(p&&(0,ro.r_)({collectionStore:p,environment:c,intl:l,queryForFilter:d}))return function(e){const{collectionStore:t,environment:o,selectedSourcePointer:n,onSelect:i,isMobile:r,intl:s}=e,l=t.getIcon(),c=(0,pt.vU)({environment:o,intl:s,store:t}),d=n&&"collection"===n.table&&n.id===t.id,u=t.getSpaceShardedPointer();return{key:"collection",items:[{key:t.id,action:()=>{u&&i(u)},render:e=>(0,je.jsx)(ye.Z,{...e,icon:l&&(0,je.jsx)(ti.Z,{isEmptyPage:!1,size:r?18:16,disabled:!0,icon:l}),title:c,caption:(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.collection.caption",defaultMessage:"Any page in this database",values:{collectionName:c}}),right:d&&(0,Yn.e)({width:12,height:"auto"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0})}}({collectionStore:p,environment:c,selectedSourcePointer:t,onSelect:i,isMobile:s,intl:l})}),[p,c,l,s,i,d,t]),v=function(e){const{menuListItems:t}=e;if(0===t.length)return;return{key:"collection-views",items:t,render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0})}}({menuListItems:(0,m.VK)((()=>p&&h&&S?function(e){const{blockStore:t,filteredCollectionViewStores:o,collectionStore:n,selectedSourcePointer:i,onSelect:r,intl:s}=e,l=n.getSchema();return[...o.map((e=>{const o=e.getSpaceShardedPointer();if(e.isDefined()&&o){const c=i&&"collection_view"===i.table&&i.id===o.id,d=(0,Re.rU)({collectionViewStore:e,collectionSchema:l}),u=(0,oe.$K)(d),p=e.getType(),g=e.getFormat().collection_view_icon,m=e.getName(),y=(o,n)=>(0,je.jsx)(ye.Z,{...o,...n,icon:(0,je.jsx)(Jn.F,{color:"lightGray",viewType:p,viewIcon:g}),title:(0,je.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4},children:[(0,je.jsx)(ei.Z,{collectionViewType:p,collectionViewName:m}),u&&c&&(0,Ft.t)({width:16,height:"auto"})]}),caption:(0,je.jsx)(ri,{blockStore:t,collectionViewStore:e,intl:s,collectionSchema:l,referencesIncompatibleProperties:u}),right:c&&(0,Yn.e)({width:12,height:"auto"}),disabled:u,disabledFeedback:u});let h;if(u&&d){var n;const e=null===(n=l[d])||void 0===n?void 0:n.type,t=e?ro.SO[e]:void 0,o=t?(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.specific",defaultMessage:"{propertyTypeName} properties are not supported",values:{propertyTypeName:t}}):(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.tooltip.incompatibleFiltersWarning.default",defaultMessage:"Some properties are not supported"});h=e=>(0,je.jsx)(ae.Z,{placement:ae.Z.Placement.Right,renderTooltip:()=>o,render:t=>y(e,t)})}else h=y;return{key:e.id,action:()=>{r(o)},render:h}}}))].filter(oe.$K)}({blockStore:h,collectionStore:p,filteredCollectionViewStores:f,selectedSourcePointer:t,onSelect:i,intl:l}):[]),[h,p,S,f,l,i,t])}),C={key:"search",items:[{key:"search_item",action:()=>{},render:()=>(0,je.jsx)(no.ZP,{value:d,focus:!0,style:j.searchBar,textWrapperStyle:j.searchText,onChange:e=>u(e.target.value),placeholder:l.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e})};let b;(0,oe.$K)(x)||(0,oe.$K)(v)||(b={key:"no-results-section",items:[{key:"no-results-item",action:He.ZT,render:()=>(0,je.jsx)(Xn.Z,{caption:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"collectionViewSelect.noResults.title"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0})});const w=[C,x,v,b].filter(oe.$K),j=function(e){return(0,y.yK)((t=>({button:{marginTop:8},buttonPopup:{width:e?void 0:230},searchBar:{marginTop:8,marginBottom:8},searchText:{marginLeft:8,marginRight:8},buttonRight:{color:t.selectLightGray[500]},menuItemTextWrapper:{...e?{marginLeft:12}:{},minWidth:"auto"}})),[e])}(s),M=(0,m.qz)(void 0,be.Z),_=(0,Zt.d)();if(!p)return null;const T=(0,je.jsx)(ii,{pointer:t,collectionStore:p,intl:l});return(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,popupType:_,style:j.buttonPopup,buttonPopupStore:M,render:e=>{let t;return t=s?{menuType:Lt.og.Modal,title:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),right:(0,je.jsx)(Ht.DoneMenuText,{}),onClickRight:()=>{e.close()}}:{menuType:Lt.og.Popup,width:230,maxHeight:"50vh"},(0,je.jsx)(fe.Z,{...t,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:w,initialFocus:0,onAccept:()=>{e.close()}})})},renderOrigin:e=>(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.notifyForOption.title",defaultMessage:"For pages in"}),showChevron:!0,right:T,rightStyle:{flexShrink:1},rotateChevron:M.state.open,disabled:r,textWrapperStyle:j.menuItemTextWrapper,...e})})}function ii(e){window.__c={n:"AutomationSourceCaption"};const{pointer:t,collectionStore:o,intl:n}=e,i=(0,g.O7)(),r=(0,y.yK)((e=>({warningIcon:{width:16,height:"auto",color:e.accentColors.orange[400]},titleContainer:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,flex:"1 1 auto",minWidth:0},title:{...ne.Z.textOverflowStyle},errorText:{color:e.errorText,fontWeight:ne.Z.fontWeight.medium}})),[]),s=(0,m.VK)((()=>t?gt.t1.createChildStore(o,t):void 0),[o,t]),l=(0,m.VK)((()=>s?(0,pt.vU)({environment:i,intl:n,store:s}):(0,je.jsx)("span",{style:r.errorText,children:(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.source.missing",defaultMessage:"Select database"})})),[i,n,r.errorText,s]),c=(0,m.VK)((()=>{if(!s||s.table===po.v)return!1;const e=o.getSchema();return(0,oe.$K)((0,Re.rU)({collectionViewStore:s,collectionSchema:e}))}),[o,s]);return(0,je.jsxs)("div",{style:r.titleContainer,children:[c&&(0,Ft.t)(r.warningIcon),(0,je.jsx)("span",{style:r.title,children:l})]})}function ri(e){window.__c={n:"CollectionViewCaption"};const{blockStore:t,collectionViewStore:o,intl:n,collectionSchema:i,referencesIncompatibleProperties:r}=e,s=(0,g.O7)(),l=(0,m.VK)((()=>!o.getAlive()),[o]),c=(0,m.VK)((()=>{const e=o.getParentBlockStore();if(e)return t.id!==e.id?(0,pt.vU)({environment:s,intl:n,store:e}):void 0}),[t.id,o,n,s]),d=(0,m.VK)((()=>{const e=o.getQuery(i);return(0,v.OH)({propertyFilters:o.getPropertyFiltersStore().getValue()??[],combinatorFilter:null==e?void 0:e.filter,schema:i}).reduce(((e,t)=>{if((0,v.aN)(t))return e+1;return e+(t.filters??[]).length}),0)}),[i,o]);return r?(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.unsupportedView",defaultMessage:"Not supported"}):l?(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.deletedView",defaultMessage:"<emphasis>View not found.</emphasis>",values:{emphasis:e=>(0,je.jsx)("em",{children:e})}}):c?(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionDifferentParent",defaultMessage:"<emphasis>View configured in {externalParentBlockName}</emphasis>",values:{emphasis:e=>(0,je.jsx)("em",{children:e}),externalParentBlockName:c}}):0===d?(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithNoFilters",defaultMessage:"Any page in this view"}):(0,je.jsx)(a.FormattedMessage,{id:"AutomationCollectionSelectMenu.collectionView.captionWithFilters",defaultMessage:"{ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",values:{ruleCount:d}})}function ai(e){window.__c={n:"DeletedPropertyStep"};const{propertyId:t,disabled:o,collectionStore:n,onClick:i}=e,r=(0,y.Fg)(),s="light"===r.mode?50:200,l="light"===r.mode?700:900,c=(0,y.yK)((e=>{const t="light"===e.mode?400:800;return{warning:{color:e.accentColors.orange[t]}}}),[]),d=(0,m.VK)((()=>n.getDeletedSchema()[t]),[n,t]);return(0,je.jsx)(_e,{disabled:o,icon:e=>(0,Ft.t)({...e,...c.warning}),title:(0,je.jsx)(w.Z,{format:w.l.Medium,value:(0,je.jsx)(a.FormattedMessage,{id:"deletedPropertyStep.deletedProperty.title",defaultMessage:"{propertyName} property deleted",values:{propertyName:null==d?void 0:d.name}}),theme:r,isSingle:!0,backgroundColor:r.accentColors.yellow[s],color:r.accentColors.yellow[l]}),onClick:i})}var si=o(55863);function li(e){window.__c={n:"AutomationDeletedPropertyMenu"};const{stepType:t,onDelete:o,onViewDeletedProperties:n}=e,i=(0,we.F)({width:266}),r=(0,g.Fy)().isMobile,s=(0,y.yK)((e=>({icon:{width:r?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[r]);return(0,je.jsx)(fe.Z,{...i,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-deleted-properties",action:()=>{n()},render:e=>(0,je.jsx)(ye.Z,{...e,title:(0,je.jsx)("span",{style:s.content,children:(0,je.jsx)(a.FormattedMessage,{id:"automationDeletedPropertyMenu.viewDeletedProperties.title",defaultMessage:"View deleted properties"})}),icon:(0,si.s)(s.icon)})},{key:"delete-action",action:()=>{o()},render:e=>(0,je.jsx)(ye.Z,{...e,title:(0,je.jsx)("span",{style:s.content,children:"action"===t?(0,je.jsx)(a.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,je.jsx)(a.FormattedMessage,{id:"automationDeletedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,pe.y)(s.icon)})}],render:e=>(0,je.jsx)(Ce.Z,{...e})}],initialFocus:0})})}const ci=(0,a.defineMessages)({searchInputPlaceholder:{id:"automationEventTriggerMenu.searchInputPlaceholder.label",defaultMessage:"Search for trigger…"},pageAddedCopy:{id:"automationEventTriggerMenu.pageAdded.title",defaultMessage:"Page added"},pagePropertiesEditedCopy:{id:"automationEventTriggerMenu.anyPropertyEdited.title",defaultMessage:"Any property"}});function di(e){window.__c={n:"AutomationEventTriggerMenu"};const{automationStore:t,automationTriggerMenuStore:o,collectionStore:i,updateCurrentState:r,onClose:s}=e,l=(0,y.Fg)(),c=(0,a.useIntl)(),[d,u]=n.useState(""),g=(0,m.VK)((()=>i.getSchema()),[i]),h=(0,m.VK)((()=>t.getTrigger()),[t]),S=(0,m.VK)((()=>("event"===(null==h?void 0:h.type)||"notification_event"===(null==h?void 0:h.type))&&h.event.pagesAdded),[h]),x=(0,m.VK)((()=>(0,f._X)({collectionFormat:i.getFormat(),collectionSchema:g})),[i,g]),v=(0,Re.EF)({collectionSchema:g,propertyIds:x,searchTerm:d}),C=(0,y.yK)((e=>({propertyIcon:{width:16,height:16,color:e.mediumIconColor}})),[]),b=(0,we.F)({maxHeight:"50vh",width:266}),w=(0,je.jsx)(no.ZP,{focus:!0,style:{marginTop:12,marginBottom:6},value:d,onChange:e=>{u(e.target.value)},placeholder:c.formatMessage(ci.searchInputPlaceholder)}),j=S?void 0:function(e){const{intl:t,searchInput:o,updateCurrentState:n,onClose:i,styles:r}=e,a=t.formatMessage(ci.pageAddedCopy);if(!p().test(o,a))return;return{key:"page_added_section",items:[{key:"page_added",action:()=>{n({type:"update_trigger",trigger:{type:"page_added"}}),i()},render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,V.R)(r.propertyIcon),title:a})}],render:e=>(0,je.jsx)(Ce.Z,{...e})}}({intl:c,searchInput:d,updateCurrentState:r,onClose:s,styles:C}),M=(0,m.VK)((()=>function(e){const{automationTriggerValue:t,automationTriggerMenuStore:o,showTopBorder:n,properties:i,collectionSchema:r,theme:s,updateCurrentState:l,onClose:c,intl:d,searchInput:u,styles:g}=e,m=d.formatMessage(ci.pagePropertiesEditedCopy);let y=!1,h=[];"event"!==(null==t?void 0:t.type)&&"notification_event"!==(null==t?void 0:t.type)||(y="any"===t.event.pagePropertiesEdited.type,h="some"===t.event.pagePropertiesEdited.type?t.event.pagePropertiesEdited.some:[]);const S=[y||!p().test(u,m)?void 0:{key:"any_property_edited",action:async()=>{await async function(e){const{hasSpecificPropertyChangedFilters:t}=e;if(!t)return!0;return await an.confirmUserAction({message:(0,je.jsx)(a.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.message",defaultMessage:"Replace other triggers?"}),description:(0,je.jsx)(a.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.description",defaultMessage:"Adding the 'Any property edited' trigger will replace all other property triggers."}),acceptLabel:(0,je.jsx)(a.FormattedMessage,{id:"automations.eventTriggerMenu.replaceTriggerConfirmation.acceptLabel",defaultMessage:"Replace"})})}({hasSpecificPropertyChangedFilters:h.length>0})&&(l({type:"update_trigger",trigger:{type:"any_page_property_edited"}}),c())},render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,A.R)(g.propertyIcon),title:m})},...i.map((e=>{if(!h.find((t=>t.property===e)))return function(e){const{automationTriggerMenuStore:t,propertyId:o,collectionSchema:n,theme:i,updateCurrentState:r,onClose:a}=e,s=n[o];if(!s)return;const l=(0,f.bD)(s);return{key:o,action:()=>{l?t.pushSettingsItem({type:"propertyChangedFilter",property:o}):(r({type:"update_trigger",trigger:{type:"property_changed",property:o,filter:{operator:"changes_to_any"}}}),a())},render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,je.jsx)($e.ZP,{icon:s.icon,type:s.type,size:16,theme:i}),title:s.name,right:l?(0,to.o)({marginLeft:6,width:12,height:"auto"}):void 0})}}({propertyId:e,collectionSchema:r,theme:s,updateCurrentState:l,automationTriggerMenuStore:o,onClose:c})})).filter(oe.$K)].filter(oe.$K);if(0===S.length)return;return{key:"page_properties_edited_section",items:S,render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:n,title:(0,je.jsx)(a.FormattedMessage,{id:"automationEventTriggerMenu.pagePropertiesEditedSection.title",defaultMessage:"Property edited"})})}}({automationTriggerValue:h,automationTriggerMenuStore:o,showTopBorder:Boolean(j),properties:v,collectionSchema:g,theme:l,updateCurrentState:r,onClose:s,searchInput:d,intl:c,styles:C})),[h,o,j,v,g,l,r,s,d,c,C]),_=n.useMemo((()=>{const e=[j,M].filter(oe.$K);return 0===e.length?[{key:"none",items:[{key:"none-item",action:()=>{},render:e=>(0,je.jsx)(ye.Z,{...e,disabled:!0,disabledFeedback:!0,title:(0,je.jsx)(a.FormattedMessage,{id:"automations.eventTriggerMenu.noResultsItem",defaultMessage:"No results"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e})}]:e}),[j,M]);return(0,je.jsx)(fe.Z,{...b,header:w,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:_,initialFocus:0})})}var ui=o(62644),pi=o(60458),gi=o(47082);function mi(e){window.__c={n:"AutomationSelectPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:r,propertyChangedFilter:s,onClose:l}=e,{isMobile:c,isAndroid:d}=(0,g.Fy)(),u=(0,a.useIntl)(),p=(0,m.VK)((()=>{if("changes_to_any"===s.operator){return(r.options??[]).map((e=>({type:"exact",value:e.value})))}if(!(0,v.dx)(s)&&!(0,v.NU)(s))return[];if((0,v.vR)(s)){const e=(r.options??[]).map((e=>e.value));return(Array.isArray(s.value)?s.value:[s.value]).filter((t=>(0,oe.$K)(t.value)&&e.includes(t.value)))}return[]}),[r,s]),[y,h]=n.useState(p),S=(0,m.VK)((()=>function(e){const{propertySchema:t,selectedOptions:o}=e;let n=!1,i=!0;const r=t.options??[];for(const a of r){const e=o.some((e=>e.value===a.value));n||=e,i&&=e}return!!i||!!n&&"partial"}({propertySchema:r,selectedOptions:y})),[r,y]),f=n.useMemo((()=>(r.options??[]).map((e=>({type:"exact",value:e.value})))),[r]),x=n.useMemo((()=>"multi_select"===r.type?{operator:"enum_contains",value:y}:"select"===r.type?{operator:"enum_is",value:y}:(0,oe.t1)(r)),[r,y]),C=!0===S?[]:y.map((e=>{if(!e.value||!r.options)return;const t=(0,b.i7)(r.options,e.value);return t?(0,je.jsx)(ze.a,{format:c?w.l.Large:w.l.Small,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!0,onClickRemove:()=>{const t=He.zu(y,e);h(t)}},t.id):void 0})),[j,M]=n.useState(""),_=(0,ui.I4)({query:j,propertySchema:r,selectedValues:y,updateValue:e=>{M(""),h(e)},isMobile:c,styles:{}}),T=[{key:"search",items:[{key:"input",action:()=>{},render:e=>(0,je.jsx)(gi.Z,{...e,focusInitial:!0,onClick:void 0,focusAfterAnimation:!0,format:gi.Z.Format.FilterValue,tokens:C,placeholder:S?u.formatMessage({defaultMessage:"Any option",id:"automations.selectPropertyChangedFilter.inputPlaceholder.anyOption"}):u.formatMessage({defaultMessage:"Select one or more options…",id:"automations.selectPropertyChangedFilter.inputPlaceholder.searchPlaceholder"}),onRemoveLastToken:()=>{const e=y.slice(0,y.length-1);h(e)},onClearButtonClick:()=>{h([]),l()},value:j,onChange:e=>{M(e.target.value)},dontShowBorderBottom:d,showClearButton:!0})}],render:e=>(0,je.jsx)(Ce.Z,{...e})},{key:"any",items:[{key:"any-option-item",action:()=>{!0===S?h([]):!1===S||"partial"===S?h(f):(0,oe.t1)(S),M("")},render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,je.jsx)(pi.Z,{checked:S,size:14,onClick:e.onClick}),title:(0,je.jsx)(a.FormattedMessage,{id:"automations.selectPropertyChangedFilter.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0})},_.length>0?{key:"items",items:_,render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0})}:void 0].filter(oe.$K);return(0,je.jsx)($t,{type:"default",automationTriggerActionMenuStore:i,onDone:()=>{(0,Re.WM)({anyOptionCheckState:S,propertyId:t,updateCurrentState:o,currentFilter:x}),l()},onClose:l,sections:T,headerTitle:(0,je.jsx)(a.FormattedMessage,{id:"automations.propertyChangedFilterHeader.select.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}var yi=o(97004);function hi(e){window.__c={n:"AutomationStatusPropertyChangedFilterMenu"};const{propertyId:t,updateCurrentState:o,automationTriggerMenuStore:i,propertySchema:r,propertyChangedFilter:s,onClose:l}=e,{isMobile:c}=(0,g.Fy)(),d=(0,m.VK)((()=>{if("changes_to_any"===s.operator){return(r.groups??[]).map((e=>({type:"is_group",value:e.name})))}return(0,v.r2)(s)&&(0,v.vR)(s)?(0,v.wB)(s):[]}),[r,s]),[u,p]=n.useState(d),y=(0,m.VK)((()=>function(e){const{propertySchema:t,selectedStatusOptions:o}=e,n=t.groups??[],i=t.options??[],r=n.map((e=>(0,yi.rQ)({group:e,options:i,filterValues:o}))),a=r.every((e=>!0===e.groupCheckState)),s=r.some((e=>!1!==e.groupCheckState));return!!a||!!s&&"partial"}({propertySchema:r,selectedStatusOptions:u})),[r,u]),h=n.useMemo((()=>(r.groups??[]).map((e=>({type:"is_group",value:e.name})))),[r]),S=(0,ui.Sm)({propertySchema:r,statusFilterValues:u,updateValue:e=>{p(e)},isMobile:c,styles:{}});return(0,je.jsx)($t,{type:"default",automationTriggerActionMenuStore:i,onDone:()=>{(0,Re.WM)({anyOptionCheckState:y,propertyId:t,updateCurrentState:o,currentFilter:{operator:"status_is",value:u}}),l()},onClose:()=>{l()},sections:[{key:"any",items:[{key:"any-option-item",action:()=>{!0===y?p([]):!1===y||"partial"===y?p(h):(0,oe.t1)(y)},render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,je.jsx)(pi.Z,{checked:y,size:14,onClick:e.onClick}),title:(0,je.jsx)(a.FormattedMessage,{id:"automationEventTriggerPropertyChangedFilterMenu.anyOption.title",defaultMessage:"Any option"})})}],render:e=>(0,je.jsx)(Ce.Z,{...e})},{key:"items",items:S,render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0})}],headerTitle:(0,je.jsx)(a.FormattedMessage,{id:"automations.propertyChangedFilterHeader.status.title",defaultMessage:"{propertyName} set to",values:{propertyName:r.name}})})}function Si(e){window.__c={n:"AutomationEventTriggerPropertyChangedFilterMenu"};const{automationStore:t,propertyId:o,automationTriggerMenuStore:n,collectionStore:i,updateCurrentState:r,onClose:a}=e,s=(0,m.VK)((()=>i.getSchema()),[i])[o],l=(0,m.VK)((()=>t.getTrigger()),[t]);let c=[];"event"!==(null==l?void 0:l.type)&&"notification_event"!==(null==l?void 0:l.type)||(c="some"===l.event.pagePropertiesEdited.type?l.event.pagePropertiesEdited.some:[]);const d=c.find((e=>e.property===o))??{property:o,filter:{operator:"changes_to_any"}};if(!s)return null;return(0,f.bD)(s)?"multi_select"===s.type||"select"===s.type?(0,je.jsx)(mi,{propertyId:o,updateCurrentState:r,automationTriggerMenuStore:n,propertySchema:s,propertyChangedFilter:d.filter,onClose:a}):"status"===s.type?(0,je.jsx)(hi,{propertyId:o,updateCurrentState:r,automationTriggerMenuStore:n,propertySchema:s,propertyChangedFilter:d.filter,onClose:a}):null:null}function fi(e){window.__c={n:"AutomationTriggerMenuController"};const{automationStore:t,collectionStore:o,initialState:i,updateCurrentAutomationState:r,buttonPopupParent:a}=e,s=(0,m.VK)((()=>{const e=new Rt;return e.setState({stack:[i]}),e}),[i]),l=(0,m.VK)((()=>s.getCurrentTab()),[s]),c=(0,n.useCallback)((()=>a.close()),[a]);return l?"eventTriggers"===l.type?(0,je.jsx)(di,{automationStore:t,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:r,onClose:c}):"propertyChangedFilter"===l.type?(0,je.jsx)(Si,{automationStore:t,propertyId:l.property,automationTriggerMenuStore:s,collectionStore:o,updateCurrentState:r,onClose:c}):(0,oe.t1)(l):null}var xi=o(50780);function vi(e){window.__c={n:"AutomationUnsupportedPropertyMenu"};const{stepType:t,onDelete:o,onViewEditProperty:n,propertyId:i,propertySchema:r}=e,s=(0,we.F)({width:266}),l=(0,g.Fy)().isMobile,c=(0,y.yK)((e=>({icon:{width:l?"12px":"16px",height:"auto",color:e.accentColors.gray[600]},content:{fontSize:"14px",fontWeight:400}})),[l]);return(0,je.jsx)(fe.Z,{...s,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,sections:[{key:"actions-section",items:[{key:"view-edit-property",action:()=>n(i),render:e=>(0,je.jsx)(ye.Z,{...e,title:(0,je.jsx)("span",{style:c.content,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Edit {propertyName}",id:"automationUnsupportedPropertyMenu.viewDeletedProperties.title",values:{propertyName:r.name}})}),icon:(0,xi.E)(c.icon)})},{key:"delete-action",action:()=>o(),render:e=>(0,je.jsx)(ye.Z,{...e,title:(0,je.jsx)("span",{style:c.content,children:"action"===t?(0,je.jsx)(a.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteAction.title",defaultMessage:"Delete action"}):(0,je.jsx)(a.FormattedMessage,{id:"automationUnsupportedPropertyMenu.deleteTrigger.title",defaultMessage:"Delete trigger"})}),icon:(0,pe.y)(c.icon)})}],render:e=>(0,je.jsx)(Ce.Z,{...e})}],initialFocus:0})})}function Ci(e){window.__c={n:"AutomationTriggerList"};const{automationStore:t,collectionStore:o,disabled:i,handleNavigateToEditProperty:r,handleNavigateToDeletedProperties:a,updateCurrentState:s}=e,l=(0,Zt.d)(),c=(0,m.VK)((()=>o.getSchema()),[o]),d=(0,m.VK)((()=>t.getTriggerStore().getKeyStore("event").getValue()),[t]),u=(0,n.useCallback)((e=>{s({type:"remove_trigger",trigger:{type:"property_changed",property:e,filter:{operator:"changes_to_any"}}})}),[s]),p=Mi(),g=[];return null!=d&&d.pagesAdded&&g.push((0,je.jsx)(wi,{disabled:i,updateCurrentState:s},"page_added_trigger")),"any"===(null==d?void 0:d.pagePropertiesEdited.type)&&g.push((0,je.jsx)(ji,{disabled:i,updateCurrentState:s},"any_page_property_edited_trigger")),"some"===(null==d?void 0:d.pagePropertiesEdited.type)&&g.push(...d.pagePropertiesEdited.some.map((e=>{const{property:d,filter:p}=e,g=c[d];return g?f.Ym[g.type]?"status"!==g.type||"changes_to_any"!==p.operator&&!(0,v.r2)(p)?"select"!==g.type||"changes_to_any"!==p.operator&&!(0,v.dx)(p)?"multi_select"!==g.type||"changes_to_any"!==p.operator&&!(0,v.NU)(p)?"changes_to_any"===p.operator?(0,je.jsx)(qe,{disabled:i,onClick:e=>{e.setState({open:!0})},propertySchema:g,onDelete:()=>{u(d)}},`changes_to_any_${d}_trigger`):void 0:(0,je.jsx)(bi,{property:d,automationStore:t,collectionStore:o,updateCurrentState:s,renderOrigin:e=>{let{onClick:t}=e;return(0,je.jsx)(Qo,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{u(d)}})}},`changes_to_any_${d}_trigger`):(0,je.jsx)(bi,{property:d,automationStore:t,collectionStore:o,updateCurrentState:s,renderOrigin:e=>{let{onClick:t}=e;return(0,je.jsx)(Qo,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{u(d)}})}},`changes_to_any_${d}_trigger`):(0,je.jsx)(bi,{automationStore:t,property:d,collectionStore:o,updateCurrentState:s,renderOrigin:e=>{let{onClick:t}=e;return(0,je.jsx)(Ye,{disabled:i,filter:p,propertySchema:g,onEdit:t,onDelete:()=>{u(d)}})}},`changes_to_any_${d}_trigger`):(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,popupType:l,render:()=>(0,je.jsx)(vi,{onDelete:()=>{s({type:"remove_trigger",trigger:{filter:p,property:d,type:"property_changed"}})},onViewEditProperty:r,propertyId:d,propertySchema:g,stepType:"trigger"}),renderOrigin:e=>(0,n.createElement)($o,{...e,key:`unsupported_${d}_trigger`,disabled:i,onClick:()=>e.onClick(),propertySchema:g})},`unsupported_property_${d}_trigger`):(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,popupType:l,render:()=>(0,je.jsx)(li,{stepType:"trigger",onDelete:()=>{s({type:"remove_trigger",trigger:{filter:p,property:d,type:"property_changed"}})},onViewDeletedProperties:a}),renderOrigin:e=>(0,je.jsx)(ai,{...e,disabled:i,propertyId:d,collectionStore:o})},`deleted_property_${d}_trigger`)})).filter(oe.$K)),(0,je.jsx)("ul",{style:p.stepList,children:g.map(((e,t)=>(0,je.jsx)("li",{style:0===t?{}:p.stepItemWithBorderTop,children:e},t)))})}function bi(e){window.__c={n:"AdvancedTriggerPopup"};const{automationStore:t,renderOrigin:o,collectionStore:n,property:i,updateCurrentState:r}=e,a=(0,Zt.d)();return(0,je.jsx)(he.ZP,{popupType:a,renderOrigin:o,render:e=>(0,je.jsx)(fi,{automationStore:t,collectionStore:n,initialState:{type:"propertyChangedFilter",property:i},updateCurrentAutomationState:r,buttonPopupParent:e})})}function wi(e){window.__c={n:"AutomationTriggerPagedAdded"};const{disabled:t,updateCurrentState:o}=e,i=(0,a.useIntl)(),r=Mi(),s=le.Mz(i),l=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),c=(0,n.useCallback)((()=>o({trigger:{type:"page_added"},type:"remove_trigger"})),[o]),d=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,icon:V.R,onClick:l,onDelete:c,title:(0,je.jsx)("div",{style:r.semiBoldTitle,children:s})})),[t,l,c,r.semiBoldTitle,s]);return(0,je.jsx)(Pe,{renderOrigin:d,title:s,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function ji(e){window.__c={n:"AutomationTriggerAnyPropertyEdited"};const{disabled:t,updateCurrentState:o}=e,i=(0,a.useIntl)(),r=Mi(),s=le.c5(i),l=(0,n.useCallback)((e=>{e.setState({open:!0})}),[]),c=(0,n.useCallback)((()=>{o({type:"remove_trigger",trigger:{type:"any_page_property_edited"}})}),[o]),d=(0,n.useCallback)((e=>(0,je.jsx)(_e,{...e,disabled:t,onClick:l,icon:A.R,title:(0,je.jsx)("div",{style:r.semiBoldTitle,children:s}),onDelete:c})),[t,l,c,r.semiBoldTitle,s]);return(0,je.jsx)(Pe,{renderOrigin:d,title:s,tooltipAlignment:ae.Z.Alignment.Center,tooltipPlacement:ae.Z.Placement.Left})}function Mi(){return(0,y.yK)((e=>({stepList:{border:`1px solid ${e.stroke.regular}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},semiBoldTitle:{fontWeight:ne.Z.fontWeight.semibold},stepItemWithBorderTop:{borderTop:`1px solid ${e.stroke.regular}`}})),[])}var _i=o(85740),Ti=o(28267),ki=o(64737),Pi=o(73266),Ai=o(73239),Vi=o(29180),Fi=o(43690),Bi=o(52105);function Ii(e){window.__c={n:"UpdatePagesActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,r=(0,m.VK)((()=>t.getConfig()),[t]),a=(0,n.useCallback)((e=>{var t;const n="collection"===e.type&&"collection"===(null==r||null===(t=r.target)||void 0===t?void 0:t.type)&&e.collection.id!==(null==r?void 0:r.target.collection.id);o({action:{config:{...r,target:e,properties:n?[]:(null==r?void 0:r.properties)??[],values:n?{}:(null==r?void 0:r.values)??{}},id:i,type:"update_pages"},type:"update_action"})}),[r,i,o]),s=(0,n.useCallback)(((e,t)=>{o({action:{config:{...r,properties:e,values:t},id:i,type:"update_pages"},type:"update_action"})}),[i,r,o]),l=(0,n.useCallback)((()=>{o({action:{config:r,id:i,type:"update_pages"},type:"remove_action"})}),[r,i,o]);return(0,je.jsx)(Zi,{...e,onConfigChange:s,onDelete:l,onTargetChange:a})}function Zi(e){window.__c={n:"UpdatePagesActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:r,onConfigChange:a,onDelete:s,onTargetChange:l}=e,c=(0,n.useRef)(null),d=(0,Ti.X)(c),u=(0,Pi.a)(d),[p,g]=(0,n.useState)(!1),h=(0,x.z)("update_pages"),S=Ee({automationStore:o,collectionStore:i}),f=(0,m.VK)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),[v,C,b]=(0,m.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.target,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),w=(0,n.useMemo)((()=>({values:b??{},properties:C??[]})),[b,C]),j=(0,m.VK)((()=>"collection"===(null==f?void 0:f.type)),[f]),M=(0,m.VK)((()=>{const e=t.getTargetStore().getValue();if(e&&S){if("collection"===e.type)return gt.NW.createChildStore(S.context.parentRecordStore,e.collection);if("variable"===e.type){const t=S.compilationResultStore.state;if(Co.x.isFail(t))return;const o=(0,Be.vx)(t.value.valueTypes,e.id);if(o)return(0,Re.wB)(o,S.context.parentRecordStore)}else{if("page"===e.type)return;(0,oe.t1)(e)}}}),[t,S]),_=(0,m.VK)((()=>{if("collection"!==(null==v?void 0:v.type))return;const e=v.filter;return(0,oe.$K)(e)?(0,Fi.Ih)(e,(null==M?void 0:M.getSchema())??{}):void 0}),[v,M]),T=(0,n.useCallback)((e=>{if(!(0,oe.$K)(v))return void l(e);const t=v.type!==e.type,o="variable"===v.type&&"variable"===e.type&&v.id!==e.id,n="collection"===v.type&&"collection"===e.type&&v.collection.id!==e.collection.id;(t||o||n)&&l(e)}),[v,l]),k=(0,n.useCallback)((e=>{(0,oe.$K)(v)&&"collection"===v.type&&(He.Xy(v.filter,e)||l({...v,filter:e}))}),[v,l]),P=(0,n.useCallback)((e=>{const t=w.properties.concat([e]);a(t,w.values)}),[a,w]),A=(0,n.useCallback)(((e,t)=>{const o=w.properties.indexOf(e);if(-1===o)return;const n=w.properties.slice(0);n[o]=t;const i={...w.values,[t]:void 0};a(n,i)}),[a,w]),V=(0,n.useCallback)((e=>{const t=w.properties.filter((t=>t!==e)),o={...w.values,[e]:void 0};a(t,o)}),[a,w]),F=(0,n.useCallback)(((e,t)=>{const o={...w.values,[e]:t};a(w.properties,o)}),[a,w]),B=(0,n.useCallback)((()=>{g(!0)}),[]),I=(0,n.useCallback)((()=>{g(!1)}),[]),Z=(0,y.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:u?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[u]);return S?(0,je.jsxs)("section",{onMouseEnter:B,onMouseLeave:I,ref:c,style:Z.sectionWrap,children:[(0,je.jsxs)(Ri,{disabled:r,icon:h.display.icon({height:21,width:14}),isHovered:p,onDelete:s,children:[(0,je.jsx)("div",{style:Z.headerTitle,children:(0,je.jsx)(Di,{actionStore:t,automationContextStore:S,disabled:r,onChange:T,value:f})}),j&&(0,oe.$K)(M)&&(0,je.jsx)("div",{style:Z.headerTitle,children:(0,je.jsx)(Ki,{automationContextStore:S,collectionStore:M,disabled:r,filter:_,onChange:k})})]}),M&&(0,je.jsx)(mo.vV,{actionId:t.id,collectionStore:M,config:w,contextStore:S,disabled:r,onPropertyAdd:P,onPropertyChange:A,onPropertyRemove:V,onPropertyValueChange:F,showSetPropertyActions:!0})]}):null}function Di(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:r}=e,s=(0,y.yK)((()=>({b:{fontWeight:ne.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,_i.H)({})}})),[]);return(0,je.jsx)(a.FormattedMessage,{defaultMessage:"<span>Update <b>pages</b> in </span>{collectionPicker}",id:"automations.UpdatePagesActionV2.header.title",values:{b:e=>(0,je.jsx)("b",{style:s.b,children:e}),collectionPicker:(0,je.jsx)("div",{style:s.picker,children:(0,je.jsx)(Ai.a,{actionStore:t,contextStore:o,currentValue:r,disabled:n,onChange:i})}),span:e=>(0,je.jsx)("span",{style:s.span,children:e})}})}function Ki(e){window.__c={n:"CollectionFilterTitle"};const{automationContextStore:t,collectionStore:o,disabled:n,filter:i,onChange:r}=e,s=(0,g.O7)(),l=(0,a.useIntl)(),c=(0,m.VK)((()=>(0,pt.vU)({environment:s,intl:l,store:o})),[o,l,s]),d=(0,y.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,_i.H)({})}})),[]);return(0,je.jsx)(a.FormattedMessage,{defaultMessage:"<span>that match </span>{filterPicker}",id:"automations.UpdatePagesActionV2.header.filterTitle",values:{filterPicker:(0,je.jsx)("div",{style:d.picker,children:(0,je.jsx)(Bi.W,{collectionStore:o,contextStore:t,disabled:n,filter:i,noFiltersMessage:(0,oe.$K)(c)?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"All pages in {collectionName}",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.label",values:{collectionName:c}}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"All pages in database",id:"automations.UpdatePagesAction.filterRuleCount.noFilters.fallbackLabel"}),onChange:r})}),span:e=>(0,je.jsx)("span",{style:d.span,children:e})}})}function Ri(e){window.__c={n:"ActionHeader"};const{children:t,disabled:o,icon:n,isHovered:i,onDelete:r}=e,{isMobile:a}=(0,g.Fy)(),[s,l]=(0,de.Z)(),c=!o&&(a||i||l),d=(0,y.yK)((()=>({wrap:{alignItems:"start",cursor:o?"default":void 0,opacity:o?.4:void 0,display:"flex",gap:6,minHeight:28},iconWrap:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,_i.H)({})},titleWrap:{display:"flex",flex:"1 1 auto",flexWrap:"wrap",fontSize:14,lineHeight:1.4,minWidth:0},moreButtonWrap:{flex:"0 0 26px"}})),[o]);return(0,je.jsxs)("header",{ref:s,style:d.wrap,children:[n&&(0,je.jsx)("div",{style:d.iconWrap,children:n}),(0,je.jsx)("div",{style:d.titleWrap,children:t}),(0,je.jsx)("div",{style:d.moreButtonWrap,children:c&&(0,je.jsx)(Te,{disabled:o,onDelete:r})})]})}function Ni(e){window.__c={n:"CreatePageActionDatabaseAutomation"};const{actionStore:t,updateCurrentAutomationState:o}=e,i=t.id,r=(0,m.VK)((()=>t.getConfig()),[t]),a=(0,n.useCallback)((e=>{o({action:{config:{...r,collection:e,properties:["title"],values:{},template_page_id:void 0},id:i,type:"create_page"},type:"update_action"})}),[i,r,o]),s=(0,n.useCallback)((e=>{if(!r)return;const{properties:t,values:n}=r;let a=!1;if(e&&t&&1===t.length&&t.includes("title")){var s;const e=null==n?void 0:n.title;e&&null!==(s=e.value)&&void 0!==s&&s.value||(a=!0)}o({action:{config:{...r,template_page_id:e,...a&&{properties:[]}},id:i,type:"create_page"},type:"update_action"})}),[i,r,o]),l=(0,n.useCallback)(((e,t)=>{o({action:{config:{...r,properties:e,values:t},id:i,type:"create_page"},type:"update_action"})}),[i,r,o]),c=(0,n.useCallback)((()=>{o({action:{config:r,id:i,type:"create_page"},type:"remove_action"})}),[r,i,o]);return(0,je.jsx)(Oi,{...e,onConfigChange:l,onDelete:c,onTargetCollectionChange:a,onTemplateChange:s})}function Oi(e){window.__c={n:"CreatePageActionV2"};const{actionStore:t,automationStore:o,collectionStore:i,disabled:r,onConfigChange:a,onDelete:s,onTargetCollectionChange:l,onTemplateChange:c}=e,d=(0,n.useRef)(null),u=(0,Ti.X)(d),p=(0,Pi.a)(u),g=(0,x.z)("create_page"),[h,S]=(0,n.useState)(!1),[f,v,C]=(0,m.VK)((()=>{const e=t.getConfig();return[null==e?void 0:e.collection,null==e?void 0:e.properties,null==e?void 0:e.values]}),[t]),b=(0,m.VK)((()=>{if(f)return gt.NW.createChildStore(i,f)}),[i,f]),w=(0,m.VK)((()=>{const e=t.getCollectionStore();if(e)return{collection:e.getSpaceShardedPointer(),type:"collection"}}),[t]),j=(0,m.VK)((()=>(0,ki.q)(b).length>0),[b]),M=(0,m.VK)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.template_page_id}),[t]),_=Ee({automationStore:o,collectionStore:i}),T=(0,n.useMemo)((()=>({values:C??{},properties:v??[]})),[C,v]),k=(0,n.useCallback)((e=>{l&&"collection"===e.type&&l(e.collection)}),[l]),P=(0,n.useCallback)((e=>{const t=T.properties.concat([e]);a(t,T.values)}),[a,T]),A=(0,n.useCallback)(((e,t)=>{const o=T.properties.indexOf(e);if(-1===o)return;const n=T.properties.slice(0);n[o]=t;const i={...T.values,[t]:void 0};a(n,i)}),[a,T]),V=(0,n.useCallback)((e=>{const t=T.properties.filter((t=>t!==e)),o={...T.values,[e]:void 0};a(t,o)}),[a,T]),F=(0,n.useCallback)(((e,t)=>{const o={...T.values,[e]:t};a(T.properties,o)}),[a,T]),B=(0,n.useCallback)((()=>{S(!0)}),[]),I=(0,n.useCallback)((()=>{S(!1)}),[]),Z=(0,y.yK)((e=>({sectionWrap:{background:e.cardContentBackground,display:"flex",flexDirection:"column",gap:p?12:16,paddingBlock:12,paddingInline:12},headerTitle:{alignItems:"center",display:"flex",flexWrap:"wrap",minWidth:100,whiteSpace:"pre"}})),[p]);return _?(0,je.jsxs)("section",{onMouseEnter:B,onMouseLeave:I,ref:d,style:Z.sectionWrap,children:[(0,je.jsxs)(Ri,{disabled:r,icon:g.display.icon({height:21,width:14}),isHovered:h,onDelete:s,children:[(0,je.jsx)("div",{style:Z.headerTitle,children:(0,je.jsx)(Ei,{actionStore:t,automationContextStore:_,disabled:r,onChange:k,value:w})}),(0,oe.$K)(b)&&j&&(0,je.jsx)("div",{style:Z.headerTitle,children:(0,je.jsx)(Li,{collectionStore:b,disabled:r,onChange:c,value:M})})]}),b&&(0,je.jsx)(mo.vV,{actionId:t.id,collectionStore:b,config:T,contextStore:_,disabled:r,onPropertyAdd:P,onPropertyChange:A,onPropertyRemove:V,onPropertyValueChange:F,showSetPropertyActions:!1})]}):null}function Ei(e){window.__c={n:"ActionTitle"};const{actionStore:t,automationContextStore:o,disabled:n,onChange:i,value:r}=e,s=(0,y.yK)((()=>({b:{fontWeight:ne.Z.fontWeight.medium},picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,_i.H)({})}})),[]);return(0,je.jsx)(a.FormattedMessage,{defaultMessage:"<span>Add <b>page</b> to </span>{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{b:e=>(0,je.jsx)("b",{style:s.b,children:e}),collectionPicker:(0,je.jsx)("div",{style:s.picker,children:(0,je.jsx)(Ai.a,{actionStore:t,contextStore:o,currentValue:r,disabled:n,onChange:i})}),span:e=>(0,je.jsx)("span",{style:s.span,children:e})}})}function Li(e){window.__c={n:"CollectionTemplateTitle"};const{collectionStore:t,disabled:o,onChange:n,value:i}=e,r=(0,y.yK)((()=>({picker:{flex:"1 1 auto",marginInlineStart:-5,minWidth:50},span:{alignItems:"center",display:"inline-flex",flex:"0 0 auto",minHeight:(0,_i.H)({})}})),[]);return(0,je.jsx)(a.FormattedMessage,{defaultMessage:"<span>as </span>{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,je.jsx)(Vi.f,{collectionStore:t,currentTemplateId:i,disabled:o,onChange:n}),span:e=>(0,je.jsx)("span",{style:r.span,children:e})}})}function Wi(e){const{automationStore:t,collectionStore:o,disabled:n,formulaValueContext:i,onClick:r,onEdit:a,propertySchema:s,setPropertyValue:l,onDelete:c}=e;return"person"===s.type?(0,je.jsx)(st,{collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"status"===s.type?(0,je.jsx)(ft,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"select"===s.type?(0,je.jsx)(tt,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"multi_select"===s.type?(0,je.jsx)(rt,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"date"===s.type?(0,je.jsx)(Le,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value,valueContext:i}):"relation"===s.type?(0,je.jsx)(mt,{automationStore:t,collectionStore:o,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"checkbox"===s.type?(0,je.jsx)(Ae,{disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"title"===s.type?(0,je.jsx)(Mt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"text"===s.type?(0,je.jsx)(_t,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"email"===s.type?(0,je.jsx)(Tt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"url"===s.type?(0,je.jsx)(kt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"number"===s.type?(0,je.jsx)(Pt,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):"phone_number"===s.type?(0,je.jsx)(At,{automationStore:t,disabled:n,onClick:r,onDelete:c,onEdit:a,propertySchema:s,value:l.value}):null}function Gi(e){window.__c={n:"CollectionSettingsAutomationActionList"};const{automationStore:t,collectionStore:o,updateCurrentAutomationState:n,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:r,currentUserIsOwner:a,disabled:s}=e,l=(0,m.VK)((()=>t.getActionStores().map((e=>e.isType("update_pages")?(0,je.jsx)(Hi,{actionStore:e,automationStore:t,collectionStore:o,disabled:s,handleNavigateToDeletedProperties:i,handleNavigateToEditProperty:r,updateCurrentAutomationState:n},e.id):e.isType("slack_notification")?(0,je.jsx)(No,{actionStore:e,automationStore:t,collectionStore:o,updateCurrentAutomationState:n,currentUserIsOwner:a,disabled:s},e.id):e.isType("create_page")?(0,je.jsx)(Ni,{actionStore:e,automationStore:t,collectionStore:o,disabled:s,updateCurrentAutomationState:n},e.id):void 0)).filter(oe.$K)),[t,o,a,s,i,r,n]),c=(0,y.yK)((e=>({stepList:{border:`1px solid ${e.regularDividerColor}`,borderRadius:6,listStyle:"none",margin:0,overflow:"hidden",padding:0},stepItemWithBorderTop:{borderTop:`1px solid ${e.regularDividerColor}`}})),[]);return(0,je.jsx)("ul",{style:c.stepList,children:l.map(((e,t)=>{const o=0===t?void 0:c.stepItemWithBorderTop;return(0,je.jsx)("li",{style:o,children:e},t)}))})}function Hi(e){var t;window.__c={n:"InternalUpdatePageAction"};const{actionStore:o,automationStore:i,collectionStore:r,disabled:a,handleNavigateToDeletedProperties:s,handleNavigateToEditProperty:l,updateCurrentAutomationState:c}=e,d=(0,Zt.d)(),u=(0,m.VK)((()=>o.getConfig()),[o]),p=(0,m.VK)((()=>r.getSchema()),[r]),g=(0,n.useCallback)((()=>{c({action:{config:u,id:o.id,type:"update_pages"},type:"remove_action"})}),[u,o.id,c]),y="variable"===(null==u||null===(t=u.target)||void 0===t?void 0:t.type)?(0,Be.MY)(u.target.id):void 0;if(y&&"global"===y.source&&"button_page"===y.global){var h;const e=((null==u?void 0:u.properties)??[])[0],t=p[e],m=null==u||null===(h=u.values)||void 0===h?void 0:h[e];if(t&&m){const s={type:"collection",collectionStore:r,property:e};return(0,f.SF)(t)?(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,popupType:d,render:t=>(0,je.jsx)(Ko,{automationStore:i,buttonPopupParent:t,collectionStore:r,initialState:{propertyId:e,actionId:o.id,type:"eventActionProperty"},updateCurrentAutomationState:c}),renderOrigin:e=>(0,je.jsx)(Wi,{...e,automationStore:i,collectionStore:r,disabled:a,formulaValueContext:s,onDelete:g,onEdit:e.onClick,propertySchema:t,setPropertyValue:m})}):(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,popupType:d,render:()=>(0,je.jsx)(vi,{onDelete:g,onViewEditProperty:l,propertyId:e,propertySchema:t,stepType:"action"}),renderOrigin:o=>(0,n.createElement)($o,{...o,key:`unsupported_${e}_action`,disabled:a,onClick:()=>o.onClick(),propertySchema:t})},`unsupported_property_${e}_action`)}return t?null:(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.Center,placementToOrigin:he.pO.Bottom,popupType:d,render:e=>(0,je.jsx)(li,{stepType:"action",onDelete:g,onViewDeletedProperties:s}),renderOrigin:t=>(0,je.jsx)(ai,{...t,disabled:a,propertyId:e,collectionStore:r})})}return(0,je.jsx)(Ii,{actionStore:o,automationStore:i,collectionStore:r,disabled:a,updateCurrentAutomationState:c})}var zi=o(3386),Ui=o(68641),$i=o(84398);var qi=o(18844);var Qi=o(13273);var Yi=o(16184),Xi=o(42402);const Ji=(0,a.defineMessages)({automationIncompatibleViewFilterAndOwner:{defaultMessage:"This automation may not work because the view has a non-supported filter",id:"AutomationHeaderView.incompatibleCollectionViewFilter.owner"},automationPublicAccess:{defaultMessage:"This automation is part of a public page",id:"AutomationHeaderView.automationPublicAccess"},automationUpgrade:{defaultMessage:"<anchor-upsell>Upgrade</anchor-upsell> to edit this automation or create your own",id:"AutomationHeaderView.automationUpgrade"},automationEditOnSite:{defaultMessage:"This automation can only be edited on notion.com",id:"AutomationHeaderView.automationEditOnSite"},automationSlackNoPermissions:{defaultMessage:"Ask {user} to edit this automation",id:"AutomationHeaderView.automationSlackNoPermissions"},automationSlackWithPermissions:{defaultMessage:"Ask {user} to edit this automation or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationSlackWithPermissions"},automationMissingPermissionsNoPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it",id:"AutomationHeaderView.automationMissingPermissionsNoPermissions"},automationMissingPermissionsWithPermissions:{defaultMessage:"You must have full access to target databases in this automation to edit it or <anchor-delete>delete</anchor-delete> it when necessary",id:"AutomationHeaderView.automationMissingPermissionsWithPermissions"},automationGenericFullAccess:{defaultMessage:"You must have full access to this database to edit automations",id:"AutomationHeaderView.automationGenericFullAccess"}});function er(e){window.__c={n:"AutomationHeaderView"};const{automationStore:t,automationPermissionScope:o,collectionStore:i,onDelete:r,referencesIncompatibleCollectionViewFilter:s}=e,l=(0,g.O7)(),c=Ee({automationStore:t,collectionStore:i}),d=(0,m.VK)((()=>Boolean((0,Bt.IJ)(l,t))),[t,l]),u=(0,m.VK)((()=>(0,io.$5)(null==c?void 0:c.context)),[c]),p=(0,m.VK)((()=>(0,Re.R4)(t)),[t]),y=(0,n.useCallback)((()=>{oo.y(l,{from:"database_automation_settings_header_message",for:"plus"})}),[l]),h=nr();if(d)return(0,je.jsx)(tr,{icon:(0,je.jsx)("div",{style:h.lockedIconWrap,children:(0,Yi.Q)(h.lockedIcon)}),children:(0,je.jsx)("p",{style:h.paragraph,children:(0,je.jsx)(a.FormattedMessage,{...Ji.automationPublicAccess})})});if("sufficient"!==u.editPermissionStatus&&"free_workspace"===u.reason)return(0,io.Rr)({environment:l})?(0,je.jsx)(or,{icon:(0,je.jsx)("div",{style:h.boltIconWrap,children:(0,T.K)(h.boltIcon)}),children:(0,je.jsx)("p",{style:h.paragraph,children:(0,je.jsx)(a.FormattedMessage,{...Ji.automationUpgrade,values:{"anchor-upsell":e=>(0,je.jsx)(Xi.Z,{onClick:y,style:h.link,children:e})}})})}):(0,je.jsx)(tr,{icon:(0,je.jsx)("div",{style:h.lockedIconWrap,children:(0,Yi.Q)(h.lockedIcon)}),children:(0,je.jsx)("p",{style:h.paragraph,children:(0,je.jsx)(a.FormattedMessage,{...Ji.automationEditOnSite})})});if("sufficient"!==u.editPermissionStatus&&"missing_permissions"===u.reason&&u.actionId){const e=p[u.actionId];return(0,je.jsx)(tr,{icon:(0,je.jsx)("div",{style:h.lockedIconWrap,children:(0,Yi.Q)(h.lockedIcon)}),children:(0,je.jsx)("p",{style:h.paragraph,children:(0,je.jsx)(a.FormattedMessage,{..."readonly"===o?Ji.automationSlackNoPermissions:Ji.automationSlackWithPermissions,values:{"anchor-delete":e=>(0,je.jsx)(Xi.Z,{onClick:r,style:h.link,children:e}),user:e}})})})}return"insufficient"===u.editPermissionStatus||"unknown"===u.editPermissionStatus?(0,je.jsx)(tr,{icon:(0,je.jsx)("div",{style:h.lockedIconWrap,children:(0,Yi.Q)(h.lockedIcon)}),children:(0,je.jsx)("p",{style:h.paragraph,children:(0,je.jsx)(a.FormattedMessage,{...Ji.automationGenericFullAccess})})}):s?(0,je.jsx)(tr,{icon:(0,je.jsx)("div",{style:h.lockedIconWrap,children:(0,Ft.t)(h.warningIcon)}),children:(0,je.jsx)(a.FormattedMessage,{...Ji.automationIncompatibleViewFilterAndOwner})}):null}function tr(e){window.__c={n:"AutomationMessage"};const{children:t,icon:o}=e,n=nr();return(0,je.jsx)("div",{style:n.wrapWrap,children:(0,je.jsxs)("div",{style:n.wrap,children:[o&&(0,je.jsx)("div",{style:n.iconWrap,children:o}),(0,je.jsx)("div",{style:n.messageWrap,children:t})]})})}function or(e){window.__c={n:"AutomationUpsellMessage"};const{children:t,icon:o}=e,n=nr();return(0,je.jsx)("div",{style:n.wrapWrap,children:(0,je.jsxs)("div",{style:n.upsellWrap,children:[o&&(0,je.jsx)("div",{style:n.iconWrap,children:o}),(0,je.jsx)("div",{style:n.messageWrap,children:t})]})})}function nr(){const{isMobile:e}=(0,g.Fy)();return(0,y.yK)((t=>({boltIcon:{fill:t.icon.yellow,height:"100%",width:"100%"},boltIconWrap:{height:20,padding:2,width:20},icon:{},iconWrap:{flexGrow:0,flexShrink:0},lockedIcon:{fill:t.icon.secondary,height:"100%",width:"100%"},lockedIconWrap:{background:t.fill.lightGray,borderRadius:3,height:20,padding:2,width:20},link:{color:t.text.interactive},messageWrap:{flexGrow:1},paragraph:{color:t.text.secondary,fontSize:e?14:12,margin:0},warningIcon:{color:t.accentColors.orange[400],height:"100%",width:"100%"},warningIconWrap:{height:20,padding:2,width:20},wrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:10},wrapWrap:{padding:e?12:"0 12px 12px 12px"},upsellWrap:{alignItems:"center",background:t.accentColors.yellow[50],border:`1px solid ${t.accentColors.yellow[100]}`,borderRadius:6,display:"flex",flexDirection:"row",gap:10,padding:8},personBadgeQuestionMark:{fill:t.mediumIconColor,width:16,height:"auto"},personBadgeQuestionMarkWrap:{height:20,padding:2,width:20}})),[e])}var ir=o(24006);const rr=(0,a.defineMessages)({automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}});function ar(e){window.__c={n:"AutomationSectionStatus"};const{automationId:t,automationOwner:o,disabled:i,isAutomationPaused:r,onPause:s,onResume:l}=e,c=`toggle-${t}`,d=(0,n.useCallback)((()=>{r?null==l||l():null==s||s()}),[r,l,s]),u=(0,y.yK)((e=>({labelWrap:{color:i?e.text.tertiary:r?e.text.secondary:e.text.primary,flex:"1 1 auto",fontSize:14},sectionWrap:{alignItems:"start",display:"flex",flexDirection:"row",gap:6,marginBlockEnd:12},toggleWrap:{flex:"0 0 auto",paddingBlockStart:2}})),[i,r]),p=r?rr.automationPausedLabel:rr.automationEnabledLabel,g=r?rr.automationPausedHiddenAriaLabel:rr.automationEnabledHiddenAriaLabel;return(0,je.jsxs)("section",{style:u.sectionWrap,children:[(0,je.jsx)("div",{style:u.toggleWrap,children:(0,je.jsx)(ae.Z,{disableTooltip:!i||!r,renderTooltip:()=>(0,je.jsx)(a.FormattedMessage,{...rr.automationDisabledTooltip,values:{user:o}}),render:e=>(0,je.jsx)("div",{...e,children:(0,je.jsx)(ir.Z,{disabled:i,inputId:c,on:!r,onClick:d})})})}),(0,je.jsx)("div",{style:u.labelWrap,children:(0,je.jsxs)("label",{htmlFor:c,children:[(0,je.jsx)("span",{"aria-hidden":!0,children:(0,je.jsx)(a.FormattedMessage,{...p})}),(0,je.jsx)("span",{style:jn.jy,children:(0,je.jsx)(a.FormattedMessage,{...g})})]})})]})}const sr=(0,a.defineMessages)({createAutomationViewMenuTitle:{id:"collectionSettings.createStatusAutomationView.menuTitle",defaultMessage:"New automation"},editAutomationViewMenuTitle:{id:"collectionSettings.editStatusAutomationView.menuTitle",defaultMessage:"Edit automation"},addTriggerAriaLabel:{id:"collectionSettings.editAutomationView.addTrigger.iconButton",defaultMessage:"Add trigger"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},deleteButton:{id:"collectionSettings.editAutomationView.deleteButton",defaultMessage:"Delete"},automationEnabledLabel:{defaultMessage:"Active",id:"collectionSettings.editAutomationView.automationEnabledLabel"},automationPausedLabel:{defaultMessage:"Paused",id:"collectionSettings.editAutomationView.automationPausedLabel"},automationEnabledHiddenAriaLabel:{defaultMessage:"Automation is active.",id:"collectionSettings.editAutomationView.automationEnabledHiddenAriaLabel"},automationPausedHiddenAriaLabel:{defaultMessage:"Automation is paused.",id:"collectionSettings.editAutomationView.automationPausedHiddenAriaLabel"},automationDisabledTooltip:{defaultMessage:"Ask {user} to resume this automation.",id:"collectionSettings.editAutomationView.automationDisabledTooltip"}}),lr=()=>{};function cr(e){window.__c={n:"CollectionSettingsEditAutomationView"};const{collectionSettingsStore:t,collectionContextStore:o,...i}=e,s=(0,n.useMemo)((()=>i),[]),{mode:c}=s,u=(0,a.useIntl)(),p=(0,nn.D)(),h=(0,g.O7)(),{isMobile:x}=(0,g.Fy)(),v=(0,Zt.d)(),C="create"===c,b=(0,$i.$)("CollectionSettingsEditAutomationView",{cacheFallback:h.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),w=(0,m.VK)((()=>_o.default.state.currentUserStore),[]),j=(0,m.VK)((()=>null==w?void 0:w.userId),[w]),M=(0,m.VK)((()=>null==w?void 0:w.getDisplayName(u)),[w,u]),_=(0,m.VK)((()=>{var e;return null===(e=_o.default.state.currentSpaceStore)||void 0===e?void 0:e.getSpaceId()}),[]),T=(0,m.VK)((()=>(0,ao.sX)()),[]),k=(0,m.VK)((()=>o.collectionStore()),[o]),P=(0,m.VK)((()=>null==k?void 0:k.id),[k]),A=(0,m.VK)((()=>null==k?void 0:k.getSchema()),[k]),F=(0,m.VK)((()=>(0,Ui.jI)({timelineViewTab:"timeline",collectionContextStore:o})),[o]),B=(0,n.useMemo)((()=>"update"===s.mode?s.automationId:(0,r.ZP)()),[s]),I=(0,m.VK)((()=>o.aliveAutomationCount.state),[o]),Z=(0,m.VK)((()=>{if(_&&k&&j)return new gt.Mz(h,{id:B,table:rn.cv,spaceId:_})}),[B,k,j,h,_]),D=(0,m.VK)((()=>(null==Z?void 0:Z.getStatus())??"disabled"),[Z]),K="active"===D,R=(0,m.VK)((()=>(0,f.XO)(u,M)),[M,u]),N=(0,m.VK)((()=>{if(!_||!k||!j)return;const e={id:B,table:rn.cv,spaceId:_},t=b.getEntry({pointer:e,userId:j});return t?t.value.value:Re.sA({automationId:B,automationName:R,collectionStore:k,userId:j})}),[R,B,k,j,_,b]),O=(0,m.VK)((()=>{if(!_||!k)return;const e={id:B,table:rn.cv,spaceId:_},t=b.getEntry({pointer:e,userId:j});C&&!(0,oe.$K)(t)&&j&&b.setRecord({pointer:e,userId:j},{role:"editor",value:N});const o=new gt.Mz(h,e,{inMemoryRecordCache:b});return Re.Xd(o)?o:void 0}),[N,B,k,j,h,C,_,b]),E=(0,m.VK)((()=>(null==O?void 0:O.getName())??""),[O]),L=(0,m.VK)((()=>{var e;return(null==O||null===(e=O.getOwnerStore())||void 0===e?void 0:e.getDisplayName(u))??""}),[u,O]),W=(0,m.VK)((()=>{if(O&&(0,Re.Xd)(O)){const e=O.getTriggerStore().getKeyStore("event").getKeyStore("source").getValue();if(e&&"filter"!==e.type)return e.pointer}}),[O]),G=(0,m.VK)((()=>((null==O?void 0:O.getActionStores())??[]).filter((e=>e.isDefined()))),[O]),H=function(e){const{actionStores:t,automationStore:o,loadingStatus:n,mode:i}=e;return(0,m.VK)((()=>"create"===i?"edit":"resolved"===n&&o&&t?(0,Re.i1)({automationStore:o,actionStores:t})?"edit":(0,Re.qM)({automationStore:o})?"readonly_with_delete":"readonly":"readonly"),[i,n,o,t])}({automationStore:O,actionStores:G,loadingStatus:"resolved",mode:s.mode}),z="readonly_with_delete"===H||"edit"===H&&!C,U="edit"===H,$=(0,m.VK)((()=>{if(!O||!w)return!1;const e=w.pointer,t=O.getCreatedByPointer();return!(!e||!t)&&te.dr.isEqual(e,t)}),[O,w]),q=Ee({automationStore:O,collectionStore:k}),Q=Ee({automationStore:Z,collectionStore:k}),Y=function(e){const{contextStore:t}=e,[o,i]=(0,n.useState)([]),r=(0,m.VK)((()=>t?(0,io.uV)(t.context.automationStore,t.context.type):void 0),[t]);return(0,m.VK)((()=>{r?(0,Re.P$)({automationAvailabilityContext:r}).then((e=>i(function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.display.hasSideEffects)-t(e.display.hasSideEffects)))}(e))),(()=>i([]))):o.length>0&&i([])}),[o.length,r]),o}({contextStore:q}),X=(0,m.VK)((()=>!!(0,oe.$K)(O)&&function(e){if(!(0,Re.Xd)(e))return!1;const t=e.getTriggerStore().getKeyStore("event").getValue();return(null==t?void 0:t.pagesAdded)||"none"!==(null==t?void 0:t.pagePropertiesEdited.type)}(O)),[O]),J=(0,m.VK)((()=>!!(0,oe.$K)(O)&&function(e){return e.getActionIds().length>0}(O)),[O]),ee=0===Y.length,ie=(0,m.VK)((()=>!(!O||!k)&&Re.vM({automationStore:O,collectionStore:k})),[O,k]),re=(0,m.VK)((()=>!!(k&&O&&q)&&Re.qk({automationContextStore:q,automationStore:O,collectionStore:k})),[q,O,k]),ae=(0,m.VK)((()=>!!(k&&Z&&Q)&&Re.qk({automationContextStore:Q,automationStore:Z,collectionStore:k})),[k,Q,Z]),se=function(e){var t,o,n;const{automationStorePointer:i,defaultRecordCache:r,inMemoryRecordCache:a,userId:s}=e;if(!i||!s)return!1;const l=null===(t=r.getEntry({pointer:i,userId:s}))||void 0===t?void 0:t.value.value,c=null===(o=a.getEntry({pointer:i,userId:s}))||void 0===o?void 0:o.value.value;return!(0,oe.$K)(l)||!(0,He.Xy)(l,c)||Boolean(null==c||null===(n=c.action_ids)||void 0===n?void 0:n.some((e=>{var t,o;const n={id:e,spaceId:i.spaceId,table:qi.Xj},l=null===(t=r.getEntry({pointer:n,userId:s}))||void 0===t?void 0:t.value.value,c=null===(o=a.getEntry({pointer:n,userId:s}))||void 0===o?void 0:o.value.value;return!(0,oe.$K)(l)||!(0,He.Xy)(l,c)})))}({automationStorePointer:null==O?void 0:O.pointer,defaultRecordCache:h.defaultRecordCache.inMemoryRecordCache,inMemoryRecordCache:b,userId:j}),le=(0,n.useMemo)((()=>({type:"eventTriggers"})),[]),ce=(0,n.useMemo)((()=>({type:"eventActions",availableActions:Y})),[Y]);!function(e){const{automationStore:t,collectionStoreId:o,eventTracker:i,isCreate:r}=e,[a,s]=(0,n.useState)(!1),l=(0,m.VK)((()=>(null==t?void 0:t.getActionIds().length)??0),[t]),c=(0,m.VK)((()=>{if(!t||!(0,Re.Xd)(t))return 0;const e=t.getTriggerStore().getKeyStore("event");let o=0;e.getKeyStore("pagesAdded").getValue()&&o++;const n=e.getKeyStore("pagePropertiesEdited").getValue();return"any"===(null==n?void 0:n.type)?o++:"some"===(null==n?void 0:n.type)&&(o+=n.some.length),o}),[t]);(0,n.useEffect)((()=>{i&&o&&!r&&!a&&t&&((0,S.nC)(i,{automation_id:t.id,automation_total_actions:l,automation_total_triggers:c,collection_id:o}),s(!0))}),[i,o,r,a,l,c,null==t?void 0:t.id,t])}({collectionStoreId:P,eventTracker:p,isCreate:C,automationStore:O});const de=(0,m.VK)((()=>!(!U||!J)&&(!T||!ee)),[U,J,ee,T]),ue=Re.EE({automationStore:O,currentUserId:j,inMemoryRecordCache:b}),ge=(0,n.useCallback)((()=>{k&&O&&se&&("create"===c?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i,intl:s}=e;(function(e){const{automationStore:t,collectionStore:o,environment:n,intl:i}=e,a=(0,cn.mc)(n);d.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.createDatabaseAutomation",perform:e=>{d.applyOperation({store:o,operation:{pointer:o.pointer,path:["format","automation_ids"],command:"listAfter",args:{id:t.id}},transaction:e});const a=gt.Mz.createChildStore(o,t.pointer),s=t.getActionStores();for(const t of s){const o=t.getType();o&&ln.zY({actionId:t.id,actionType:o,automationStore:a,config:t.getConfig(),environment:n,intl:i,transaction:e})}const l=mn(s);sn.ae({environment:n,inMemoryRecordCache:o.inMemoryRecordCache,table:rn.cv,transaction:e,value:{action_ids:t.getActionIds(),alive:!0,id:t.id,parent_id:o.id,parent_table:o.table,properties:{name:t.getName()},space_id:o.getSpaceId(),status:"active",trigger:{id:(0,r.ZP)(),event:t.getEventConfiguration()??{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:o.getSpaceShardedPointer(),type:"collection"}},type:l}}})}});const s=yn({automationStore:t,collectionStore:o});S.T0(a,s)})({automationStore:t,collectionStore:n,environment:i,intl:s}),Un.oV({label:(0,je.jsx)(a.FormattedMessage,{id:"automations.editAutomationView.createdConfirmation",defaultMessage:"{automationName} created",values:{automationName:t.getName()}})}),l.z$({collectionSettingsStore:o})}({automationStore:O,collectionSettingsStore:t,collectionStore:k,environment:h,intl:u}):"update"===c?function(e){const{automationStore:t,collectionSettingsStore:o,collectionStore:n,environment:i}=e;(function(e){const{automationStore:t,collectionStore:o,environment:n}=e;d.createAndCommit({environment:n,userAction:"collectionSettingsAutomationsActions.saveDatabaseAutomation",perform:e=>{const n=gt.Mz.createChildStore(o,t.pointer),i=t.getName(),r=n.getKeyStore("properties");sn.sW({store:r,data:{name:i},transaction:e});const a=t.getActionStores(),s=mn(a),l=n.getTriggerStore();if(sn.sW({store:l,data:{type:s},transaction:e}),(0,Re.Xd)(n)&&(0,Re.Xd)(t)){const o=n.getTriggerStore().getKeyStore("event");sn.sW({store:o,data:t.getTriggerStore().getKeyStore("event").getValue(),transaction:e})}const c=[];for(const t of a){const o=t.getModel();if(!o)continue;const i=gt.zq.createChildStore(n,t.pointer);sn.sO({store:i,value:{alive:!0,config:o.getConfig(),id:o.id,parent_id:n.id,parent_table:n.table,space_id:n.getSpaceId(),type:o.type},transaction:e}),c.push(t.id)}sn.sW({store:n,data:{action_ids:c},transaction:e})}});const i=(0,cn.mc)(n),r=yn({automationStore:t,collectionStore:o});S.r4(i,r)})({automationStore:t,collectionStore:n,environment:i}),Un.oV({label:(0,je.jsx)(a.FormattedMessage,{id:"automations.editAutomationView.updatedConfirmation",defaultMessage:"{automationName} updated",values:{automationName:t.getName()}})}),l.z$({collectionSettingsStore:o})}({automationStore:O,collectionSettingsStore:t,collectionStore:k,environment:h}):(0,oe.t1)(c))}),[O,t,k,h,se,u,c]),me=(0,n.useCallback)((()=>{O&&k&&pn({automationStore:O,collectionStore:k,environment:h})}),[k,h,O]),ye=(0,n.useCallback)((()=>{O&&k&&gn({automationStore:O,collectionStore:k,environment:h})}),[k,h,O]),fe=(0,n.useCallback)((async()=>{O&&k&&!C&&await un({intl:u,environment:h,existingAutomationStore:O,collectionStore:k,triggerType:"event",onDelete:()=>{1===I?l.wl({collectionSettingsStore:t,item:{type:"main"}}):l.z$({collectionSettingsStore:t})}})}),[I,O,t,k,h,u,C]),ve=(0,n.useCallback)((async()=>{await dr({automationName:E,hasPendingChanges:se})&&(0===I?l.wl({collectionSettingsStore:t,item:{type:"main"}}):l.z$({collectionSettingsStore:t}))}),[I,E,t,se]),be=(0,n.useCallback)((async()=>{await dr({automationName:E,hasPendingChanges:se})&&l.E3({collectionSettingsStore:t})}),[E,t,se]);!function(e){const{hasPendingChanges:t,onClick:o}=e;(0,n.useEffect)((()=>{async function e(e){const n=e.target;if(t&&e.eventPhase===Event.CAPTURING_PHASE&&n instanceof Element){if((0,Qi.jM)(n)||(0,Qi.yT)(n))return;e.stopPropagation(),e.preventDefault(),await o()}}return window.addEventListener("click",e,{capture:!0}),()=>{window.removeEventListener("click",e,{capture:!0})}}),[t,o])}({hasPendingChanges:se,onClick:be});const we=(0,n.useCallback)((async()=>{await dr({automationName:E,hasPendingChanges:se})&&(l.wl({collectionSettingsStore:t,item:{type:"main"}}),l.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),l.H4({collectionSettingsStore:t,item:{type:"deletedProperties",timelineViewTab:"timeline"}}))}),[E,t,se]),Me=(0,n.useCallback)((async e=>{await dr({automationName:E,hasPendingChanges:se})&&(l.wl({collectionSettingsStore:t,item:{type:"main"}}),l.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}}),l.H4({collectionSettingsStore:t,item:{type:"property",formatKey:F,property:e}}))}),[E,t,F,se]),_e=(0,m.VK)((()=>e=>{if(ue(e),P&&A&&O)if("update_trigger"===e.type||"remove_trigger"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("page_added"===t.trigger.type)r={type:"page"};else if("any_page_property_edited"===t.trigger.type)r={condition:"any",type:"property"};else if("property_changed"===t.trigger.type){const e=i[t.trigger.property];if(!e)return;r={condition:"some",property_types:[e.type],type:"property"}}else(0,oe.t1)(t.trigger);return{automation_id:o,automation_trigger:r,collection_id:n}}({action:e,automationId:B,collectionStoreId:P,schema:A});if(!t)return;"remove_trigger"===e.type?(0,S.Ey)(p,t):"update_trigger"===e.type&&function(e,t){if(!(0,Re.Xd)(t))return!0;const o=t.getTriggerStore().getKeyStore("event");if("page_added"===e.type&&!0===o.getKeyStore("pagesAdded").getValue())return!1;if("any_page_property_edited"===e.type&&"any"===o.getKeyStore("pagePropertiesEdited").getKeyStore("type").getValue())return!1;if("property_changed"===e.type){const t=o.getKeyStore("pagePropertiesEdited").getValue();if("some"===(null==t?void 0:t.type)&&t.some.some((t=>t.property===e.property)))return!0}return!0}(e.trigger,O)&&(0,S.nK)(p,t)}else if("update_action"===e.type||"remove_action"===e.type){const t=function(e){const{action:t,automationId:o,collectionStoreId:n,schema:i}=e;let r;if("slack_notification"===t.action.type)r={type:"slack_notification"};else{if("update_pages"!==t.action.type)return;var a;r={property_types:((null===(a=t.action.config)||void 0===a?void 0:a.properties)??[]).map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.type})).filter(oe.$K),type:"update_pages"}}return{automation_action:r,automation_action_id:t.action.id,automation_id:o,collection_id:n}}({action:e,automationId:B,collectionStoreId:P,schema:A});if(!t)return;"remove_action"===e.type?(0,S.OK)(p,t):"update_action"===e.type&&function(e,t){return!t.getActionIds().includes(e.id)}(e.action,O)&&(0,S.A2)(p,t)}}),[B,O,A,P,p,ue]),Te=(0,n.useCallback)((e=>{const t=e.target.value;_e({type:"update_name",name:t})}),[_e]),ke=(0,n.useCallback)((e=>{_e({type:"update_source",pointer:e})}),[_e]),Pe=function(e){const t=4,{showDeleteEnableDisableOptions:o}=e,{isMobile:n}=(0,g.Fy)();return(0,y.yK)((e=>({automationSection:{display:"flex",flexDirection:"column",gap:t},automationSectionAdd:{marginLeft:"auto",flexGrow:0,flexShrink:0},automationSectionHeader:{alignItems:"center",display:"flex",flexDirection:"row"},automationSectionHeaderAction:{background:`linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%), linear-gradient(to right, ${e.stroke.regular} 50%, transparent 50%)`,backgroundPosition:"20px 0px, 20px bottom",backgroundRepeat:"no-repeat",backgroundSize:`2px 36px, 2px ${t+2}px`,marginBlockEnd:-t,paddingBlock:`36px ${t}px`,position:"relative"},automationSectionTitle:{color:e.lightTextColor,fontSize:n?14:12,lineHeight:1.3,position:"relative",fontWeight:ne.Z.fontWeight.medium},automationCreateMobile:{boxShadow:"none",paddingBlock:"0 12px",paddingInline:12},automationCreateDesktop:{paddingBlock:o?"12px 0":12,paddingInline:12},automationCreateButton:{...n?{minHeight:45}:{},width:"100%"},automationNameInput:{marginBlockEnd:n?void 0:8},automationNameText:{marginInlineStart:12},automationOptionIconDesktop:{marginInlineStart:12},menuScroller:{...n?{}:{marginBlockStart:6}},wrap:{borderTop:`1px solid ${e.regularDividerColor}`,paddingBlockStart:15,paddingBlockEnd:12,paddingInline:12}})),[n,o])}({showDeleteEnableDisableOptions:z}),Ae=[],Ve=se&&re;if(U&&Ae.push((0,je.jsx)(Ce.Z,{mobileStyle:Pe.automationCreateMobile,style:Pe.automationCreateDesktop,topBorder:!x,children:(0,je.jsx)(jo.Z,{onClick:ge,disabled:!Ve,style:Pe.automationCreateButton,children:C?(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.createButton.label",defaultMessage:"Create"}):(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.saveButton.label",defaultMessage:"Save"})})})),z&&Ae.push((0,je.jsx)(Ce.Z,{disableMobilePadding:!0,topBorder:x||0===Ae.length,children:(0,je.jsx)(en.Z,{desktopIconStyle:Pe.automationOptionIconDesktop,icon:pe.y,isRed:!0,onClick:fe,title:u.formatMessage(sr.deleteButton)})})),!k||!O)return null;const Fe=C?u.formatMessage(sr.createAutomationViewMenuTitle):u.formatMessage(sr.editAutomationViewMenuTitle),Be=D&&L&&(0,je.jsx)(er,{automationStore:O,collectionStore:k,automationPermissionScope:H,referencesIncompatibleCollectionViewFilter:ie,onDelete:fe});return(0,je.jsx)(zi.Z,{capture:!0,onEsc:be,children:(0,je.jsxs)(Jo.ZP,{title:Fe,collectionSettingsStore:t,collectionContextStore:o,handleBackArrowClick:ve,handleClose:be,footer:Ae,fullHeight:!0,menuScrollerStyle:Pe.menuScroller,children:[Be,(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:void 0,sections:[{key:"automation_top_input",items:[{key:"automation_name",action:()=>{},render:e=>(0,je.jsx)(no.ZP,{style:Pe.automationNameInput,...e,value:E??"Loading...",onChange:Te,disabled:!U,textWrapperStyle:Pe.automationNameText})},{key:"automation_source",action:lr,render:e=>(0,je.jsx)(ni,{menuListItemProps:e,selectedSourcePointer:W,collectionContextStore:o,onSelect:ke,disabled:!U})}],render:e=>(0,je.jsx)(Ce.Z,{...e,disableMobilePadding:Boolean(Be)})}]}),(0,je.jsxs)("div",{style:Pe.wrap,children:[ae&&z&&(0,je.jsx)(ar,{automationId:O.id,automationOwner:L,isAutomationPaused:!K,onPause:me,onResume:ye}),(0,je.jsxs)("section",{style:Pe.automationSection,children:[(0,je.jsxs)("header",{style:Pe.automationSectionHeader,children:[(0,je.jsx)("div",{style:Pe.automationSectionTitle,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.title",defaultMessage:"When any of these occur"})}),(0,je.jsx)("div",{style:{...Pe.automationSectionAdd,visibility:X&&U?void 0:"hidden"},children:(0,je.jsx)(he.ZP,{popupType:v,alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,renderOrigin:e=>(0,je.jsx)(Se.Z,{...e,ariaLabel:u.formatMessage(sr.addTriggerAriaLabel),icon:V.R}),render:e=>k&&(0,je.jsx)(fi,{automationStore:O,collectionStore:k,initialState:le,updateCurrentAutomationState:_e,buttonPopupParent:e})})})]}),X?(0,je.jsx)(Ci,{automationStore:O,collectionStore:k,updateCurrentState:_e,handleNavigateToDeletedProperties:we,handleNavigateToEditProperty:Me,disabled:!U}):(0,je.jsx)(he.ZP,{popupType:v,renderOrigin:e=>(0,je.jsx)($n,{...e,icon:(0,V.R)({height:24,width:12}),title:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.triggerSection.placeholder",defaultMessage:"Add trigger"})}),render:e=>k&&(0,je.jsx)(fi,{automationStore:O,collectionStore:k,initialState:le,updateCurrentAutomationState:_e,buttonPopupParent:e})})]}),(0,je.jsxs)("section",{style:Pe.automationSection,children:[(0,je.jsxs)("header",{style:{...Pe.automationSectionHeader,...Pe.automationSectionHeaderAction},children:[(0,je.jsx)("div",{style:Pe.automationSectionTitle,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettings.editAutomationView.actionSection.title",defaultMessage:"Do this"})}),(0,je.jsx)("div",{style:{...Pe.automationSectionAdd,visibility:de?void 0:"hidden"},children:(0,je.jsx)(he.ZP,{alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,popupType:v,render:e=>(0,je.jsx)(Ko,{automationStore:O,buttonPopupParent:e,collectionStore:k,initialState:ce,updateCurrentAutomationState:_e}),renderOrigin:e=>(0,je.jsx)(Se.Z,{...e,ariaLabel:u.formatMessage(sr.addActionAriaLabel),icon:V.R})})})]}),J?(0,je.jsx)(Gi,{automationStore:O,collectionStore:k,handleNavigateToDeletedProperties:we,handleNavigateToEditProperty:Me,updateCurrentAutomationState:_e,currentUserIsOwner:$,disabled:!U}):(0,je.jsx)(qn,{automationStore:O,collectionStore:k,initialState:ce,updateCurrentAutomationState:_e})]})]})]})})}async function dr(e){const{automationName:t,hasPendingChanges:o}=e;return!o||await an.confirmUserAction({message:(0,je.jsx)(a.FormattedMessage,{id:"automations.confirmDiscardChanges.message",defaultMessage:"{hasName, select, true {Are you sure you want to discard {automationName}?} other {Are you sure you want to discard this automation?}}",values:{automationName:t,hasName:Boolean(t)}}),acceptLabel:(0,je.jsx)(a.FormattedMessage,{id:"automations.confirmDiscardChanges.acceptLabel",defaultMessage:"Discard"})})}var ur=o(12534),pr=o(34859),gr=o(58421),mr=o(36857),yr=o(59187),hr=o(39132),Sr=o(61061),fr=o(44495),xr=o(66890);var vr=o(81166),Cr=o(29376),br=o(77080);function wr(e){return(0,m.VK)((()=>br.default.checkGate(e)),[e])}var jr=o(64275);function Mr(e){window.__c={n:"CollectionSettingsNotification"};const{title:t,icon:o,style:n,children:i,showCloseButton:r,onClose:a}=e,s=(0,y.Fg)();return(0,je.jsxs)("div",{style:{padding:"12px 16px",margin:"4px 12px",fontSize:12,background:s.accentColors.orange[50],borderRadius:6,...n},children:[t&&(0,je.jsxs)("div",{style:{display:"flex",marginBottom:2},children:[o,(0,je.jsx)("div",{style:{fontWeight:ne.Z.fontWeight.medium,flexGrow:1},children:t}),r&&(0,je.jsx)(me.Z,{onClick:a,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16},children:(0,jr.D)({width:14,fill:s.mediumTextColor})})]}),i]})}var _r=o(64369),Tr=o(5210);function kr(e){window.__c={n:"CollectionSettingsViewSubitemsPreview"};const{propertyName:t,inversePropertyName:o,newDesign:n}=e,i=(0,y.yK)((e=>({togglePreviewParentIcon:{color:e.regularIconColor,marginRight:"4"},togglePreviewChildIcon:{color:e.mediumIconColor,marginLeft:"24px",marginRight:"4"},togglePreviewRowWithDivider:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderBottom:`1px solid ${e.regularDividerColor}`},togglePreviewRow:{padding:"4px",margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center"},togglePreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:"4px",alignItems:"center",...n?{fontWeight:ne.Z.fontWeight.medium,backgroundColor:e.accentColors.gray[30],padding:"9px 0"}:{}}})),[n]);return(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(Ce.Z,{disableMobileBorders:!0,children:(0,je.jsxs)("div",{style:i.togglePreviewOutsideBorder,children:[(0,je.jsxs)("div",{style:i.togglePreviewRowWithDivider,children:[(0,je.jsx)(Tr.Z,{isSidebar:!1,open:!0,fill:!0,onClick:()=>{},style:i.togglePreviewParentIcon,disabled:!0}),(0,je.jsx)("span",{children:"🐔"}),(0,je.jsx)("div",{style:{marginLeft:"5px"},children:o})]}),(0,je.jsxs)("div",{style:i.togglePreviewRowWithDivider,children:[(0,je.jsx)(Tr.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:i.togglePreviewChildIcon,disabled:!0}),(0,je.jsx)("span",{children:"🐣"}),(0,je.jsx)("div",{style:{marginLeft:"5px"},children:t})]}),(0,je.jsxs)("div",{style:i.togglePreviewRow,children:[(0,je.jsx)(Tr.Z,{isSidebar:!1,open:!1,fill:!0,onClick:()=>{},style:i.togglePreviewChildIcon,disabled:!0}),(0,je.jsx)("span",{children:"🐣"}),(0,je.jsx)("div",{style:{marginLeft:"5px"},children:t})]})]})})})}var Pr=o(22491),Ar=o(65742),Vr=(o(21703),o(27731));function*Fr(e,t){const o=new Vr.Z;for(o.currentValue=e,o.endValue=t,o.stiffness=35;;){const e=yield o.currentValue;if(o.step(e)){yield o.currentValue;break}}}function*Br(e,t,o){let n=0;for(;n<o;){n+=(yield e+n/o*(t-e))}}function*Ir(e){for(const[t,o]of He.$R(e,e.slice(1)))(0,oe.$K)(t)&&(0,oe.$K)(o)&&(yield*Fr(t,o))}function*Zr(e,t){let o=0;for(;!(0,oe.$K)(t)||o<t;){o+=(yield e)}}function*Dr(e){let t=0;for(;;){const o={};for(const[n,i]of(0,oe.qP)(e)){const e=i.next(t);if(e.done)return;o[n]=e.value}t=yield o}}var Kr=o(43350);const Rr="inactive-task-filter",Nr="active-task-filter",Or="mouse-cursor-filter",Er=80,Lr=24;function*Wr(e){yield*Dr({x:e,opacity:Zr(1)})}function Gr(e){window.__c={n:"DateShiftingPreview"};const{mode:t}=e,o=(0,y.yK)((e=>({wrap:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112}})),[1]),i=(0,n.useRef)(null),r=(0,Ti.X)(i),a=r?r.width-2:264;return(0,je.jsx)("div",{style:o.wrap,ref:i,children:(0,je.jsx)(Hr,{mode:t,sceneWidth:a})})}function Hr(e){window.__c={n:"DateShiftingPreviewAnimation"};const{mode:t,sceneWidth:o}=e,i=(0,y.yK)((e=>({svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:Ar.lf},invalidArrow:{stroke:e.collectionInvalidDependencyArrow},svgContainer:{position:"absolute",width:"100%",height:"100%",backgroundColor:e.accentColors.gray[30]}})),[]),r=(0,n.useMemo)((()=>({none:function*(){for(;;)yield*Wr(Ir([o/2,o/2+40+20,o/2-40-20,o/2]))},preserve_gap:function*(){for(;;)yield*Wr(Ir([o/2,o/2+40,o/2-40,o/2]))},consume_gap:function*(){for(;;){yield*Wr(Ir([o/2,o/2-40,o/2+40,o/2+Er]));const e=500;yield*Dr({x:Zr(o/2+Er),opacity:Br(1,0,e)}),yield*Dr({x:Zr(o/2),opacity:Br(0,1,e)})}}})),[o]),{x:a,opacity:s}=function(e){const t=(0,n.useMemo)((()=>e()),[e]),[o,i]=(0,n.useState)((()=>{const e=t.next(0);if(e.done)throw new Error("Generator must provide at least one result");return e.value}));return(0,n.useEffect)((()=>{const e=t.next(0);e.done||i(e.value);let o=Date.now(),n=0;return n=requestAnimationFrame((function e(){n=requestAnimationFrame(e);const r=Date.now(),a=r-o;o=r;const s=t.next(a);s.done||i(s.value)})),()=>cancelAnimationFrame(n)}),[t]),o}(r[t??"none"]),l={x:o/2-160,y:10},c={x:a-40,y:42},d={x:o/2+Er,y:74},u={x:c.x+40,y:c.y+12};return(0,oe.$K)(t)&&("consume_gap"===t?(l.x=Math.min(l.x,c.x-Er),d.x=Math.max(d.x,c.x+Er)):"preserve_gap"===t?(l.x=l.x+a-o/2,d.x=d.x+a-o/2):(0,oe.t1)(t)),(0,je.jsxs)("svg",{style:i.svgContainer,children:[He.w6(o/2-160,o,40).map(((e,t)=>(0,je.jsx)(Ur,{startPoint:{x:e,y:0},endPoint:{x:e,y:110}},t))),(0,je.jsx)(Kr.Z,{startPoint:{x:c.x+Er,y:c.y+12},endPoint:{x:d.x-2,y:d.y+12},...(0,Pr.iv)(i.svgArrowTheme,c.x+Er>d.x?i.invalidArrow:void 0,{opacity:s}),showArrowHead:!0}),(0,je.jsx)(Kr.Z,{startPoint:{x:l.x+Er,y:l.y+12},endPoint:{x:c.x-2,y:c.y+12},...(0,Pr.iv)(i.svgArrowTheme,c.x<l.x+Er?i.invalidArrow:void 0,{opacity:s}),showArrowHead:!0}),(0,je.jsx)(zr,{point:l,opacity:s}),(0,je.jsx)(zr,{point:c,active:!0,opacity:s}),(0,je.jsx)(zr,{point:d,opacity:s}),(0,je.jsx)($r,{point:u,opacity:s}),(0,je.jsx)(qr,{})]})}function zr(e){window.__c={n:"SvgTaskBox"};const{point:t,active:o,opacity:n}=e,i=(0,y.Fg)(),r=o?"dark"===i.mode?"#28456C":"#E7F3F8":i.buttonBackground;return(0,je.jsx)("g",{transform:`translate(${t.x-4},${t.y-2})`,opacity:n,children:(0,je.jsx)("rect",{filter:`url(#${o?Nr:Rr})`,width:Er,height:Lr,x:"4",y:"2",fill:r,rx:"3"})})}function Ur(e){window.__c={n:"SvgDashedLine"};const{startPoint:t,endPoint:o}=e,n=(0,y.Fg)(),i="dark"===n.mode?n.accentColors.gray[300]:"#E3E2E0";return(0,je.jsx)("line",{x1:t.x,y1:t.y,x2:o.x,y2:o.y,stroke:i,strokeDasharray:"3 4"})}function $r(e){const{point:t,opacity:o}=e;return(0,je.jsxs)("g",{filter:"url(#mouse-cursor-filter)",transform:`translate(${t.x},${t.y})`,opacity:o,children:[(0,je.jsx)("path",{fill:"#32302C",d:"M14 12.25h-3.334l2.193 5.294-2.309.956-2.194-5.294L6 15.563l-.75-.75V3.94l1.06-.44L14 11.19v1.06z"}),(0,je.jsx)("path",{stroke:"#fff",fill:"#32302C",strokeWidth:"0.5",d:"M14 12.5h.25v-1.413l-.073-.073-7.69-7.69-.12-.12-.154.065-1.059.44L5 3.775v11.142l.073.073.75.75.177.177.177-.177 2.092-2.091 2.05 4.948.096.23.23-.095 2.31-.956.231-.096-.096-.231-2.05-4.948H14z"})]})}function qr(){return(0,je.jsxs)("defs",{children:[(0,je.jsxs)("filter",{id:Rr,width:88,height:32,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,je.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_7659"}),(0,je.jsx)("feOffset",{}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_7659"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feOffset",{dy:"2"}),(0,je.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"effect1_dropShadow_637_7659",result:"effect2_dropShadow_637_7659"}),(0,je.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_7659",result:"shape"})]}),(0,je.jsxs)("filter",{id:Nr,width:88,height:32,x:"0",y:"0",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,je.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_637_5084"}),(0,je.jsx)("feOffset",{}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.2 0 0 0 0 0.494118 0 0 0 0 0.662745 0 0 0 0.2 0"}),(0,je.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_5084"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feOffset",{dy:"2"}),(0,je.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"effect1_dropShadow_637_5084",result:"effect2_dropShadow_637_5084"}),(0,je.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_637_5084",result:"shape"})]}),(0,je.jsxs)("filter",{id:Or,width:"17.75",height:"24.244",x:"0.75",y:"0.91",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,je.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feOffset",{dy:"2"}),(0,je.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.2 0"}),(0,je.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_637_4925"}),(0,je.jsx)("feBlend",{in:"SourceGraphic",in2:"effect1_dropShadow_637_4925",result:"shape"})]})]})}var Qr=o(52936),Yr=o(18442),Xr=o(71644),Jr=o(16956),ea=o(76427),ta=o(86825),oa=o(61053),na=o(98519),ia=o(69872);function ra(e){window.__c={n:"CollectionSettingsViewDefaultPropertyPopup"};const{menuProps:t,property:o,defaultProperty:n,checkState:i,propertySchema:r,collectionContextStore:a,handleDefaultPropertySelect:s,handlePropertySelect:l,...c}=e,d=(0,g.MO)(),u=(0,m.VK)((()=>a.permissionScopes.state),[a]);return(0,m.VK)((()=>br.default.checkGate("collection_level_subitems_setting")),[])?(0,je.jsx)(ia.Z,{...t,disabled:!u.canConfigureBlock,propertySchema:r,format:ia.Z.DisplayFormat.Name,onClick:()=>s(o),right:(0,je.jsx)(aa,{property:o,checkState:o===n,collectionContextStore:a,defaultProperty:void 0})}):(0,je.jsx)(he.ZP,{popupType:d?he.Z4.SlideUp:he.Z4.Popup,alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,originGap:0,renderOrigin:e=>(0,je.jsx)(ia.Z,{...t,...e,disabled:!u.canConfigureBlock,propertySchema:r,format:ia.Z.DisplayFormat.Name,right:(0,je.jsx)(aa,{property:o,defaultProperty:n,checkState:i,collectionContextStore:a})}),render:e=>(0,je.jsx)(sa,{...c,parent:e,property:o,collectionContextStore:a,handleDefaultPropertySelect:s,handlePropertySelect:l})})}function aa(e){window.__c={n:"DefaultCheck"};const{property:t,defaultProperty:o,checkState:n,collectionContextStore:i}=e,r=(0,g.MO)(),s=(0,m.VK)((()=>{var e;return null===(e=i.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[i]),l=(0,y.yK)((e=>({defaultText:{color:e.mediumTextColor,fontSize:12,fontWeight:500,textTransform:"uppercase",marginRight:4}})),[]);return(0,je.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,je.jsx)("div",{style:{...l.defaultText},children:t===o&&(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Default",id:"database.viewSettings.setViewPropertyDefault.defaultProperty.tag",values:{databaseName:s}})}),n&&(0,je.jsx)("div",{style:{...r?{marginLeft:"auto",marginRight:20,minWidth:0,flexShrink:0}:{marginLeft:"auto",marginRight:12,minWidth:0,flexShrink:0},width:r?16:14,flexShrink:0},children:(0,na.k)()})]})}function sa(e){window.__c={n:"PropertySelectPopup"};const{parent:t,property:o,collectionContextStore:n,handleDefaultPropertySelect:i,handlePropertySelect:r,...s}=e,l=(0,g.MO)(),c=(0,m.VK)((()=>n.permissionScopes.state),[n]),d=(0,m.VK)((()=>n.databaseType),[n]),u=(0,m.VK)((()=>{var e;return null===(e=n.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[n]);let p;p=l?{menuType:Lt.og.ActionSheet}:{menuType:Lt.og.Popup,width:300};const y=c.canConfigureCollection;let h;if("v1"===e.version)h=(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[y&&(0,je.jsx)(en.Z,{isGray:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Set on all new {databaseName} views",id:"database.viewSettings.setViewPropertyDefault.allDefaultButton.title",values:{databaseName:u}}),onClick:()=>{i(o),t.close()}}),(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view"}),isGray:!0,onClick:()=>{r(o),t.close()}})]});else if("v2"===e.version){const n=(0,vr.K9)({feature:e.feature,databaseType:d});h=(0,je.jsxs)(je.Fragment,{children:[y&&(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Set as default",id:"database.viewSettings.relationFeatures.setViewPropertyDefault.allDefaultButton.title",values:{databaseName:u}}),caption:(0,je.jsx)(a.FormattedMessage,{...n}),shouldWrapCaption:!0,onClick:()=>{i(o),t.close()}})}),(0,je.jsx)(Ce.Z,{topBorder:y,children:(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationFeatures.setViewPropertyDefault.setProperty.title",defaultMessage:"Set on this view only"}),onClick:()=>{r(o),t.close()}})})]})}else(0,oe.t1)(e);return(0,je.jsx)(fe.Z,{...p,children:h})}var la=o(6695),ca=o(29798);const da=(0,a.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a property…",id:"database.viewSettings.propertySelect.inputPlaceholder"}});function ua(e){window.__c={n:"CollectionSetttingsGroupedPropertySelectMenu"};const{currentProperty:t,getGroupedProperties:o,onAccept:i,renderProperty:r,inputPlaceholder:s,schema:l,format:c,defaultShowPropertyGroupCount:d}=e,u=(0,g.Fy)(),h=(0,m.qz)(void 0,ca.Z),S=(0,m.VK)((()=>o()),[o]),[f,x]=(0,n.useState)(!1),[v,C]=(0,n.useState)(""),b=(0,la.iB)(c,l,void 0,la.j5.Page).collection_page_properties||[],w=(0,n.useCallback)((e=>{C(e.target.value),h.setState({...h.state,focus:{section:0,indexLocal:0,indexGlobal:0}}),x(!1)}),[h]),j=(0,y.yK)((e=>({dotsIcon:{width:16,fill:e.mediumTextColor,marginLeft:4,marginRight:2},showMoreButton:{color:e.mediumTextColor}})),[]),M=He.MR(S,(e=>Math.min(...e.map((e=>b.findIndex((t=>t.property===e))))))),_=[{key:"input",comp:(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(no.ZP,{focusInitial:!u.isMobile||void 0,focus:!u.isMobile||void 0,value:v,onChange:w,placeholder:s||Ne.default.formatMessage(da.inputPlaceholder)})})}];if(v){const e=M.map((e=>e.filter((e=>{const t=l[e],o=t?`${t.name} ${ro.SO[t.type]}`:"";return Boolean(p().match(v,o))})))).filter((e=>e.length>0));if(0===e.length)_.push({key:"noResults",comp:(0,je.jsx)(Xn.Z,{caption:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.propertySelect.noResultsTitle"})})});else{const o=[{key:"results",render:e=>(0,je.jsx)(Ce.Z,{...e}),items:e.flat().map((e=>ga({onAccept:i,property:e,schema:l,currentProperty:t,renderProperty:r}))).filter(oe.$K)}];_.push(pa({sections:o,menuListStore:h}))}}else{const e=d||2;let o,n;if(!f&&M.length>e){o=M.slice(0,e);const t=He.Sm(M.slice(e).map((e=>e.length)));n={key:"show_more",render:e=>(0,je.jsx)(ye.Z,{...e,icon:(0,ue.o)(j.dotsIcon),style:j.showMoreButton,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{moreCount} more",id:"database.viewSettings.propertySelect.showMoreTitle",values:{moreCount:t}})}),action:()=>{x(!0)}}}else o=M;const s=o.map(((e,a)=>({key:e.join("-"),render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:0!==a}),items:e.map((e=>ga({onAccept:i,property:e,schema:l,currentProperty:t,renderProperty:r}))).concat(a===o.length-1?[n]:[]).filter(oe.$K)})));_.push(pa({sections:s,menuListStore:h}))}return(0,je.jsx)(je.Fragment,{children:_.map((e=>{let{key:t,comp:o}=e;return(0,je.jsx)(n.Fragment,{children:o},t)}))})}function pa(e){const{menuListStore:t,sections:o}=e;return{key:"properties",comp:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:0,sections:o,store:t})}}function ga(e){const{schema:t,currentProperty:o,onAccept:n,renderProperty:i,property:r}=e,a=t[r];if(!a)return;return{key:r,render:e=>{const t=r===o;return i?i(e,r,t,a):(0,je.jsx)(ia.Z,{...e,propertySchema:a,format:ia.Z.DisplayFormat.Name,checkState:t})},action:()=>{n(r)}}}var ma=o(31869),ya=o(54281),ha=o(30188);function Sa(e){const{collectionContextStore:t,feature:o}=e,n=(0,a.useIntl)();return{initialPropertyName:(0,m.VK)((()=>{const e=t.collectionStore();if(null!=e&&e.isDefined()){const i=t.normalizedSchemaStore.state;return Cr.m8(n,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:i,createUnique:!0,from:o})}return n.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[t,n,o])}}function fa(e){const{feature:t,collectionContextStore:o,collectionSettingsStore:i,onPropertySelect:r}=e,s=(0,g.O7)(),c=(0,a.useIntl)(),{initialPropertyName:u}=Sa({collectionContextStore:o,feature:t}),p=(0,n.useCallback)((e=>{const{collectionViewStore:o,newProperty:n,transaction:i}=e;"subitem"===t?ha.dR({collectionViewStore:o,propertyId:n,transaction:i}):"timeline_arrows_by"===t?ya.tF({collectionViewStore:o,newProperty:n,transaction:i}):(0,oe.t1)(t)}),[t]),y=(0,m.VK)((()=>o.normalizedSchemaStore.state),[o]),h=(0,n.useCallback)((()=>Cr.ND(o,y)),[o,y]),S=(0,n.useCallback)((e=>{const{relationPropertyId:n,transaction:i}=e;"subitem"===t?ha.jA({collectionContextStore:o,relationPropertyId:n,transaction:i}):"timeline_arrows_by"===t?ya._p({collectionContextStore:o,relationPropertyId:n,transaction:i}):(0,oe.t1)(t)}),[o,t]),f=(0,n.useCallback)((e=>{const{featureType:t}=e,n=o.collectionStore(),r=n,a=o.collectionViewStore();n&&r&&(d.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:s,perform:i=>{const l=Jr.G3({environment:s,collectionStore:n,collectionViewArgs:a?{collectionViewStore:a,format:a.getFormat(),formatKey:"collection_page_properties"}:void 0,propertyType:"relation",transaction:i});return ma.n7({environment:s,collectionContextStore:o,collectionStore:n,property:l,propertyName:u,targetCollectionStore:r,hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1},propertyLimit:"no_limit",intl:c,transaction:i,from:t}),a&&(p({collectionViewStore:a,newProperty:l,transaction:i}),S({relationPropertyId:l,transaction:i})),"timeline_arrows_by"===t&&Fa({environment:s,intl:c,collectionStore:n,transaction:i,newConfig:e.dateShiftingConfig}),l}}),l.wl({collectionSettingsStore:i,item:{type:"main"}}),Ot._H({environment:s,collectionContextStore:o,from:t,property_type:"relation"}))}),[o,i,s,u,c,S,p]),x=(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;d.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:s,perform:t=>{p({collectionViewStore:n,newProperty:e,transaction:t}),S({relationPropertyId:e,transaction:t})}}),r(e),"subitem"===t?i="update_default_subitem":"timeline_arrows_by"===t?i="update_default_timeline_arrows_by":(0,oe.t1)(t),Ot.wd({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:s,collectionContextStore:o})}),[o,s,r,t,p,S]);return{handlePropertySelect:(0,n.useCallback)((e=>{const n=o.collectionViewStore();if(!n)return;let i;d.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:s,perform:t=>{p({collectionViewStore:n,newProperty:e,transaction:t})}}),r(e),"subitem"===t?i="update_subitem":"timeline_arrows_by"===t?i="update_timeline_arrows_by":(0,oe.t1)(t),Ot.wd({action:i,original_view_type:void 0,property_type:e?"relation":void 0,environment:s,collectionContextStore:o})}),[o,s,r,t,p]),handleDefaultPropertySelect:x,handleAddRelation:f,getProperties:h}}function xa(e){const{feature:t,collectionContextStore:o}=e;let n,i;var r,a;if("subitem"===t)n=null===(r=o.currentSubitemFormatStore.state)||void 0===r?void 0:r.property,i=null===(a=o.collectionStore())||void 0===a?void 0:a.getFormatStore().getKeyStore("collection_default_subitem").getValue();else if("timeline_arrows_by"===t){var s;n=o.currentArrowsByFormatStore.state,i=null===(s=o.collectionStore())||void 0===s?void 0:s.getFormatStore().getKeyStore("collection_default_arrows_by").getValue()}else(0,oe.t1)(t);const l=o.normalizedSchemaStore.state,c=Cr.NA(o,l);(0,oe.$K)(n)&&!c.includes(n)&&(n=void 0),(0,oe.$K)(i)&&!c.includes(i)&&(i=void 0);const d=n??i;if(d)return{property:d,isDefault:d===i,enabledOnView:Boolean(n),enabledOnCollection:Boolean(i),supportedInView:Ba({feature:t,viewType:o.getViewType()})}}function va(e){const{feature:t,collectionContextStore:o}=e;return(0,m.VK)((()=>xa({feature:t,collectionContextStore:o})),[o,t])}function Ca(e){window.__c={n:"RelationPropertyPicker"};const{currentPropertyId:t,feature:o,collectionContextStore:n,collectionSettingsStore:i,permissionScopes:r,onPropertySelect:s,buttonPopupStore:l,disabled:c}=e,d=(0,a.useIntl)(),u=(0,m.VK)((()=>{var e,t;return"subitem"===o?null===(e=n.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.collection_default_subitem:"timeline_arrows_by"===o?null===(t=n.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void(0,oe.t1)(o)}),[o,n]),p=(0,m.VK)((()=>n.databaseType),[n]),{handleDefaultPropertySelect:g,handlePropertySelect:y,getProperties:h}=fa({collectionContextStore:n,collectionSettingsStore:i,feature:o,onPropertySelect:s}),S=(0,vr.g3)({feature:o,databaseType:p});return(0,je.jsx)(wa,{intl:d,icon:z.v,caption:(0,je.jsx)(a.FormattedMessage,{...S}),collectionContextStore:n,buttonPopupStore:l,shouldGroupProperties:!0,getGroupedProperties:h,currentProperty:t,disabled:c,onAccept:r.canConfigureBlock&&r.canConfigureCollection?y:()=>{},renderProperty:(e,t,i,r)=>(0,je.jsx)(ra,{version:"v2",feature:o,menuProps:e,property:t,defaultProperty:u,checkState:i,propertySchema:r,collectionContextStore:n,handleDefaultPropertySelect:g,handlePropertySelect:y})})}function ba(e){window.__c={n:"DatePropertyPicker"};const{currentPropertyId:t,collectionContextStore:o,onPropertyChanged:i,disabled:r,title:s}=e,l=(0,a.useIntl)(),c=(0,m.qz)(void 0,be.Z),d=(0,m.VK)((()=>o.normalizedSchemaStore.state),[o]),u=(0,n.useCallback)((()=>Object.keys(d).filter((e=>{const t=d[e];return"date"===(null==t?void 0:t.type)})).filter(oe.$K)),[d]);return(0,je.jsx)(wa,{intl:l,buttonPopupStore:c,title:s,collectionContextStore:o,shouldGroupProperties:!1,getProperties:u,currentProperty:t,disabled:r,onAccept:e=>{e&&i(e),c.setState({open:!1})}})}function wa(e){window.__c={n:"PopupPropertyPicker"};const{currentProperty:t,icon:o,caption:n,buttonPopupStore:i,collectionContextStore:r,disabled:s,title:l,shouldGroupProperties:c}=e,d=(0,g.Fy)(),u=(0,m.VK)((()=>{var e;return(null===(e=r.collectionStore())||void 0===e?void 0:e.getFormat())??{}}),[r]),p=(0,m.VK)((()=>r.normalizedSchemaStore.state),[r]),h=(0,y.yK)((e=>({caption:{fontSize:d.isMobile?ne.Z.fontSize.UISmall.mobile:ne.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,margin:"0 12px 28px 12px"}})),[d]),S=(0,m.VK)((()=>i.state.open),[i]),f=(0,m.VK)((()=>d.isPhone?{menuType:Lt.og.ActionSheet}:{menuType:Lt.og.Popup,width:300}),[d.isPhone]);return(0,je.jsxs)(je.Fragment,{children:[n&&(0,je.jsx)("div",{style:h.caption,children:n}),(0,je.jsx)(he.ZP,{popupType:d.isPhone?ve.kQ.SlideUp:ve.kQ.Popup,alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,disabled:s,originGap:0,renderOrigin:e=>{var n;return(0,je.jsx)(en.Z,{title:l??(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationFeatures.propertyPicker.default.title",defaultMessage:"Property"}),showChevron:!0,right:t?(0,je.jsx)("span",{style:ne.Z.textOverflowStyle,children:null===(n=p[t])||void 0===n?void 0:n.name}):void 0,rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},rotateChevron:S,disabled:s,icon:o,...e})},render:t=>(0,je.jsx)(fe.Z,{...f,children:c?(0,je.jsx)(ua,{...e,getGroupedProperties:e.getGroupedProperties,format:u,schema:p}):(0,je.jsx)(oa.Z,{...e,getProperties:e.getProperties,format:u,schema:p})}),buttonPopupStore:i})]})}function ja(e){var t;window.__c={n:"DateShiftingConfigSection"};const{currentConfig:o,onConfigChange:i,disabled:r,collectionContextStore:s}=e,l=(0,m.VK)((()=>s.databaseType),[s]),c=(0,g.O7)(),d=null===(t=o.configWithoutDates)||void 0===t?void 0:t.mode,[u,p]=(0,n.useState)(!(0,oe.$K)(o.configWithoutDates)||Boolean(o.configWithoutDates.avoid_weekends)),y=(0,oe.$K)(o.configWithoutDates)?Boolean(o.configWithoutDates.avoid_weekends):u;(0,n.useEffect)((()=>{if((0,oe.$K)(o.configWithoutDates)){const e=Boolean(o.configWithoutDates.avoid_weekends);e!==u&&p(e)}}),[o,u]);const h=(0,n.useCallback)((e=>{(0,oe.$K)(o.configWithoutDates)&&(i({...o,configWithoutDates:{...o.configWithoutDates,avoid_weekends:e}}),Ot.wd({environment:c,collectionContextStore:s,action:"update_dependency_date_shift_avoid_weekends",new_avoid_weekends:e}))}),[s,o,c,i]),S=(0,n.useCallback)((e=>{(0,oe.$K)(e)?i({...o,configWithoutDates:{...o.configWithoutDates,mode:e,avoid_weekends:u}}):i({...o,configWithoutDates:void 0}),Ot.wd({environment:c,collectionContextStore:s,action:"update_dependency_date_shift_mode",new_date_shift_mode:e??"none"})}),[s,o,c,u,i]);return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{title:(0,je.jsx)(a.FormattedMessage,{...vr.dH.dateShiftingSectionCaption}),disableMobileBorders:!0,children:(0,je.jsx)(Gr,{mode:d})}),(0,je.jsx)(Ce.Z,{disableMobileBorders:!0,children:(0,je.jsx)(Aa,{currentMode:d,onModeChange:S,databaseType:l,disabled:r})}),(0,je.jsxs)(Ce.Z,{children:[(0,je.jsx)(Pa,{currentValue:y,databaseType:l,onChange:h,disabled:r||!(0,oe.$K)(o.configWithoutDates)}),(0,je.jsx)(Ma,{...e})]})]})}function Ma(e){window.__c={n:"DatePropertiesConfigSection"};const{collectionContextStore:t,currentConfig:o,onConfigChange:i,disabled:r}=e,s=(0,m.VK)((()=>{const e=t.normalizedSchemaStore.state;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,C.Lt)(o)}))}),[t]),l=s.length,c=o.datePropertyId?s.find((e=>e!==o.datePropertyId)):void 0,d="string"==typeof o.datePropertyId&&(0,oe.$K)(o.endDatePropertyId),u=(0,n.useCallback)(((e,t)=>{const n={[e]:t};if(d&&(0,oe.$K)(o.datePropertyId)){const i="datePropertyId"===e?"endDatePropertyId":"datePropertyId";o[i]===t&&(n[i]=s.find((e=>e!==t)))}i({...o,...n})}),[o,s,i,d]);return!(0,oe.$K)(o.configWithoutDates)||l<=1?null:(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(ba,{collectionContextStore:t,currentPropertyId:o.datePropertyId,title:d?(0,je.jsx)(a.FormattedMessage,{...vr.dH.startDate}):(0,je.jsx)(a.FormattedMessage,{...vr.dH.datePropertyPickerTitle}),onPropertyChanged:e=>u("datePropertyId",e),disabled:r}),(0,oe.$K)(c)&&"string"==typeof o.datePropertyId&&(0,je.jsxs)(je.Fragment,{children:[(0,oe.$K)(o.endDatePropertyId)&&(0,je.jsx)(ba,{collectionContextStore:t,currentPropertyId:o.endDatePropertyId,title:(0,je.jsx)(a.FormattedMessage,{...vr.dH.endDate}),onPropertyChanged:e=>u("endDatePropertyId",e),disabled:r}),(0,je.jsx)(ta.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationFeatures.datePropertyPicker.separateStartEnd",defaultMessage:"Separate start and end dates"}),focused:!1,on:d,disabled:r,disabledFeedback:!0,onClick:()=>{i({...o,endDatePropertyId:d?void 0:c})}})]})]})}function _a(e){const{collectionSettingsStore:t,feature:o,permissionScopes:n}=e,i=!n.canConfigureCollection&&!n.canConfigureBlock;return(0,je.jsx)(en.Z,{icon:Yr.H,showChevron:!0,disabled:i,title:(0,je.jsx)(a.FormattedMessage,{...vr.dH.advancedSettings}),onClick:()=>{l.H4({collectionSettingsStore:t,item:{type:"relationFeaturesAdvancedSettings",feature:o}})}})}function Ta(e){window.__c={n:"TurnOnFeatureButton"};const{feature:t,handleAddRelation:o,databaseType:n,permissionScopes:i}=e,r=(0,y.yK)((e=>({button:{width:"100%"},buttonWrap:{margin:"0px 12px"}})),[]);if(!i.canConfigureBlock||!i.canConfigureCollection)return null;const s=(0,vr.Tq)({feature:t,databaseType:n});return(0,je.jsx)(Ce.Z,{disableMobileBorders:!0,children:(0,je.jsx)("div",{style:r.buttonWrap,children:(0,je.jsx)(jo.Z,{style:r.button,onClick:o,isLarge:!0,children:(0,je.jsx)(a.FormattedMessage,{...s})})})})}function ka(e){window.__c={n:"TurnOffFeatureMenuItem"};const{feature:t,permissionScopes:o,propertyName:n,relationPropertyId:i,inversePropertyName:r,collectionContextStore:s,collectionSettingsStore:c,handleDefaultPropertySelect:u,databaseType:p}=e,m=(0,g.O7)(),h=(0,y.yK)((e=>({modalTitle:{fontWeight:ne.Z.fontWeight.semibold,fontSize:18},modalInnerStyle:{textAlign:"center"},modalPropertyName:{color:e.darkTextColor,fontWeight:ne.Z.fontWeight.semibold}})),[]);if(!(o.canConfigureCollection&&o.canConfigureBlock&&n&&r))return null;const S=(0,vr.nB)({feature:t,databaseType:p}),f=(0,vr.OH)({feature:t,databaseType:p});return(0,je.jsx)(en.Z,{icon:pe.y,title:(0,je.jsx)(a.FormattedMessage,{...S}),isRed:!0,onClick:()=>{an.showDialog({description:(0,je.jsx)(a.FormattedMessage,{...vr.dH.turnOffFeatureDeletedProperties,values:{span:e=>(0,je.jsx)("span",{style:h.modalPropertyName,children:e}),propertyName:n,inversePropertyName:r}}),message:(0,je.jsx)("div",{style:h.modalTitle,children:(0,je.jsx)(a.FormattedMessage,{...f})}),innerStyle:h.modalInnerStyle,showCancel:!0,keepFocus:!0,items:[{label:(0,je.jsx)(a.FormattedMessage,{...vr.dH.turnOffAndDelete}),color:"red",onAccept:async()=>{i&&(await async function(e){const{environment:t,collectionContextStore:o,propertyId:n,feature:i}=e,r=o.normalizedSchemaStore.state,a=o.collectionStore();if(!a)return;await d.createAndCommitAsync({environment:t,userAction:"CollectionSettingsViewRelationFeatures.handleTurnOffFeatureAndDeleteAccept",waitForServerCommit:!1,perform:e=>Jr.yV({environment:t,collectionStore:a,schema:r,property:n,transaction:e})});const s=r[n];s&&Ot.y9({environment:t,collectionContextStore:o,property_type:s.type,from:i,property:n})}({environment:m,propertyId:i,collectionContextStore:s,feature:t}),u(void 0),l.wl({collectionSettingsStore:c,item:{type:"main"}}))}}]})}})}function Pa(e){const{currentValue:t,onChange:o,disabled:n,databaseType:i}=e;return(0,je.jsx)(ta.Z,{title:(0,je.jsx)(a.FormattedMessage,{...vr.dH.avoidWeekendsSwitcherTitle}),caption:(0,je.jsx)(a.FormattedMessage,{...(0,vr.Bq)(i)}),shouldWrapCaption:!0,shouldWrapTitle:!0,focused:!1,on:t,disabled:n,disabledFeedback:!0,onClick:()=>o(!t)})}function Aa(e){window.__c={n:"DateShiftModeSelect"};const{currentMode:t,onModeChange:o,disabled:n,databaseType:i}=e,r=(0,y.yK)((e=>({wrap:{display:"flex",flexDirection:"column",rowGap:8,marginLeft:12,marginRight:12}})),[]);return(0,je.jsx)("div",{style:r.wrap,children:[...Qr.Bp,void 0].map((e=>(0,je.jsx)(Va,{dateShiftingMode:e,databaseType:i,onClick:()=>o(e),active:e===t,disabled:n},e??"none")))})}function Va(e){window.__c={n:"DateShiftButton"};const{dateShiftingMode:t,onClick:o,active:n,disabled:i,databaseType:r}=e,s=(0,g.Fy)(),l=(0,y.yK)((e=>({buttonStyles:{fontSize:s.isMobile?ne.Z.fontSize.UISmall.mobile:ne.Z.fontSize.UISmall.desktop,fontWeight:ne.Z.fontWeight.medium,borderRadius:3,width:"100%",padding:"8px 8px",boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.darkTextColor,fill:e.mediumTextColor,...n&&{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor,fill:e.blueColor},...i&&{opacity:.65}},icon:{width:20,height:20,marginRight:6},buttonContentWrap:{display:"flex",alignItems:"center"}})),[n,s,i]),c=(0,vr.W3)({dateShiftingMode:t,databaseType:r}),d=(0,vr.l7)(t);return(0,je.jsx)(me.Z,{style:l.buttonStyles,onClick:o,disabled:i,children:(0,je.jsxs)("div",{style:l.buttonContentWrap,children:[(0,je.jsx)("div",{children:d(l.icon)}),(0,je.jsx)("div",{children:(0,je.jsx)(a.FormattedMessage,{...c})})]})})}function Fa(e){const{environment:t,newConfig:o,collectionStore:n,transaction:i,intl:r}=e;let a;if((0,oe.$K)(o.configWithoutDates))if(o.datePropertyId)a={...o.configWithoutDates,date_property:o.datePropertyId,end_date_property:o.endDatePropertyId};else{const e=(0,Xr.ZP)(),s={name:r.formatMessage(vr.dH.newDateProperty),type:"date"};ea.xO({environment:t,collectionStore:n,update:{[e]:s},transaction:i}),a={...o.configWithoutDates,date_property:e,end_date_property:void 0}}sn.sW({store:n.getFormatStore(),data:{dependency_date_shifting_config:a??null},transaction:i})}function Ba(e){const{viewType:t,feature:o}=e;return"timeline_arrows_by"===o?"timeline"===t:"subitem"===o||void(0,oe.t1)(o)}function Ia(e){window.__c={n:"CollectionSettingsViewRelationFeatures"};const{collectionContextStore:t,collectionSettingsStore:o,feature:i}=e,r=(0,a.useIntl)(),s=(0,g.Fy)(),l=(0,m.VK)((()=>t.normalizedSchemaStore.state),[t]),c=(0,m.VK)((()=>t.databaseType),[t]),d=(0,m.VK)((()=>t.collectionStore()),[t]),u=va({collectionContextStore:t,feature:i}),p=null==u?void 0:u.property,h=(0,n.useMemo)((()=>oi.HI(l)),[l]),S=(0,m.VK)((()=>t.permissionScopes.state),[t]),f=(0,m.VK)((()=>{var e;return p&&(null===(e=l[p])||void 0===e?void 0:e.name)}),[l,p]),x=(0,m.VK)((()=>{const e=p&&l[p];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=l[o])||void 0===t?void 0:t.name:void 0}}),[p,l]),v=(0,m.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?Cr.aI(r,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:i}):r.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[t,r,i]),C=(0,m.VK)((()=>Boolean(d&&function(e){const{collectionContextStore:t,collectionStore:o}=e,n=o.getFormat().collection_default_arrows_by,i=t.currentArrowsByFormatStore.state;return!(0,oe.$K)(i)||i===n}({collectionContextStore:t,collectionStore:d}))),[t,d]),b=(0,m.qz)(void 0,be.Z),w=(0,n.useCallback)((e=>{e&&b.setState({open:!1})}),[b]),{initialPropertyName:j}=Sa({collectionContextStore:t,feature:i}),M=fa({collectionContextStore:t,collectionSettingsStore:o,onPropertySelect:w,feature:i}),{handleAddRelation:_,handleDefaultPropertySelect:T}=M,k=wr("collection_level_subitems_setting"),P=(0,y.yK)((e=>({container:{marginLeft:12,marginRight:12},captionText:{fontSize:s.isMobile?ne.Z.fontSize.UISmall.mobile:ne.Z.fontSize.UISmall.desktop,color:e.mediumTextColor,fontWeight:ne.Z.fontWeight.regular}})),[s]);if(!d)return null;let A;"subitem"===i?A=u?(0,je.jsxs)(Ce.Z,{disableMobileBorders:!0,children:[(0,je.jsx)(_a,{collectionSettingsStore:o,feature:i,permissionScopes:S}),k?(0,je.jsx)(Na,{databaseType:c,permissionScopes:S}):(0,je.jsx)(Ra,{feature:i,databaseType:c,featuredRelationProperty:u,actions:M,permissionScopes:S}),(0,je.jsx)(ka,{feature:i,databaseType:c,permissionScopes:S,propertyName:f,relationPropertyId:p,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:T,inversePropertyName:x})]}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(kr,{propertyName:f||j,inversePropertyName:x||v,newDesign:!0}),(0,je.jsx)(Ta,{feature:i,permissionScopes:S,databaseType:c,handleAddRelation:()=>{_({featureType:"subitem"})}})]}):"timeline_arrows_by"===i?A=u?(0,je.jsxs)(je.Fragment,{children:[C?(0,je.jsx)(Da,{collectionContextStore:t,firstDatePropertyId:h,permissionScopes:S}):(0,je.jsx)(Za,{collectionContextStore:t,databaseType:c}),(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[(0,je.jsx)(_a,{collectionSettingsStore:o,feature:i,permissionScopes:S}),(0,je.jsx)(Ra,{feature:i,databaseType:c,featuredRelationProperty:u,actions:M,permissionScopes:S}),(0,je.jsx)(ka,{feature:i,databaseType:c,permissionScopes:S,relationPropertyId:p,propertyName:f,inversePropertyName:x,collectionContextStore:t,collectionSettingsStore:o,handleDefaultPropertySelect:T})]})]}):(0,je.jsx)(Ka,{databaseType:c,collectionContextStore:t,firstDatePropertyId:h,handleAddRelation:_,permissionScopes:S}):(0,oe.t1)(i);const V=(0,vr.Gt)({feature:i,databaseType:c}),F=(0,vr.qi)({feature:i,databaseType:c});return(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{...V}),children:[(0,je.jsx)(Ce.Z,{disableMobileBorders:!0,children:(0,je.jsx)("div",{style:{...P.container,...P.captionText},children:(0,je.jsx)(a.FormattedMessage,{...F})})}),A]})}function Za(e){window.__c={n:"DateShiftingNotApplicableToThisViewMessage"};const{collectionContextStore:t,databaseType:o}=e,n=(0,g.MO)(),i=(0,y.yK)((e=>({wrap:{boxShadow:e.plainButtonBoxShadow,...n?{backgroundColor:e.sidebarBackground,margin:void 0,borderRadius:void 0}:{background:"rgba(196, 196, 196, 0.13)",marginTop:14,marginBottom:20}},iconWithMessage:{display:"flex",gap:8},icon:{width:14,height:14,position:"relative",top:1,color:e.mediumTextColor}})),[n]),r=(0,m.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),s=(0,vr.uM)({currentDateShiftConfig:r,databaseType:o});return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{title:(0,je.jsx)(a.FormattedMessage,{...vr.dH.dateShiftingSectionCaption}),children:(0,je.jsx)(Gr,{mode:null==r?void 0:r.mode})}),(0,je.jsx)(Mr,{style:i.wrap,showCloseButton:!1,children:(0,je.jsxs)("div",{style:i.iconWithMessage,children:[(0,fr.D)(i.icon),(0,je.jsx)(_r.Z,{isSmall:!0,isMultiline:!0,children:(0,je.jsx)(a.FormattedMessage,{...s})})]})})]})}function Da(e){window.__c={n:"FeatureEnabledDependenciesSection"};const{collectionContextStore:t,firstDatePropertyId:o,permissionScopes:i}=e,r=(0,g.O7)(),s=(0,a.useIntl)(),l=(0,m.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getNormalizedDependencyDateShiftingConfig()}),[t]),c=(0,n.useCallback)((e=>{const o=t.collectionStore();o&&d.createAndCommit({userAction:"FeatureEnabledDependenciesSection.handleConfigChange",environment:r,perform:t=>{Fa({collectionStore:o,environment:r,intl:s,newConfig:e,transaction:t})}})}),[t,r,s]),u=(0,n.useMemo)((()=>({configWithoutDates:l,...l?{datePropertyId:l.date_property,endDatePropertyId:l.end_date_property}:{datePropertyId:o}})),[l,o]);return(0,je.jsx)(ja,{collectionContextStore:t,currentConfig:u,disabled:!i.canConfigureBlock||!i.canConfigureCollection,onConfigChange:c})}function Ka(e){window.__c={n:"FeatureDisabledDependenciesSection"};const{collectionContextStore:t,handleAddRelation:o,firstDatePropertyId:i,permissionScopes:r,databaseType:a}=e,[s,l]=(0,n.useState)({datePropertyId:i,configWithoutDates:{mode:"consume_gap",avoid_weekends:true}});return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(ja,{collectionContextStore:t,currentConfig:s,disabled:!r.canConfigureBlock||!r.canConfigureCollection,onConfigChange:l}),(0,je.jsx)(Ta,{feature:"timeline_arrows_by",permissionScopes:r,databaseType:a,handleAddRelation:()=>{o({featureType:"timeline_arrows_by",dateShiftingConfig:s})}})]})}function Ra(e){window.__c={n:"ToggleViewVisibilityMenuItem"};const{feature:t,featuredRelationProperty:o,actions:n,permissionScopes:i,databaseType:r}=e,s=(0,g.Fy)(),l=(0,y.yK)((()=>({eyeHideIcon:{width:20,height:s.isMobile?24:12,marginLeft:3}})),[s]);if(!o.supportedInView)return null;const c=o.enabledOnView,d=c?{icon:Sr.B,iconStyle:l.eyeHideIcon}:{icon:hr.c};return(0,je.jsx)(en.Z,{...d,onClick:()=>{n.handlePropertySelect(c?void 0:o.property)},title:(0,je.jsx)(a.FormattedMessage,{...(0,vr.cn)({feature:t,isOn:c,databaseType:r})}),disabled:!i.canConfigureBlock})}function Na(e){window.__c={n:"SubitemDisplayModeMenuItem"};const{databaseType:t,permissionScopes:o}=e,i=(0,xr.Y$)(),r=(0,m.VK)((()=>i.collectionViewStore()),[i]),s=(0,m.VK)((()=>null==r?void 0:r.getFormat().collection_view_subitem),[r]),l=void 0===(null==s?void 0:s.display_mode),u=(0,g.Fy)(),p=(0,g.O7)(),h=(0,y.yK)((()=>({eyeHideIcon:{width:20,height:u.isMobile?24:12,marginLeft:3}})),[u]),S=n.useCallback((()=>{r&&s&&d.createAndCommit({userAction:"actionRegistry.updateCollectionViewSubitemDisplayMode",environment:p,perform:e=>{c.FH({stores:[r],update:{collection_view_subitem:{...s,display_mode:void 0===s.display_mode?"hidden":void 0}},transaction:e})}})}),[r,s,p]),f=l?{icon:Sr.B,iconStyle:h.eyeHideIcon}:{icon:hr.c};return(0,je.jsx)(en.Z,{...f,onClick:S,title:(0,je.jsx)(a.FormattedMessage,{...(0,vr.cn)({feature:"subitem",isOn:l,databaseType:t})}),disabled:!o.canConfigureBlock})}var Oa=o(91),Ea=o(80402),La=o(60442);function Wa(e){const{render:t,showImage:o,caption:i,tooltipImage:r}=e,a=e.tooltipImageScale||1,[s,l]=n.useState(!1),[c,d]=n.useState({width:0,height:0});return n.useEffect((()=>{if(r){const e=new Image;e.src=r,e.onload=()=>{d({width:e.width*a,height:e.height*a}),l(!0)}}}),[r,a]),(0,je.jsx)(ae.Z,{placement:ae.Z.Placement.Left,disableTooltip:void 0===i,style:{whiteSpace:"break-spaces"},render:t,renderTooltip:()=>r&&s&&o?(0,je.jsx)(La.Z,{caption:i,imageURL:r,imageWidth:c.width,imageHeight:c.height}):(0,je.jsx)("div",{children:i})})}const Ga="box1-filter",Ha="box2-filter";function za(e){window.__c={n:"CollectionSettingsViewDependenciesPreview2"};const{propertyName:t,inversePropertyName:o}=e,n=(0,y.Fg)(),i=(0,y.yK)((e=>({svgWrap:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,backgroundColor:e.accentColors.gray[30],display:"flex",justifyContent:"center"}})),[]);return(0,je.jsx)(Ce.Z,{disableMobileBorders:!0,children:(0,je.jsx)("div",{style:i.svgWrap,children:(0,je.jsxs)("svg",{width:"266",height:"116",fill:"none",children:[(0,je.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M124 20h.426c7.703 0 17.307-.002 25.029 1.93 3.979.994 8.078 2.638 11.248 5.575C164.082 30.635 166 34.868 166 40c0 8.001-6.095 12.917-11.524 15.932-5.553 3.086-12.74 5.481-19.23 7.644l-.349.116c-6.919 2.307-13.074 4.381-17.546 6.866C112.655 73.166 112 75 112 76c0 1.868.582 2.885 1.453 3.692 1.08 1.001 2.981 1.982 6.002 2.737C125.59 83.963 132.773 84 141 84"}),(0,je.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M125 32c8.227 0 15.41.037 21.545 1.57 3.021.756 4.922 1.737 6.002 2.738.871.807 1.453 1.824 1.453 3.692 0 .999-.655 2.834-5.351 5.443-4.472 2.484-10.627 4.558-17.546 6.865l-.349.116c-6.49 2.163-13.677 4.558-19.23 7.644C106.095 63.084 100 67.998 100 76c0 5.132 1.918 9.365 5.297 12.495 3.17 2.937 7.269 4.581 11.248 5.576C124.267 96 133.871 96 141.574 96H142"}),(0,je.jsx)("path",{fill:n.accentColors.gray[30],d:"M157 27h16v18h-16zM92 70h16v18H92z"}),(0,je.jsx)("path",{stroke:"#DFAF49",strokeWidth:"2",d:"M136 88l5-4-5-4"}),(0,je.jsx)("path",{stroke:"#E3E2E0",strokeWidth:"2",d:"M130 36l-5-4 5-4"}),(0,je.jsxs)("g",{filter:"url(#box1-filter)",children:[(0,je.jsx)("rect",{width:"100",height:"28",x:"24",y:"12",fill:n.buttonBackground,rx:"3"}),(0,je.jsx)("text",{x:"67",y:"31",fill:"#000",children:"🌱"})]}),(0,je.jsxs)("g",{filter:"url(#box2-filter)",children:[(0,je.jsx)("rect",{width:"100",height:"28",x:"142",y:"76",fill:n.buttonBackground,rx:"3"}),(0,je.jsx)("text",{x:"185",y:"95",fill:"#000",children:"🌳"})]}),(0,je.jsx)(Ua,{x:"161",y:"26",width:"100",height:"16",textStyles:{fontSize:12,fontWeight:590,color:n.regularTextColor},children:t}),(0,je.jsx)(Ua,{x:"15",y:"69",width:"90",height:"16",textStyles:{color:n.lightTextColor,fontSize:12,fontWeight:500,textAlign:"right"},children:o}),(0,je.jsxs)("defs",{children:[(0,je.jsxs)("filter",{id:Ga,width:"108",height:"36",x:"20",y:"10",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,je.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,je.jsx)("feOffset",{}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feOffset",{dy:"2"}),(0,je.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,je.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]}),(0,je.jsxs)("filter",{id:Ha,width:"108",height:"36",x:"138",y:"74",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",children:[(0,je.jsx)("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feMorphology",{in:"SourceAlpha",operator:"dilate",radius:"1",result:"effect1_dropShadow_1034_52436"}),(0,je.jsx)("feOffset",{}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0707 0 0 0 0 0.0693 0 0 0 0 0.0693 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"BackgroundImageFix",result:"effect1_dropShadow_1034_52436"}),(0,je.jsx)("feColorMatrix",{in:"SourceAlpha",result:"hardAlpha",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),(0,je.jsx)("feOffset",{dy:"2"}),(0,je.jsx)("feGaussianBlur",{stdDeviation:"2"}),(0,je.jsx)("feComposite",{in2:"hardAlpha",operator:"out"}),(0,je.jsx)("feColorMatrix",{values:"0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0 0.0705882 0 0 0 0.1 0"}),(0,je.jsx)("feBlend",{in2:"effect1_dropShadow_1034_52436",result:"effect2_dropShadow_1034_52436"}),(0,je.jsx)("feBlend",{in:"SourceGraphic",in2:"effect2_dropShadow_1034_52436",result:"shape"})]})]})]})})})}function Ua(e){const{children:t,textStyles:o,...n}=e;return(0,je.jsx)("foreignObject",{...n,children:(0,je.jsx)("div",{style:{...ne.Z.textOverflowStyle,...n.width?{width:Number(n.width)}:{},...o},children:t})})}function $a(e){var t;window.__c={n:"CollectionSettingsDependenciesAdvancedSettings"};const{collectionContextStore:o,collectionSettingsStore:i,feature:r}=e,s=(0,a.useIntl)(),l=wr("collection_level_subitems_setting"),c=(0,m.VK)((()=>o.collectionStore()),[o]),d=(0,m.VK)((()=>o.normalizedSchemaStore.state),[o]),u=(0,m.VK)((()=>o.permissionScopes.state),[o]),p=null===(t=va({collectionContextStore:o,feature:r}))||void 0===t?void 0:t.property,g=(0,m.VK)((()=>{var e;return p&&(null===(e=d[p])||void 0===e?void 0:e.name)}),[p,d]),y=(0,m.VK)((()=>{const e=p&&d[p];if(e&&"relation"===e.type){var t;const o=e.property;return o?null===(t=d[o])||void 0===t?void 0:t.name:void 0}}),[p,d]),h=(0,m.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?Cr.aI(s,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:r}):s.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,s,r]),S=(0,m.qz)(void 0,be.Z),{initialPropertyName:f}=Sa({collectionContextStore:o,feature:r}),x=(0,n.useCallback)((e=>{e&&S.setState({open:!1})}),[S]);if(!c)return null;let v;return"subitem"===r?v=(0,je.jsx)(kr,{propertyName:g||f,inversePropertyName:y||h,newDesign:!0}):"timeline_arrows_by"===r?v=(0,je.jsx)(za,{propertyName:g||f,inversePropertyName:y||h}):(0,oe.t1)(r),(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{...vr.dH.advancedSettings}),children:[v,(0,je.jsxs)(Ce.Z,{disableMobileBorders:!0,children:[(0,je.jsx)(Ca,{currentPropertyId:p,feature:r,onPropertySelect:x,buttonPopupStore:S,collectionContextStore:o,collectionSettingsStore:i,permissionScopes:u,disabled:l&&!u.canConfigureCollection}),"subitem"===r&&(0,je.jsx)(qa,{collectionContextStore:o,permissionScopes:u})]})]})}function qa(e){window.__c={n:"ToggleNestingOnTitleMenuItem"};const{collectionContextStore:t,permissionScopes:o}=e,i=(0,a.useIntl)(),r=(0,g.O7)(),s=(0,m.VK)((()=>"title"===t.normalizedFormatStore.state.table_subitem_toggle_column),[t]),l=!o.canConfigureBlock,c=(0,n.useCallback)((()=>{const e=t.collectionViewStore();e&&(Ea.d1({environment:r,collectionViewStore:e,currentValue:t.normalizedFormatStore.state.table_subitem_toggle_column}),Ot.wd({environment:r,collectionContextStore:t,action:"toggle_table_subitem_toggle_on_title"}))}),[t,r]);return(0,je.jsx)(Wa,{showImage:o.canConfigureBlock,caption:i.formatMessage(vr.dH.toggleNestingOnTitleMenuItemTooltip),tooltipImage:xo.Z.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,je.jsx)(en.Z,{...e,icon:e=>(0,Oa.L)({width:11,height:11,marginRight:5,marginLeft:6,transform:"rotateZ(180deg)"}),onClick:c,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:(0,je.jsx)(ir.Z,{disallowTabbing:!0,on:s,disabled:l,onClick:c}),disabled:l})})}var Qa=o(1302),Ya=o(93959),Xa=o(3500);function Ja(e){window.__c={n:"CollectionSettingsViewDependenciesPreview"};const{propertyName:t}=e,o=(0,y.Fg)(),n=(0,y.yK)((e=>({dependenciesPreviewOutsideBorder:{margin:"0px 12px",border:`1px solid ${e.regularDividerColor}`,borderRadius:4,alignItems:"center",position:"relative",height:112,paddingLeft:19},svgContainer:{position:"absolute",width:"100%",height:"100%"},svgArrowTheme:{stroke:e.collectionValidDependencyArrow,strokeWidth:Ar.lf},dependencyPropertyNamePreview:{fontSize:12,position:"absolute",background:e.buttonBackground,top:48,left:96},timelineItemPreview:{padding:4,margin:"0px 12px",display:"flex",fontSize:14,alignItems:"center",borderRadius:5,background:e.cardBackground,boxShadow:e.buttonBoxShadow,width:100,justifyContent:"center"}})),[]);return(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(Ce.Z,{children:(0,je.jsxs)("div",{style:n.dependenciesPreviewOutsideBorder,children:[(0,je.jsxs)("svg",{style:n.svgContainer,children:[(0,je.jsx)(Kr.Z,{startPoint:{x:110,y:25},endPoint:{x:110,y:87},style:n.svgArrowTheme,showArrowHead:!0}),(0,je.jsx)(Kr.Z,{startPoint:{x:210,y:87},endPoint:{x:223,y:87},style:n.svgArrowTheme,showArrowHead:!1}),(0,je.jsx)("circle",{cx:223,cy:87,r:Ar.Wk,style:n.svgArrowTheme,fill:o.white})]}),(0,je.jsx)("div",{style:n.dependencyPropertyNamePreview,children:t}),(0,je.jsx)("div",{style:{...n.timelineItemPreview,marginTop:10,marginLeft:10},children:(0,je.jsx)("span",{children:"🌱"})}),(0,je.jsx)("div",{style:{...n.timelineItemPreview,marginTop:34,marginLeft:111},children:(0,je.jsx)("span",{children:"🌳"})})]})})})}const es=(0,a.defineMessages)({subitemInputPlaceholder:{defaultMessage:"Sub-tasks…",id:"database.viewSettings.relationsPropertyTab.subitemInputPlaceholder"},timelineArrowsByInputPlaceholder:{defaultMessage:"Dependencies…",id:"database.viewSettings.relationsPropertyTab.timelineArrowsByInputPlaceholder"}});const ts=(0,a.injectIntl)((function(e,t){window.__c={n:"CollectionSettingsViewRelationsProperty"};const{collectionContextStore:o,collectionSettingsStore:i,formatSetting:r}=e,s=(0,g.Fy)(),u=(0,a.useIntl)(),p=(0,g.O7)(),h="collection_page_properties",[S]=(0,n.useState)("no_limit"),f="subitem"===r,x="timeline_arrows_by"===r,v=(0,m.VK)((()=>o.databaseType),[o.databaseType]),C=(0,m.VK)((()=>o.normalizedSchemaStore.state),[o]),b=(0,m.VK)((()=>o.collectionStore()),[o]),w=(0,m.VK)((()=>(null==b?void 0:b.getFormat())??{}),[b]),j=(0,m.VK)((()=>{var e;return f?null===(e=o.currentSubitemFormatStore.state)||void 0===e?void 0:e.property:x?o.currentArrowsByFormatStore.state:void 0}),[o,f,x]),M=(0,m.VK)((()=>{var e,t;return f?null===(e=o.collectionStore())||void 0===e||null===(e=e.getFormat())||void 0===e?void 0:e.collection_default_subitem:x?null===(t=o.collectionStore())||void 0===t||null===(t=t.getFormat())||void 0===t?void 0:t.collection_default_arrows_by:void 0}),[o,f,x]),_=(0,m.VK)((()=>o.permissionScopes.state),[o]),T=(0,m.VK)((()=>Cr.NA(o,C)),[o,C]),k=(0,m.VK)((()=>o.normalizedSchemaStore.state),[o]),P=(0,m.VK)((()=>{var e;const t=o.currentSubitemFormatStore.state,n=o.currentArrowsByFormatStore.state;let i;return f?i=t?C[t.property]:void 0:x&&(i=n?C[n]:void 0),null===(e=i)||void 0===e?void 0:e.name}),[o,C,f,x]),A=(0,m.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?Cr.m8(u,{targetCollectionStore:e,isSelfRelation:!0,sourceSchema:k,createUnique:!0,from:r}):u.formatMessage({id:"database.viewSettings.relationsPropertyTab.initialPropertyName.placeholder",defaultMessage:"Related to target"})}),[o,k,u,r]),[F,B]=(0,n.useState)(P||A),I=F===A,Z=(0,m.VK)((()=>{const e=o.currentSubitemFormatStore.state,t=o.currentArrowsByFormatStore.state;let n;if(f?n=e?C[e.property]:void 0:x&&(n=t?C[t]:void 0),n&&"relation"===n.type){var i;const e=n.property;return e?null===(i=C[e])||void 0===i?void 0:i.name:void 0}}),[o,C,f,x]),D=(0,m.VK)((()=>{const e=o.collectionStore();return null!=e&&e.isDefined()?Cr.aI(u,{sourceCollection:e.getModel(),isSelfRelation:!0,targetCollectionStore:e,createUnique:!0,from:r}):u.formatMessage({id:"database.viewSettings.relationsPropertyTab.inverseName.placeholder",defaultMessage:"Related to this database"})}),[o,u,r]),K=(0,m.VK)((()=>"title"===o.normalizedFormatStore.state.table_subitem_toggle_column),[o]),[R,N]=(0,n.useState)({hasInverseRelation:!0,inverseName:Z,autoRelate:{enabled:!1}}),[O,E]=(0,n.useState)(0===T.length),L=(0,m.VK)((()=>(0,Ya.$4)()),[]),W=(0,m.qz)(void 0,be.Z),G=(0,m.Kw)(W),H=(0,n.useCallback)((()=>Cr.NA(o,C)),[o,C]),U=(0,n.useCallback)((e=>{if(e){const t=C[e];if(t&&"relation"===t.type){const e=t.property;if(e){const t=C[e];if(t&&R){const e=t.name;N({hasInverseRelation:null==R?void 0:R.hasInverseRelation,inverseName:e,autoRelate:null==R?void 0:R.autoRelate})}}B(t.name)}}}),[C,R,B]),$=(0,n.useCallback)((e=>{const{collectionViewStore:t,newProperty:o,transaction:n}=e;f?(ha.dR({collectionViewStore:t,propertyId:o,transaction:n}),(0,He.o8)(t.getFormat().table_subitem_toggle_column)&&c.FH({stores:[t],update:{table_subitem_toggle_column:"title"},transaction:n})):x&&ya.tF({collectionViewStore:t,newProperty:o,transaction:n})}),[f,x]),q=(0,n.useCallback)((e=>{const{relationPropertyId:t,transaction:n}=e;f&&ha.jA({collectionContextStore:o,relationPropertyId:t,transaction:n}),x&&ya._p({collectionContextStore:o,relationPropertyId:t,transaction:n})}),[o,f,x]),Q=(0,n.useCallback)((e=>{const t=o.collectionViewStore();t&&(d.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handleDefaultPropertySelect",environment:p,perform:o=>{$({collectionViewStore:t,newProperty:e,transaction:o}),q({relationPropertyId:e,transaction:o})}}),U(e),E(!1),l.E3({collectionSettingsStore:i}),Ot.wd({action:f?"update_default_subitem":"update_default_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:p,collectionContextStore:o}))}),[o,p,E,U,i,f,$,q]),Y=(0,n.useCallback)((e=>{const t=o.collectionViewStore();t&&(d.createAndCommit({userAction:"CollectionSettingsViewRelationsProperty.handlePropertySelect",environment:p,perform:o=>{$({collectionViewStore:t,newProperty:e,transaction:o})}}),U(e),E(!1),l.E3({collectionSettingsStore:i}),Ot.wd({action:f?"update_subitem":"update_timeline_arrows_by",original_view_type:void 0,property_type:e?"relation":void 0,environment:p,collectionContextStore:o}))}),[o,p,U,i,f,$]),X=(0,n.useCallback)((()=>{Qa.default.afterNextFlush((()=>{E(!0),N({hasInverseRelation:!0,inverseName:D,autoRelate:{enabled:!1}}),B(A)}))}),[D,A]),J=(0,n.useCallback)((()=>{if(!R)return;const{hasInverseRelation:e,inverseName:t,autoRelate:n}=R,a=o.collectionStore(),s=a,c=o.collectionViewStore();a&&s&&(d.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:p,perform:i=>{const l=Jr.G3({environment:p,collectionStore:a,collectionViewArgs:c?{collectionViewStore:c,format:c.getFormat(),formatKey:h}:void 0,propertyType:"relation",transaction:i});return ma.n7({environment:p,collectionContextStore:o,collectionStore:a,property:l,propertyName:F,targetCollectionStore:s,hasInverseRelation:e,inverseName:t,autoRelate:n,propertyLimit:S,intl:u,transaction:i,from:r}),c&&($({collectionViewStore:c,newProperty:l,transaction:i}),q({relationPropertyId:l,transaction:i})),l}}),l.z$({collectionSettingsStore:i}),l.H4({collectionSettingsStore:i,item:{type:"main"}}),Ot._H({environment:p,collectionContextStore:o,from:r,property_type:"relation"}))}),[o,p,i,h,u,S,F,R,r,$,q]),ee=(0,n.useCallback)((()=>{const e=o.collectionViewStore();e&&(Ea.d1({environment:p,collectionViewStore:e,currentValue:o.normalizedFormatStore.state.table_subitem_toggle_column}),Ot.wd({environment:p,collectionContextStore:o,action:"toggle_table_subitem_toggle_on_title"}))}),[o,p]),te=!_.canConfigureBlock,oe=(0,y.yK)((e=>({emptyStateText:{color:e.mediumTextColor,fontSize:14,margin:"0px 12px"},useExistingTitle:{fontSize:12,color:e.mediumTextColor,marginLeft:12,marginTop:12}})),[]);if(!b)return null;const ne=f&&_.canConfigureBlock&&P&&L,ie=_.canConfigureCollection,re=(e,t,n,i)=>(0,je.jsx)(ra,{version:"v1",menuProps:e,property:t,defaultProperty:M,checkState:n,propertySchema:i,collectionContextStore:o,handleDefaultPropertySelect:Q,handlePropertySelect:Y});return(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{...(0,vr.Gt)({feature:r,databaseType:v})}),footer:(0,je.jsxs)(Ce.Z,{topBorder:T.length>0&&!O,children:[ne&&!O&&(0,je.jsx)(Wa,{showImage:!te,caption:Ne.default.formatMessage(vr.dH.toggleNestingOnTitleMenuItemTooltip),tooltipImage:xo.Z.images.tooltips.collectionSettings.subitemsToggleOnTitlePng,tooltipImageScale:.3,render:e=>(0,je.jsx)(en.Z,{...e,icon:e=>(0,Oa.L)({width:11,height:11,marginRight:5,marginLeft:6,transform:"rotateZ(180deg)"}),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Show nesting toggle on title",id:"database.viewSettings.layoutTab.tableSubitemToggleOnTitle"}),right:(0,je.jsx)(ir.Z,{disallowTabbing:!0,on:K,onClick:ee,disabled:te}),disabled:te,isGray:!0,onClick:ee})}),ie&&T.length>0&&!O&&(0,je.jsx)(en.Z,{icon:V.R,title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.subitemTab.newRelation",defaultMessage:"Create new relation"}),isGray:!0,onClick:X}),!O&&(0,je.jsx)(je.Fragment,{children:_.canConfigureBlock&&!_.canConfigureCollection?(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeSubitemRelation.removeSubitemButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>Y(void 0)}):_.canConfigureBlock&&(0,je.jsx)(he.ZP,{popupType:s.isPhone?ve.kQ.SlideUp:ve.kQ.Popup,alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,originGap:0,renderOrigin:e=>(0,je.jsx)(je.Fragment,{children:!(!_.canConfigureBlock||!j)&&(0,je.jsx)(en.Z,{isGray:!0,icon:pe.y,title:(0,je.jsx)(a.FormattedMessage,{...(0,vr.nB)({feature:r,databaseType:v})}),isRed:!0,...e})}),render:e=>{let t;return t=s.isPhone?{menuType:Lt.og.ActionSheet}:{menuType:Lt.og.Popup,width:300},(0,je.jsx)(fe.Z,{...t,footer:(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[_.canConfigureBlock&&(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.removeRelation.removeRelationButton.title",defaultMessage:"Turn off for this view"}),isRed:!0,onClick:()=>Y(void 0)}),_.canConfigureCollection&&(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Turn off for all new views",id:"database.viewSettings.relationsPropertyTab.removeRelation.removeAllDefaultButton.title"}),isRed:!0,onClick:()=>{Q(void 0)}})]})})}})})]}),children:[f&&(0,je.jsx)(kr,{propertyName:F||A,inversePropertyName:(null==R?void 0:R.inverseName)||D,newDesign:!1}),x&&(0,je.jsx)(Ja,{propertyName:F||A}),!O&&(0,je.jsx)("div",{style:oe.useExistingTitle,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Use an existing relation",id:"database.viewSettings.relationsPropertyTab.useExistingRelation.title"})}),T.length>0&&!O?(0,je.jsx)("div",{style:{paddingBottom:"6px"},children:(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(he.ZP,{buttonPopupStore:W,render:e=>{let t;return t=s.isPhone?{menuType:Lt.og.ActionSheet}:{menuType:Lt.og.Popup,width:300},(0,je.jsx)(fe.Z,{...t,footer:(0,je.jsx)(oa.Z,{schema:C,format:w,getProperties:H,onAccept:_.canConfigureBlock&&!_.canConfigureCollection?Y:()=>{},inputPlaceholder:Ne.default.formatMessage(f?es.subitemInputPlaceholder:es.timelineArrowsByInputPlaceholder),currentProperty:j,defaultShowPropertyCount:5,renderProperty:_.canConfigureBlock&&!_.canConfigureCollection?void 0:re})})},renderOrigin:e=>{var t;return(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.existingRelation",defaultMessage:"Property"}),showChevron:!0,right:j?null===(t=C[j])||void 0===t?void 0:t.name:void 0,rotateChevron:G.open,disabled:!1,icon:z.v,...e})},popupType:s.isPhone?ve.kQ.SlideUp:ve.kQ.Popup,alignmentToOrigin:he.vR.End,placementToOrigin:he.pO.Bottom,originGap:0})})}):ie&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{children:(0,je.jsx)("div",{style:oe.emptyStateText,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Rename (optional)",id:"database.viewSettings.relationsPropertyTab.emptyStateDescription"})})}),(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(no.ZP,{value:F,placeholder:F,onChange:e=>B(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})}),(0,je.jsx)(Xa.Z,{collectionContextStore:o,targetCollectionStore:b,property:void 0,buttonContents:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Create",id:"database.viewSettings.relationsPropertyTab.createButton.title"}),temporaryInverseState:R,setTemporaryInverseState:N,isInitialPropertyName:I,onSubmit:J,from:r}),T.length>0&&(0,je.jsx)("div",{style:{margin:"auto",textAlign:"center"},children:(0,je.jsx)(zt.Z,{onClick:()=>{Qa.default.afterNextFlush((()=>{E(!1)}))},isGray:!0,style:{margin:"6px 12px 6px 12px",width:"auto"},children:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.relationsPropertyTab.newRelation",defaultMessage:"Use existing relation"})})})]})]})}));var os=o(98742);function ns(e){window.__c={n:"CollectionSettingsAccountPicker"};const{integration:t,collectionSettingsStore:o,collectionContextStore:n,onAccountSelect:i}=e,r=(0,y.yK)((()=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"}})),[]),s=(0,g.O7)(),c=(0,m.VK)((()=>{var e;return null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId()}),[n]),d=(0,m.VK)((()=>{const e=It.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]);return t&&c?(0,je.jsx)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Choose an account",id:"collectionSettingsAccountPicker.title"}),footer:is({environment:s,integration:t,spaceId:c}),children:(0,je.jsx)("div",{style:r.settingsMenu,children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:0,sections:[{key:"externalAuthentications",items:d.map((e=>({key:e.id,render:o=>(0,je.jsx)(ae.Z,{renderTooltip:()=>(0,je.jsx)("span",{children:e.account_name}),placement:ae.Z.Placement.Left,textWrap:!0,render:n=>(0,je.jsx)(ye.Z,{...(0,os.Z)(n||{},o),title:e.account_name,icon:(0,je.jsx)("img",{style:{width:18},src:t.info.icon}),focused:o.focused})}),action:()=>{l.z$({collectionSettingsStore:o}),i(e)}}))),render:e=>(0,je.jsx)(Ce.Z,{...e})}]})})}):null}function is(e){const t=e.environment.device.isMobileBrowser;return(0,je.jsx)(Ce.Z,{topBorder:!0,children:t?void 0:rs(e)})}function rs(e){return(0,je.jsx)(en.Z,{...e,icon:V.R,title:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsAccountPicker.addAccount",defaultMessage:"Connect another account"}),isGray:!0,onClick:async()=>{await wo.hM({...e,from:"source_picker_connect_another_account"})}})}var as=o(8848),ss=o(58573),ls=o(59054),cs=o(20270),ds=o(35840),us=o(64002),ps=o(54642),gs=o(14871),ms=o(61202),ys=o(70764),hs=o(75079);function Ss(e){window.__c={n:"CollectionSettingsAccountSelectionIndicator"};const{onClick:t,integration:o,accountName:n}=e,i=(0,y.yK)((e=>({accountSelection:{padding:"8px",borderTop:`1px solid ${e.regularDividerColor}`,cursor:"pointer"},accountSelectionLabel:{fontWeight:ne.Z.fontWeight.medium,paddingLeft:4,paddingTop:4}})),[]);return(0,je.jsx)("div",{style:i.accountSelection,children:(0,je.jsxs)("div",{onClick:t,children:[(0,je.jsx)(_r.Z,{isSecondaryColor:!0,isSmall:!0,style:i.accountSelectionLabel,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.currentAccountSection.label",defaultMessage:"Connected to {integration}",values:{integration:o.name}})}),(0,je.jsx)(ae.Z,{renderTooltip:()=>(0,je.jsx)("span",{children:n}),placement:ae.Z.Placement.Left,textWrap:!0,render:t=>(0,je.jsx)(ye.Z,{showExtensionArrow:!0,focused:!1,...(0,os.Z)(t||{},e),title:n,icon:(0,je.jsx)("img",{style:{width:18},src:o.info.icon})})})]})})}var fs=o(29109),xs=o(1634);function vs(e){window.__c={n:"CollectionSettingsExternalAuthentication"};const{collectionContextStore:t,integration:o}=e,n=(0,y.Fg)(),i=(0,m.VK)((()=>t.collectionStore()),[t]),r=(0,m.VK)((()=>null==i?void 0:i.getIcon()),[i]),s=(0,g.O7)(),l=(0,m.VK)((()=>{var e;return null===(e=_o.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),c=(0,y.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},authenticationBody:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",padding:"0px 16px 16px 16px",textAlign:"center"},settingsMenuSubHeading:{display:"inline",fontSize:14,margin:"4px 20px 20px 20px",color:e.mediumTextColor,textAlign:"center"},settingsMenuAuthenticationButton:{fontSize:14,height:32,color:e.regularInvertedTextColor}})),[]),{background:d,hoveredBackground:u,pressedBackground:p}=(0,fs.d)(o,n.mode);return(0,je.jsx)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateHeader.title",values:{integration:o.name}}),children:(0,je.jsx)("div",{style:c.settingsMenu,children:(0,je.jsxs)("div",{style:c.authenticationBody,children:[(0,je.jsx)(ti.Z,{disabled:!0,bucket:"secure",store:i,icon:r,size:40,isEmptyPage:!1,style:{marginBottom:6}}),(0,je.jsx)("div",{style:c.settingsMenuSubHeading,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Link your {integration} account for richer content previews and seamless imports.",id:"collectionSettingsCreateExternalViewPicker.authenticateBody.title",values:{integration:o.name}})}),(0,je.jsx)(zt.Z,{onClick:()=>{l&&(wo.hM({environment:s,integration:o,spaceId:l,from:"placeholder_root_external_collection_view_block"}),xs.Z.reset())},style:{background:d,...c.settingsMenuAuthenticationButton},hoveredStyle:{background:u},pressedStyle:{background:p},children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"collectionSettingsCreateExternalViewPicker.authenticateButton.title",values:{integration:o.name}})})]})})})}var Cs=o(33338),bs=o(68785),ws=o(53336);function js(e){window.__c={n:"CollectionSettingsCreateExternalViewPicker"};const{collectionSettingsStore:t,collectionContextStore:o,externalAuthentication:n}=e,i=(0,m.VK)((()=>o.collectionStore()),[o]),r=(0,m.VK)((()=>{if(!i)return;const e=i.getFormat().integration_id;return It.Z.integrations.state.find((t=>t.id===e))}),[i]),a=(0,m.VK)((()=>!!r&&(0,ys.NP)(r.id).length>0),[r]),s=(0,m.VK)((()=>{var e;return null===(e=_o.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit()}),[]);return i&&s&&r?(0,je.jsx)(je.Fragment,{children:a?(0,je.jsx)(Ts,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:r,externalAuthentication:n}):(0,je.jsx)(vs,{...e,collectionContextStore:o,collectionSettingsStore:t,integration:r})}):null}const Ms=e=>{var t;return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))},_s=(0,a.defineMessages)({all:{id:"collectionSettingsCreateExternalViewPicker.filters.all",defaultMessage:"All"},issues:{id:"collectionSettingsCreateExternalViewPicker.filters.issues",defaultMessage:"Issues"},pull_requests:{id:"collectionSettingsCreateExternalViewPicker.filters.pullRequests",defaultMessage:"Pull Requests"},board:{id:"collectionSettingsCreateExternalViewPicker.filters.boards",defaultMessage:"Boards"},project:{id:"collectionSettingsCreateExternalViewPicker.filters.projects",defaultMessage:"Projects"},Releases:{id:"collectionSettingsCreateExternalViewPicker.filters.releases",defaultMessage:"Releases"},"Pull Request":{id:"collectionSettingsCreateExternalViewPicker.filters.PullRequests",defaultMessage:"Pull Requests"},Issues:{id:"collectionSettingsCreateExternalViewPicker.filters.Issues",defaultMessage:"Issues"}});function Ts(e){window.__c={n:"CollectionSettingsSourceSelection"};const{integration:t,collectionContextStore:o,collectionSettingsStore:i,externalAuthentication:r}=e,[c,d]=(0,n.useState)(""),u=(0,m.VK)((()=>{const e=It.Z.state;return e.loaded?e.externalAuthentications.filter((e=>e.integration_id===t.id)):[]}),[t]),p=(0,m.VK)((()=>r||(u.length?u[0]:null)),[u,r]),[h,S]=(0,n.useState)(!1),[f,x]=(0,n.useState)(null),v=(0,y.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},syncSourceButton:{width:"100%",display:"flex",justifyContent:"center"},noResults:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:as.ZP.white,background:as.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},syncingData:{width:"100%",paddingBottom:10,display:"flex",justifyContent:"center",fontSize:14,color:e.mediumTextColor},filterContainer:{position:"relative",flexGrow:0,overflow:"hidden"},filterContainerScroller:{display:"flex",alignItems:"center",padding:"8px 12px"}})),[]),C=(0,m.VK)((()=>o.collectionStore()),[o]),b=(0,m.VK)((()=>o.collectionViewBlockStore()),[o]),w=(0,g.O7)(),[{value:j,status:M}]=(0,ls.r5)((async()=>{if(!p)return;const e=p.parent_id;return ps.listExternalCollections(w,{bot_id:e})}),[w,p]),_="success"===(null==j?void 0:j.type)&&"data"in j.data?j.data.data:[],T="success"===(null==j?void 0:j.type)&&"error"in j.data?j.data.error:null,k=_.filter((e=>!f||e.type===f)),P=k.length?(0,ss.ZP)(c,k,(e=>e.title)):[],A=Array.from(new Set(_.map((e=>e.type)))),V=Ms({integration:t,url:c}),F=async e=>{if(S(!0),!C||!b)return;const n=e||c,r=Ms({integration:t,url:n});if(!r)return S(!1),void an.showDialog({items:[{label:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{gs.RD({environment:w,stringValue:JSON.stringify({botId:null==p?void 0:p.parent_id,url:n},null,2),copiedMessage:gs.tq.copiedToClipboard})}},{label:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const d=(0,ys.NP)(t.id);await ms.UY({environment:w,url:n,botIds:d.map((e=>e.id)),externalCollectionStore:C,externalCollectionViewBlockStore:b});const{host:u}=(0,us.Qc)(n);s.Mp(w,{...(0,hs.Pn)(o),integrationId:t.id,type:"collection",entity:r.name,domain:u||"",from:"external_picker_settings"}),l.wl({collectionSettingsStore:i,item:{type:"shareSyncedView",integrationName:t.name,integrationIcon:t.info.icon}}),S(!1)};if(!C||!b)return null;const B=A.length>1?(0,je.jsx)("div",{style:v.filterContainer,children:(0,je.jsxs)(ws.Z,{type:pr.Z.X,style:v.filterContainerScroller,showLeftRightOverlay:!1,children:[(0,je.jsx)(Cs.Z,{title:(0,je.jsx)("span",{children:Ne.default.formatMessage(_s.all)}),on:!(0,oe.K0)(f),hideChevron:!0,onClick:e=>{(0,ur.ZP)({event:e,context:ur.Af.CollectionSettingsClick,callback:()=>{x(null)}})}},"all"),A.map((e=>(0,je.jsx)(Cs.Z,{title:(0,je.jsx)("span",{children:Ne.default.formatMessage(_s[e])}),on:f===e,hideChevron:!0,onClick:t=>{(0,ur.ZP)({event:t,context:ur.Af.CollectionSettingsClick,callback:()=>{x((t=>t===e?null:e))}})}},e)))]})}):null,I=V?(0,je.jsx)("div",{style:v.syncSourceButton,children:(0,je.jsx)(jo.Z,{isLarge:!0,onClick:e=>{(0,ur.ZP)({event:e,context:ur.Af.CollectionSettingsClick,callback:()=>{F()}})},disabled:!1,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.syncSourceButton.label",defaultMessage:"Sync Source"})})}):null,Z=V||_.length&&P.length?null:(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:v.noResults,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.noResults.text",defaultMessage:"No results"})}),(0,je.jsxs)("div",{style:v.suggestionBox,children:[(0,fr.D)({marginRight:8,width:14,height:14}),(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Try different search or paste any {integration} URL",id:"collectionSettingsCreateExternalViewPicker.noResults.help",values:{integration:t.name}})]})]}),D=_.length&&P.length?(0,je.jsx)(je.Fragment,{children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:0,sections:[{key:"collections",items:P.map((e=>({key:e.url,render:t=>(0,je.jsx)(ae.Z,{renderTooltip:()=>(0,je.jsx)("span",{children:e.title}),placement:ae.Z.Placement.Left,textWrap:!0,render:o=>(0,je.jsx)(ye.Z,{...(0,os.Z)(o||{},t),title:e.title,icon:(0,je.jsx)("img",{style:{width:18},src:e.icon}),caption:e.parent.title})}),action:t=>{"stopPropagation"in t.event&&t.event.stopPropagation(),F(e.url)}}))),render:e=>(0,je.jsx)(Ce.Z,{...e,disableMobilePadding:!0})}]})}):null,K="pending"===M||"idle"===M||h;if(!p||T&&(T.status===cs.mQ.UNAUTHORIZED||T.status===cs.mQ.FORBIDDEN))return(0,je.jsx)(vs,{collectionContextStore:o,collectionSettingsStore:i,integration:t});const R="rejected"===M||"failed"===(null==j?void 0:j.type)||T,N=(0,je.jsx)(Ss,{onClick:()=>{l.H4({collectionSettingsStore:i,item:{type:"selectAccountForExternalSource",integration:t,onAccountSelect:e=>{l.H4({collectionSettingsStore:i,item:{type:"createSyncedViewSource",externalAuthentication:e}})}}})},integration:t,accountName:p.account_name});return(0,je.jsx)(Jo.ZP,{...e,footer:I||h?null:N,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Select from {integration}",id:"collectionSettingsCreateExternalViewPicker.title",values:{integration:t.name}}),header:!K&&"resolved"===M&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(no.ZP,{inputLeft:(0,je.jsx)(no.f_,{icon:ds.R}),onSubmit:()=>{V&&F()},style:v.settingsMenuSearchBox,focusInitial:!0,value:c,onChange:e=>{d(e.target.value)},placeholder:"Search source or paste a link..."}),V?null:B]}),children:(0,je.jsxs)("div",{style:v.settingsMenu,children:[R&&(0,je.jsx)("div",{style:v.errorMessage,children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.error.unknown",defaultMessage:"Something went wrong.",values:{integration:t.name}})}),K&&(h?(0,je.jsxs)("div",{style:v.syncingData,children:[(0,je.jsx)("span",{children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.settingUpSync",defaultMessage:"Setting up sync..."})}),(0,je.jsx)(bs.Z,{style:{alignSelf:"center"}})]}):(0,je.jsxs)("div",{style:v.syncingData,children:[(0,je.jsx)("span",{children:(0,je.jsx)(a.FormattedMessage,{id:"collectionSettingsCreateExternalViewPicker.loadingData",defaultMessage:"Loading available sources..."})}),(0,je.jsx)(bs.Z,{style:{alignSelf:"center"}})]})),!K&&"resolved"===M&&(0,je.jsxs)(je.Fragment,{children:[I,Z,D]})]})})}var ks=o(26263),Ps=o(45433),As=o(93108),Vs=o(38715),Fs=o(75081),Bs=o(26122);function Is(e){window.__c={n:"CollectionSettingsCreateTypedDB"};const t=(0,y.Fg)(),o=(0,g.O7)(),i=o.device,[r,s]=(0,n.useState)(Ps.br),[c,u]=(0,n.useState)(),p=(0,n.useMemo)((()=>Dt.default.createValue("")),[]),h=(0,n.useMemo)((()=>new ks.Z({name:"CollectionSettingsCreateTypedDB"})),[]),S=(0,m.VK)((()=>{const t=e.collectionContextStore.collectionStore();if(t)return t.clone(h).getIcon()}),[e.collectionContextStore,h]);(0,n.useEffect)((()=>{var t;void 0===c&&u(null===(t=e.collectionContextStore.collectionViewStore())||void 0===t?void 0:t.getType())}),[e.collectionContextStore,c]),(0,n.useEffect)((()=>{const e=o.defaultRecordCache.inMemoryRecordCache;return e.addCacheOverride(h),()=>{e.removeCacheOverride(h)}}),[o,h,e.collectionContextStore]);const f=(0,n.useCallback)((e=>{p.setState(e)}),[p]),x=(0,n.useCallback)(((t,n)=>{const{collectionContextStore:i}=e,r=i.collectionViewStore(),a=i.collectionViewBlockStore();r&&a&&l.nr({environment:o,baseViewType:c,selectedDBType:n,collectionName:p.state,collectionContextStore:i,collectionViewBlockStore:a,collectionViewStore:r,useTemporaryRecordCache:t,temporaryRecordCache:h})}),[e,c,o,p,h]);(0,n.useEffect)((()=>{x(!0,Ps.br)}),[x]);const v=(0,n.useCallback)((t=>{const{collectionContextStore:o}=e;s(t),x(!0,t),ea.Ip({collectionContextStore:o})}),[e,x]);const C=(0,n.useCallback)((t=>{var n;const i=null===(n=e.collectionContextStore.collectionStore())||void 0===n?void 0:n.getIconStore().clone(h);i&&d.createAndCommit({userAction:"SpacePermissionGroup.handleIconChange",environment:o,perform:e=>{sn.sO({store:i,value:t,transaction:e})}})}),[e.collectionContextStore,o,h]),b=(0,n.useCallback)((t=>{(0,ur.ZP)({event:t,context:ur.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:t}=e;an.showDialog({message:(0,je.jsx)("span",{children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Would you like to continue creating this database?",id:"collectionSettingsNewDatabase.confirmDialog.prompt"})}),showCancel:!1,keepFocus:!1,items:[{label:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Yes create {selectedType, select, untyped {an {type}} other {a {type}}} database",values:{selectedType:r,type:r===Ps.br?"empty":(0,Fs.Mn)(r)},id:"collectionSettingsNewDatabase.confirmDialog.affirmativeButton.label"}),color:"red",onAccept:()=>{x(!1,r),l.E3({collectionSettingsStore:t})}},{label:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Cancel",id:"collectionSettingsNewDatabase.confirmDialog.cancel.label"}),color:"blue",onAccept:()=>{}}]})}})}),[e,r,x]),w=(0,n.useCallback)((()=>{o.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(h);const{collectionContextStore:t,collectionSettingsStore:n}=e,i=t.collectionViewBlockStore(),r=t.collectionViewStore();void 0!==i&&void 0!==r&&(t.setContext({type:"collectionView",collectionViewBlockStore:i,collectionStore:void 0,collectionViewStore:r}),l.H4({collectionSettingsStore:n,item:{type:"createViewSource"}}))}),[o,e,h]);return(0,je.jsxs)(Jo.ZP,{...e,handleClose:b,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createTypedDBTab.title"}),footer:(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[(0,je.jsx)(en.Z,{icon:As.p,isGray:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"View an existing database",id:"database.viewSettings.createTypedDBTab.viewExistingDatabaseButton"}),onClick:w}),(0,je.jsx)(en.Z,{icon:Vs.N,isGray:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Import or sync from",id:"database.viewSettings.createTypedDB.importDatabaseButton"})})]}),children:[(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(Bs.Z,{initialValue:"",placeholder:(0,Fs.Mn)(r),inputStore:p,onBlur:f,onSubmit:f,iconButton:{icon:e=>(0,je.jsx)(ti.Z,{isEmptyPage:!0,disabled:!0,defaultIcon:(0,Ps.T)(r)({width:16,height:16,backfaceVisibility:void 0,marginRight:6}),icon:S,size:16}),onSubmit:C,includeEmojiTab:!0}})}),(0,je.jsxs)("div",{style:{...!i.isMobile&&{width:"100%",paddingLeft:8,paddingRight:8},...i.isMobile&&{background:t.contentBackground,width:"100%",paddingTop:12,paddingBottom:12}},children:[(0,je.jsx)("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"},children:Ps.Cr[Ps.TM].map((function(e){return(0,je.jsx)(Zs,{dbType:e,isCurrentType:r===e,onClick:()=>v(e)})}))}),(0,je.jsx)(jo.Z,{style:{display:"flex",margin:"14px",height:32},onClick:function(){const{collectionSettingsStore:t}=e;x(!1,r),l.E3({collectionSettingsStore:t})},children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Create database",id:"database.viewSettings.createTypedDB.createDatabase"})})]})]})}function Zs(e){window.__c={n:"CollectionSettingsTypedDBButton"};const{dbType:t,onClick:o,isCurrentType:n}=e,i=(0,y.Fg)();return(0,je.jsxs)(me.Z,{style:{display:"flex",width:"95%",height:45,flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${i.regularDividerColor}`,color:i.mediumTextColor,fill:i.mediumTextColor,...n&&{boxShadow:`0 0 0 2px ${i.blueColor}`,color:i.blueColor,fill:i.blueColor,fontWeight:500}},disabled:n,onClick:o,children:[(0,je.jsx)("div",{children:(0,Ps.T)(t)({...n&&{fill:i.blueColor,color:i.blueColor},width:17,height:17,marginBottom:4,marginTop:4,marginLeft:4})}),(0,je.jsxs)("div",{style:{position:"relative",width:"100%",marginLeft:12},children:[(0,je.jsx)("span",{style:{position:"absolute",fontSize:13,fontWeight:500},children:(0,Fs.Mn)(t)}),(0,je.jsx)("span",{style:{position:"absolute",top:15,fontSize:12,marginTop:1},children:(0,je.jsx)(a.FormattedMessage,{...Ps.LI[t].caption})})]})]})}var Ds=o(79362),Ks=o(23877),Rs=o(92165);const Ns=(0,Sn.I)("collectionDependenciesArrowRight",{viewBox:"0 0 16 16",svg:(0,je.jsx)("path",{transform:"translate(3,3)",d:"M1.34.302a.701.701 0 00-.383.095.708.708 0 00-.24.253 1.074 1.074 0 00-.109.322 3.26 3.26 0 00-.054.465c-.01.173-.014.36-.014.56 0 1.609.353 2.791 1.06 3.548.71.752 1.857 1.128 3.438 1.128h4.525l1.634-.089L9.16 8.423 7.643 9.968a.798.798 0 00-.164.239.785.785 0 00-.055.294c0 .205.068.376.205.513a.736.736 0 00.533.205c.196 0 .378-.082.547-.246l4.498-4.485a.78.78 0 00.246-.567.743.743 0 00-.246-.56L8.695.854A.76.76 0 008.162.63a.736.736 0 00-.533.205.696.696 0 00-.205.513c0 .104.018.202.055.294a.715.715 0 00.164.232L9.16 3.419l2.037 1.852-1.634-.102h-4.43c-.76 0-1.366-.11-1.818-.328a1.94 1.94 0 01-.963-1.04c-.196-.473-.294-1.09-.294-1.852 0-.191.002-.358.006-.499.01-.141.014-.278.014-.41a.721.721 0 00-.205-.533.721.721 0 00-.533-.205z"})});var Os=o(6637),Es=o(89036);const Ls=(0,Sn.I)("groupByHorizontal",{viewBox:"0 0 16 16",svg:(0,je.jsx)("path",{d:"M2.1416 14.4492H13.8516C15.3281 14.4492 16.0938 13.6904 16.0938 12.2344V3.9082C16.0938 2.45215 15.3281 1.69336 13.8516 1.69336H2.1416C0.665039 1.69336 -0.100586 2.44531 -0.100586 3.9082V12.2344C-0.100586 13.6904 0.665039 14.4492 2.1416 14.4492ZM2.22363 13.1094C1.58789 13.1094 1.23926 12.7812 1.23926 12.1182V4.02441C1.23926 3.36133 1.58789 3.02637 2.22363 3.02637H4.86914V13.1094H2.22363ZM6.18164 13.1094V3.02637H9.81152V13.1094H6.18164ZM13.7695 3.02637C14.3984 3.02637 14.7539 3.36133 14.7539 4.02441V12.1182C14.7539 12.7812 14.3984 13.1094 13.7695 13.1094H11.124V3.02637H13.7695Z"})}),Ws=(0,Sn.I)("groupByVertical",{viewBox:"0 0 16 16",svg:(0,je.jsx)("path",{d:"M0.952148 1.83008H15.041C15.3691 1.83008 15.5879 1.59082 15.5879 1.24219C15.5879 0.893555 15.3691 0.647461 15.041 0.647461H0.952148C0.624023 0.647461 0.405273 0.886719 0.405273 1.24219C0.405273 1.59082 0.624023 1.83008 0.952148 1.83008ZM1.875 7.44238H3.2832C4.26758 7.44238 4.75293 6.95703 4.75293 5.94531V4.58496C4.75293 3.57324 4.26758 3.09473 3.2832 3.09473H1.875C0.890625 3.09473 0.405273 3.57324 0.405273 4.58496V5.94531C0.405273 6.95703 0.890625 7.44238 1.875 7.44238ZM7.28906 7.44238H8.69727C9.68164 7.44238 10.167 6.95703 10.167 5.94531V4.58496C10.167 3.57324 9.68164 3.09473 8.69727 3.09473H7.28906C6.30469 3.09473 5.81934 3.57324 5.81934 4.58496V5.94531C5.81934 6.95703 6.30469 7.44238 7.28906 7.44238ZM12.71 7.44238H14.1182C15.1025 7.44238 15.5879 6.95703 15.5879 5.94531V4.58496C15.5879 3.57324 15.1025 3.09473 14.1182 3.09473H12.71C11.7188 3.09473 11.2402 3.57324 11.2402 4.58496V5.94531C11.2402 6.95703 11.7188 7.44238 12.71 7.44238ZM1.88184 6.31445C1.64258 6.31445 1.52637 6.19824 1.52637 5.94531V4.57812C1.52637 4.33887 1.64258 4.21582 1.88184 4.21582H3.26953C3.50879 4.21582 3.625 4.33887 3.625 4.57812V5.94531C3.625 6.19824 3.50879 6.31445 3.26953 6.31445H1.88184ZM7.30273 6.31445C7.05664 6.31445 6.94727 6.19824 6.94727 5.94531V4.57812C6.94727 4.33887 7.05664 4.21582 7.30273 4.21582H8.69043C8.92969 4.21582 9.0459 4.33887 9.0459 4.57812V5.94531C9.0459 6.19824 8.92969 6.31445 8.69043 6.31445H7.30273ZM12.7168 6.31445C12.4775 6.31445 12.3613 6.19824 12.3613 5.94531V4.57812C12.3613 4.33887 12.4775 4.21582 12.7168 4.21582H14.1045C14.3438 4.21582 14.46 4.33887 14.46 4.57812V5.94531C14.46 6.19824 14.3438 6.31445 14.1045 6.31445H12.7168ZM0.952148 9.82812H15.041C15.3691 9.82812 15.5879 9.58887 15.5879 9.24023C15.5879 8.8916 15.3691 8.64551 15.041 8.64551H0.952148C0.624023 8.64551 0.405273 8.88477 0.405273 9.24023C0.405273 9.5957 0.624023 9.82812 0.952148 9.82812ZM1.88184 15.4404H3.29004C4.27441 15.4404 4.75977 14.9619 4.75977 13.9434V12.583C4.75977 11.5713 4.27441 11.0928 3.29004 11.0928H1.88184C0.897461 11.0928 0.412109 11.5713 0.412109 12.583V13.9434C0.412109 14.9619 0.897461 15.4404 1.88184 15.4404ZM7.2959 15.4404H8.7041C9.68848 15.4404 10.1738 14.9619 10.1738 13.9434V12.583C10.1738 11.5713 9.68848 11.0928 8.7041 11.0928H7.2959C6.31152 11.0928 5.82617 11.5713 5.82617 12.583V13.9434C5.82617 14.9619 6.31152 15.4404 7.2959 15.4404ZM12.7168 15.4404H14.1182C15.1094 15.4404 15.5879 14.9619 15.5879 13.9434V12.583C15.5879 11.5713 15.1094 11.0928 14.1182 11.0928H12.7168C11.7256 11.0928 11.2471 11.5713 11.2471 12.583V13.9434C11.2471 14.9619 11.7256 15.4404 12.7168 15.4404ZM1.88867 14.3125C1.64941 14.3125 1.5332 14.1963 1.5332 13.9502V12.583C1.5332 12.3369 1.64941 12.2139 1.88867 12.2139H3.27637C3.51562 12.2139 3.63184 12.3369 3.63184 12.583V13.9502C3.63184 14.1963 3.51562 14.3125 3.27637 14.3125H1.88867ZM7.30957 14.3125C7.06348 14.3125 6.9541 14.1963 6.9541 13.9502V12.583C6.9541 12.3369 7.06348 12.2139 7.30957 12.2139H8.69727C8.93652 12.2139 9.05273 12.3369 9.05273 12.583V13.9502C9.05273 14.1963 8.93652 14.3125 8.69727 14.3125H7.30957ZM12.7236 14.3125C12.4844 14.3125 12.3682 14.1963 12.3682 13.9502V12.583C12.3682 12.3369 12.4844 12.2139 12.7236 12.2139H14.1113C14.3506 12.2139 14.4668 12.3369 14.4668 12.583V13.9502C14.4668 14.1963 14.3506 14.3125 14.1113 14.3125H12.7236Z"})}),Gs=(0,Sn.I)("layoutPadded",{viewBox:"0 0 24 24",svg:(0,je.jsx)("path",{d:"M3.94727 11.832H10.2295C11.3574 11.832 11.9248 11.2715 11.9248 10.1504V7.30664C11.9248 6.18555 11.3574 5.625 10.2295 5.625H3.94727C2.81934 5.625 2.25195 6.18555 2.25195 7.30664V10.1504C2.25195 11.2715 2.81934 11.832 3.94727 11.832ZM15.6572 17.5811H20.0459C21.1738 17.5811 21.7412 17.0273 21.7412 15.8994V8.33203C21.7412 7.21094 21.1738 6.65723 20.0459 6.65723H15.6572C14.5361 6.65723 13.9688 7.21094 13.9688 8.33203V15.8994C13.9688 17.0273 14.5361 17.5811 15.6572 17.5811ZM4.11133 10.5469C3.73535 10.5469 3.53711 10.3486 3.53711 9.95898V7.49805C3.53711 7.10156 3.73535 6.91016 4.11133 6.91016H10.0586C10.4414 6.91016 10.6396 7.10156 10.6396 7.49805V9.95898C10.6396 10.3486 10.4414 10.5469 10.0586 10.5469H4.11133ZM15.8213 16.3027C15.4521 16.3027 15.2471 16.1045 15.2471 15.7148V8.52344C15.2471 8.12695 15.4521 7.93555 15.8213 7.93555H19.875C20.2578 7.93555 20.4561 8.12695 20.4561 8.52344V15.7148C20.4561 16.1045 20.2578 16.3027 19.875 16.3027H15.8213ZM5.66309 18.4629H10.9951C12.1162 18.4629 12.6904 17.9092 12.6904 16.7812V14.8535C12.6904 13.7324 12.1162 13.1787 10.9951 13.1787H5.66309C4.53516 13.1787 3.96777 13.7324 3.96777 14.8535V16.7812C3.96777 17.9092 4.53516 18.4629 5.66309 18.4629ZM5.82715 17.1846C5.45117 17.1846 5.25293 16.9863 5.25293 16.5967V15.0449C5.25293 14.6553 5.45117 14.4639 5.82715 14.4639H10.8242C11.2002 14.4639 11.4053 14.6553 11.4053 15.0449V16.5967C11.4053 16.9863 11.2002 17.1846 10.8242 17.1846H5.82715Z"})});var Hs=o(27714);const zs=(0,Sn.I)("nest",{viewBox:"0 0 16 16",svg:(0,je.jsxs)("g",{children:[(0,je.jsx)("path",{d:"M5.59375 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.59375C5.23145 3.22461 4.94434 3.51172 4.94434 3.87402C4.94434 4.23633 5.22461 4.52344 5.59375 4.52344ZM8 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H8C7.6377 7.42188 7.35059 7.70898 7.35059 8.07129C7.35059 8.43359 7.63086 8.7207 8 8.7207ZM10 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H10C9.6377 11.6191 9.35059 11.9062 9.35059 12.2686C9.35059 12.6309 9.63086 12.918 10 12.918Z"}),(0,je.jsx)("path",{d:"M1.66386 4.7627L0.898238 3.46387C0.713668 3.14941 0.829878 2.80762 1.19218 2.80762H2.85332C3.22929 2.80762 3.33867 3.14258 3.14726 3.46387L2.36113 4.7627C2.21074 5.01562 1.82109 5.02246 1.66386 4.7627Z"}),(0,je.jsx)("path",{d:"M3.85358 8.94885L3.08795 7.65002C2.90338 7.33557 3.01275 6.99377 3.3819 6.99377H5.03619C5.41217 6.99377 5.52838 7.32874 5.33014 7.65002L4.55084 8.94885C4.40045 9.20178 4.0108 9.20862 3.85358 8.94885Z"}),(0,je.jsx)("path",{d:"M6.90723 12.6377L5.6084 13.4033C5.29395 13.5878 4.95215 13.4716 4.95215 13.1093V11.4482C4.95215 11.0722 5.28711 10.9628 5.6084 11.1543L6.90723 11.9404C7.16016 12.0908 7.16699 12.4804 6.90723 12.6377Z"})]})});var Us=o(84199),$s=o(87393);const qs=(0,Sn.I)("sortPadded",{viewBox:"0 0 24 24",svg:(0,je.jsx)("path",{d:"M7.50879 5.80273L4.06348 9.32324C3.92676 9.4668 3.83789 9.67188 3.83789 9.85645C3.83789 10.2803 4.13184 10.5674 4.54883 10.5674C4.75391 10.5674 4.91797 10.499 5.04785 10.3623L6.46289 8.89941L7.37891 7.83984L7.32422 9.30273V17.8477C7.32422 18.2715 7.625 18.5723 8.04199 18.5723C8.45898 18.5723 8.75977 18.2715 8.75977 17.8477V9.30273L8.70508 7.83984L9.62793 8.89941L11.0361 10.3623C11.166 10.499 11.3369 10.5674 11.5352 10.5674C11.9521 10.5674 12.2461 10.2803 12.2461 9.85645C12.2461 9.67188 12.1641 9.4668 12.0205 9.32324L8.58203 5.80273C8.28125 5.48828 7.80957 5.48145 7.50879 5.80273ZM16.4912 18.3398L19.9365 14.8057C20.0732 14.6689 20.1621 14.4639 20.1621 14.2793C20.1621 13.8555 19.8682 13.5684 19.4512 13.5684C19.2461 13.5684 19.082 13.6367 18.9453 13.7734L17.5371 15.2295L16.6211 16.2959L16.6758 14.833V6.28809C16.6758 5.87109 16.375 5.56348 15.958 5.56348C15.541 5.56348 15.2334 5.87109 15.2334 6.28809V14.833L15.2881 16.2959L14.3721 15.2295L12.9639 13.7734C12.8271 13.6367 12.6631 13.5684 12.4648 13.5684C12.0479 13.5684 11.7539 13.8555 11.7539 14.2793C11.7539 14.4639 11.8359 14.6689 11.9727 14.8057L15.418 18.3398C15.7188 18.6475 16.1904 18.6543 16.4912 18.3398Z"})});var Qs=o(37888),Ys=o(72711),Xs=o(40745),Js=o(13709);class el extends i.Z{constructor(){super(...arguments),this.handleFirstLoadLimitChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(d.createAndCommit({userAction:"CollectionSettingsFirstLoadLimit.handleFirstLoadLimitChange",environment:this.environment,perform:t=>{c.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),Ot.wd({environment:this.environment,collectionContextStore:t,action:"set_first_load_limit"}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state,o=e.isFullScreen.state,n=this.getCurrentViewType();if(!(t.collection_group_by||!o&&"calendar"!==n))return;const i=this.getCurrentFirstLoadLimit(),r=e.permissionScopes.state;return(0,je.jsx)(Js.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Load limit",id:"database.viewSettings.layoutTab.firstLoadLimitSetting"}),selectedKey:i,popupStyle:{minWidth:190},options:this.getFirstLoadLimitOptions(),onChange:this.handleFirstLoadLimitChange,disabled:!r.canConfigureBlock,icon:Xs.M})}getFirstLoadLimitOptions(){return la.jk.map((e=>({key:e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.viewSettings.layoutTab.limitPagesTitle"})})))}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getCurrentFirstLoadLimit(){const{collectionContextStore:e}=this.props,t=e.normalizedFormatStore.state;return(0,la.rx)(t.inline_collection_first_load_limit,Boolean(t.collection_group_by))}}el.displayName="CollectionSettingsFirstLoadLimit";const tl=(0,a.injectIntl)(el);var ol=o(35011),nl=o(14714),il=o(49865),rl=o(81849),al=o(18514),sl=o(26055),ll=o(75498),cl=o(21269),dl=o(79131),ul=o(5145),pl=o(28992),gl=o(97820);class ml extends i.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:Dt.default.createClass(void 0),groupsLimit:Dt.default.createClass(rl.XD)},this.handleHideEmptyGroupsClick=()=>{const{groupByKey:e,collectionContextStore:t,groupsFormatKey:o}=this.props,n=this.getGroupBy(),i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:r}=i,a=t.collectionViewStore();if(!n||!a)return;const s=!n.hideEmptyGroups;d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideEmptyGroupsClick",environment:this.environment,perform:i=>{if(s){const e=r.map((e=>!1===e.hidden?{...e,hidden:void 0}:e));il.A6({collectionContextStore:t,newGroups:e,groupsFormatKey:o,transaction:i})}c.FH({stores:[a],update:{[e]:{...n,hideEmptyGroups:s}},transaction:i})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"toggle_hide_empty_groups"})},this.handleHideAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:n}=o,i=n.map((e=>({...e,hidden:!0})));this.stores.groupsLimit.setState(rl.XD),d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleHideAllClick",environment:this.environment,perform:o=>{il.A6({collectionContextStore:e,newGroups:i,groupsFormatKey:t,transaction:o})}}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_hide_all"})},this.handleShowAllClick=()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=this.groupsDisplayStateStore.state;if(!o)return;const{currentGroups:n}=o,i=n.map((e=>({...e,hidden:!1})));this.stores.groupsLimit.setState(rl.XD),d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleShowAllClick",environment:this.environment,perform:o=>{il.A6({collectionContextStore:e,newGroups:i,groupsFormatKey:t,transaction:o})}}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_groups_show_all"})},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o,groupsFormatKey:n}=this.props,i=this.groupsDisplayStateStore.state;if(!i)return;const{currentGroups:r}=i,a=r.filter((t=>e.indexOf((0,nl.mD)(t))<0)),l=r.filter((t=>e.indexOf((0,nl.mD)(t))>=0)),c=He.MR(l,(t=>{const o=e.indexOf((0,nl.mD)(t));return o>=0?o:1/0})),u=t?[...a,...c]:[...c,...a];d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleGroupReorder",environment:this.environment,perform:e=>{il.A6({collectionContextStore:o,newGroups:u,groupsFormatKey:n,transaction:e})}}),s.wds(this.environment,{view_type:this.getCurrentViewType(),action:t?"reorder_hidden_groups":"reorder_groups"})},this.handleToggleGroupVisibility=e=>{const{collectionContextStore:t,groupsFormatKey:o}=this.props,n=this.groupsDisplayStateStore.state;if(!n)return;const{currentGroups:i}=n,r=i.map((t=>(0,nl.ZH)(t,e)?{...e,hidden:!(0,nl.eF)(e)}:t));d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleToggleGroupVisibility",environment:this.environment,perform:e=>{il.A6({collectionContextStore:t,newGroups:r,groupsFormatKey:o,transaction:e})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"toggle_group_visibility"})},this.handleSortTypeChange=e=>{const{collectionContextStore:t,groupByKey:o}=this.props,n=this.getGroupBy(),i=t.collectionViewStore();if(n&&i){if("formula"===n.type){const t={...n,groupBy:{...n.groupBy,sort:{type:e}}};d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:e=>{c.FH({stores:[i],update:{[o]:t},transaction:e})}})}else d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleSortTypeChange",environment:this.environment,perform:t=>{c.FH({stores:[i],update:{[o]:{...n,sort:{type:e}}},transaction:t})}});Ot.wd({environment:this.environment,collectionContextStore:t,action:"update_group_sort"})}},this.handleTextGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=this.getGroupBy(),r=t.collectionViewStore();if(!i||!r)return;const a=Cl(i);if(a){if((0,nl.aB)(i))d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:t=>{c.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}});else if("formula"===i.type){const t={...He.CE(a,"property"),groupBy:e},s={...i,groupBy:t};d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleTextGroupByTypeChange",environment:this.environment,perform:e=>{c.FH({stores:[r],update:{[o]:s,[n]:void 0},transaction:e})}})}Ot.wd({environment:this.environment,collectionContextStore:t,action:"update_text_group_by"})}},this.handleDateGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=this.getGroupBy(),r=t.collectionViewStore();if(!i||!r)return;const a=vl(i);if(a){if((0,nl.ib)(i))d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:t=>{c.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}});else if("formula"===i.type){const t={...He.CE(a,"property"),type:"date",groupBy:e},s={...i,groupBy:t};d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleDateGroupByTypeChange",environment:this.environment,perform:e=>{c.FH({stores:[r],update:{[o]:s,[n]:void 0},transaction:e})}})}Ot.wd({environment:this.environment,collectionContextStore:t,action:"update_date_group_by"})}},this.handleStatusGroupByTypeChange=e=>{const{collectionContextStore:t,groupByKey:o,groupsFormatKey:n}=this.props,i=this.getGroupBy(),r=t.collectionViewStore();i&&r&&"status"===(null==i?void 0:i.type)&&(d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleStatusGroupByTypeChange",environment:this.environment,perform:t=>{c.FH({stores:[r],update:{[o]:{...i,groupBy:e},[n]:void 0},transaction:t})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"update_status_group_by"}))},this.handleRemoveClick=()=>{const{collectionContextStore:e,groupByKey:t,groupsFormatKey:o}=this.props,n=e.collectionViewStore();n&&(d.createAndCommit({userAction:"CollectionSettingsViewGroup.handleRemoveClick",environment:this.environment,perform:e=>{c.FH({stores:[n],update:{[t]:void 0,[o]:void 0},transaction:e})}}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_remove_grouping"}))},this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsFormatKey:t}=this.props,o=e.normalizedFormatStore.state,n=e.normalizedSchemaStore.state,i=e.remoteRequestStore.state,r=this.getGroupBy();if(r)return(0,rl.ej)({groupBy:r,schema:n,format:o,filter:null==i?void 0:i.loader.filter,groupsFormatKey:t,limit:this.stores.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=this.getGroupBy();if(o)return(0,nl.Qq)({schema:t,groupBy:o})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupsFormatKey:t,collectionContextStore:o}=this.props,n=o.normalizedFormatStore.state,i=o.normalizedSchemaStore.state,r=o.collectionViewBlockStore(),a=this.getGroupBy(),s=this.stores.reducerResultStore.state;if(!a||!r||!s)return;const l=this.stores.groupsLimit.state,c=this.schemaGroupsStore.state,d=s.results,u=s?s.total:0,p=(0,rl.Cz)({groupBy:a,schema:i,formatGroups:n[t]||[],schemaGroups:c,reducerResults:d,getRecordModel:r.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),g=p.filter((e=>!(0,nl.eF)(e))).slice(0,l),m=p.filter((e=>(0,nl.eF)(e)));return{currentGroups:[...g,...m],visibleGroups:g,hiddenGroups:m,total:u}}),!0)}renderComponent(){const{collectionContextStore:e,groupByKey:t}=this.props,o=this.getGroupBy(),n=e.normalizedSchemaStore.state;return(0,je.jsxs)(Jo.ZP,{...this.props,title:this.renderTitle(),children:[(0,je.jsxs)(Ce.Z,{children:[this.renderPropertyMenuButton(o),o&&fl({groupBy:o,schema:n})&&this.renderTypeMenuButton(o),o&&this.renderSortMenuButton(o),o&&this.renderAutoHideButton(o),o&&"board_columns_by"===t&&this.renderColorColumnsOption()]}),o&&this.renderGroupSortListReducer(),(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[o&&this.canRemoveGrouping()&&(0,je.jsx)(en.Z,{isGray:!0,icon:pe.y,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Remove grouping",id:"database.viewSettings.groupTab.removeButton.title"}),onClick:this.handleRemoveClick,isRed:!0}),(0,je.jsx)(cl.Z,{href:(0,al.UY)("guides.databaseGroup"),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Learn about grouping",id:"database.viewSettings.groupTab.learnMoreButton.title"}),analyticsFrom:"view_settings_group"})]})]})}renderTitle(){const{collectionSettingsStore:e}=this.props,t=(0,gr.n)(e);if(t&&"group"===t.type)return"collection_group_by"===t.groupByKey&&"board"===this.getCurrentViewType()?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.groupTab.subGroup.title"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.groupTab.group.title"})}renderPropertyMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:i}=this.props,r=t.normalizedSchemaStore.state,a=e?r[e.property]:void 0;return(0,je.jsx)(en.Z,{title:hl(n,this.getCurrentViewType()),showChevron:!0,right:yl(a),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:t,action:"click_group_by_property",original_view_type:void 0,property_type:null==a?void 0:a.type}),l.H4({collectionSettingsStore:o,item:{type:"groupByProperty",groupByKey:n,groupsFormatKey:i}})},disabled:!this.canConfigureBlock()})}renderTypeMenuButton(e){const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:i}=this.props,r=t.normalizedSchemaStore.state,a=this.canConfigureBlock(),s="formula"===e.type?{...e.groupBy,property:e.property}:e;if((0,nl.ib)(s))return(0,je.jsx)(Js.Z,{title:xl({groupBy:s,schema:r}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:nl.z8.map((e=>({key:e,title:Ml(e)}))),onChange:this.handleDateGroupByTypeChange,disabled:!a});if((0,nl.aB)(s))return(0,je.jsx)(Js.Z,{title:xl({groupBy:s,schema:r}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:nl.Kp.map((e=>({key:e,title:_l(e)}))),onChange:this.handleTextGroupByTypeChange,disabled:!a});if("number"===s.type)return(0,je.jsx)(en.Z,{title:xl({groupBy:s,schema:r}),showChevron:!0,right:wl({groupBy:s,schema:r}),onClick:()=>{l.H4({collectionSettingsStore:o,item:{type:"groupByNumber",groupByKey:n,groupsFormatKey:i}})},disabled:!a});if("status"===s.type){const e="collectionTypedView"===t.contextType?["group"]:nl.vu;return(0,je.jsx)(Js.Z,{title:xl({groupBy:s,schema:r}),popupStyle:{minWidth:190},selectedKey:s.groupBy,options:e.map((e=>({key:e,title:jl(e)}))),onChange:this.handleStatusGroupByTypeChange,disabled:!a})}}renderSortMenuButton(e){const t=(0,nl.YG)(e,!br.default.checkGate("collection_properties_select_auto_sort_options"));if(t.length<=1)return;const o=(0,nl.mu)(e);return(0,je.jsx)(Js.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.groupTab.sort"}),popupStyle:{minWidth:190},selectedKey:o.type,options:t.map((t=>({key:t,title:Sl(e,t)}))),onChange:this.handleSortTypeChange,disabled:!this.canConfigureBlock()})}renderAutoHideButton(e){return(0,je.jsx)(ta.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Hide empty groups",id:"database.viewSettings.groupTab.hideEmptyGroups"}),on:Boolean(e.hideEmptyGroups),focused:!1,onClick:this.handleHideEmptyGroupsClick,disabled:!this.canConfigureBlock(),textWrapperStyle:{opacity:1}})}renderColorColumnsOption(){return(0,je.jsx)(ta.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Color columns",id:"database.viewSettings.groupTab.colorColumns"}),on:!this.getDisableBoardColorColumns(),focused:!1,onClick:()=>{l.iN({environment:this.environment,collectionContextStore:this.props.collectionContextStore})},disabled:!this.canConfigureBlock(),textWrapperStyle:{opacity:1}})}renderGroupSortListReducer(){const{groupsFormatKey:e}=this.props,t=this.reducerStore.state,o=this.groupsDisplayStateStore.state;return t?(0,je.jsx)(ll.Z,{id:`group_menu_${e}`,reducer:t,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderGroupSortListSections(o)}):this.renderGroupSortListSections(o)}renderGroupSortListSections(e){const t=this.getGroupBy();if(!t)return;if(!e)return(0,je.jsx)(Ce.Z,{topBorder:!0,disableMobileBorders:!0,noTextOverflow:!0,children:(0,je.jsx)("div",{style:{marginTop:6,display:"flex",alignItems:"center",flexDirection:"column"},children:(0,je.jsx)(bs.Z,{})})});const o="manual"===(0,nl.mu)(t).type&&!this.environment.device.isMobile&&this.canConfigureBlock(),n=this.stores.groupsLimit.state,{total:i,hiddenGroups:r,visibleGroups:s}=e,l=Math.min(rl.kW,i-r.length-s.length),c=l>0?(0,je.jsx)(ye.Z,{disabled:!1,focused:!1,style:{color:this.theme.mediumTextColor},icon:(0,ue.o)({width:14,height:14}),title:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.loadMoreButton.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:l}}),onClick:()=>{this.props.collectionContextStore.isLoading.state||this.props.collectionContextStore.loadingDetails.setState({type:"load_groups_menu"}),this.stores.groupsLimit.setState(n+rl.kW)}}):void 0;return(0,je.jsxs)(je.Fragment,{children:[e.visibleGroups.length>0&&(0,je.jsxs)(Ce.Z,{topBorder:!0,noTextOverflow:!0,isTitleUppercase:!1,title:(0,je.jsx)("span",{style:{alignSelf:"center"},children:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.visibleGroups",defaultMessage:"Visible groups"})}),right:(0,je.jsx)(zt.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleHideAllClick,disabled:!this.canConfigureBlock(),children:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.hideAllGroups",defaultMessage:"Hide all"})}),children:[this.renderGroupSortList({displayState:e,groups:e.visibleGroups,canReorder:o,isHidden:!1}),c]}),e.hiddenGroups.length>0&&(0,je.jsx)(Ce.Z,{topBorder:!1,noTextOverflow:!0,isTitleUppercase:!1,title:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.hiddenGroups",defaultMessage:"Hidden groups"}),right:(0,je.jsx)(zt.Z,{isSmall:!0,shouldShrink:!0,isBlue:!0,style:{fontSize:12,height:void 0,paddingTop:2,paddingBottom:2},onClick:this.handleShowAllClick,disabled:!this.canConfigureBlock(),children:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.showAllGroups",defaultMessage:"Show all"})}),children:this.renderGroupSortList({displayState:e,groups:e.hiddenGroups,canReorder:o,isHidden:!0})})]})}renderGroupSortList(e){const{displayState:t,groups:o,canReorder:i,isHidden:r}=e;return i?(0,je.jsx)(dl.ZP,{direction:"vertical",keys:o.map((e=>(0,nl.mD)(e))),renderKey:(e,n)=>{const r=o[n];return this.renderGroupSortListItem({displayState:t,groupFormat:r,canReorder:i})},onDrop:e=>{this.handleGroupReorder(e,r)},disabled:!this.canConfigureBlock()}):o.map((e=>(0,je.jsx)(n.Fragment,{children:this.renderGroupSortListItem({displayState:t,groupFormat:e,canReorder:i})},(0,nl.mD)(e))))}renderGroupSortListItem(e){const{collectionContextStore:t}=this.props,{displayState:o,groupFormat:n,canReorder:i}=e,r=t.normalizedSchemaStore.state,a=(0,nl.eF)(n),s=this.getGroupBy();if(s)return(0,je.jsx)(pl.Z,{disabled:!this.canConfigureBlock(),title:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[i&&(0,je.jsx)(ul.ZP,{iconSize:12,style:{marginRight:3}}),(0,je.jsx)(sl.Z,{groupBy:s,groupFormat:n,currentGroups:o.currentGroups,schema:r,disabled:!0,isHiddenGroup:!1,style:{padding:0},collectionContextStore:t})]}),right:(0,je.jsx)(Se.Z,{icon:a?Sr.B:hr.c,iconStyle:{width:16,height:16},isDarkIconColor:!a,onClick:()=>{this.handleToggleGroupVisibility(n)},disabled:!this.canConfigureBlock()}),textWrapperStyle:{opacity:1}})}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}canRemoveGrouping(){return this.canConfigureBlock()&&(0,rl._1)({viewType:this.getCurrentViewType(),groupByKey:this.props.groupByKey})}canConfigureBlock(){const{collectionContextStore:e}=this.props;return e.permissionScopes.state.canConfigureBlock}getDisableBoardColorColumns(){return(0,rl.h6)(this.environment,this.props.collectionContextStore)}}function yl(e){return e?(0,je.jsx)(gl.Z,{propertySchema:e,showIcon:!1}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.groupTab.noGroupingSetMessage"})}function hl(e,t){return"collection_group_by"===e&&"board"===t?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sub-group by",id:"database.viewSettings.groupTab.subGroupProperty"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Group by",id:"database.viewSettings.groupTab.groupProperty"})}function Sl(e,t){return"manual"===t?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.groupTab.sortType.manual"}):"ascending"===t?(0,nl.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Oldest first",id:"database.viewSettings.groupTab.sortType.chronological"}):(0,nl.aB)(e)||"relation"===e.type||"select"===e.type||"multi_select"===e.type||"formula"===e.type&&"text"===e.groupBy.type?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.groupTab.sortType.alphabetical"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Ascending",id:"database.viewSettings.groupTab.sortType.ascending"}):"descending"===t?(0,nl.ib)(e)||"formula"===e.type&&"date"===e.groupBy.type?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Newest first",id:"database.viewSettings.groupTab.sortType.reverseChronological"}):(0,nl.aB)(e)||"relation"===e.type||"select"===e.type||"multi_select"===e.type||"formula"===e.type&&"text"===e.groupBy.type?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.groupTab.sortType.reverseAlphabetical"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Descending",id:"database.viewSettings.groupTab.sortType.descending"}):void(0,oe.t1)(t)}function fl(e){const{groupBy:t,schema:o}=e,n=o[t.property];if(!n||!(0,nl.LG)(n))return;let i;if("formula"===n.type){const e=(0,ol.mm)(n);if("unknown"===e||"array"===e)return;i="block"===e?"relation":e}else i=n.type;return(0,nl.A1)(i)||(0,nl.HB)(i)||"number"===i||"status"===i?i:void 0}function xl(e){const t=fl(e);if(t)return(0,nl.A1)(t)?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Date by",id:"database.viewSettings.groupByTypeTab.dateBy"}):(0,nl.HB)(t)?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Text by",id:"database.viewSettings.groupByTypeTab.textBy"}):"number"===t?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Number by",id:"database.viewSettings.groupByTypeTab.numberBy"}):"status"===t?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Status by",id:"database.viewSettings.groupByTypeTab.statusBy"}):void 0}function vl(e){return(0,nl.ib)(e)?e:"formula"===e.type&&"date"===e.groupBy.type?e.groupBy:void 0}function Cl(e){return(0,nl.aB)(e)?e:"formula"===e.type&&"text"===e.groupBy.type?e.groupBy:void 0}function bl(e){return"number"===e.type?e:"formula"===e.type&&"number"===e.groupBy.type?{...e.groupBy,property:e.property}:void 0}function wl(e){const{groupBy:t}=e,o=fl(e);if(o)if((0,nl.A1)(o)){const e=vl(t);if(e)return Ml(e.groupBy)}else if((0,nl.HB)(o)){const e=Cl(t);if(e)return _l(e.groupBy)}else if("number"===o){const e=bl(t);if(e)return(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.groupMenu.numberGroupBy.range",values:{start:e.start,end:e.end}})}}function jl(e){return"group"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Group",id:"database.groupMenu.statusGroupBy.group"}):"option"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Option",id:"database.groupMenu.statusGroupBy.option"}):void(0,oe.t1)(e)}function Ml(e){return"relative"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Relative",id:"database.groupMenu.dateGroupBy.relative"}):"day"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Day",id:"database.groupMenu.dateGroupBy.day"}):"week"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Week",id:"database.groupMenu.dateGroupBy.week"}):"month"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Month",id:"database.groupMenu.dateGroupBy.month"}):"year"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Year",id:"database.groupMenu.dateGroupBy.year"}):void(0,oe.t1)(e)}function _l(e){return"exact"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Exact",id:"database.groupMenu.textGroupBy.exact"}):"alphabet_prefix"===e?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.groupMenu.textGroupBy.alphabetical"}):void(0,oe.t1)(e)}ml.displayName="CollectionSettingsViewGroup";const Tl=(0,a.injectIntl)(ml);function kl(e){window.__c={n:"ContentOnlyEditorEducationPill"};const{style:t}=e,o=(0,y.Fg)(),n=(0,g.MO)(),i=(0,je.jsx)("div",{style:{marginTop:1},children:(0,Vt.b)({width:14,marginRight:8,height:void 0})}),r=(0,je.jsx)(_r.Z,{style:{color:o.regularTextColor,lineHeight:ne.Z.lineHeight.UISmall.desktop},isSmall:!0,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"You're a content editor",id:"database.viewSettings.mainTab.contentOnlyEditorPill.title"})});return(0,je.jsx)(Mr,{icon:i,title:r,style:n?{backgroundColor:o.sidebarBackground,boxShadow:o.plainButtonBoxShadow,margin:void 0,borderRadius:void 0,...t}:{background:"rgba(196, 196, 196, 0.13)",margin:"8px 14px",...t},showCloseButton:!1,children:(0,je.jsx)(_r.Z,{style:{marginLeft:22},isSmall:!0,isMultiline:!0,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Content editors can edit pages, but cannot change view and database settings.",id:"database.viewSettings.mainTab.contentOnlyEditorPill.subtitle"})})})}var Pl=o(74420),Al=o(76798),Vl=o(32662);const Fl=(0,a.defineMessages)({viewNamePlaceholderMessage:{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNamePlaceholder.title"}});class Bl extends i.Z{constructor(){super(...arguments),this.handleViewNameSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(o.getName()!==e&&d.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewNameSubmit",environment:this.environment,perform:t=>{ea.iG({collectionViewStore:o,update:{name:e},transaction:t})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"rename",original_view_type:o.getType()}))},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(d.createAndCommit({userAction:"CollectionSettingsViewMain.handleViewIconSubmit",environment:this.environment,perform:t=>{ea.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))},this.handleDuplicateClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t,intl:o}=this.props,n=e.collectionViewStore();n&&(l.zt({environment:this.environment,collectionContextStore:e,collectionViewStore:n,collectionSettingsStore:t,intl:o}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_duplicate",original_view_type:n.getType()}))},this.handleCopyLinkClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();t&&(l.Ol({environment:this.environment,collectionContextStore:e,collectionViewStore:t}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_copy_link",original_view_type:t.getType()}))},this.handleDeleteClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();o&&(l.TT({environment:this.environment,collectionContextStore:e,collectionViewStore:o,collectionSettingsStore:t,from:"view_settings"}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_delete",original_view_type:o.getType()}))},this.handleToggleLockClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();t&&(Ys.bo({environment:this.environment,store:t,lock:!t.isLocked()}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_toggle_lock"}))},this.shouldRenderDatabaseTypeStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore(),n=e.collectionViewStore();if(!t||!o||!n)return!1;if(t.isSyncedCollection())return!1;return void 0!==o.getCollectionViewSourceCollectionStore()})),this.shouldRenderSourceStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore(),n=e.collectionViewStore();if(!t||!o||!n)return!1;if(t.isSyncedCollection())return!0;return void 0===o.getCollectionViewSourceCollectionStore()}))}renderComponent(){const{device:e}=this.environment,{collectionContextStore:t,selectViewNameInitial:o}=this.props,n=t.collectionViewStore(),i=t.collectionViewBlockStore();if(!n||!i)return;if(!n.isDefined())return;const r=t.permissionScopes.state,s=(0,Ya.rm)()&&this.renderType(),l=n.getFormat().collection_view_icon,c=n.getType(),d=n.getAppConfigUri(),u=!(0,oe.$K)(d)||!(0,Ya.xB)(d),p=(0,je.jsx)(Ce.Z,{title:e.isMobile&&(0,je.jsx)(a.FormattedMessage,{defaultMessage:"View name",id:"database.viewSettings.mainTab.viewNameSection.title"}),children:(0,je.jsx)(Bs.Z,{initialValue:n.getName()||"",placeholder:Ne.default.formatMessage(Fl.viewNamePlaceholderMessage),onBlur:this.handleViewNameSubmit,onSubmit:this.handleViewNameSubmit,focusInitial:o,selectAll:o,disabled:!r.canConfigureBlock||!u,iconButton:{icon:e=>(0,je.jsx)(Jn.F,{color:"gray",viewIcon:l,viewType:c,style:{marginRight:6}}),iconStyle:{fill:Ds.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit}})});return"page"===n.getType()?(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"}),children:p}):(0,je.jsxs)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"View options",id:"database.viewSettings.mainTab.title"}),children:[this.renderContentOnlyEditorEducationPill(),p,e.isMobile?(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[this.renderSource(),this.renderLayout(),this.renderProperties(),this.renderFilter(),this.renderSort(),this.renderGroup(),this.renderSubGroup(),this.renderRelationFeatures(),(0,je.jsx)(tl,{collectionContextStore:t}),this.renderAutomationAction()]}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(Ce.Z,{children:[s,!s&&this.renderSource(),!s&&this.renderLayout()]}),(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[s&&this.renderSource(),s&&this.renderLayout(),this.renderProperties(),this.renderFilter(),this.renderSort(),this.renderGroup(),this.renderSubGroup(),this.renderRelationFeatures(),(0,je.jsx)(tl,{collectionContextStore:t}),this.renderAutomationAction()]})]}),(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[this.renderLockAction(),this.renderCopyLinkAction(),this.renderDuplicateAction(),this.renderDeleteAction()]})]})}renderContentOnlyEditorEducationPill(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(t&&"content_only_editor"===t.getRole())return(0,je.jsx)(kl,{})}renderLockAction(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore();if(!t)return;const o=t.getCollectionViewSourceCollectionStore(),n=t.isLocked();if(!(o?o.canEditCollection():t.canEditCollection()))return;const i=null==t?void 0:t.isCollectionViewPageWithContent();return(0,je.jsx)(en.Z,{icon:n?Qs.U:Vt.b,title:this.getLockUnlockTitle(o,i,n),onClick:this.handleToggleLockClick})}getLockUnlockTitle(e,t,o){return t?o?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Unlock wiki",id:"action.unlockWikiName.name"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Lock wiki",id:"action.lockWikiName.name"}):e?o?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Unlock database",id:"database.viewSettings.mainTab.unlockDatabase.title"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Lock database",id:"database.viewSettings.mainTab.lockDatabase.title"}):o?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Unlock views",id:"database.viewSettings.mainTab.unlockViews.title"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Lock views",id:"database.viewSettings.mainTab.lockViews.title"})}renderCopyLinkAction(){return(0,je.jsx)(en.Z,{icon:Hs.N,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.mainTab.copyLinkButton.title"}),onClick:this.handleCopyLinkClick})}renderDuplicateAction(){const{collectionContextStore:e}=this.props;if(e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType)return(0,je.jsx)(en.Z,{icon:vn.a,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Duplicate view",id:"database.viewSettings.mainTab.duplicateButton.title"}),onClick:this.handleDuplicateClick})}renderGroup(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=this.getCurrentViewType(),n="board"===o?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},i=e.normalizedSchemaStore.state,r=e.normalizedFormatStore.state[n.groupByKey],s=e.permissionScopes.state;return"calendar"!==o&&(0,je.jsx)(en.Z,{icon:"board"===o?Ls:Ws,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Group",id:"database.viewSettings.mainTab.groupButton.title"}),showChevron:!0,right:yl(r?i[r.property]:void 0),onClick:()=>{var a;Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_group",original_view_type:o,property_type:r?null===(a=i[r.property])||void 0===a?void 0:a.type:void 0}),e.isLoading.state||e.loadingDetails.setState({type:"load_groups_menu"}),l.H4({collectionSettingsStore:t,item:r?{type:"group",...n}:{type:"groupByProperty",...n}})},disabled:!r&&!s.canConfigureBlock})}renderSubGroup(){const e=this.getCurrentViewType(),{collectionContextStore:t,collectionSettingsStore:o}=this.props,n=t.normalizedSchemaStore.state,i=t.normalizedFormatStore.state.collection_group_by,r={groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},s=t.permissionScopes.state;return"board"===e&&(0,je.jsx)(en.Z,{icon:Ws,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sub-group",id:"database.viewSettings.mainTab.subGroupButton.title"}),showChevron:!0,right:yl(i?n[i.property]:void 0),onClick:()=>{var a;Ot.wd({environment:this.environment,collectionContextStore:t,action:"click_subgroup",original_view_type:e,property_type:i?null===(a=n[i.property])||void 0===a?void 0:a.type:void 0}),t.isLoading.state||t.loadingDetails.setState({type:"load_groups_menu"}),l.H4({collectionSettingsStore:o,item:i?{type:"group",...r}:{type:"groupByProperty",...r}})},disabled:!i&&!s.canConfigureBlock})}renderRelationFeatures(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if((null==t||!t.isSyncedCollection())&&"collectionTypedView"!==e.contextType)return(0,je.jsxs)(n.Fragment,{children:[this.renderSubitem(),this.renderArrowsBy()]})}renderSubitem(){return br.default.checkGate("dependency_date_shifting_by_space")?this.renderSubitemV2():this.renderSubitemV1()}renderSubitemV1(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedSchemaStore.state,n=e.currentSubitemFormatStore.state,i=n?o[n.property]:void 0,r=e.permissionScopes.state,s=e.databaseType;return(0,je.jsx)(en.Z,{icon:zs,title:(0,je.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[(0,je.jsx)(a.FormattedMessage,{...(0,vr.Gt)({feature:"subitem",databaseType:s})}),(0,je.jsx)(Vl.Z,{size:2})]}),showChevron:!0,right:(0,je.jsx)("span",{style:{...ne.Z.textOverflowStyle},children:(null==i?void 0:i.name)??(0,je.jsx)(a.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.subitemTab.none"})}),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_subitem"}),l.H4({collectionSettingsStore:t,item:{type:"subitem"}})},disabled:!n&&!r.canConfigureBlock})}renderSubitemV2(){const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=t.currentSubitemFormatStore.state,n=t.databaseType,i=xa({feature:"subitem",collectionContextStore:t});return(0,je.jsx)(en.Z,{icon:zs,title:(0,je.jsx)(a.FormattedMessage,{...(0,vr.Gt)({feature:"subitem",databaseType:n})}),showChevron:!0,right:this.getLabelForRelationFeatureItem(i),onClick:()=>{l.H4({collectionSettingsStore:e,item:{type:"subitemV2"}})},disabled:!this.isRelationFeatureEnabled(o)})}getLabelForRelationFeatureItem(e){let t;return t=e?e.supportedInView&&!e.enabledOnView?vr.dH.relationFeatureHiddenMessage:vr.dH.relationFeatureOnMessage:vr.dH.relationFeatureOffMessage,Ne.default.formatMessage(t)}renderArrowsBy(){return br.default.checkGate("dependency_date_shifting_by_space")?this.renderArrowsByV2():Ba({feature:"timeline_arrows_by",viewType:this.getCurrentViewType()})?this.renderArrowsByV1():void 0}renderArrowsByV1(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.normalizedSchemaStore.state,n=e.currentArrowsByFormatStore.state,i=n?o[n]:void 0,r=e.permissionScopes.state;return(0,je.jsx)(en.Z,{icon:Rs.Z,title:(0,je.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Dependencies",id:"database.viewSettings.mainTab.dependencies.title"}),(0,je.jsx)(Vl.Z,{size:2})]}),showChevron:!0,right:(0,je.jsx)("span",{style:{...ne.Z.textOverflowStyle},children:(null==i?void 0:i.name)??(0,je.jsx)(a.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.arrowsByTab.none"})}),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_timeline_arrows_by"}),l.H4({collectionSettingsStore:t,item:{type:"arrowsBy"}})},disabled:!n&&!r.canConfigureBlock})}renderArrowsByV2(){const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=t.currentArrowsByFormatStore.state,n=t.databaseType,i=xa({feature:"timeline_arrows_by",collectionContextStore:t});return(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{...(0,vr.Gt)({feature:"timeline_arrows_by",databaseType:n})}),showChevron:!0,icon:Ns,right:this.getLabelForRelationFeatureItem(i),onClick:()=>{l.H4({collectionSettingsStore:e,item:{type:"dependencies"}})},disabled:!this.isRelationFeatureEnabled(o)})}isRelationFeatureEnabled(e){const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,n=(0,oe.$K)(e),i=o.canConfigureBlock;return n||i}renderAutomationAction(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props;if(!(0,Re.cB)(e))return;const o=this.props.collectionContextStore.aliveAutomationCount.state;return(0,je.jsx)(en.Z,{icon:fn,onClick:()=>{o>0?l.H4({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}):(l.H4({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}),l.H4({collectionSettingsStore:t,item:{type:"automationCreateSettings"}}))},right:o>0?o:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.mainTab.automations.none",defaultMessage:"None"}),showChevron:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Automations",id:"database.viewSettings.mainTab.automations.title"})})}renderDeleteAction(){const{collectionContextStore:e}=this.props;if(!e.collectionViewBlockStore())return;return e.permissionScopes.state.canConfigureBlock&&"collectionTypedView"!==e.contextType?(0,je.jsx)(en.Z,{icon:pe.y,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Delete view",id:"database.viewSettings.mainTab.deleteButton.title"}),isRed:!0,onClick:this.handleDeleteClick}):void 0}renderSource(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore(),n=e.collectionViewBlockStore();if(!o||!n)return;if(!this.shouldRenderSourceStore.state)return;const i=o.getIcon();return(0,je.jsx)(en.Z,{icon:Es.v,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.mainTab.sourceButton.title"}),showChevron:!0,right:(0,je.jsxs)(je.Fragment,{children:[i&&(0,je.jsx)(ti.Z,{icon:i,isEmptyPage:!1,size:20,disabled:!0,style:{marginRight:4,opacity:.6}}),(0,je.jsx)(Al.Z,{store:o})]}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0},onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_source"}),l.H4({collectionSettingsStore:t,item:{type:"source"}})}})}renderLayout(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewStore();if(!o)return;const n=o.getType();return n?(0,je.jsx)(en.Z,{icon:Gs,isPadded:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.mainTab.layoutButton.title"}),showChevron:!0,right:ro.Bh[n],onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_layout"}),l.H4({collectionSettingsStore:t,item:{type:"layout"}})}}):void 0}renderType(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionStore();if(!o)return;if(!this.shouldRenderDatabaseTypeStore.state)return;const n=o.getDatabaseType()||Ps.br;return(0,je.jsx)(en.Z,{icon:()=>(0,$s.L)({width:20}),isPadded:!0,title:(0,je.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Database type",id:"database.viewSettings.mainTab.databaseTypeButton.title"}),(0,je.jsx)(Pl.Z,{})]}),showChevron:!0,right:(0,Fs.Mn)(n),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_database_type"}),l.H4({collectionSettingsStore:t,item:{type:"setDatabaseType"}})}})}renderProperties(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(e.normalizedFormatStore.state[(0,la.oz)(this.getCurrentViewType())]||[]).filter((e=>Boolean(e.visible))).length;return(0,je.jsx)(en.Z,{icon:Us.N,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Properties",id:"database.viewSettings.mainTab.propertiesButton.title"}),showChevron:!0,right:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{propertiesShown} shown",id:"database.viewSettings.mainTab.propertiesButton.propertiesShown.title",values:{propertiesShown:o}}),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_properties"}),l.H4({collectionSettingsStore:t,item:{type:"properties",timelineViewTab:"timeline"}})}})}renderFilter(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.permissionScopes.state,n=e.currentPropertyFiltersStore.state.length+(e.currentCombinatorFilterStore.state&&o.canConfigureBlock?1:0);return(0,je.jsx)(en.Z,{icon:Os.I,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Filter",id:"database.viewSettings.mainTab.filterButton.title"}),showChevron:!0,right:n>0?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{numberOfFilters, plural, one {{numberOfFilters} filter} other {{numberOfFilters} filters}}",values:{numberOfFilters:n},id:"database.viewSettings.mainTab.filterButton.filters.title"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.mainTab.filterButton.noFilters.title"}),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_filters"}),0===n?l.H4({collectionSettingsStore:t,item:{type:"createFilter"}}):l.H4({collectionSettingsStore:t,item:{type:"filters"}})}})}renderSort(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.currentSortsStore.state.length;return(0,je.jsx)(en.Z,{icon:qs,isPadded:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.mainTab.sortButton.title"}),showChevron:!0,right:o>0?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{numberOfSorts, plural, one {{numberOfSorts} sort} other {{numberOfSorts} sorts}}",values:{numberOfSorts:o},id:"database.viewSettings.mainTab.sortButton.oneOrMoreSorts.title"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"None",id:"database.viewSettings.mainTab.sortButton.noSorts.title"}),onClick:()=>{Ot.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),0===o?l.H4({collectionSettingsStore:t,item:{type:"createSort"}}):l.H4({collectionSettingsStore:t,item:{type:"sort"}})}})}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}}Bl.displayName="CollectionSettingsViewMain";const Il=(0,a.injectIntl)(Bl);class Zl extends i.Z{constructor(){super(...arguments),this.handleViewNameBlur=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&o.getName()!==e&&d.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewNameBlur",environment:this.environment,perform:t=>{ea.iG({collectionViewStore:o,update:{name:e},transaction:t})}})},this.handleViewNameSubmit=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.handleViewNameBlur(e),l.wl({collectionSettingsStore:t,item:{type:"main"}}),Ot.wd({environment:this.environment,collectionContextStore:o,action:"rename"})},this.handleViewIconSubmit=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&o.isDefined()&&(d.createAndCommit({userAction:"CollectionSettingsCreateView.handleViewIconSubmit",environment:this.environment,perform:t=>{ea.Uy({collectionViewBlockStore:o,icon:e,transaction:t})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"change_icon",icon:e}))}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{device:o}=this.environment,n=e.collectionViewStore();if(!n)return;if(!n.isDefined())return;const i=n.getFormat().collection_view_icon,r=n.getType();return(0,je.jsxs)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"New view",id:"database.viewSettings.createViewTab.title"}),desktopWidth:290,children:[(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(Bs.Z,{initialValue:"",placeholder:Ne.default.formatMessage(Fl.viewNamePlaceholderMessage),focusInitial:!o.isMobile||void 0,onBlur:this.handleViewNameBlur,iconButton:{icon:e=>(0,je.jsx)(Jn.F,{color:"gray",viewIcon:i,viewType:r,style:{marginRight:6}}),iconStyle:{fill:Ds.Lr[this.theme.mode].gray},enforceIconColor:"gray",onSubmit:this.handleViewIconSubmit},onSubmit:this.handleViewNameSubmit})}),(0,je.jsx)(Ks.Z,{collectionContextStore:e,collectionSettingsStore:t,showDoneButton:!o.isMobile})]})}}Zl.displayName="CollectionSettingsCreateView";const Dl=(0,a.injectIntl)(Zl);var Kl=o(49670),Rl=o(48299),Nl=o(58449),Ol=o(4023),El=o(74523);function Ll(e){window.__c={n:"CollectionSettingsDBTypePropertyMapping"};const t=(0,g.O7)(),o=t.device.isMobile,{collectionSettingsStore:i,collectionContextStore:r,databaseType:s}=e,c=(0,m.VK)((()=>Ya.ck((0,Nl.appConfigs)(),s)),[s]),u=(0,m.VK)((()=>{var e;return null===(e=r.collectionStore())||void 0===e?void 0:e.getSchema()}),[r]),p=(0,m.VK)((()=>{if(u&&c)return Ya.Au(c,u)}),[c,u]),y=(0,m.VK)((()=>{const e={};return Object.keys(c||{}).filter((e=>void 0!==(null==c?void 0:c[e])&&e.startsWith("notion://"))).forEach((t=>{e[t]=Ps.bK})),Object.entries(p||{}).forEach((t=>{let[o,n]=t;e[o]=n})),e}),[c,p]),[h,S]=(0,n.useState)(y),[f,x]=(0,n.useState)(!1),v=(0,n.useCallback)(((e,t)=>{S({...h,[e]:t})}),[h]),C=(0,m.VK)((()=>{const e=s,t=Ya.YB((0,Nl.appConfigs)(),e);return t&&Ya.yK(t,e)}),[s]),b=(0,n.useCallback)((()=>{const e=r.collectionStore(),o=r.collectionViewBlockStore();e&&o&&d.createAndCommit({userAction:"CollectionSettingsDBTypePropertyMapping.migrateDatabase",environment:t,perform:n=>{Rl.vD({environment:t,collectionViewBlockStore:o,collectionStore:e,databaseType:s,propertyMapping:{...h,...p},typedPropertySchemas:{...c,...C},transaction:n}),l.E3({collectionSettingsStore:i});const r=(0,Fs.Mn)(s);Un.oV({label:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"<boldtext>{databaseName}</boldtext> has been changed to {databaseType} type",id:"database.viewSettings.databaseTypePropertyMappingTab.successfulTypingToastMessage",values:{boldtext:e=>(0,je.jsxs)("span",{style:{fontWeight:ne.Z.fontWeight.semibold},children:[" ",e," "]}),databaseType:r,databaseName:e.getName()||"Untitled"}})})}})}),[r,t,s,h,p,c,C,i]),w=(0,n.useCallback)((e=>{const t=e.type;return(u?Object.entries(u):[]).filter((e=>{let[o,n]=e;if(n)return n.type===t})).map((e=>{let[o,n]=e;return{key:o,title:null==n?void 0:n.name,icon:$e.wG[t]({width:12})}}))}),[u]),j=(0,n.useCallback)(((e,t,o)=>{const n=o||(null==c?void 0:c[e]);if(!n)return null;const i=n.name,r=w(n);return(0,je.jsx)(Js.Z,{title:i,selectedKey:h[e]||t,popupStyle:{minWidth:190},icon:$e.wG[n.type],options:[...r,{key:t,title:t,icon:(0,V.R)({width:12})}],onChange:t=>v(e,t)})}),[h,c,w,v]),M=(0,n.useMemo)((()=>{const e=Object.entries(C||{}).map((e=>{let[t,o]=e;return j(t,Ps.bK,o)}));return f||e.length<=3?e:e.slice(0,3)}),[C,f,j]);return(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Database type",id:"database.viewSettings.databaseTypePropertyMappingTab.title"}),children:[(0,je.jsx)(Ce.Z,{topBorder:!1,shouldShowBottomDivider:o,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"New database type",id:"database.viewSettings.databaseTypePropertyMappingTab.type"}),style:{paddingBottom:15},children:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingLeft:20},children:[(0,je.jsx)("div",{children:(0,Ps.T)(s)({width:13,height:13,marginRight:8})}),(0,je.jsx)("span",{style:{fontSize:14},children:(0,Fs.Mn)(s)})]})}),(0,je.jsx)(Ce.Z,{topBorder:!1,shouldShowBottomDivider:o,title:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Required Properties",id:"database.viewSettings.databaseTypePropertyMappingTab.requiredPropertiesTitle"}),(0,je.jsx)(ae.Z,{placement:Ol.u.Right,render:e=>(0,je.jsx)(El.Z,{...e,href:(0,al.UY)("guides.databaseType"),analyticsFrom:"set_database_type",style:{marginLeft:4}}),renderTooltip:()=>(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.databaseTypePropertyMappingTab.requiredPropertiesTooltip",defaultMessage:"Properties required for {type}",values:{type:s}})})]}),children:Object.entries(y).map((e=>{let[t,o]=e;return j(t,Ps.bK)}))}),(0,je.jsx)(Ce.Z,{topBorder:!1,shouldShowBottomDivider:o,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Suggested Properties",id:"database.viewSettings.databaseTypePropertyMappingTab.suggestedPropertiesTitle"}),children:M}),!f&&(0,je.jsx)(on.Z,{style:{marginLeft:12},onClick:e=>{e.stopPropagation(),x(!0)},children:(0,je.jsx)("div",{style:{},children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"More...",id:"database.viewSettings.databaseTypePropertyMappingTab.showMoreSuggestedProperties"})})}),(0,je.jsx)(jo.Z,{style:{display:"flex",margin:"14px",height:32},onClick:()=>{b()},children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Change to {type}",id:"database.viewSettings.databaseTypePropertyMappingTab.confirmChangeType",values:{type:(0,Fs.Mn)(s)}})}),(0,je.jsx)(cl.Z,{href:(0,al.UY)("guides.databaseType"),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Learn about {type} databases",id:"database.viewSettings.databaseTypePropertyMappingTab.learnMoreButton.title",values:{type:(0,Fs.Mn)(s)}}),analyticsFrom:"set_database_type"})]})}class Wl extends i.Z{renderComponent(){return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Deleted properties",id:"database.viewSettings.propertyTab.deletedTitle"}),children:this.renderContent()})}renderContent(){const{collectionContextStore:e}=this.props,t=e.normalizedDeletedSchemaStore.state,o=Object.entries(t).map((e=>{let[t,o]=e;if(o)return{propertyId:t,propertySchema:o}})).filter(oe.$K);if(0===o.length)return(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(pl.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.deletedPropertiesTab.noResults"})})});const{theme:n}=this;return(0,je.jsx)(Ce.Z,{children:o.map((e=>{let{propertyId:t,propertySchema:o}=e;return(0,je.jsx)(pl.Z,{title:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,je.jsx)($e.ZP,{type:o.type,icon:o.icon,size:16,theme:n,style:{fill:n.regularIconColor}}),(0,je.jsx)("span",{style:{marginLeft:6,maxWidth:200,...ne.Z.textOverflowStyle},children:o.name})]}),right:(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Se.Z,{icon:si.s,iconStyle:{marginRight:2},onClick:()=>{this.handleRestoreDeletedPropertyClick(t)}}),(0,je.jsx)(Se.Z,{icon:pe.y,onClick:()=>{this.handlePermanentlyDeleteDeletedPropertyClick(t)}})]})},t)}))})}handleRestoreDeletedPropertyClick(e){const{collectionSettingsStore:t,collectionContextStore:o,timelineViewTab:n}=this.props,i=o.collectionStore(),r=(0,Ui.jI)({timelineViewTab:n,collectionContextStore:o});if(i){const o=oi.D8({deletedSchema:i.getDeletedSchema(),property:e});if(o){var s;if("verification"===(null===(s=i.getDeletedSchema()[e])||void 0===s?void 0:s.type)){const e=i.getSchema();if(Object.keys(e).some((t=>{var o;return"verification"===(null===(o=e[t])||void 0===o?void 0:o.type)})))return void an.showDialog({message:(0,je.jsx)(a.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.verification",defaultMessage:"You can only have one verification property."}),showCancel:!1,keepFocus:!0,items:[{label:(0,je.jsx)(a.FormattedMessage,{id:"database.deletedPropertiesTab.cannotRestoreDuplicateProperty.modal.dismissButton",defaultMessage:"Dismiss"}),onAccept:()=>{}}]})}d.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handleRestoreDeletedPropertyClick",environment:this.environment,perform:e=>{ea.xO({environment:this.environment,collectionStore:i,update:o.updateSchema,transaction:e}),ea.$N({collectionStore:i,update:o.updateDeletedSchema,transaction:e})}}),l.z$({collectionSettingsStore:t}),l.H4({collectionSettingsStore:t,item:{type:"property",property:e,formatKey:r}})}}}handlePermanentlyDeleteDeletedPropertyClick(e){an.showDialog({message:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.deletedPropertiesTab.permanentlyDeleteProperty.modal.prompt",defaultMessage:"Are you sure you want to delete this property?"}),showCancel:!0,keepFocus:!0,items:[{label:(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.propertyTab.deleteProperty.modal.confirmButton",defaultMessage:"Delete"}),color:"red",onAccept:()=>{const t=this.props.collectionContextStore.collectionStore();t&&d.createAndCommit({userAction:"CollectionSettingsDeletedProperties.handlePermanentlyDeleteDeletedPropertyClick",environment:this.environment,perform:o=>{ea.$N({collectionStore:t,update:{[e]:null},transaction:o})}})}}]})}}Wl.displayName="CollectionSettingsDeletedProperties";const Gl=(0,a.injectIntl)(Wl);var Hl=o(83319),zl=o(65326);const Ul=12e3;var $l=o(3791),ql=o(79474),Ql=o(55332),Yl=o(44866),Xl=o(28020),Jl=o(77181),ec=o(12921),tc=o(83212),oc=o(78291),nc=o(30905),ic=o(8132),rc=o(1743);const ac=(0,a.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},extractPromptSectionTitle:{defaultMessage:"What key info to extract?",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptSectionTitle"},customPromptSectionTitle:{defaultMessage:"What to generate?",id:"database.viewSettings.propertyTab.aiAutofill.customPromptSectionTitle"},extractPromptInputPlaceholder:{defaultMessage:"e.g. “Key topics in bullets” or “People mentioned on the page”",id:"database.viewSettings.propertyTab.aiAutofill.extractPromptInputPlaceholder"},customPromptInputPlaceholder:{defaultMessage:"Tell AI what to generate from page content and properties…",id:"database.viewSettings.propertyTab.aiAutofill.customPromptInputPlaceholder"}});function sc(e){var t;let{environment:o,aiInference:i,setAiInference:r,collectionContextStore:s,isAutofillSetupEnabled:l,shouldShowUserPromptIsInvalidError:c,setShouldShowUserPromptIsInvalidError:d}=e;window.__c={n:"CollectionSettingsAiAutofillPromptInput"};const u=function(e){if(!e)return;switch(e.type){case"summarize":case"translate":return;case"extract":return{aiInferenceType:e.type,sectionTitle:ac.extractPromptSectionTitle,inputPlaceholder:ac.extractPromptInputPlaceholder,value:e.prompt};case"custom":return{aiInferenceType:e.type,sectionTitle:ac.customPromptSectionTitle,inputPlaceholder:ac.customPromptInputPlaceholder,value:e.prompt};case"select":case"multi_select":return{aiInferenceType:e.type,sectionTitle:ac.customPromptSectionTitle,inputPlaceholder:ac.customPromptInputPlaceholder,value:e.prompt};default:(0,oe.t1)(e)}}(i),p=(0,m.VK)((()=>(0,ro.k4)()),[]),g=(0,n.useCallback)((e=>{if(s.collectionStore()&&u)switch(e.target.value&&e.target.value.length<=Ul?d(!1):e.target.value.length>Ul&&d(!0),u.aiInferenceType){case"extract":case"custom":r({type:u.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==i?void 0:i.auto_update_on_edit)??p});break;case"select":case"multi_select":r({type:u.aiInferenceType,prompt:e.target.value,auto_update_on_edit:(null==i?void 0:i.auto_update_on_edit)??p,add_options:((null==i?void 0:i.type)===u.aiInferenceType&&(null==i?void 0:i.add_options))??!1});break;case"summarize":case"translate":return;default:(0,oe.t1)(u.aiInferenceType)}}),[i,s,p,u,r,d]);return u?(0,je.jsxs)(Ce.Z,{title:Ne.default.formatMessage(u.sectionTitle),isInput:!0,style:{marginTop:-4},children:[(0,je.jsx)(rc.Z,{capture:!0,allowEsc:!0,children:(0,je.jsx)(no.ZP,{inputOuterStyle:{margin:o.device.isMobile?"8px 0":0,border:c?"1px solid red":void 0},type:"text",value:u.value||"",onChange:g,placeholder:Ne.default.formatMessage(u.inputPlaceholder),textarea:!0,disabled:!l,autosize:!0,autosizeMinHeight:100,autosizeMaxHeight:600},u.aiInferenceType)}),c&&(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingLeft:12,fontSize:12},children:[(0,Ft.t)({width:12,height:12,fill:"#D34F43"}),(0,je.jsx)("div",{style:{color:"#D34F43",paddingLeft:4},children:((null===(t=u.value)||void 0===t?void 0:t.length)??0)>Ul?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Instruction is too long",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.exceedsMaxLength"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Required",id:"CollectionSettings.propertyTab.aiAutofill.promptInput.required"})})]})]}):null}function lc(e){const{collectionContextStore:t,isAutofillSetupEnabled:o,draftAiInference:n,setDraftAiInference:i,environment:r,shouldShowUserPromptIsInvalidError:a,setShouldShowUserPromptIsInvalidError:s,doesUserHaveAIAddOn:l}=e;return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{style:{marginBottom:10},children:(0,je.jsx)(ic.p,{collectionContextStore:t,environment:r,setAiInference:i,aiInference:n,doesUserHaveAIAddOn:l})}),n&&(0,je.jsx)(Ce.Z,{topBorder:!0,children:(0,je.jsx)(sc,{environment:r,aiInference:n,setAiInference:i,collectionContextStore:t,isAutofillSetupEnabled:o,shouldShowUserPromptIsInvalidError:a,setShouldShowUserPromptIsInvalidError:s})})]})}o(30541);var cc=o(87205),dc=o(91396);const uc=new be.Z;var pc=o(43765);const gc=(0,a.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},whatToTranslate:{defaultMessage:"What to translate?",id:"CollectionSettingsPropertyAiAutofill.translateProperty.propertySelector"},translateTo:{defaultMessage:"Translate to",id:"CollectionSettingsPropertyAiAutofill.translateProperty.languageSelector"},selectorSearchPlaceholder:{defaultMessage:"Search",id:"CollectionSettingsPropertyAiAutofill.selectorOption.searchbar.placeholder"},allProperties:{defaultMessage:"All properties",id:"CollectionSettingsPropertyAiAutofill.selectorOption.allProperties.checkbox"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"}});function mc(e){window.__c={n:"CollectionSettingsTextPropertyAiAutofill"};const{collectionContextStore:t,propertySchema:o,previousPromptByAiInferenceType:i,isAutofillSetupEnabled:r,draftAiInference:a,setDraftAiInference:s,environment:l,propertyId:c,collectionSchema:d,shouldShowUserPromptIsInvalidError:u,setShouldShowUserPromptIsInvalidError:p,doesUserHaveAIAddOn:g}=e,m=(0,y.Fg)(),h=(0,n.useMemo)((()=>[new be.Z,new be.Z]),[]),S=(0,n.useMemo)((()=>function(e){var t;let{environment:o,aiInference:n,collectionSchema:i,setAiInference:r,property:a,theme:s,optionsButtonPopupStores:l}=e;if(!n)return[];switch(n.type){case"summarize":return[];case"translate":const e=He.oA((0,oe.Yd)(i).map((e=>{if(e===a)return;const t=i[e];if(t&&(0,cc.K9)(t)){var o;if("text"===t.type&&"translate"===(null===(o=t.ai_inference)||void 0===o?void 0:o.type))return;return{id:e,option:t.name,icon:(0,je.jsx)($e.ZP,{icon:t.icon,type:t.type,theme:s,size:16})}}}))),o=e.findIndex((e=>"title"===e.id));if(o&&o>0){const t=e[o];e.splice(o,1),e.unshift(t)}for(;l.length<2;)l.push(new be.Z);return[{type:"multi",options:e,selectedIds:(null===(t=n.targetProperties)||void 0===t?void 0:t.length)>0?n.targetProperties:["title"],setSelectedIds:e=>{r({...n,targetProperties:e})},selectorTitle:gc.whatToTranslate,selectAllTitle:gc.allProperties,buttonPopupStore:l[0]},{type:"single",options:cc.nI.map((e=>{let{key:t,name:o}=e;return{id:t,option:Ne.default.formatMessage(o)}})),selectedId:n.toLanguage,onSelect:e=>{r({...n,toLanguage:e})},selectorTitle:gc.translateTo,buttonPopupStore:l[1]}];case"extract":case"custom":return[];default:(0,oe.t1)(n)}}({environment:l,aiInference:a,collectionSchema:d,setAiInference:s,property:c,theme:m,optionsButtonPopupStores:h})),[l,a,d,s,c,m,h]);return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsxs)(Ce.Z,{style:{marginBottom:10},children:[(0,je.jsx)(yc,{propertySchema:o,previousPromptByAiInferenceType:i,draftAiInference:a,setDraftAiInference:s,environment:l}),(0,je.jsx)(ic.p,{collectionContextStore:t,environment:l,setAiInference:s,aiInference:a,doesUserHaveAIAddOn:g})]}),a&&(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[(0,je.jsx)(sc,{environment:l,aiInference:a,setAiInference:s,collectionContextStore:t,isAutofillSetupEnabled:r,shouldShowUserPromptIsInvalidError:u,setShouldShowUserPromptIsInvalidError:p}),(0,je.jsx)(Sc,{environment:l,optionProps:S})]})]})}function yc(e){let{propertySchema:t,previousPromptByAiInferenceType:o,draftAiInference:i,setDraftAiInference:r,environment:s}=e;window.__c={n:"AiPromptTypeSelectorSections"};const l=(0,m.VK)((()=>(0,ro.k4)()),[]),c=(0,n.useCallback)((e=>{var n,i,a,s,c,d,u,p;if(!t||!(0,C.qQ)(t)||!e)return;let g;switch(e){case"summarize":g={type:e,auto_update_on_edit:l};break;case"translate":g={type:e,auto_update_on_edit:l,targetProperties:(null===(n=t.ai_inference)||void 0===n?void 0:n.type)===e?null===(i=t.ai_inference)||void 0===i?void 0:i.targetProperties:["title"],toLanguage:(null===(a=t.ai_inference)||void 0===a?void 0:a.type)===e?null===(s=t.ai_inference)||void 0===s?void 0:s.toLanguage:"english"};break;case"extract":g={type:e,prompt:(null===(c=t.ai_inference)||void 0===c?void 0:c.type)===e?null===(d=t.ai_inference)||void 0===d?void 0:d.prompt:o[e]??"",auto_update_on_edit:l};break;case"custom":g={type:e,prompt:(null===(u=t.ai_inference)||void 0===u?void 0:u.type)===e?null===(p=t.ai_inference)||void 0===p?void 0:p.prompt:o[e]??"",auto_update_on_edit:l};break;default:(0,oe.t1)(e)}r(g)}),[l,o,t,r]),d=(0,y.Fg)();return t&&(0,C.qQ)(t)?(0,je.jsx)(he.ZP,{popupType:s.device.isMobile?he.Z4.SlideUp:he.Z4.Popup,buttonPopupStore:uc,render:e=>{const t={key:"section",render:e=>(0,je.jsx)(Ce.Z,{...e}),items:He.oA(Object.keys(dc.OE.text).map((t=>{if(("translate"!==t||(0,ec.hu)())&&(0,dc.MD)(t))return{key:t,render:e=>{const o=dc.OE.text[t];return(0,je.jsx)(ye.Z,{focused:!1,onClick:e.onClick,icon:o.svg({height:20,width:24,fill:d.aiPurpleColor}),title:Ne.default.formatMessage(o.name),checkState:(null==i?void 0:i.type)===t})},action:()=>{e.close(),c(t)}}})))};return(0,je.jsx)(fe.Z,{menuType:Lt.og.Popup,minWidth:260,maxWidth:"100vw",children:(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:void 0,sections:[t]})})},renderOrigin:e=>{let{onClick:t}=e;return(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",fontSize:14,marginLeft:4,marginRight:4,marginTop:8,paddingLeft:12,paddingRight:12,cursor:"pointer",height:28},onClick:t,children:[(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Fill with",id:"CollectionSettingsPropertyAiAutofill.ClosedSelector.Title"}),(0,je.jsx)(hc,{aiActionType:null==i?void 0:i.type})]})}}):null}function hc(e){let{aiActionType:t}=e;window.__c={n:"AiActionRenderer"};const o=(0,y.Fg)(),n=t?dc.OE.text[t]:{name:gc.noAiAutofillSelected,svg:()=>null};return(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:14,paddingLeft:15,paddingBottom:0},children:[(0,je.jsx)("div",{style:{color:o.lightIconColor},children:n.svg({height:16,width:16,marginRight:2})}),(0,je.jsx)("div",{style:{color:o.lightTextColor,paddingLeft:4},children:(0,je.jsx)(a.FormattedMessage,{...n.name})}),(0,je.jsx)("div",{style:{color:o.lightIconColor,paddingLeft:4},children:(0,to.o)({height:12,width:12})})]})}function Sc(e){let{environment:t,optionProps:o}=e;return o&&o.length>0?(0,je.jsx)(Ce.Z,{title:Ne.default.formatMessage(gc.optionsSectionTitle),isInput:!0,style:{marginTop:-4},children:o.map(((e,o)=>"multi"===e.type?(0,je.jsx)(fc,{environment:t,options:e.options,selectedIds:e.selectedIds,setSelectedIds:e.setSelectedIds,selectorTitle:e.selectorTitle,selectAllTitle:e.selectAllTitle,buttonPopupStore:e.buttonPopupStore},o):(0,je.jsx)(xc,{environment:t,options:e.options,selectedId:e.selectedId,onSelect:e.onSelect,selectorTitle:e.selectorTitle,buttonPopupStore:e.buttonPopupStore},o)))}):null}function fc(e){let{environment:t,options:o,selectedIds:i,setSelectedIds:r,selectorTitle:s,selectAllTitle:l,buttonPopupStore:c}=e;window.__c={n:"CheckSelectorOption"};const[d,u]=(0,n.useState)(""),p=(0,y.Fg)(),g=o.filter((e=>i.includes(e.id))),h=(0,m.VK)((()=>He.jj(He.MR(o.map((e=>e.id)))).join(",")===He.jj(He.MR(i)).join(",")),[o,i]),S=e=>{i.includes(e)?r(i.filter((t=>t!==e))):r(He.jj([...i,e]))},f=()=>{i.length<o.length?r(o.map((e=>e.id))):r(["title"])},x=(0,je.jsx)(Ce.Z,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,je.jsx)(no.ZP,{focusInitial:!t.device.isMobile||void 0,focus:!t.device.isMobile||void 0,value:d,onChange:e=>{u(e.target.value)},placeholder:Ne.default.formatMessage(gc.selectorSearchPlaceholder)})});return(0,je.jsx)(he.ZP,{popupType:t.device.isMobile?he.Z4.SlideUp:he.Z4.Popup,buttonPopupStore:c,render:e=>{const t=o.filter((e=>{var t;const o=null===(t=e.option)||void 0===t?void 0:t.toLowerCase();return-1!==(null==o?void 0:o.indexOf(d.toLowerCase()))})).map((e=>{let{id:t,option:o,icon:n}=e;return{key:t,render:e=>(0,je.jsx)(ye.Z,{focused:!1,onClick:e.onClick,left:(0,je.jsx)(pi.Z,{checked:i.includes(t),size:14,checkSize:8,onClick:e=>{S(t)}}),icon:n,title:o}),action:()=>{S(t)}}})),n={key:"section",render:e=>(0,je.jsx)(Ce.Z,{...e,topBorder:!0}),items:t},r={key:"all-items",render:e=>(0,je.jsx)(Ce.Z,{...e}),items:[{key:"all-items",render:e=>(0,je.jsx)(ye.Z,{focused:!1,onClick:()=>{f()},left:(0,je.jsx)(pi.Z,{checked:h,size:14,checkSize:8,onClick:()=>{f()}}),title:Ne.default.formatMessage(l)}),action:()=>{f()}}]};return(0,je.jsxs)(fe.Z,{menuType:Lt.og.Popup,minWidth:260,maxWidth:"100vw",children:[x,0===t.length?(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(pc.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:void 0,sections:[r,n]})]})},renderOrigin:e=>(0,je.jsx)(en.Z,{title:Ne.default.formatMessage(s),showChevron:!0,right:(0,je.jsx)("div",{style:{color:p.lightTextColor,paddingLeft:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:He.oA(g.map((e=>{let{id:t,option:o,icon:n}=e;return o}))).join(", ")}),rightStyle:{flexShrink:1},rotateChevron:c.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}function xc(e){let{environment:t,options:o,selectedId:i,onSelect:r,selectorTitle:s,buttonPopupStore:l}=e;window.__c={n:"SelectorOption"};const[c,d]=(0,n.useState)(""),u=o.find((e=>e.id===i)),p=(0,y.Fg)(),g=(0,je.jsx)(Ce.Z,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,je.jsx)(no.ZP,{focusInitial:!t.device.isMobile||void 0,focus:!t.device.isMobile||void 0,value:c,onChange:e=>{d(e.target.value)},placeholder:Ne.default.formatMessage(gc.selectorSearchPlaceholder)})});return(0,je.jsx)(he.ZP,{popupType:t.device.isMobile?he.Z4.SlideUp:he.Z4.Popup,buttonPopupStore:l,render:e=>{const t=o.filter((e=>{var t;return-1!==(null===(t=e.option)||void 0===t?void 0:t.toLowerCase().indexOf(c.toLowerCase()))})).map((t=>{let{id:o,option:n,icon:a}=t;return{key:o,render:e=>(0,je.jsx)(ye.Z,{focused:!1,onClick:e.onClick,icon:a,title:n,checkState:o===i}),action:()=>{e.close(),r(o)}}})),n={key:"section",render:e=>(0,je.jsx)(Ce.Z,{...e}),items:t};return(0,je.jsxs)(fe.Z,{menuType:Lt.og.Popup,minWidth:260,maxWidth:"100vw",children:[g,0===t.length?(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(pc.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"No results",id:"CollectionSettingsPropertyAiAutofill.searchBar.noResults.label"})})}):(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:void 0,sections:[n]})]})},renderOrigin:e=>(0,je.jsx)(en.Z,{title:Ne.default.formatMessage(s),showChevron:!0,right:u&&(0,je.jsxs)(je.Fragment,{children:[u.icon,(0,je.jsx)("div",{style:{color:p.lightTextColor,paddingLeft:4,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"90%"},children:u.option})]}),rightStyle:{flexShrink:1},rotateChevron:l.state.open,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})})}var vc=o(73420),Cc=o(91839);const bc=(0,a.defineMessages)({optionsSectionTitle:{defaultMessage:"Options",id:"database.viewSettings.propertyTab.aiAutofill.optionsSectionTitle"},removeAutofillButton:{defaultMessage:"Turn off AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.removeAutofillButton"},toggleFillWithAiSectionLabel:{defaultMessage:"Actions",id:"database.viewSettings.propertyTab.aiAutofill.actionsSectionLabel"},confirmOverwriteExistingPropertyValues:{defaultMessage:"Filling “{propertyName}” with AI will overwrite any existing values of the property. Are you sure you want to continue?",id:"database.viewSettings.propertyTab.aiAutofill.confirmOverwriteModal"},noAiAutofillSelected:{defaultMessage:"Select an option",id:"database.CollectionSettingsPropertyAiAutofill.noAiAutofillSelected"}});function wc(e){window.__c={n:"CollectionSettingsPropertyAiAutofill"};const{property:t,collectionContextStore:o,collectionSettingsStore:i}=e,r=(0,m.VK)((()=>o.normalizedSchemaStore.state[t]),[t,o.normalizedSchemaStore]),s=(0,m.VK)((()=>o.collectionStore()),[o]),c=(0,m.VK)((()=>o.normalizedSchemaStore.getState()),[o]),u=r&&(0,C.qQ)(r)?(0,C.q3)(r):void 0,p=(0,g.O7)(),y=Mc(),h=(0,m.VK)((()=>{const e=o.collectionStore();return e&&(0,ec.mX)(p,tc.Z.getMode(p,e),e)}),[p,o]),S=Dt.default.createValue({stage:"not_started"});(0,n.useEffect)((()=>{var e,n;if("page"===o.getViewType())return;if(!1!==(null===(e=o.getPropertyFormat(t))||void 0===e?void 0:e.visible))return;const i=new ks.Z({name:"CollectionSettingsPropertyAiAutofill"});p.defaultRecordCache.inMemoryRecordCache.addCacheOverride(i);const r=null===(n=o.formatStore())||void 0===n?void 0:n.clone(i),a=o.getPropertyFormatKey();return r&&a&&d.createAndCommit({userAction:"CollectionSettingsPropertyAiAutofill.open",environment:p,perform:e=>{Jr.er({formatStore:r,formatKey:a,property:t,update:{visible:!0},transaction:e})}}),()=>{p.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(i)}}),[o,p,t]);const f=(0,n.useRef)({}),x=(0,m.VK)((()=>(0,ro.k4)()),[]),[v,b]=(0,n.useState)(function(e){const t=e&&(0,C.qQ)(e)?(0,C.q3)(e):void 0;if(!t&&e&&(0,C.cu)(e))return{type:e.type,auto_update_on_edit:!1,add_options:!1};return t}(r)),[w,j]=(0,n.useState)(!1),M=(0,n.useCallback)((()=>{const e=o.collectionStore();if(!e||!r||!(0,C.qQ)(r))return;const n=(0,C.q3)(r);n&&"prompt"in n&&(f.current={...f.current,[n.type]:n.prompt}),Yl.saveOrRemovePropertyAiInference({environment:p,propertySchema:r,collectionStore:e,property:t,draftAiInference:v})}),[o,r,v,t,p]),_=(0,m.VK)((()=>{var e;return(null===(e=o.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString())||""}),[o]),T=(0,m.VK)((()=>{const e=o.collectionStore();return e?(0,la.De)(e.getFormat(),t):{isRunning:!1,numPagesFilled:void 0,numPagesRequested:void 0}}),[o,t]),k=(0,n.useCallback)((async()=>{const e=o.collectionStore();e&&r&&await Yl.autofillPropertyForCollection({environment:p,collectionStore:e,propertySchema:r,property:t,...v&&{includedCollectionSchemaUpdateOp:{pointer:e.pointer,command:"set",path:["schema",t,"ai_inference"],args:v}}})}),[p,r,t,o,v]),A=(0,n.useCallback)((async()=>{if(r&&(0,C.qQ)(r)&&He.Xy(v,(0,C.q3)(r)))l.E3({collectionSettingsStore:i});else if(v){var e;if("prompt"in v)if(function(e){if(!e)return!1;switch(e.type){case"extract":case"custom":return!0;case"select":case"multi_select":case"summarize":case"translate":return!1;default:throw(0,oe.t1)(e)}}(v)&&0===(null===(e=v.prompt)||void 0===e?void 0:e.length)||(0,oe.$K)(v.prompt)&&v.prompt.length>Ul)return void j(!0);(null==u||!u.auto_update_on_edit)&&null!=v&&v.auto_update_on_edit&&x&&r?await ql.r({sourceAction:"auto_update",propertyName:r.name,collectionName:_})&&M():M()}}),[_,i,u,v,M,x,r]),V=(0,n.useCallback)((()=>{const e=o.collectionStore();e&&u&&r&&(Yl.saveOrRemovePropertyAiInference({environment:p,propertySchema:r,collectionStore:e,property:t,draftAiInference:null}),l.z$({collectionSettingsStore:i}))}),[o,u,p,r,t,i]),F=r&&(0,C.qQ)(r)&&He.Xy(v,(0,C.q3)(r)),B=(0,n.useCallback)((async()=>new Promise((e=>{an.showDialog({showCancel:!1,keepFocus:!1,message:(0,je.jsxs)(vc.sg,{alignItems:"center",gap:8,children:[(0,P.y)(y.confirmDiscardChangesDialogIconStyle),(0,je.jsx)("div",{style:y.confirmDiscardChangesDialogMessageStyle,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Do you want to discard changes for AI autofill?",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.message"})})]}),items:[{label:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Discard",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.acceptLabel"}),color:"red",onAccept:()=>e(!0)},{label:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Continue editing",id:"database.viewSettings.propertyTab.aiAutofill.confirmDiscordChangesDialog.cancelLabel"}),onAccept:()=>e(!1)}]})}))),[y]),I=(0,n.useCallback)((async()=>{(F||await B())&&l.z$({collectionSettingsStore:i})}),[F,i,B]),Z=(0,n.useCallback)((async()=>{(F||await B())&&l.E3({collectionSettingsStore:i})}),[F,i,B]),D=(0,m.VK)((()=>{var e;const t=(null===(e=oc.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,$l.de)(t)}),[]);return r&&(0,C.qQ)(r)&&s?(0,je.jsx)(zi.Z,{capture:!0,onEsc:Z,children:(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Fill “{propertyName}” with AI",id:"database.viewSettings.propertyTab.aiAutofill.title",values:{propertyName:r.name}}),handleBackArrowClick:I,handleClose:Z,children:[!h&&(0,je.jsx)(Ce.Z,{style:y.menuItemStyle,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"You don't have permission to set up AI autofill on this database.",id:"database.viewSettings.propertyTab.aiAutofill.noSetupPermission"})}),"text"===r.type&&(0,je.jsx)(mc,{collectionContextStore:o,propertySchema:r,previousPromptByAiInferenceType:f.current,isAutofillSetupEnabled:Boolean(h),draftAiInference:v,setDraftAiInference:b,environment:p,propertyId:t,collectionSchema:c,shouldShowUserPromptIsInvalidError:w,setShouldShowUserPromptIsInvalidError:j,doesUserHaveAIAddOn:D}),(0,C.cu)(r)&&(0,je.jsx)(lc,{collectionContextStore:o,isAutofillSetupEnabled:Boolean(h),draftAiInference:v,setDraftAiInference:b,environment:p,shouldShowUserPromptIsInvalidError:w,setShouldShowUserPromptIsInvalidError:j,doesUserHaveAIAddOn:D}),v&&(0,je.jsxs)(Ce.Z,{children:[(0,je.jsx)(jc,{environment:p,isAutofillSetupEnabled:h,collectionContextStore:o,tryAutofillStore:S,propertySchema:r,property:t,aiInference:v}),(0,je.jsx)(jo.Z,{style:{...y.buttonStyle,margin:"8px 12px 12px 12px",display:F?"none":"flex"},onClick:A,disabled:!h,children:F?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Done",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonAllSaved"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Save changes",id:"database.viewSettings.propertyTab.aiAutofill.saveButtonWithChanges"})})]}),(0,je.jsxs)(Ce.Z,{topBorder:!0,title:p.device.isMobile&&Ne.default.formatMessage(bc.toggleFillWithAiSectionLabel),children:[void 0!==u&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(ae.Z,{disableTooltip:D,renderTooltip:()=>(0,je.jsx)(nc.qQ,{collectionStore:s,propertySchema:r}),render:e=>(0,je.jsx)(en.Z,{icon:e=>(0,je.jsx)(nc.Xh,{updateAiInferencesTaskStatus:T,iconStyle:e,progressIconStyle:{marginTop:4,marginLeft:4,marginRight:2}}),title:(0,je.jsx)(nc.ZP,{updateAiInferencesTaskStatus:T}),caption:void 0!==T.numPagesFilled&&void 0!==T.numPagesRequested&&(0,je.jsx)(nc.Y7,{updateAiInferencesTaskStatus:T}),focused:!1,onClick:k,disabled:T.isRunning||!h,...e})}),(0,je.jsx)(en.Z,{icon:pe.y,isRed:!0,focused:!1,title:Ne.default.formatMessage(bc.removeAutofillButton),onClick:V,disabled:!h})]}),(0,je.jsx)(cl.Z,{href:(0,al.UY)("guides.aiAutofill"),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Learn about AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.learnMoreLink"}),analyticsFrom:"collection_ai_autofill_menu"})]})]})}):null}function jc(e){let{environment:t,isAutofillSetupEnabled:o,collectionContextStore:i,tryAutofillStore:l,propertySchema:c,property:d,aiInference:u}=e;window.__c={n:"TryOnThisViewActionSection"};const[p,g]=(0,n.useState)((0,r.ZP)()),y=(0,n.useRef)((0,r.ZP)()),h=(0,m.VK)((()=>l.state.stage),[l]),S=(0,m.VK)((()=>{const e=i.contextType;if("collectionPage"===e)return{type:"page",candidateBlockStores:He.oA([(0,Xl.np)()])};if("collectionTypedView"===e||"collectionView"===e){var t,o;const e=i.collectionViewBlockStore(),n=i.collectionStore();if(!e||!n)return{type:"collection",candidateBlockStores:[]};const r=i.normalizedFormatStore.state,a="board"===i.getViewType()?{groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}:{groupByKey:"collection_group_by",groupsFormatKey:"collection_groups"},s=i.normalizedSchemaStore.state,l=r[a.groupByKey],c=(0,oe.$K)(l)?(0,nl.Qq)({schema:s,groupBy:l}):[],d=Object.values((null===(t=i.localResultStore.state)||void 0===t?void 0:t.reducerResults)??{}).find((e=>"groups"===e.type)),u=(0,rl.Cz)({getRecordModel:e.getRecordModel,schema:s,groupBy:l,formatGroups:r[a.groupsFormatKey]??[],schemaGroups:c,reducerResults:(null==d?void 0:d.results)??[],relativeVariableResult:i.relativeVariableStore.state,viewAppConfigUri:null===(o=i.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri});let p,g;if(0===u.length){const e=i.localResultStore.state;if(e){const t=Object.values(e.reducerResults).find((e=>"results"===e.type));p=((null==t?void 0:t.blockIds)??[]).map((e=>gt.G.createChildStore(n,{table:"block",id:e})))}else p=[]}else{p=[];for(const e of u){const t=i.groupsStore.getGroupState(e),o=null==t?void 0:t.resultsStore.state;p.push(...o??[])}}if(p=He.mN(p,(e=>e.id)),i.currentSubitemFormatStore.state){g=[];const e=i.subitemTreeStore.state;for(const t of p){if(g.length>=5)break;const o=e.children.find((e=>e.value.store.id===t.id));if(o){const e=[];(0,Jl.yU)({results:e,tree:o}),g.push(...e)}}}else g=p;return{type:"collection",candidateBlockStores:g.slice(0,5)}}throw new Error(`Unexpected context type: ${e}`)}),[i]),f=(0,n.useCallback)((()=>{var e;s.qG2(t,{ai_inference_type:u.type,type:"undo_from_collection_settings",inference_id:p,collection_id:null===(e=i.collectionStore())||void 0===e?void 0:e.id,session_id:y.current}),"not_started"!==h&&(Ql.Yw(t,!1),l.setState({stage:"not_started"}))}),[t,u,p,i,h,l]),x=(0,oe.Of)(S.candidateBlockStores),v=Mc({isTryAutofillEnabled:o&&x});if(t.device.isMobile)return null;let C;return C=x?"collection"===S.type?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Updates the first {maxPages} pages. You can undo changes anytime.",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollectionDescription",values:{maxPages:5}}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:'Updates "{propertyName}" on this page. You can undo changes anytime.',id:"database.viewSettings.propertyTab.aiAutofill.tryOnPageDescription",values:{propertyName:c.name}}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Add more pages or remove filters to try AI on this view.",id:"database.viewSettings.propertyTab.tryAutofillDisabledDescription"}),(0,je.jsx)(n.Fragment,{children:(0,je.jsx)("div",{style:{margin:"8px 12px"},children:(0,je.jsxs)(vc.X2,{gap:8,children:[(0,je.jsx)(zt.Z,{disabled:!o||!x,style:{...v.buttonStyle,...v.undoButtonStyle,..."not_started"===h&&{display:"none"}},onClick:f,children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Undo",id:"database.viewSettings.propertyTab.aiAutofill.undoButton"})}),(0,je.jsx)(ae.Z,{renderTooltip:()=>(0,je.jsx)("div",{children:C}),render:e=>(0,je.jsx)(zt.Z,{...e,disabled:!o||!x,style:{...v.buttonStyle,...v.tryButtonStyle},hoveredStyle:v.tryButtonHoveredStyle,pressedStyle:v.tryButtonPressedStyle,onClick:async()=>{if((0,oe.Of)(S.candidateBlockStores)){const e=(0,r.ZP)();g(e),l.setState({stage:"in_progress"}),await Yl.autofillPropertyForBlocks({environment:t,stores:S.candidateBlockStores,property:d,propertySchema:c,aiInferenceOverride:u,userEventForAnalytics:"generate_from_try_on_view_button",sessionIdForAnalytics:y.current,collectionContextStore:i,from:"ai_autofill_settings"}),l.setState({stage:"complete"})}},children:"in_progress"===h?(0,je.jsx)(Cc.Z,{}):(0,je.jsxs)(je.Fragment,{children:[(0,P.y)({width:16,..."not_started"!==h&&{display:"none"}}),"not_started"!==h?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Try again",id:"database.viewSettings.propertyTab.aiAutofill.tryAgain"}):"collection"===S.type?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Try on this view",id:"database.viewSettings.propertyTab.aiAutofill.tryOnCollection"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Try on this page",id:"database.viewSettings.propertyTab.aiAutofill.tryOnPage"})]})})})]})})})}function Mc(e){const t=(0,y.Fg)();return(0,y.yK)((()=>({buttonStyle:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8},menuItemStyle:{fontSize:13,borderRadius:6,background:t.accentColors.purple[50],color:t.accentColors.purple[500],margin:"8px 12px",padding:"8px 12px"},undoButtonStyle:{border:`1px solid ${t.accentColors.gray[100]}`,flex:1},tryButtonStyle:{fontWeight:500,flex:1,background:null!=e&&e.isTryAutofillEnabled?"light"===t.mode?t.accentColors.purple[50]:t.accentColors.purple[200]:t.accentColors.gray[50],color:null!=e&&e.isTryAutofillEnabled?t.aiPurpleColor:t.accentColors.gray[400]},fillAllPagesWandIconStyle:{fill:t.aiPurpleColor},tryButtonHoveredStyle:{background:t.accentColors.purple[100]},tryButtonPressedStyle:{background:t.accentColors.purple[200]},confirmDiscardChangesDialogIconStyle:{width:32,height:32,fill:t.aiPurpleColor,paddingTop:8},confirmDiscardChangesDialogMessageStyle:{textAlign:"center",fontWeight:500}})),[t,null==e?void 0:e.isTryAutofillEnabled])}var _c=o(75246),Tc=o(29369),kc=o(16173),Pc=o(88990);const Ac=(0,a.defineMessages)({upgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.upgrade.label",defaultMessage:"Upgrade"},cancelUpgradeButton:{id:"appTemplateUpgradeActions.upgradeConfirmationDialog.cancelUpgrade.label",defaultMessage:"Don't upgrade"}});async function Vc(e){const{environment:t,collectionViewBlockStore:o,collectionSettingsStore:n}=e,i=null==o?void 0:o.getFormat().app_config_uri,r=null==o?void 0:o.getParentStore();if(!o||i!==Ps.TZ&&i!==Ps.pz)return!1;const a=i===Ps.TZ?o:await Rl.JN({environment:t,collectionViewBlockStore:o,databaseUri:Ps.iS}),s=i===Ps.pz?o:await Rl.JN({environment:t,collectionViewBlockStore:o,databaseUri:Ps.p$});return!(!(a&&s&&r)||r.table!==_c.bx&&r.table!==dt.iU&&r.table!==Tc.e0)&&(an.showDialog({message:(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{children:"Upgrade Existing Sprints to Latest?"}),(0,je.jsx)("div",{style:{fontSize:12,padding:8},children:"This will update your Sprints Database, and change some existing views and properties."})]}),items:[{label:Ne.default.formatMessage(Ac.upgradeButton),color:"red",onAccept:async()=>{await async function(e){var t;const{environment:o,appParentStore:n,collectionViewBlockStore:i}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.app_uri_map,a=i.getCollectionStore();if(!r||!a)return;const s=await Fc(i,n),l=(0,C.oC)({format:a.getFormat(),space_id:a.getSpaceId(),schema:a.getSchema()});d.createAndCommit({userAction:"appTemplateActions.upgradeSprintsDatabaseFromV1ToV2",environment:o,perform:e=>{ea.Rm({environment:o,collectionStore:a,update:Bc[Ps.p$](l,a.getFormat()),transaction:e}),s.forEach((t=>{const o=t.id,n=t.getFormat(),i=t.getQuery(l);r["notion://sprints/sprints_timeline_view"]===o?ea.iG({collectionViewStore:t,update:Bc["notion://sprints/sprints_timeline_view"](n,i),transaction:e}):r["notion://sprints/sprints_view"]===o&&ea.iG({collectionViewStore:t,update:Bc["notion://sprints/sprints_view"](n,i),transaction:e})}))}})}({environment:t,appParentStore:r,collectionViewBlockStore:s}),await async function(e){var t;const{environment:o,appParentStore:n,collectionViewBlockStore:i}=e,r=null===(t=i.getFormat())||void 0===t?void 0:t.app_uri_map;if(!r)return;const a=await Fc(i,n);d.createAndCommit({userAction:"appTemplateActions.upgradeTasksDatabaseSprintsFeatureFromV1ToV2",environment:o,perform:e=>{a.forEach((t=>{const o=t.id,n=t.getFormat();if(r[Ps.g3]===o){const o=Bc[Ps.g3](n);ea.iG({collectionViewStore:t,update:o,transaction:e})}else r[Ps.y$]===o&&ea.iG({collectionViewStore:t,update:Bc[Ps.y$](n),transaction:e})}))}})}({environment:t,appParentStore:r,collectionViewBlockStore:a}),n.setState({open:!1,stack:[]})}},{label:Ne.default.formatMessage(Ac.cancelUpgradeButton),onAccept:()=>{}}],showCancel:!1,keepFocus:!0}),!0)}async function Fc(e,t){return await Promise.all(e.getCollectionViewPointers().map((async e=>{const o=gt.Xr.createChildStore(t,e);return await o.load(),o})))}const Bc={[Ps.g3]:e=>({name:Ne.default.formatMessage(Pc.sY.tasksCurrentSprintV2ViewName),format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==Ps.Es.SprintStatusRollup)),Pc.Ws]}}),[Ps.y$]:e=>({format:{...e,property_filters:[...(e.property_filters??[]).filter((e=>e.filter.property!==Ps.Es.TaskToSprintRelation))],table_properties:[...(e.table_properties??[]).filter((e=>e.property!==Ps.Es.SprintStatusRollup)),{property:Ps.Es.SprintStatusRollup,visible:!1}]}}),[Ps.p$]:(e,t)=>({schema:{...e,[Ps.b0.UniqueId]:kc.eK(Ne.default.getIntl())[Ps.b0.UniqueId],[Ps.b0.TotalTasksRollup]:Pc.X$,[Ps.b0.CompletedTasksRollup]:Pc.sU,[Ps.b0.StatusV2]:kc.eK(Ne.default.getIntl())[Ps.b0.StatusV2]},format:{...t,app_uri_map:{...(null==t?void 0:t.app_uri_map)||{},[Ps.b0.UniqueId]:Ps.b0.UniqueId,[Ps.b0.TotalTasksRollup]:Ps.b0.TotalTasksRollup,[Ps.b0.CompletedTasksRollup]:Ps.b0.CompletedTasksRollup,[Ps.b0.StatusV2]:Ps.b0.StatusV2}}}),"notion://sprints/sprints_timeline_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==Ps.b0.Status)),{width:147,visible:!1,property:Ps.b0.Status},{width:147,visible:!0,property:Ps.b0.StatusV2}],timeline_table_properties:[...(e.timeline_table_properties??[]).filter((e=>e.property!==Ps.b0.Status)),{width:132,visible:!1,property:Ps.b0.Status},{width:132,visible:!0,property:Ps.b0.StatusV2}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:Ps.b0.StatusV2}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:Ps.b0.StatusV2,direction:"ascending"}]}}),"notion://sprints/sprints_view":(e,t)=>({format:{...e,table_properties:[...(e.table_properties??[]).filter((e=>e.property!==Ps.b0.Status)),{width:137,visible:!1,property:Ps.b0.Status},{width:137,visible:!0,property:Ps.b0.StatusV2},{width:75,visible:!0,property:Ps.b0.TotalTasksRollup}],collection_group_by:{sort:{type:"ascending"},type:"status",groupBy:"group",property:Ps.b0.StatusV2}},query2:{...t??{},sort:[...(null==t?void 0:t.sort)??[],{property:Ps.b0.StatusV2,direction:"ascending"}]}})};var Ic=o(90559),Zc=o(10070),Dc=o(87085);function Kc(e){var t,o;const{render:n,showDisabledTooltip:i,property:r,overrideCaption:a}=e;let s=r.description;if(a)s=a;else if(i){var l;s=null===(l=r.canOnlyAdminAuth)||void 0===l?void 0:l.disabledPropertyTooltipMessage}return(0,je.jsx)(Wa,{render:n,showImage:!i,caption:s,tooltipImage:null===(t=r.tooltipImage)||void 0===t?void 0:t.img,tooltipImageScale:null===(o=r.tooltipImage)||void 0===o?void 0:o.scale})}var Rc=o(54119),Nc=o(15560),Oc=o(45959),Ec=o(95477);var Lc=o(69834),Wc=o(32363);var Gc=o(33954),Hc=o(85644),zc=o(12205);const Uc=(0,a.defineMessages)({duplicateGithubPropertyTooltip:{defaultMessage:"A database can only have one GitHub Pull Requests property",id:"database.viewSettings.propertyTab.duplicateGithubProperty.tooltip"},wikiGithubPropertyTooltip:{defaultMessage:"A wiki cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.wikiGithubProperty.tooltip"},syncedDatabaseGithubPropertyTooltip:{defaultMessage:"A synced database cannot have a GitHub Pull Requests property",id:"database.viewSettings.propertyTab.syncedDatabaseGithubProperty.tooltip"},nonMeetingsCronPropertyTooltip:{defaultMessage:"The Cron Calendar property can only be added to a Meetings database",id:"database.viewSettings.propertyTab.nonMeetingsCronProperty.tooltip"},duplicateCronEventPropertyTooltip:{defaultMessage:"A database can only have one Cron Calendar event property",id:"database.viewSettings.propertyTab.duplicateCronEventProperty.tooltip"},newPill:{defaultMessage:"New",id:"database.viewSettings.newHighlightedFeature"}});function $c(e){let{collectionContextStore:t,propertySchema:o}=e;const i=(0,g.O7)(),r=(0,y.Fg)(),a=(0,m.VK)((()=>t.collectionStore()),[t]),s=(0,m.VK)((()=>{if(!a)return;return a.getParentBlockStore()}),[a]),l=(0,m.VK)((()=>It.Z.bots.state),[]),c=(0,m.VK)((()=>{var e;if(!a)return;const t=null===(e=a.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,Ya.YB)((0,Nl.appConfigs)(),t):void 0}),[a]),d=(0,m.VK)((()=>{if(!a||!s||!c)return;if(void 0!==o)return;return a.isDefined()?function(e,t,o){const n=t=>{var n,i;const r=null===(n=o.format)||void 0===n?void 0:n.app_config_uri,a=Zc.aQ.deriveTypeUris(o.schema??{},null===(i=o.format)||void 0===i?void 0:i.app_uri_map);if(t.collectionUri!==r)return!1;const s=_o.default.state.mainEditorCurrentBlockStore,l=s&&tc.Z.getMode(e,s),c=(0,ec.GD)(e,l);let d=!0;return t.uri===(0,Pc.GT)().uri&&a.has(Ps.Es.GithubPrsRelation)&&(d=!1),t.dependencies.some((e=>"property"===e.type&&e.collectionUri===r&&(0,Ps.jP)(e.uri)&&!a.has(e.uri)))&&(!t.isAi||c)&&d},i={};t.allFeatures.forEach((e=>{(0,Ya.FW)(e)&&e.variants.every((e=>Boolean(t.allFeatures.find((t=>t.uri===e&&(0,Ya.oX)(t)&&n(t))))))&&(i[e.uri]=e.variants)}));const r=Object.values(i).flat();return t.allFeatures.filter((e=>(0,Ya.oX)(e)&&!r.find((t=>t===e.uri))?n(e):!!(0,Ya.FW)(e)&&Boolean(i[e.uri]))).sort(((e,t)=>(0,Ya.FW)(e)?-1:(0,Ya.FW)(t)?1:e.dependencies.length-t.dependencies.length))}(i,c,{format:a.getFormat(),space_id:a.getSpaceId(),schema:a.getSchema()}):void 0}),[a,s,c,o,i]),u=(0,zc.J)();return{suggestedProperties:d,renderSuggestedProperty:n.useCallback((e=>{const o=e.integrationId,n=Boolean(l.find((e=>e.integration_id===o))),s=Boolean(e.canOnlyAdminAuth),d=(0,b.gi)(n,u,s,i.device.isMobile),p=(e,t,o,n)=>{const i=Zc.aQ.deriveTypeUris((null==a?void 0:a.getSchema())??{},null==a?void 0:a.getPropertyMapping()),s=o.dependencies.find((e=>{var t;return"property"===e.type&&e.collectionUri===(null==a||null===(t=a.getFormat())||void 0===t?void 0:t.app_config_uri)&&(0,Ps.jP)(e.uri)&&!i.has(e.uri)})),l=o.dependencies.find((e=>"property"===e.type&&(0,C.qQ)(e.propertySchema)&&(0,C.q3)(e.propertySchema)));if(s)return(0,je.jsx)(ye.Z,{...e,disabled:d,disabledFeedback:d,title:(0,je.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[t,l?(0,je.jsx)(Rc.Z,{}):null,o.isNew?"notion://projects/tasks_with_sprints_feature"===o.uri&&(0,je.jsx)(Nc.Z,{}):null]}),icon:(0,je.jsx)($e.ZP,{type:s.propertySchema.type,theme:r,icon:n,size:16,style:{fill:r.regularIconColor}})})};return{key:e.name,render:o=>(0,je.jsx)(Kc,{showDisabledTooltip:d,property:e,render:n=>{if((0,Ya.oX)(e))return p({...o,...n,onMouseEnter:e=>{var t,i;null===(t=n.onMouseEnter)||void 0===t||t.call(n,e),null===(i=o.onMouseEnter)||void 0===i||i.call(o,e)}},e.name,e,e.icon);{const r=He.oA(e.variants.map((e=>{const t=null==c?void 0:c.allFeatures.find((t=>t.uri===e));if(t&&(0,Ya.oX)(t))return t})));return(0,je.jsx)(Oc.Z,{items:r,getKey:e=>e.name,onSelect:async e=>{await Dc.G0({environment:i,feature:e,collectionContextStore:t})},selectedItem:void 0,renderOrigin:t=>p({...o,...n,...t,onMouseEnter:e=>{var t,i;null===(t=n.onMouseEnter)||void 0===t||t.call(n,e),null===(i=o.onMouseEnter)||void 0===i||i.call(o,e)}},e.name,r[0],e.icon),renderItem:e=>(0,je.jsx)(ye.Z,{...e,title:e.value.name,shouldWrapCaption:!0,shouldWrapTitle:!0})})}}}),action:async()=>{await Dc.G0({environment:i,feature:e,collectionContextStore:t})}}}),[l,u,i,a,r,null==c?void 0:c.allFeatures,t])}}function qc(e){let{collectionContextStore:t,propertyTypes:o,onAccept:i,propertySchema:r}=e;const a=(0,y.Fg)(),s=(0,m.VK)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getSchema()}),[t]),l=(0,m.VK)((()=>t.collectionViewBlockStore()),[t]),c=n.useCallback((()=>{if(!(0,Hc.iL)()||null==l||!l.isCollectionViewPageWithContent()||r&&"verification"!==r.type)return!1;for(const e in s){const t=s[e];if("verification"===(null==t?void 0:t.type))return!1;if((0,b.Kp)(t))return!1}return!0}),[r,s,l]),d=n.useCallback((()=>{for(const t in s){var e;const o=s[t];if("text"===(null==o?void 0:o.type)&&"summarize"===(null===(e=o.ai_inference)||void 0===e?void 0:e.type))return!1}return!0}),[s]);return{standardAndDerivedPropertyTypes:(0,m.VK)((()=>o.filter((e=>"button"===e?(0,io.PN)():"auto_increment_id"===e?br.default.checkGate("unique_id"):"verification"===e?c():"ai_summary"===e?d():"ai_translate"!==e||(0,ec.hu)()))),[o,c,d]),renderStandardOrDerivedProperty:n.useCallback(((e,o)=>({key:e,render:n=>{const i=(null==r?void 0:r.type)===e,s=function(e,t,o){if("auto_increment_id"===t){var n;const t=e.collectionStore(),i=null==t?void 0:t.isPageTreeCollection(),r=Boolean(null==t?void 0:t.isSyncedCollection());if(i)return Ne.default.formatMessage(Gc.zU.wiki_forbidden_auto_increment_id_property);if(r)return Ne.default.formatMessage(Gc.zU.synced_database_forbidden_auto_increment_id_property);if(null!=o&&o.type)return Ne.default.formatMessage(Gc.zU.convert_to_auto_increment_id_property);const a=t&&t.getFormat(),s=t&&(null===(n=t.getSpaceStore())||void 0===n?void 0:n.id),l=t&&t.getSchema(),c=t&&t.getDeletedSchema();if(!(a&&s&&l&&c))return;if(t&&(0,Ic.cj)({format:a,space_id:s,schema:l,deleted_schema:c}))return Ne.default.formatMessage(Gc.zU.duplicate_auto_increment_id_property)}}(t,e,r),l=void 0!==s,c=(0,je.jsx)(ye.Z,{...n,checkState:i,title:(0,je.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[o??ro.SO[e],!1]}),icon:(0,je.jsx)($e.ZP,{type:e,icon:void 0,size:16,theme:a,style:{fill:(0,C.XU)(e)?a.aiPurpleColor:a.regularIconColor}}),disabled:l,disabledFeedback:l});return s?(0,je.jsx)(ae.Z,{placement:ae.Z.Placement.Left,render:e=>(0,je.jsx)("div",{...e,children:c}),renderTooltip:()=>s,style:{whiteSpace:"break-spaces"}}):c},action:()=>{i(e,o)}})),[r,t,a,i])}}const Qc=new Set([vo.Nw]);function Yc(e,t){const o=(0,g.O7)(),i=(0,a.useIntl)(),r=(0,m.VK)((()=>It.Z.bots.state),[]),s=(0,m.VK)((()=>e.collectionStore()),[e]),l=(0,m.VK)((()=>null==s?void 0:s.getSchema()),[s]),c=(0,m.VK)((()=>null==s?void 0:s.isPageTreeCollection()),[s]),d=(0,m.VK)((()=>e.databaseType),[e]),u=(0,m.VK)((()=>{if(void 0===t)return function(e){if(!e)return[];const t=br.default.checkGate("google_drive_connected_relation"),o=br.default.checkGate("figma_connected_relation"),n=br.default.checkGate("zendesk_connected_relation"),i=br.default.checkGate("connected_relation"),r=e.getDatabaseType()===Ps.iS,a=It.Z.state;if(!a.loaded)return[];const s=a.integrations,l={};if(!r){const e=s.find((e=>e.id===vo.U9)),t=(0,Pc.GT)();var c;e&&(l[t.name]={name:t.name,pattern:Lc.x,integration:e,tooltipImage:{img:xo.Z.images.tooltips.properties.githubSyncPullStatusPng,scale:.5},description:t.description,canOnlyAdminAuth:{disabledPropertyTooltipMessage:null===(c=t.canOnlyAdminAuth)||void 0===c?void 0:c.disabledPropertyTooltipMessage}})}const d=[];if(t&&d.push(vo.f3),o&&d.push(vo.mQ),n&&d.push(vo.Nw),d.forEach((e=>{const t=s.find((t=>t.id===e));if(null!=t&&t.info.original_url_patterns)for(const n of t.info.original_url_patterns){var o;null!==(o=n.additional_types)&&void 0!==o&&o.connectedRelation&&(l[n.name]||(l[n.name]={name:(0,Wc.ni)({pattern:n,integration:t}),pattern:n,integration:t}))}})),!i)return Object.values(l);for(const p of s)if(p.info.original_url_patterns&&![vo.U9,vo.f3,vo.mQ].includes(p.id))for(const e of p.info.original_url_patterns){var u;null!==(u=e.additional_types)&&void 0!==u&&u.connectedRelation&&(l[e.name]||(l[e.name]={name:(0,Wc.ni)({pattern:e,integration:p}),pattern:e,integration:p}))}return Object.values(l)}(s)}),[s,t]),p=(0,m.VK)((()=>Boolean(null==s?void 0:s.isSyncedCollection())),[s]),y=(0,zc.J)();return{connectedRelationProperties:u,renderConnectedRelationProperty:n.useCallback((t=>{const n=t.integration.id,a=Boolean(r.find((e=>e.integration_id===n))),s=Boolean(t.canOnlyAdminAuth),u=Boolean(l&&(0,oe.qP)(l).find((e=>{let[t,o]=e;return o&&(0,b.Kp)(o)}))),g=Boolean(l&&(0,oe.qP)(l).find((e=>{let[t,o]=e;return o&&(0,b.A0)(o)}))),m=t.integration.id===vo.U9&&u||c||p;let h;m&&(u?h=i.formatMessage(Uc.duplicateGithubPropertyTooltip):c?h=i.formatMessage(Uc.wikiGithubPropertyTooltip):p&&(h=i.formatMessage(Uc.syncedDatabaseGithubPropertyTooltip)));const S=d===Ps.Fi,f=t.integration.id===vo.Dv&&(!S||g);f&&(S?g&&(h=i.formatMessage(Uc.duplicateCronEventPropertyTooltip)):h=i.formatMessage(Uc.nonMeetingsCronPropertyTooltip));const x=(0,b.gi)(a,y,s,o.device.isMobile)||m||f;return{key:t.name,render:e=>(0,je.jsx)(Kc,{showDisabledTooltip:x,property:t,overrideCaption:h,render:o=>(0,je.jsx)(ye.Z,{...e,...o,checkState:!1,title:(0,je.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[t.name,Qc.has(t.integration.id)?(0,je.jsx)(Pl.Z,{}):null]}),icon:(0,je.jsx)("img",{src:t.integration.info.icon,alt:t.name,style:{width:16,height:16}}),disabled:x,disabledFeedback:x})}),action:async()=>{await Dc.Jw({environment:o,connectedRelationProperty:t,collectionContextStore:e,intl:i})}}}),[r,e,d,o,i,y,p,c,l])}}const Xc=(0,a.defineMessages)({searchPlaceholder:{defaultMessage:"Search or add new property",id:"database.viewSettings.propertyTypeSelect.searchPlaceholder"},suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.viewSettings.propertyTypeSection.suggested"},connectedRelationSectionTitle:{defaultMessage:"Connections",id:"database.viewSettings.propertyTypeSection.connected"},typesSectionTitle:{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"},newProperty:{defaultMessage:"New property",id:"database.viewSettings.newProperty"},newPropertyWithDatabaseName:{defaultMessage:"New property on {databaseName}",id:"database.viewSettings.newPropertyOnDatabase"},selectToAddNewProperty:{defaultMessage:"Select to add",id:"database.viewSettings.selectToAdd"}});function Jc(e){window.__c={n:"CollectionSettingsPropertyType"};const t=(0,g.Fy)(),[o,i]=n.useState(""),{collectionContextStore:r,propertyTypes:a,onAccept:s,propertySchema:l}=e,c=(0,g.O7)(),d=(0,m.VK)((()=>{var e;return null==r||null===(e=r.collectionStore())||void 0===e||null===(e=e.getName())||void 0===e?void 0:e.toString()}),[r]),{connectedRelationProperties:u,renderConnectedRelationProperty:y}=Yc(e.collectionContextStore,e.propertySchema),{standardAndDerivedPropertyTypes:h,renderStandardOrDerivedProperty:S}=qc({collectionContextStore:r,propertyTypes:a,onAccept:s,propertySchema:l}),{suggestedProperties:f,renderSuggestedProperty:x}=$c({collectionContextStore:e.collectionContextStore,propertySchema:e.propertySchema}),{derivedPropertyTypesInSuggestedSection:v}=(0,n.useMemo)((()=>{const e=new Set;for(const t of h)(0,C.XU)(t)&&"suggested"===(0,ro.to)(t)&&e.add(t);return{derivedPropertyTypesInSuggestedSection:e}}),[h]);n.useEffect((()=>{!async function(){const e=await async function(e,t){if(!(0,Ya.Ru)()||!t.permissionScopes.state.canConfigureCollection)return!1;const o=t.collectionStore(),n=t.collectionViewBlockStore();if(!n)return!1;const i=n.getFormat();if((null==i?void 0:i.app_config_uri)===Ps.TZ){var r;const t=await Rl.JN({environment:e,collectionViewBlockStore:n,databaseUri:Ps.p$});if(!t)return!1;const o=null==t?void 0:t.getCollectionStore();return Boolean(!(null!=o&&null!==(r=o.getPropertyMapping())&&void 0!==r&&r[Ps.b0.StatusV2]))}var a;return(null==i?void 0:i.app_config_uri)===Ps.pz&&Boolean(!(null!=o&&null!==(a=o.getPropertyMapping())&&void 0!==a&&a[Ps.b0.StatusV2]))}(c,r);w(e)}()}),[r,c]);const[b,w]=(0,n.useState)(!1),j=n.useCallback((async()=>{await Vc({environment:c,collectionViewBlockStore:r.collectionViewBlockStore(),collectionSettingsStore:e.collectionSettingsStore})}),[r,c,e.collectionSettingsStore]),M=(0,n.useMemo)((()=>new Map(h.map((e=>[ro.SO[e],e])))),[h]);let _=[];if(""!==o){const e=(null==f?void 0:f.reduce(((e,t)=>(e[t.name]=x(t),e)),{}))||{};for(const o of v)e[ro.SO[o]]=S(o);const t=(null==u?void 0:u.reduce(((e,t)=>(y&&(e[t.name]=y(t)),e)),{}))||{},n=p().filter(o,Object.keys(e)).flatMap((t=>e[t.original])),i=p().filter(o,Array.from(M.keys())).flatMap((e=>{const t=M.get(e.original);return!t||v.has(t)?[]:S(t)})),r=p().filter(o,Object.keys(t)).flatMap((e=>t[e.original]));n.length&&_.push({key:"suggested",render:e=>(0,je.jsx)(Ce.Z,{...e,title:Ne.default.formatMessage(Xc.suggestedSectionTitle)}),items:n}),i.length&&_.push({key:"search",render:e=>(0,je.jsx)(Ce.Z,{title:Ne.default.formatMessage(Xc.typesSectionTitle),...e}),items:i}),r.length&&_.push({key:"connected",render:e=>(0,je.jsx)(Ce.Z,{...e,title:Ne.default.formatMessage(Xc.connectedRelationSectionTitle)}),items:r}),0===n.length&&0===i.length&&_.push({key:"custom",render:e=>(0,je.jsx)(Ce.Z,{...e,title:Ne.default.formatMessage(Xc.selectToAddNewProperty)}),items:[S("text",o)]})}else{const e=(null==f?void 0:f.map((e=>x(e))))??[];for(const n of v)e.push(S(n));const t=h.map((e=>v.has(e)?void 0:S(e))).filter(oe.$K),o=(null==u?void 0:u.map((e=>y&&y(e))).filter(oe.$K))??[];_=He.oA([e.length&&{key:"suggested",render:e=>(0,je.jsx)(Ce.Z,{...e,title:Ne.default.formatMessage(Xc.suggestedSectionTitle)}),items:e},t.length&&{key:"properties",render:e=>(0,je.jsx)(Ce.Z,{...e,title:Ne.default.formatMessage(Xc.typesSectionTitle)}),items:t},o.length&&{key:"connected",render:e=>(0,je.jsx)(Ce.Z,{...e,title:Ne.default.formatMessage(Xc.connectedRelationSectionTitle)}),items:o}])}const T=(0,je.jsx)(Ce.Z,{desktopStyle:{paddingTop:12,paddingBottom:4},children:(0,je.jsx)(no.ZP,{focusInitial:!t.isMobile||void 0,focus:!t.isMobile||void 0,value:o,onChange:e=>{i(e.target.value)},placeholder:Ne.default.formatMessage(Xc.searchPlaceholder)})});return(0,je.jsxs)(Jo.ZP,{...e,title:t.isDesktop&&d?Ne.default.formatMessage(Xc.newPropertyWithDatabaseName,{databaseName:d}):Ne.default.formatMessage(Xc.newProperty),children:[T,b&&(0,je.jsxs)(me.Z,{style:{border:"1px solid #b3d4fc",borderRadius:5,margin:"3px 11px",padding:7,fontSize:14,color:"rgba(35, 131, 226, 1)",boxShadow:"2px 2px 3px 0px #b3d4fc",cursor:"pointer",marginTop:10},onClick:j,children:["🏃 New Sprints 💨",(0,je.jsx)("div",{style:{fontSize:11},children:"Upgrade V1 to V2!!!"})]}),(0,je.jsx)(xe.Z,{disableInitialScroll:!0,type:xe.i.Vertical,initialFocus:0,sections:_})]})}var ed=o(34296);class td extends i.Z{constructor(){super(...arguments),this.searchSessionId="",this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,property:n,formatKey:i}=this.props;if(!t.collectionStore())return;Ot.wd({environment:this.environment,collectionContextStore:t,action:"select_relation_source"});const{stack:r}=o.state,a=r[r.length-2];a&&"setupRelation"===a.type&&l.z$({collectionSettingsStore:o}),l.FK({collectionSettingsStore:o,item:{type:"setupRelation",property:n,formatKey:i,targetCollectionPointer:e.pointer}})}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=e.collectionViewBlockStore();if(!o)return;const n=Dt.default.createValue("");return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.selectNewRelationSourceTab.title"}),handleClose:()=>{Ot.tW({environment:this.environment,eventName:"abandoned_search",queryLength:n.state.length,sessionId:this.searchSessionId,source:ed.S.Relation}),l.E3({collectionSettingsStore:t})},children:(0,je.jsx)(Et.Z,{collectionContextStore:e,onAccept:this.handleSourcePickerAccept,parentStore:o,context:ed.S.Relation,searchSessionId:this.searchSessionId,inputStore:n})})}willMount(){this.searchSessionId=(0,r.ZP)()}}td.displayName="CollectionSettingsSelectRelationSource";const od=(0,a.injectIntl)(td);function nd(e){window.__c={n:"CollectionSettingsSetDBType"};const t=(0,g.O7)().device.isMobile,{collectionContextStore:o,collectionSettingsStore:i}=e,r=(0,m.VK)((()=>o.collectionStore()),[o]),s=(0,m.VK)((()=>{const e=null==r?void 0:r.getDatabaseType(),t=Ps.wC[Ps.TM].find((t=>t===e));return t||Ps.br}),[r]),[c,d]=(0,n.useState)(s),u=(0,m.VK)((()=>o.permissionScopes.state),[o]),p=(0,y.yK)((e=>({databaseTypeButton:{display:"flex",flexDirection:"column",alignItems:"center",width:"calc(33% - 12px)",flexGrow:0,flexShrink:0,fontSize:11,borderRadius:3,margin:6,padding:6,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,fill:e.mediumTextColor},selectedType:{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor,fill:e.blueColor,fontWeight:500},databaseTypeIcon:{width:void 0,height:20,marginBottom:4,marginTop:4},continueButton:{display:"flex",margin:"14px",height:32},typeBenefits:{fontSize:12,color:e.mediumTextColor},databaseTypesContainer:{background:t?e.contentBackground:void 0,width:"100%",paddingTop:t?12:void 0,paddingBottom:t?12:void 0,paddingLeft:t?void 0:8,paddingRight:t?void 0:8}})),[t]),h=()=>{const e=Ps.LI[c].migrationBenefits;return 0===e.length?null:(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{topBorder:!1,shouldShowBottomDivider:t,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"What you get...",id:"database.viewSettings.databaseTypeSelectionTab.benefitsTitle"}),children:(0,je.jsx)("div",{style:{marginLeft:14,marginTop:15},children:e.map(((e,t)=>(0,je.jsxs)("div",{style:{display:"flex",paddingBottom:15},children:[(0,je.jsx)("div",{style:{paddingRight:8},children:e.icon({width:14})}),(0,je.jsx)("span",{style:p.typeBenefits,children:(0,je.jsx)(a.FormattedMessage,{...e.message})})]},t)))})}),s!==Ps.br&&(0,je.jsx)(Ce.Z,{topBorder:!0,children:(0,je.jsx)(en.Z,{isGray:!0,icon:pe.y,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Remove {type} database",id:"database.viewSettings.databaseTypeSelectionTab.removeTypeDatabase",values:{type:(0,Fs.Mn)(s)}}),onClick:()=>{}})})]})},S=e=>{const t=c===e,o=t||!u.canConfigureBlock;return(0,je.jsxs)(me.Z,{style:{...p.databaseTypeButton,...t&&p.selectedType},disabled:o,onClick:()=>{(e=>{d(e)})(e)},children:[(0,Ps.T)(e)(p.databaseTypeIcon),(0,Fs.Mn)(e)]})};return(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Database type",id:"database.viewSettings.databaseTypeSelectionTab.title"}),children:[s!==Ps.br&&(0,je.jsx)(Ce.Z,{topBorder:!1,shouldShowBottomDivider:t,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Current database type",id:"database.viewSettings.databaseTypeSelectionTab.currentTypeTitle"}),style:{paddingBottom:15},children:(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingLeft:20},children:[(0,je.jsx)("div",{children:(0,Ps.T)(s)({width:13,height:13,marginRight:8})}),(0,je.jsx)("span",{style:{fontSize:14},children:(0,Fs.Mn)(s)})]})}),s!==Ps.br?h():(()=>{const e=Ps.Cr[Ps.TM];return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{topBorder:!1,shouldShowBottomDivider:t,children:(0,je.jsx)("div",{style:p.databaseTypesContainer,children:(0,je.jsx)("div",{style:{display:"flex",flexFlow:"wrap",justifyContent:"center"},children:e.map(S)})})}),h(),c!==Ps.br&&(0,je.jsx)(jo.Z,{style:p.continueButton,onClick:()=>{l.H4({collectionSettingsStore:i,item:{type:"databaseTypePropertyMapping",databaseType:c}})},children:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Continue",id:"database.viewSettings.databaseTypeSelectionTab.continue"})}),(0,je.jsx)(Ce.Z,{topBorder:!1,children:(0,je.jsx)(cl.Z,{href:(0,al.UY)("guides.databaseType"),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Learn about {type} databases",id:"database.viewSettings.databaseTypeSelectionTab.learnMoreButton.title",values:{type:c===Ps.br?"typed":(0,Fs.Mn)(c)}}),analyticsFrom:"set_database_type"})})]})})()]})}var id=o(16257),rd=o(79892);function ad(e){window.__c={n:"CollectionSettingsSetupRelation"};const{collectionContextStore:t,collectionSettingsStore:o,property:i,formatKey:r,targetCollectionPointer:s,from:u}=e,p=(0,m.VK)((()=>t.collectionStore()),[t]),y=(0,m.VK)((()=>{const e=t.collectionViewBlockStore();return function(e){const{targetCollectionPointer:t,collectionStore:o,collectionViewBlockStore:n}=e;if(!t)return;if(o&&o.pointer===t)return o;return n?gt.NW.createChildStore(n,t):void 0}({targetCollectionPointer:s,collectionStore:p,collectionViewBlockStore:e})}),[t,p,s]),h=(0,m.VK)((()=>i?Cr.KV(t,i):void 0),[t,i]),S=Boolean(p&&y&&p.id===y.id),f=Boolean("relation"===(null==h?void 0:h.type)&&h.connectedRelation),x=Boolean("subitem"===u),v=Boolean("timeline_arrows_by"===u),C=(0,m.VK)((()=>t.contextType),[t]),b=(0,g.O7)(),w=(0,a.useIntl)(),j=(0,m.VK)((()=>{const e=null==p?void 0:p.getSchema();return void 0===(null==h?void 0:h.name)&&y&&e?Cr.m8(w,{targetCollectionStore:y,isSelfRelation:S,sourceSchema:e,createUnique:!0,from:u}):(null==h?void 0:h.name)||""}),[p,null==h?void 0:h.name,y,w,S,u]),[M,_]=(0,n.useState)(j),[T,k]=(0,n.useState)("no_limit"),[P,A]=(0,n.useState)(x||v?{hasInverseRelation:!0,inverseName:void 0,autoRelate:{enabled:!1}}:{hasInverseRelation:!1,inverseName:void 0,autoRelate:{enabled:!1}}),V=M===j,F=(0,n.useCallback)((()=>{l.H4({collectionSettingsStore:o,item:{type:"selectRelationSource",property:i,formatKey:r}})}),[o,i,r]),B=(0,n.useCallback)((()=>{if(!P)return;const{hasInverseRelation:e,inverseName:n,autoRelate:a}=P,s=t.collectionStore(),p=t.collectionViewStore();if(!s||!y)return;const{performResult:g}=d.createAndCommit({userAction:"CollectionSettingsSetupRelation.handleAddRelation",environment:b,perform:o=>{const l=i??Jr.G3({environment:b,collectionStore:s,collectionViewArgs:p&&r?{collectionViewStore:p,format:p.getFormat(),formatKey:r}:void 0,propertyType:"relation",transaction:o});if(ma.n7({environment:b,collectionContextStore:t,collectionStore:s,property:l,propertyName:M,targetCollectionStore:y,hasInverseRelation:e,inverseName:n,autoRelate:a,propertyLimit:T,intl:w,transaction:o,from:u}),p){var d;const e=(null===(d=p.getFormat().table_properties)||void 0===d?void 0:d.find((e=>e.property===l)))??{property:l,visible:!0};c.FH({stores:[p],update:{table_properties:[...p.getFormat().table_properties??[],e]},transaction:o})}return"subitem"===u&&p?(ha.dR({collectionViewStore:p,propertyId:l,transaction:o}),ha.jA({collectionContextStore:t,relationPropertyId:l,transaction:o})):"timeline_arrows_by"===u&&p&&(ya.tF({collectionViewStore:p,newProperty:l,transaction:o}),ya._p({collectionContextStore:t,relationPropertyId:l,transaction:o})),l}});"subitem"===u||"timeline_arrows_by"===u?(l.z$({collectionSettingsStore:o}),l.H4({collectionSettingsStore:o,item:{type:"main"}})):l.qU({collectionSettingsStore:o,property:g,formatKey:r}),Ot._H({environment:b,collectionContextStore:t,from:"collectionPage"===C?"page_properties":"view_settings",property_type:"relation"})}),[P,t,y,b,o,i,r,C,M,T,w,u]);return(0,je.jsxs)(Jo.ZP,{...e,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"New relation",id:"database.viewSettings.setupRelationTab.title"}),children:[(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(no.ZP,{value:M||"",placeholder:"Property name",onChange:e=>_(e.target.value),onBlur:()=>{},onSubmit:()=>{},focusInitial:!0,selectAll:!1})}),(0,je.jsx)(rd.Z,{isSelfRelation:S,collectionStore:y,showAs:"chevron",onClick:F,disabled:x}),!u&&(0,je.jsx)(id.U,{selectedKey:T,propertyType:"relation",onChange:e=>k(e)}),y&&!f&&(0,je.jsx)(Xa.Z,{collectionContextStore:t,targetCollectionStore:y,property:i,propertyName:M,buttonContents:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Add relation",id:"database.viewSettings.setupRelationTab.addButton.title"}),temporaryInverseState:P,setTemporaryInverseState:A,isInitialPropertyName:V,onSubmit:B,from:u}),(0,je.jsx)(Ce.Z,{children:(0,je.jsx)(cl.Z,{href:(0,al.UY)("guides.relations"),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})]})}var sd=o(27006),ld=o(63143),cd=o(76464),dd=o(13627),ud=o(29551),pd=o(46978);class gd extends i.Z{constructor(){super(...arguments),this.storeTypes={restrictedStore:Dt.default.createClass(!1)},this.handleContinue=()=>{const e=this.stores.restrictedStore.state,{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore(),n=t.settingsStore;o&&(e&&this.restrictAccessToSyncedContent({environment:this.environment,store:o}),s.KIh(this.environment,{type:e?"restrict":"share"}),l.E3({collectionSettingsStore:n}))}}renderComponent(){const{collectionSettingsStore:e,collectionContextStore:t,integrationName:o,integrationIcon:n}=this.props,{restrictedStore:i}=this.stores,r=t.collectionViewBlockStore();if(!r)return;const s=this.createComputedStore((()=>{const e=oc.default.state.data?dd.CM(oc.default.state.data):[],t=(0,ld.m8)(He.oA(e.map((e=>[e.userId,e.role])))),o=(0,Bt.YO)(r).map((e=>e.permissionItem));let n=!1,i=!1;for(const r of o)sd.$D(r)?n=!0:sd.ix(r)&&!sd.Wi(r.role)&&(i=!0);const a=He.jj(He.oA([...o.map((e=>"user_permission"===e.type?e.user_id:void 0)),...i?Object.keys(t):[]])),s=a.filter((e=>"none"!==t[e])).length,l=a.filter((e=>{const n=t[e],i=Boolean(o.filter(sd.jg).find((t=>t.user_id===e)));return Boolean(n&&i&&!sd.YX(n))})).length;return{numberOfGuests:l,numberOfUsers:s+l,isPublic:n}})),{numberOfGuests:c,numberOfUsers:d,isPublic:u}=s.state;if(!u&&1===d)return void l.E3({collectionSettingsStore:e});const p=(0,je.jsx)("div",{style:this.getPromptTitleStyle(),children:(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.header",defaultMessage:"Share synced content with"})}),g=(0,je.jsxs)(je.Fragment,{children:[0!==c?(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithGuests",defaultMessage:"{numberOfUsers} people (including you {numberOfGuests, plural, one {and {numberOfGuests} guest} other {and {numberOfGuests} guests}})",values:{numberOfUsers:d,numberOfGuests:c}})," "]}):(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.usersWithoutGuests",defaultMessage:"{numberOfUsers} people (including you)",values:{numberOfUsers:d}})," "]}),u&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.sharedWithPublic",defaultMessage:"and those with the link"})," "]}),(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.caption.accessToIntegration",defaultMessage:"will get access to content synced from {integrationName}",values:{integrationName:o}})]}),m=(0,je.jsx)(ud.gq,{style:{marginTop:10},children:(0,je.jsx)(jo.Z,{style:{flex:"0 0 100%"},isLarge:!0,onClick:this.handleContinue,children:(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.continueButton",defaultMessage:"Continue"})})}),y=(0,je.jsx)(ud.gq,{style:{paddingBottom:24},alignItems:"center",justifyContent:"center",children:(0,je.jsx)("img",{style:{width:40},src:n})}),h=(0,je.jsx)(xe.Z,{type:xe.i.Vertical,initialFocus:void 0,sections:[{key:"grant_permissions",items:[{key:"allow",action:()=>null,render:e=>(0,je.jsx)(ye.Z,{...e,textWrapperStyle:{textAlign:"left"},title:(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.share.title",defaultMessage:"Anyone on this page"}),shouldWrapCaption:!0,caption:g,icon:(0,je.jsx)(pd.Z,{isSelected:!i.state}),onClick:()=>{i.setState(!1)}})},{key:"restrict",action:()=>null,render:e=>(0,je.jsx)(ye.Z,{...e,textWrapperStyle:{textAlign:"left"},title:(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.title",defaultMessage:"Only you"}),shouldWrapCaption:!0,caption:(0,je.jsx)(a.FormattedMessage,{id:"CollectionSettingsSyncedContentShare.option.restrict.caption",defaultMessage:"You'll need to share with others using the share menu"}),icon:(0,je.jsx)(pd.Z,{isSelected:i.state}),onClick:()=>{i.setState(!0)}})}],render:e=>(0,je.jsx)(Ce.Z,{...e})}]});return(0,je.jsx)(Jo.ZP,{...this.props,children:(0,je.jsxs)(ud.gq,{style:this.getInnerContainerStyle(),flexDirection:"column",children:[y,(0,je.jsxs)("div",{children:[p,h]}),m]})})}restrictAccessToSyncedContent(e){const{environment:t,store:o}=e,n=t.currentUser.id;n&&d.createAndCommit({userAction:"CollectionSettingsSyncedContentShare.restrictAccessToSyncedContent",environment:t,perform:e=>{cd.Pk({environment:t,store:o,shouldInherit:!1,transaction:e,permissionItem:{type:"user_permission",user_id:n,role:"editor"}})}})}getInnerContainerStyle(){return{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"0px 16px 16px 16px"}}getPromptTitleStyle(){return{color:this.theme.regularTextColor,fontWeight:ne.Z.fontWeight.semibold,fontSize:14}}}gd.displayName="CollectionSettingsSyncedContentShare";const md=(0,a.injectIntl)(gd);var yd=o(21197),hd=o(40778);const Sd=(0,a.defineMessages)({inputPlaceholder:{defaultMessage:"Filter by…",id:"database.viewSettings.createFilterTab.inputPlaceholder"}});class fd extends i.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{if(!e)return;const{collectionContextStore:t}=this.props,o=t.collectionViewStore(),n=this.suggestedFilters.state.find((t=>t.property===e));if(!n||!o)return;const i={id:(0,r.ZP)(),filter:n};hd.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...this.getPropertyFilters(),i]}}}),this.acceptAndOpenPropertyFilter(i)},this.handleCombinatorFilterClick=()=>{const{collectionContextStore:e}=this.props;if(!e.collectionViewStore())return;this.getCombinatorFilter()||hd.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.state,combinatorFilter:{value:v.TI}}}),this.acceptAndOpenCombinatorFilter()},this.suggestedFilters=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=e.collectionViewStore();if(!o)return[];return(0,yi.qd)({schema:t,filters:this.getPropertyFilters(),getRecordModel:o.getRecordModel})}),!0)}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=this.suggestedFilters.state,n=this.getCombinatorFilter(),i=t.permissionScopes.state;return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.createFilterTab.title"}),footer:i.canConfigureBlock&&(0,je.jsx)(Ce.Z,{topBorder:!0,children:(0,je.jsx)(en.Z,{icon:n?yd.Q:V.R,isGray:!0,title:n?(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Advanced filter",id:"database.viewSettings.createFilterTab.advancedFilter.title"}):(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Add advanced filter",id:"database.viewSettings.createFilterTab.addAdvancedFilter.title"}),right:n&&(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.viewSettings.createFilterTab.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=n.filters)||void 0===e?void 0:e.length)||1}}),onClick:this.handleCombinatorFilterClick})}),children:(0,je.jsx)(oa.Z,{schema:t.normalizedSchemaStore.state,format:t.normalizedFormatStore.state,getProperties:()=>o.map((e=>e.property)),onAccept:this.handlePropertyAccept,inputPlaceholder:Ne.default.formatMessage(Sd.inputPlaceholder)})})}acceptAndOpenPropertyFilter(e){const{collectionContextStore:t,context:o}=this.props;if(Ot.wd({environment:this.environment,collectionContextStore:t,action:"create_property_filter"}),o===Ui.HV.FilterBar||o===Ui.HV.TopbarFilterPopup){this.closeMenuAndOpenFilterBar();const o=t.getFilterBarItemSettingsStore(e);l.wl({collectionSettingsStore:o,item:{type:"filter"}})}else if(o===Ui.HV.ViewSettings){this.navigateToMainThenFilters();const o=t.getFilterOptionsItemSettingsStore(e);l.wl({collectionSettingsStore:o,item:{type:"filter"}})}}acceptAndOpenCombinatorFilter(){const{collectionContextStore:e,context:t}=this.props;Ot.wd({environment:this.environment,collectionContextStore:e,action:"create_combinator_filter"}),t===Ui.HV.FilterBar||t===Ui.HV.TopbarFilterPopup?(this.closeMenuAndOpenFilterBar(),l.wl({collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,item:{type:"filter"}})):t===Ui.HV.ViewSettings&&(this.navigateToMainThenFilters(),l.wl({collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState,item:{type:"filter"}}))}closeMenuAndOpenFilterBar(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props;e.filtersBarOpen.setState(!0),l.z$({collectionSettingsStore:t})}navigateToMainThenFilters(){const{collectionSettingsStore:e}=this.props;l.wl({collectionSettingsStore:e,item:{type:"main"}}),l.H4({collectionSettingsStore:e,item:{type:"filters"}})}getPropertyFilters(){const{collectionContextStore:e}=this.props;return e.currentPropertyFiltersStore.state}getCombinatorFilter(){const{collectionContextStore:e}=this.props;return e.currentCombinatorFilterStore.state}}fd.displayName="CollectionSettingsViewCreateFilter";const xd=(0,a.injectIntl)(fd),vd=(0,a.defineMessages)({inputPlaceholder:{defaultMessage:"Sort by…",id:"database.viewSettings.createSortTab.inputPlaceholder"}});class Cd extends i.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{var t;if(!e)return;const{collectionContextStore:o,context:n,collectionSettingsStore:i}=this.props,r=o.collectionViewStore(),a=o.normalizedSchemaStore.state;if(!r||!a)return;const s=null===(t=a[e])||void 0===t?void 0:t.type;Ot.wd({environment:this.environment,collectionContextStore:o,action:"create_sort_accept",original_view_type:r.getType(),property_type:s});const c={property:e,direction:"ascending"},d=[...this.getSorts(),c];if(hd.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:d}}}),n===Ui.HV.TopbarSortPopup||n===Ui.HV.FilterBar){o.filtersBarOpen.setState(!0),l.z$({collectionSettingsStore:i});const{filterBarSortSettingsStore:e}=o;l.wl({collectionSettingsStore:e,item:{type:"sort"}})}else n===Ui.HV.ViewSettings&&(l.wl({collectionSettingsStore:i,item:{type:"main"}}),l.H4({collectionSettingsStore:i,item:{type:"sort"}}))}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state,o=this.getSorts();return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"New sort",id:"database.viewSettings.createSortTab.title"}),children:(0,je.jsx)(oa.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,getProperties:()=>Object.keys(t).filter((e=>!o.find((t=>t.property===e)))),onAccept:this.handlePropertyAccept,inputPlaceholder:Ne.default.formatMessage(vd.inputPlaceholder)})})}getSorts(){const{collectionContextStore:e}=this.props;return e.currentSortsStore.state}}Cd.displayName="CollectionSettingsViewCreateSort";const bd=(0,a.injectIntl)(Cd);var wd=o(18245),jd=o(88426),Md=o(8982);class _d extends i.Z{constructor(){super(...arguments),this.handleFilterChange=(e,t)=>{var o;const{collectionContextStore:n}=this.props,i=null===(o=n.remoteResult.state)||void 0===o?void 0:o.sizeHint,r=wd.default.mark("collections.update_filter_lag");wd.default.measureAfterNextFlush(r,{environment:this.environment,getData:()=>hs.Y5({from:"combinator_filter",collectionContextStore:n,sizeHintAtStart:i})}),hd.iU({environment:this.environment,collectionContextStore:n,temporaryState:{...n.temporaryState.state,combinatorFilter:{value:t}}}),Ot.wd({environment:this.environment,collectionContextStore:n,action:"update_combinator_filter"})},this.handleRemoveClick=()=>{const{collectionContextStore:e,context:t,collectionSettingsStore:o}=this.props;hd.iU({environment:this.environment,collectionContextStore:e,temporaryState:{...e.temporaryState.state,combinatorFilter:{value:void 0}}}),t===Ui.HV.FilterBar&&l.E3({collectionSettingsStore:o}),Ot.wd({environment:this.environment,collectionContextStore:e,action:"delete_combinator_filter"})}}renderComponent(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.normalizedSchemaStore.state,n=this.getFilter();if(!t||!n)return;const i=t.getType();return i?(0,je.jsxs)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Advanced filter",id:"database.viewSettings.filterTab.title"}),unconstrainedWidth:!0,children:[(0,je.jsx)(Md.D,{children:(0,je.jsx)(jd.Pq,{index:0,level:0,combinatorFilter:n,schema:o,onChange:this.handleFilterChange,collectionViewType:i,collectionViewId:t.id,parentStore:t})}),(0,je.jsx)(Ce.Z,{topBorder:!0,children:(0,je.jsx)(en.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Delete filter",id:"database.viewSettings.filterTab.deleteFilterButton.title"}),onClick:this.handleRemoveClick})})]}):void 0}getFilter(){const{collectionContextStore:e}=this.props;return e.currentCombinatorFilterStore.state}}_d.displayName="CollectionSettingsViewFilter";const Td=(0,a.injectIntl)(_d);var kd=o(63743),Pd=o(34660),Ad=o(58814),Vd=o(19699);class Fd extends i.Z{constructor(){super(...arguments),this.renderPropertyFilter=e=>{const{collectionContextStore:t}=this.props;return(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[this.canReorder()&&(0,je.jsx)(ul.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6}}),(0,je.jsx)(Vd.Z,{id:e.id,context:Pd.P.SettingsFilters,collectionContextStore:t,collectionSettingsStore:t.getFilterOptionsItemSettingsStore(e)},e.id)]})},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,n=He.oA(e.map((e=>o.find((t=>t.id===e)))));hd.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n}}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleNewFilterClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;Ot.wd({environment:this.environment,collectionContextStore:t,action:"click_new_filter"}),l.H4({collectionSettingsStore:e,item:{type:"createFilter"}}),t.filtersBarOpen.setState(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,yi.yU)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,o=e.currentPropertyFiltersStore.state,n=o.map((e=>e.id)),i=e.permissionScopes.state,r=i.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Filters",id:"database.viewSettings.filtersTab.title"}),footer:this.localStateHasChangesStore.state&&(0,je.jsx)(Ce.Z,{topBorder:!0,children:this.renderSaveControl()}),unconstrainedWidth:!0,children:(0,je.jsxs)(Ce.Z,{desktopStyle:{paddingBottom:24},children:[(n.length>0||r)&&(0,je.jsxs)("div",{style:t.isMobile?{paddingTop:8,background:this.theme.contentBackground}:void 0,children:[r&&this.renderCombinatorFilter(),this.canReorder()?(0,je.jsx)(dl.ZP,{direction:"vertical",keys:n,renderKey:e=>{const t=n.indexOf(e);return this.renderPropertyFilter(o[t])},onDrop:this.handleFiltersDrop,disabled:!i.canConfigureBlock}):n.map((e=>{const t=n.indexOf(e);return this.renderPropertyFilter(o[t])}))]}),(0,je.jsx)(ye.Z,{focused:!1,icon:(0,V.R)({width:14,marginLeft:4,marginRight:4,fill:this.theme.mediumIconColor}),style:{color:this.theme.mediumTextColor},title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Add filter",id:"database.viewSettings.filtersTab.newFilter.title"}),onClick:this.handleNewFilterClick})]})})}renderCombinatorFilter(){const{collectionContextStore:e}=this.props;return(0,je.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"4px 10px"},children:[this.canReorder()&&(0,je.jsx)(ul.ZP,{iconSize:12,style:{marginLeft:6,marginRight:6,opacity:.4,cursor:void 0}}),(0,je.jsx)(Ad.Z,{context:Pd.P.SettingsFilters,collectionContextStore:e,collectionSettingsStore:e.filterOptionsCombinatorFilterSettingsState})]})}renderSaveControl(){const{collectionContextStore:e}=this.props;return(0,je.jsx)(kd.ZP,{context:kd.R1.SettingsFilters,collectionContextStore:e})}canReorder(){return!this.environment.device.isMobile}}Fd.displayName="CollectionSettingsViewFilters";const Bd=(0,a.injectIntl)(Fd);var Id=o(74194);class Zd extends i.Z{constructor(){super(...arguments),this.storeTypes={inputValue:Dt.default.createClass("")},this.handleChangeDebounced=He.Ds((e=>{void 0!==e&&this.props.onChange(e)}),300)}willMount(e){this.stores.inputValue.setState(e.value.toString())}renderComponent(){const e=this.stores.inputValue.state;return(0,je.jsx)(Id.Z,{type:"number",value:e,inputClassName:"input-hide-arrows",style:{background:this.theme.contentBackground},onChange:e=>{const t=e.target.value,o=parseFloat(t);isNaN(o)?this.handleChangeDebounced(void 0):this.handleChangeDebounced(o),this.stores.inputValue.setState(t)}})}}Zd.displayName="CollectionViewGroupMenuNumberInput";const Dd=Zd;class Kd extends i.Z{renderComponent(){const{numberGroupBy:e,collectionContextStore:t,schema:o}=this.props,n=o[e.property];if(t.collectionStore()&&n)return(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{topBorder:!1,disableMobileBorders:!0,title:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.numberGroupRange",defaultMessage:"Group range"}),isTitleUppercase:!1,children:(0,je.jsxs)("div",{style:{display:"flex",paddingLeft:14,paddingRight:14},children:[this.renderNumberGroupByKeyInput(e,"start"),(0,je.jsx)("span",{style:{color:this.theme.mediumTextColor,margin:"0 8px"},children:"–"}),this.renderNumberGroupByKeyInput(e,"end")]})}),(0,je.jsx)(Ce.Z,{topBorder:!1,disableMobileBorders:!0,title:(0,je.jsx)(a.FormattedMessage,{id:"database.groupMenu.numberGroupSize",defaultMessage:"Group every"}),isTitleUppercase:!1,children:(0,je.jsxs)("div",{style:{paddingLeft:14,paddingRight:14},children:[this.renderNumberGroupByKeyInput(e,"size"),(0,je.jsxs)("span",{style:{color:this.theme.mediumTextColor,fontSize:12},children:[(0,je.jsx)(sl.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start,end:e.start+e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:this.getInlineNumberGroupValueStyle(),collectionContextStore:t}),", ",(0,je.jsx)(sl.Z,{groupBy:e,groupFormat:{property:e.property,value:{type:"number",value:{type:"range",start:e.start+e.size,end:e.start+2*e.size}}},schema:o,currentGroups:[],disabled:!0,isHiddenGroup:!1,style:this.getInlineNumberGroupValueStyle(),collectionContextStore:t}),", ..."]})]})})]})}renderNumberGroupByKeyInput(e,t){return(0,je.jsx)(Dd,{value:e[t],onChange:o=>{"size"===t&&o<=0&&(o=1),"start"===t&&o>e.end&&(o=e.end),"end"===t&&o<e.start&&(o=e.start),this.props.onChange({newNumberGroupBy:{...e,[t]:o}})}})}getInlineNumberGroupValueStyle(){return{display:"inline",paddingRight:0,paddingLeft:0}}}Kd.displayName="CollectionViewNumberGroupMenu";const Rd=(0,a.injectIntl)(Kd);class Nd extends i.Z{renderComponent(){return(0,je.jsx)(Jo.ZP,{...this.props,title:this.renderTitle(),children:this.renderContent()})}renderTitle(){const{collectionSettingsStore:e}=this.props,t=(0,gr.n)(e);if(!t||"groupByNumber"!==t.type)return;const{collectionContextStore:o}=this.props,n=o.normalizedSchemaStore.state,i=o.normalizedFormatStore.state[t.groupByKey];return i?xl({groupBy:i,schema:n}):void 0}renderContent(){const{groupByKey:e,groupsFormatKey:t,collectionContextStore:o}=this.props,n=o.collectionViewStore(),i=o.normalizedSchemaStore.state,r=this.getGroupBy();if(!r||!n)return;const a=bl(r);return a?(0,je.jsx)(Rd,{numberGroupBy:a,disabled:!1,schema:i,onChange:i=>{if("number"===r.type)d.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:this.environment,perform:o=>{c.FH({stores:[n],update:{[e]:i.newNumberGroupBy,[t]:void 0},transaction:o})}});else if("formula"===r.type){const o=He.CE(i.newNumberGroupBy,"property"),a={...r,groupBy:o};d.createAndCommit({userAction:"CollectionSettingsViewGroupByNumber.renderContent",environment:this.environment,perform:o=>{c.FH({stores:[n],update:{[e]:a,[t]:void 0},transaction:o})}})}Ot.wd({environment:this.environment,collectionContextStore:o,action:"group_by_number_update",original_view_type:void 0,property_type:r.type})},collectionContextStore:o}):void 0}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}}Nd.displayName="CollectionSettingsViewGroupByNumber";const Od=(0,a.injectIntl)(Nd);class Ed extends i.Z{constructor(){super(...arguments),this.handlePropertyAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o,groupByKey:n,groupsFormatKey:i}=this.props,r=t.collectionViewStore(),a=t.normalizedSchemaStore.state;if(r){if(e){const o=a[e];if(!o||!(0,nl.LG)(o))return;const s=(0,nl.fw)(e,o,"collectionTypedView"===t.contextType);d.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{c.FH({stores:[r],update:{[n]:s,[i]:void 0},transaction:e})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept",original_view_type:void 0,property_type:o.type})}else d.createAndCommit({userAction:"CollectionSettingsViewGroupByProperty.handlePropertyAccept",environment:this.environment,perform:e=>{c.FH({stores:[r],update:{[n]:void 0,[i]:void 0},transaction:e})}}),Ot.wd({environment:this.environment,collectionContextStore:t,action:"group_by_property_accept"});l.wl({collectionSettingsStore:o,item:{type:"main"}}),l.H4({collectionSettingsStore:o,item:{type:"group",groupByKey:n,groupsFormatKey:i}})}},this.sortBySchemaName=(e,t)=>{var o,n;const i=null==e||null===(o=e[1])||void 0===o?void 0:o.name,r=null==t||null===(n=t[1])||void 0===n?void 0:n.name;return i&&r?i.localeCompare(r,void 0,{sensitivity:"base"}):i?1:r?-1:0}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,o=(0,gr.n)(t),n=e.collectionViewBlockStore(),i=e.collectionViewStore();if(!n||!i||!o||"groupByProperty"!==o.type)return;const r=this.getGroupBy();return(0,je.jsx)(Jo.ZP,{...this.props,title:hl(o.groupByKey,this.getCurrentViewType()),children:(0,je.jsx)(oa.Z,{schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,currentProperty:null==r?void 0:r.property,showNoneOption:this.canRemoveGrouping(),getProperties:()=>this.getGroupableProperties(),onAccept:this.handlePropertyAccept})})}getGroupBy(){const{collectionContextStore:e,groupByKey:t}=this.props;return e.normalizedFormatStore.state[t]}getGroupableProperties(){const{collectionContextStore:e}=this.props,t=e.normalizedSchemaStore.state;return Object.entries(t).sort(this.sortBySchemaName).map((e=>e[0])).filter((e=>{const o=t[e];return o&&(0,nl.LG)(o)}))}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}canRemoveGrouping(){return(0,rl._1)({viewType:this.getCurrentViewType(),groupByKey:this.props.groupByKey})}}Ed.displayName="CollectionSettingsViewGroupByProperty";const Ld=(0,a.injectIntl)(Ed);class Wd extends i.Z{renderComponent(){return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Layout",id:"database.viewSettings.layoutTab.title"}),desktopWidth:290,children:(0,je.jsx)(Ks.Z,{...this.props})})}}Wd.displayName="CollectionSettingsViewLayout";const Gd=(0,a.injectIntl)(Wd);var Hd=o(75544),zd=o(12076);class Ud extends i.Z{constructor(){super(...arguments),this.handleSortChange=e=>{this.setSorts(e)},this.handleDeleteAllSortsClick=()=>{const{collectionSettingsStore:e,context:t}=this.props;t===Ui.HV.FilterBar&&l.E3({collectionSettingsStore:e})},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,yi.Mj)(e)}))}renderComponent(){const{collectionContextStore:e,context:t}=this.props,o=e.permissionScopes.state,n=t===Ui.HV.ViewSettings&&this.localStateHasChangesStore.state,i=e.collectionViewStore();if(i)return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.sortTab.title"}),footer:n&&(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)("div",{style:{paddingTop:24}}),(0,je.jsx)(Ce.Z,{topBorder:!0,children:this.renderSaveControl()})]}),unconstrainedWidth:!0,children:(0,je.jsx)(zd.Z,{collectionViewStore:e.collectionViewStore(),schema:e.normalizedSchemaStore.state,format:e.normalizedFormatStore.state,sorts:this.getSorts(),disabled:!o.canConfigureBlock,parentStore:i,onChange:this.handleSortChange,showDeleteAll:!0,onDeleteAll:this.handleDeleteAllSortsClick})})}renderSaveControl(){const{collectionContextStore:e}=this.props;return(0,je.jsx)(kd.ZP,{context:kd.R1.SettingsSort,collectionContextStore:e})}getSorts(){const{collectionContextStore:e}=this.props;return e.currentSortsStore.state}setSorts(e){const{collectionContextStore:t}=this.props;t.collectionViewStore()&&hd.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,sorts:{value:e}}})}}Ud.displayName="CollectionSettingsViewSort";const $d=(0,a.injectIntl)(Ud);var qd=o(59753),Qd=o(47425);var Yd=o(75553),Xd=o(1436),Jd=o(60291),eu=o(69619),tu=o(15157),ou=o(32056),nu=o(16402),iu=o(24039);class ru extends i.Z{constructor(e){super(e),this.storeTypes={nextSync:Dt.default.createClass(void 0),uri:Dt.default.createClass(void 0),botId:Dt.default.createClass(void 0)},this.reducer={type:"aggregation",filter:void 0,aggregation:{aggregator:"count",property:"title"}},this.setNextSync=this.setNextSync.bind(this)}didMount(){const e=this.stores.uri.state,t=this.stores.botId.state;if(e&&t){const o=`${t}:${e}`,n=tu.Z.get({userId:this.environment.currentUser.id,key:o});this.setNextSync(n)}}renderComponent(){var e;const{collectionContextStore:t}=this.props,o=t.collectionStore(),n=null==o?void 0:o.getFormatStore(),i=null==n?void 0:n.getKeyStore("uri").getValue(),r=null==n?void 0:n.getKeyStore("bot_id").getValue(),s=null==o||null===(e=o.pointer)||void 0===e?void 0:e.spaceId,l=_o.default.state.currentSpaceStore,c=null==n?void 0:n.getKeyStore("original_url").getValue(),d=(0,Wc.wY)(c,s),u=t.collectionViewBlockStore(),p=br.default.checkGate("free_tier_sync_database")||l&&!(0,Qd.QM)(l.getSubscriptionTier());return this.stores.uri.setState(i),this.stores.botId.setState(r),(0,je.jsxs)(je.Fragment,{children:[(0,je.jsx)(Ce.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Source database",id:"database.viewSettings.syncedSourceTab.sourceDatabase"}),children:(0,je.jsx)(ae.Z,{placement:ae.Z.Placement.Left,alignment:ae.Z.Alignment.Center,renderTooltip:()=>u&&(0,je.jsx)(iu.Z,{store:u,compactFormat:!0}),render:e=>(0,je.jsx)(pl.Z,{...e,title:d,icon:(0,je.jsx)(ti.Z,{disabled:!0,icon:null==o?void 0:o.getIcon(),isEmptyPage:!1,size:20,style:this.styles().menuItemIcon}),style:this.styles().menuItemTitle})}),style:{paddingBottom:0}}),(0,je.jsx)(Ce.Z,{children:this.renderLimitMenuItem()}),(0,je.jsxs)(Ce.Z,{topBorder:!0,children:[p&&i&&r&&this.renderSyncButton({uri:i,botId:r}),(0,je.jsx)(en.Z,{isGray:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Copy debugging information",id:"database.viewSettings.syncedSourceTab.copyDebugging"}),icon:Yd.U,onClick:()=>{const e={uri:i,botId:r,spaceId:s};gs.RD({environment:this.environment,stringValue:JSON.stringify(e,null,2),copiedMessage:gs.tq.copiedLinkToClipboard})}}),(0,je.jsx)(tn.Z,{href:`${Ec.default.domainBaseUrl}?target=connected_apps`,children:(0,je.jsx)(en.Z,{icon:Xd.g,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Manage my connections",id:"database.viewSettings.syncedSourceTab.manageConnections"}),isGray:!0})}),(0,je.jsx)(cl.Z,{href:(0,al.UY)("guides.syncedDatabases"),title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Learn about synced databases",id:"database.viewSettings.syncedSourceTab.learnMoreButton.title."}),analyticsFrom:"view_settings_source"})]})]})}renderCountRowValue(e){const{collectionContextStore:t}=this.props;return(0,je.jsx)(ll.Z,{id:"table:uncategorized:title:count",collectionContextStore:t,reducer:this.reducer,render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;if("number"!==o.aggregationResult.type)return;const n={...o.aggregationResult,value:o.aggregationResult.value&&Math.min(e,o.aggregationResult.value)};return(0,ou.uf)(n.value,"number_with_commas",this.props.intl)}})}renderLimitMenuItem(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=null==t?void 0:t.getFormatStore(),n="row_limit_exceeded"===(null==o?void 0:o.getKeyStore("sync_state").getKeyStore("syncing").getValue()),i=_o.default.state.currentSpaceStore,r=this.createComputedStore((()=>{var e;return function(e){if(!e)return 2e4;const t=qd.kk.fromSpace(e),o=t.getSetting("database_sync_row_limit");return void 0!==o?o:(0,Qd.QM)(t.getSubscriptionTier())?100:2e4}(null===(e=_o.default.state.currentSpaceStore)||void 0===e?void 0:e.getModel())}));return(0,je.jsx)(pl.Z,{title:(0,je.jsxs)("span",{style:{display:"inline-flex",alignItems:"center"},children:[n&&i&&(0,Qd.QM)(i.getSubscriptionTier())&&(0,je.jsx)(ae.Z,{placement:ae.Z.Placement.Left,alignment:ae.Z.Alignment.Center,renderTooltip:()=>(0,je.jsx)(a.FormattedMessage,{id:"database.viewSettings.syncedSourceTab.limitFree.toolTip",defaultMessage:"Free Plans are limited to 1 synced database with up to 100 rows."}),render:e=>(0,je.jsx)("div",{...e,children:(0,Ft.t)({fill:(0,as.fi)("orange",this.theme).fill,marginRight:14,width:12,alignSelf:"center"})})}),(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.syncedSourceTab.limit"})]}),right:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{value}/{limit} rows",id:"database.viewSettings.syncedSourceTab.limitRows",values:{value:this.renderCountRowValue(r.state),limit:(0,ou.uf)(r.state,"number_with_commas",this.props.intl)}}),style:this.styles().menuItem})}renderSyncButton(e){const{uri:t,botId:o}=e,n=this.stores.nextSync.state,i=!n||n<Date.now();return this.isSyncing()?(0,je.jsx)(pl.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Syncing",id:"database.viewSettings.syncedSourceTab.isSyncing"}),icon:(0,Jd.b)(this.styles().menuItemIcon,"sync-spinner"),style:this.styles().menuItem}):i?(0,je.jsx)(en.Z,{isGray:!0,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"{message}",id:"database.viewSettings.syncedSourceTab.syncNow",values:{message:this.syncButtonMessage().defaultMessage,description:this.syncButtonMessage().description}}),icon:Jd.b,onClick:async()=>{var e,i;const r=null===(e=this.props.collectionContextStore.collectionStore())||void 0===e?void 0:e.id,a=!0===(null===(i=this.props.collectionContextStore.collectionStore())||void 0===i?void 0:i.getFormat().stale);r&&await l.R0({environment:this.environment,uri:t,botId:o,collectionId:r,nextSync:n,setNextSync:this.setNextSync,isStale:a})}}):(0,je.jsx)(pl.Z,{title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Sync available in {timeToNextSync}",id:"database.viewSettings.syncedSourceTab.syncNow.disabled",values:{timeToNextSync:(0,nu.hH)(Date.now(),n)}}),icon:(0,eu.T)(this.styles().menuItemIcon),style:this.styles().menuItem})}setNextSync(e){this.stores.nextSync.setState(e)}isSyncing(){var e;const t=this.props.collectionContextStore,o=t.numberChildrenUnfurled.state,n=t.numberChildrenReceived.state,i=o/n,r=!0===(null===(e=t.collectionStore())||void 0===e||null===(e=e.getFormat().sync_state)||void 0===e?void 0:e.syncing),a=this.environment.device.isMobile;return o&&n&&i<1&&!a||r&&a}styles(){const e=this.environment.device.isMobile;return{menuItemTitle:{paddingLeft:e?4:8},menuItem:{color:this.theme.mediumTextColor,paddingLeft:e?4:8},menuItemIcon:{height:16,width:16,marginRight:2}}}syncButtonMessage(){const e=_o.default.state.currentSpaceStore,t=e&&(0,Qd.QM)(e.getSubscriptionTier());return{defaultMessage:t?"Clear and sync database":"Sync database",description:t?"Clears and refreshes the database ":"Refreshes the synced database."}}}ru.displayName="CollectionSettingsViewSyncedSource";const au=(0,a.injectIntl)(ru);class su extends i.Z{constructor(){super(...arguments),this.searchSessionId="",this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;d.createAndCommit({userAction:"CollectionSettingsViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{ea.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o})}}),l.z$({collectionSettingsStore:o})}}renderComponent(){var e;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,n=Boolean(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewSourceCollectionStore()),i=t.collectionViewBlockStore();if(!i)return;const r=Dt.default.createValue("");return(0,je.jsx)(Jo.ZP,{...this.props,title:(0,je.jsx)(a.FormattedMessage,{defaultMessage:"Source",id:"database.viewSettings.sourceTab.title"}),handleClose:()=>{Ot.tW({environment:this.environment,eventName:"abandoned_search",sessionId:this.searchSessionId,source:ed.S.Source,queryLength:r.state.length}),l.E3({collectionSettingsStore:o})},children:n?(0,je.jsx)(au,{collectionContextStore:t}):(0,je.jsx)(Et.Z,{collectionContextStore:t,parentStore:i,onAccept:this.handleSourcePickerAccept,context:ed.S.Source,searchSessionId:this.searchSessionId,inputStore:r})})}willMount(){this.searchSessionId=(0,r.ZP)()}}su.displayName="CollectionSettingsViewSource";const lu=(0,a.injectIntl)(su);var cu=o(72897);class du extends i.Z{constructor(){super(...arguments),this.lastTab=void 0,this.renderMainTab=e=>{var t;if("main"!==e.type)return;const{collectionContextStore:o}=this.props;return(0,je.jsx)(Il,{selectViewNameInitial:e.selectViewNameInitial,...this.props},null===(t=o.collectionViewStore())||void 0===t?void 0:t.id)},this.renderPageViewTab=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(o)return(0,je.jsx)(Jo.ZP,{...this.props,title:"Select page to display",children:(0,je.jsx)("div",{style:{margin:12},children:(0,je.jsx)(Id.Z,{showClearButton:!0,placeholder:"Enter page ID",focusInitial:!0,onChange:e=>{mr.Z.setState({pageId:e.target.value})},onSubmit:e=>{const t=mr.Z.state.pageId;t&&d.createAndCommit({userAction:"collectionSettings.pageView.selectPage",environment:this.environment,perform:e=>{c.FH({stores:[o],update:{page_pointer:{id:(0,r.Mt)(t),spaceId:e.spaceId,table:"block"}},transaction:e})}})}})})})},this.renderSetDBTypeTab=()=>(0,je.jsx)(nd,{...this.props}),this.renderDBTypePropertyMappingTab=e=>{if("databaseTypePropertyMapping"===e.type)return(0,je.jsx)(Ll,{...this.props,databaseType:e.databaseType})},this.renderCreateTypedDBTab=()=>(0,je.jsx)(Is,{...this.props}),this.renderSourceTab=()=>(0,je.jsx)(lu,{...this.props}),this.renderCreateViewSourceTab=()=>(0,je.jsx)(Kl.Z,{...this.props}),this.renderCreateExternalViewSourceTab=e=>{if("createSyncedViewSource"===e.type)return(0,je.jsx)(js,{...this.props,...e})},this.renderSelectAccountForExternalViewSourceTab=e=>{if("selectAccountForExternalSource"===e.type)return(0,je.jsx)(ns,{...this.props,...e})},this.renderSyncedShareTab=e=>{if("shareSyncedView"===e.type)return(0,je.jsx)(md,{...this.props,...e})},this.renderPropertyTypeTab=e=>{if("propertyType"===e.type)return(0,je.jsx)(Jc,{...this.props,...e})},this.renderPropertyAiAutofillTab=e=>{if("propertyAiAutofill"===e.type)return(0,je.jsx)(wc,{...this.props,...e})},this.renderCreateViewTab=()=>(0,je.jsx)(Dl,{...this.props}),this.renderDuplicateExistingViewTab=()=>(0,je.jsx)(Hl.Z,{...this.props}),this.renderPropertiesTab=e=>{if("properties"===e.type)return(0,je.jsx)(Hd.Z,{...this.props,timelineViewTab:e.timelineViewTab})},this.renderPropertyTab=e=>{if("property"===e.type)return(0,je.jsx)(zl.ZP,{...this.props,...e},e.property)},this.renderDeletedPropertiesTab=e=>{if("deletedProperties"===e.type)return(0,je.jsx)(Gl,{...e,...this.props})},this.renderSelectRelationSourceTab=e=>{if("selectRelationSource"===e.type)return(0,je.jsx)(od,{...this.props,...e})},this.renderSetupRelationTab=e=>{if("setupRelation"===e.type)return(0,je.jsx)(ad,{...this.props,...e})},this.renderLayoutTab=()=>(0,je.jsx)(Gd,{...this.props}),this.renderGroupTab=e=>{if("group"===e.type)return(0,je.jsx)(Tl,{...this.props,...e})},this.renderGroupByPropertyTab=e=>{if("groupByProperty"===e.type)return(0,je.jsx)(Ld,{...this.props,...e})},this.renderGroupByNumberTab=e=>{if("groupByNumber"===e.type)return(0,je.jsx)(Od,{...this.props,...e})},this.renderSubitemTab=e=>{if("subitem"===e.type)return(0,je.jsx)(ts,{...this.props,...e,formatSetting:"subitem"})},this.renderSubitemV2Tab=e=>{if("subitemV2"===e.type)return(0,je.jsx)(Ia,{...this.props,feature:"subitem"})},this.renderArrowsByTab=e=>{if("arrowsBy"===e.type)return(0,je.jsx)(ts,{...this.props,...e,formatSetting:"timeline_arrows_by"})},this.renderDependencies=e=>{if("dependencies"===e.type)return(0,je.jsx)(Ia,{...this.props,feature:"timeline_arrows_by"})},this.renderRelationFeaturesAdvancedSettings=e=>{if("relationFeaturesAdvancedSettings"===e.type)return(0,je.jsx)($a,{...this.props,feature:e.feature})},this.renderGithubConfigTab=e=>{if("githubConfig"===e.type)return(0,je.jsx)(yr.Z,{...this.props,property:e.property})},this.renderFiltersTab=()=>(0,je.jsx)(Bd,{...this.props}),this.renderFilterTab=e=>{if("filter"===e.type)return(0,je.jsx)(Td,{...this.props})},this.renderCreateFilterTab=()=>(0,je.jsx)(xd,{...this.props}),this.renderCreateSortTab=()=>(0,je.jsx)(bd,{...this.props}),this.renderSortTab=()=>(0,je.jsx)($d,{...this.props}),this.renderAutomationSettingsTab=e=>{if("automationSettings"===e.type)return(0,je.jsx)(Zn,{...this.props,tabSettings:e})},this.renderAutomationCreateSettingsTab=e=>{if("automationCreateSettings"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props;return(0,je.jsx)(cr,{collectionContextStore:t,collectionSettingsStore:o,mode:"create"})},this.renderAutomationEditSettingsTab=e=>{if("automationEditSettings"!==e.type)return;const{collectionContextStore:t,collectionSettingsStore:o}=this.props,{automationId:n}=e;return(0,je.jsx)(cr,{automationId:n,collectionContextStore:t,collectionSettingsStore:o,mode:"update"})},this.tabRenderers={main:this.renderMainTab,source:this.renderSourceTab,createViewSource:this.renderCreateViewSourceTab,createSyncedViewSource:this.renderCreateExternalViewSourceTab,selectAccountForExternalSource:this.renderSelectAccountForExternalViewSourceTab,shareSyncedView:this.renderSyncedShareTab,propertyType:this.renderPropertyTypeTab,propertyAiAutofill:this.renderPropertyAiAutofillTab,createView:this.renderCreateViewTab,duplicateExistingView:this.renderDuplicateExistingViewTab,properties:this.renderPropertiesTab,property:this.renderPropertyTab,deletedProperties:this.renderDeletedPropertiesTab,selectRelationSource:this.renderSelectRelationSourceTab,setupRelation:this.renderSetupRelationTab,layout:this.renderLayoutTab,group:this.renderGroupTab,groupByProperty:this.renderGroupByPropertyTab,subitem:this.renderSubitemTab,arrowsBy:this.renderArrowsByTab,githubConfig:this.renderGithubConfigTab,filters:this.renderFiltersTab,groupByNumber:this.renderGroupByNumberTab,filter:this.renderFilterTab,createFilter:this.renderCreateFilterTab,createSort:this.renderCreateSortTab,sort:this.renderSortTab,page:this.renderPageViewTab,createTypedDB:this.renderCreateTypedDBTab,setDatabaseType:this.renderSetDBTypeTab,databaseTypePropertyMapping:this.renderDBTypePropertyMappingTab,automationSettings:this.renderAutomationSettingsTab,automationCreateSettings:this.renderAutomationCreateSettingsTab,automationEditSettings:this.renderAutomationEditSettingsTab,dependencies:this.renderDependencies,relationFeaturesAdvancedSettings:this.renderRelationFeaturesAdvancedSettings,subitemV2:this.renderSubitemV2Tab},this.handleClose=e=>{(0,ur.ZP)({event:e,context:ur.Af.CollectionSettingsClick,callback:()=>{const{collectionSettingsStore:e}=this.props;l.E3({collectionSettingsStore:e})}})}}didMountOrUpdate(){const{collectionSettingsStore:e}=this.props,t=(0,gr.n)(e),o=this.getCurrentViewType();t&&this.lastTab!==t&&s.r5L(this.environment,{view_type:o,menu:t.type}),this.lastTab=t}renderComponent(){var e,t;const{collectionSettingsStore:o}=this.props,n=(0,gr.n)(o);if(n)return(0,je.jsx)(cu.Z,{capture:!0,preventType:pr.Z.Y,children:(0,je.jsx)(zi.Z,{capture:!0,onEsc:this.handleClose,children:null===(e=(t=this.tabRenderers)[n.type])||void 0===e?void 0:e.call(t,n)})})}getCurrentViewType(){const{collectionContextStore:e}=this.props;return e.getViewType()}}du.displayName="CollectionSettings";const uu=(0,a.injectIntl)(du)},46978:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(67294),i=o(24405),r=o(85893);function a(e,t){let{isSelected:o}=e;window.__c={n:"RadioButtonIcon"};const{radioButtonStyle:n,dotStyle:a}=(0,i.yK)((e=>({radioButtonStyle:{display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:16,height:16,borderRadius:16,marginRight:8,background:o?e.blueColor:e.whiteButtonBackground,border:o?"none":`1px solid ${e.radioButtonBorder}`,transition:"background 100ms ease-out"},dotStyle:{width:6,height:6,borderRadius:6,background:e.regularInvertedTextColor,transition:"opacity 100ms ease-out",opacity:o?1:0}})),[o]);return(0,r.jsx)("div",{ref:t,style:n,children:(0,r.jsx)("div",{style:a})})}const s=n.forwardRef(a)},92165:(e,t,o)=>{o.d(t,{Z:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("arrowsDiverging",{viewBox:"0 0 12 12",svg:(0,i.jsx)("path",{d:"M6 11.2891C6.42188 11.2891 6.63281 11.0469 6.63281 10.5625V7.3457C6.63281 7.00586 6.71875 6.64062 6.89062 6.25C7.06641 5.85938 7.29492 5.47266 7.57617 5.08984C7.86133 4.70703 8.16992 4.35547 8.50195 4.03516C8.83789 3.71484 9.16406 3.45312 9.48047 3.25L9.95508 2.94531C10.1621 2.81641 10.2656 2.63281 10.2656 2.39453C10.2656 2.21875 10.2109 2.07227 10.1016 1.95508C9.99219 1.83789 9.8418 1.7793 9.65039 1.7793C9.4668 1.7793 9.29102 1.83398 9.12305 1.94336L8.81836 2.14844C8.51367 2.34766 8.20898 2.58984 7.9043 2.875C7.59961 3.15625 7.31641 3.45508 7.05469 3.77148C6.79297 4.08398 6.56836 4.39258 6.38086 4.69727C6.19727 4.99805 6.07227 5.26953 6.00586 5.51172H5.98828C5.91797 5.26953 5.79102 4.99805 5.60742 4.69727C5.42383 4.39258 5.19922 4.08398 4.93359 3.77148C4.67188 3.45508 4.38867 3.15625 4.08398 2.875C3.7832 2.58984 3.48047 2.34766 3.17578 2.14844L2.87109 1.94336C2.69922 1.83398 2.52344 1.7793 2.34375 1.7793C2.14844 1.7793 1.99609 1.83984 1.88672 1.96094C1.78125 2.08203 1.72852 2.22461 1.72852 2.38867C1.72852 2.62695 1.83203 2.8125 2.03906 2.94531L2.51367 3.25C2.83008 3.45312 3.1543 3.71484 3.48633 4.03516C3.81836 4.35547 4.12695 4.70703 4.41211 5.08984C4.69727 5.47266 4.92773 5.85938 5.10352 6.25C5.2793 6.64062 5.36719 7.00586 5.36719 7.3457V10.5625C5.36719 11.0469 5.57812 11.2891 6 11.2891ZM1.81641 3.9707L3.71484 1.52734C3.85547 1.33984 3.88281 1.17578 3.79688 1.03516C3.71484 0.890625 3.55469 0.814453 3.31641 0.806641L0.808594 0.712891C0.613281 0.705078 0.466797 0.763672 0.369141 0.888672C0.271484 1.00977 0.251953 1.16406 0.310547 1.35156L1.02539 3.75391C1.0918 3.98438 1.20312 4.125 1.35938 4.17578C1.51953 4.22656 1.67188 4.1582 1.81641 3.9707ZM10.0898 3.95898C10.2266 4.1543 10.375 4.23047 10.5352 4.1875C10.6992 4.14062 10.8164 4.00391 10.8867 3.77734L11.6777 1.39258C11.7402 1.20508 11.7246 1.04883 11.6309 0.923828C11.541 0.798828 11.3984 0.736328 11.2031 0.736328L8.68945 0.753906C8.45117 0.753906 8.28711 0.824219 8.19727 0.964844C8.10742 1.10156 8.13086 1.26562 8.26758 1.45703L10.0898 3.95898Z"})})},93108:(e,t,o)=>{o.d(t,{p:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("contentSearch",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M0.25293 5.82031C0.25293 8.88965 2.74805 11.3848 5.81738 11.3848C6.95898 11.3848 8.00488 11.0361 8.87988 10.4414L12.0244 13.5859C12.2158 13.7842 12.4824 13.873 12.749 13.873C13.3301 13.873 13.7471 13.4355 13.7471 12.8682C13.7471 12.5947 13.6514 12.3418 13.4668 12.1504L10.3428 9.01953C10.9922 8.12402 11.3818 7.0166 11.3818 5.82031C11.3818 2.75098 8.88672 0.255859 5.81738 0.255859C2.74805 0.255859 0.25293 2.75098 0.25293 5.82031ZM1.70215 5.82031C1.70215 3.55078 3.54102 1.70508 5.81738 1.70508C8.08691 1.70508 9.93262 3.55078 9.93262 5.82031C9.93262 8.08984 8.08691 9.93555 5.81738 9.93555C3.54102 9.93555 1.70215 8.08984 1.70215 5.82031Z"})})},50780:(e,t,o)=>{o.d(t,{E:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("editPropertyType",{viewBox:"0 0 16 16 ",svg:(0,i.jsx)("path",{d:"M11.5615 4.84473L12.2998 4.11328C12.6689 3.74414 12.6826 3.34082 12.3545 3.00586L12.0879 2.73926C11.7529 2.4043 11.3428 2.43848 10.9736 2.79395L10.2354 3.52539L11.5615 4.84473ZM3.22168 13.1641L10.9053 5.4873L9.59277 4.16797L1.90918 11.8516L1.23926 13.4512C1.16406 13.6562 1.37598 13.875 1.57422 13.7998L3.22168 13.1641ZM3.92578 13.8066H14.1045C14.4736 13.8066 14.7744 13.499 14.7744 13.1367C14.7744 12.7676 14.4736 12.4668 14.1045 12.4668H5.27246L3.92578 13.8066Z"})})},6637:(e,t,o)=>{o.d(t,{I:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("filterCircled",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.667 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.41797 6.75879H11.5889C11.9307 6.75879 12.1699 6.54688 12.1699 6.22559C12.1699 5.9043 11.9307 5.68555 11.5889 5.68555H4.41797C4.07617 5.68555 3.84375 5.9043 3.84375 6.22559C3.84375 6.54688 4.07617 6.75879 4.41797 6.75879ZM5.36816 9.02148H10.6455C10.9805 9.02148 11.2197 8.80273 11.2197 8.48145C11.2197 8.16016 10.9805 7.94141 10.6455 7.94141H5.36816C5.02637 7.94141 4.78711 8.16016 4.78711 8.48145C4.78711 8.80273 5.02637 9.02148 5.36816 9.02148ZM6.35254 11.2773H9.6543C9.99609 11.2773 10.2354 11.0654 10.2354 10.7441C10.2354 10.4229 9.99609 10.2041 9.6543 10.2041H6.35254C6.01074 10.2041 5.77148 10.4229 5.77148 10.7441C5.77148 11.0654 6.01074 11.2773 6.35254 11.2773Z"})})},87393:(e,t,o)=>{o.d(t,{L:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("settingsIntegration",{viewBox:"0 0 20 20",svg:(0,i.jsx)("path",{d:"M4.633 9.42h3.154c1.093 0 1.632-.532 1.632-1.656V4.655C9.42 3.532 8.88 3 7.787 3H4.633C3.532 3 3 3.532 3 4.655v3.109c0 1.124.532 1.655 1.633 1.655zm7.58 0h3.162C16.468 9.42 17 8.887 17 7.763V4.655C17 3.532 16.468 3 15.374 3h-3.16c-1.094 0-1.633.532-1.633 1.655v3.109c0 1.124.539 1.655 1.633 1.655zm-7.58-1.251c-.262 0-.382-.135-.382-.405V4.648c0-.27.12-.405.382-.405h3.146c.262 0 .39.135.39.405v3.116c0 .27-.128.405-.39.405H4.633zm7.588 0c-.262 0-.39-.135-.39-.405V4.648c0-.27.128-.405.39-.405h3.146c.262 0 .39.135.39.405v3.116c0 .27-.128.405-.39.405h-3.146zM4.633 17h3.154c1.093 0 1.632-.532 1.632-1.655v-3.109c0-1.124-.539-1.655-1.632-1.655H4.633C3.532 10.58 3 11.112 3 12.236v3.109C3 16.468 3.532 17 4.633 17zm7.58 0h3.162C16.468 17 17 16.468 17 15.345v-3.109c0-1.124-.532-1.655-1.626-1.655h-3.16c-1.094 0-1.633.531-1.633 1.655v3.109c0 1.123.539 1.655 1.633 1.655zm-7.58-1.25c-.262 0-.382-.128-.382-.398v-3.116c0-.277.12-.405.382-.405h3.146c.262 0 .39.128.39.405v3.116c0 .27-.128.397-.39.397H4.633zm7.588 0c-.262 0-.39-.128-.39-.398v-3.116c0-.277.128-.405.39-.405h3.146c.262 0 .39.128.39.405v3.116c0 .27-.128.397-.39.397h-3.146z"})})},37888:(e,t,o)=>{o.d(t,{U:()=>r});o(67294);var n=o(45238),i=o(85893);const r=(0,n.I)("unlocked",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M2.49023 14.7227H8.89551C9.94824 14.7227 10.4746 14.1963 10.4746 13.0479V8.20801C10.4746 7.22363 10.085 6.69727 9.29883 6.57422V4.83105C9.29883 3.22461 10.3174 2.35645 11.541 2.35645C12.7646 2.35645 13.79 3.22461 13.79 4.83105V6.28711C13.79 6.76562 14.0703 7.01855 14.4395 7.01855C14.8018 7.01855 15.082 6.7793 15.082 6.28711V4.96094C15.082 2.36328 13.3525 1.1123 11.541 1.1123C9.72949 1.1123 8 2.36328 8 4.96094V6.54004H2.49023C1.43066 6.54004 0.911133 7.06641 0.911133 8.20801V13.0479C0.911133 14.1963 1.43066 14.7227 2.49023 14.7227ZM2.68848 13.5059C2.3877 13.5059 2.2373 13.3623 2.2373 13V8.25586C2.2373 7.89355 2.3877 7.76367 2.68848 7.76367H8.7041C9.00488 7.76367 9.14844 7.89355 9.14844 8.25586V13C9.14844 13.3623 9.00488 13.5059 8.7041 13.5059H2.68848ZM7.99316 21.1123C6.5918 21.1123 5.2793 21.8779 4.75293 23.375L5.78516 24.4141C5.94922 23.0811 6.87891 22.3564 7.99316 22.3564C9.2168 22.3564 10.2422 23.2246 10.2422 24.8311V26.54H7.9248L9.1416 27.7637H11.0078C11.3086 27.7637 11.4521 27.8936 11.4521 28.2559V30.0742L12.7783 31.4072V28.208C12.7783 27.2031 12.3682 26.6768 11.541 26.5674V24.9609C11.541 22.3633 9.81152 21.1123 7.99316 21.1123ZM13.749 35.126C13.9609 35.3379 14.3164 35.3379 14.5215 35.126C14.7266 34.9072 14.7334 34.5723 14.5215 34.3535L2.46973 22.3154C2.25781 22.1035 1.90918 22.0967 1.69043 22.3154C1.48535 22.5205 1.48535 22.876 1.69043 23.0811L13.749 35.126ZM4.79395 34.7227H11.1992C11.5 34.7227 11.7598 34.6816 11.9785 34.5928L10.8711 33.4922C10.8096 33.499 10.7549 33.5059 10.6865 33.5059H4.99219C4.69141 33.5059 4.54102 33.3623 4.54102 33V28.2559C4.54102 27.9004 4.68457 27.7637 4.97852 27.7637H5.14258L4.04883 26.6631C3.48828 26.8818 3.21484 27.3809 3.21484 28.208V33.0479C3.21484 34.1963 3.73438 34.7227 4.79395 34.7227Z"})})}}]);