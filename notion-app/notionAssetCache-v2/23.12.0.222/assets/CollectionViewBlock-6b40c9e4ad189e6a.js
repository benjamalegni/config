"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190],{26797:(e,t,o)=>{o.d(t,{Fv:()=>P,JN:()=>C,QG:()=>R,cQ:()=>k,f$:()=>x,fX:()=>w,td:()=>b,xD:()=>T});o(57658);var r=o(30120),i=o(80951),n=o(40506),s=o(53877),l=o(42875),a=o(72126),c=o(6287),d=o(97880),h=o(95802),p=o(15723),u=o(17746),m=o(90106),g=o(49865),S=o(75134),y=o(42239),v=o(19785),f=o(9953);function C(e){const{environment:t,droppedStores:o,collectionStore:a,duplicate:d,calendarBy:h,transaction:p,collectionContextStore:u}=e,m=r.ou.fromMillis(e.startOfDay);let S=!0;for(const r of o){if(r.getParentTable()===c.v){S=!1;break}v.zw({childStore:r,parentStore:a,transaction:p})||(S=!1)}const f=y.LQ({environment:t,droppedStores:o,duplicate:d,duplicateUseCrdt:!1,transaction:p,resolveTemplateVariables:!1});for(const r of f){const e=r.getPropertyStore(h),o=i.Gl(e.getValue())||s.Lg((0,l.r)()),c=s.c$(o,(0,l.r)()),d=m.toFormat(s.Iq);let y;if("date"===c.type||"datetime"===c.type)y={...c,start_date:d};else{const e=s.NK(c,(0,l.r)());if(!e.end)return;const t={...c,start_date:d},o=s.NK(t,(0,l.r)()).start.diff(e.start,"days"),r=e.end.plus(o).toFormat(s.Iq);y={...c,start_date:d,end_date:r}}const v=s.c$(y,n.yw(o)||(0,l.r)());g.mp({environment:t,store:r,collectionStore:a,collectionContextStore:u,coerce:!0,groupsPointer:[],transaction:p,alreadyMovedToCollection:S}),T({environment:t,type:"dateValue",propertyId:h,store:r,transaction:p,dateValue:v})}}function x(e){const{calendarStore:t,direction:o,target:r}=e;t.setState({...t.state,isDragging:!0,target:r,direction:o})}function b(e){const{calendarStore:t,x:o,y:c,calendarBy:d}=e,m=t.state;if(m.isDragging){const e=i.Gl(m.target.getPropertyStore(d).getValue());if(!e)return;const g=s.c$(e,(0,l.r)()),S=m.temporaryValue||e,y=s.c$(S,(0,l.r)()),v=[];m.dayStoreMap.forEach(((e,t)=>{v.push({store:e,timestamp:t})}));const f=v.find((e=>{let{store:t}=e;const r=h.C.getRectFromStore(t);return Boolean(r&&p.uh(r,o,c))}));let C;if(f){const e=r.ou.fromMillis(f.timestamp),t=e.endOf("day"),o=e.toFormat(s.Iq);if(g){const i=s.NK(g,(0,l.r)());if(m.direction===u.t.Left)if(r.Xp.fromDateTimes(e,t).contains(i.start))C=g;else{let e;e="datetimerange"===g.type||"daterange"===g.type?{...g,start_date:o,end_date:g.end_date}:"datetime"===g.type?{type:"datetimerange",start_date:o,start_time:g.start_time,end_date:g.start_date,end_time:g.start_time,time_zone:g.time_zone,reminder:g.reminder}:{type:"daterange",start_date:o,end_date:g.start_date,reminder:g.reminder};const t=s.NK(e,(0,l.r)());C=!i.end&&t.start>i.start||i.end&&t.start>i.end?y:e}else if(i.end?r.Xp.fromDateTimes(e,t).contains(i.end):r.Xp.fromDateTimes(e,t).contains(i.start))C=g;else{let e;e="date"===g.type?{...g,type:"daterange",end_date:o}:"datetime"===g.type?{...g,type:"datetimerange",end_date:o,end_time:"00:00"}:{...g,end_date:o};const t=s.NK(e,(0,l.r)());C=t.end&&t.end<t.start?y:e}}}if(C&&!a.Xy(y,C)){const e=s.c$(C,n.yw(S)||(0,l.r)());t.setState({...m,temporaryValue:e})}}}function w(e){const{environment:t,calendarStore:o,calendarBy:r,transaction:i}=e,n=o.state;n.isDragging&&n.temporaryValue&&(T({type:"dateValue",environment:t,dateValue:n.temporaryValue,propertyId:r,store:n.target,transaction:i}),o.setState({...o.state,isDragging:!1}))}function k(e){const{calendarStore:t}=e,o=t.state;o.isDragging&&t.setState({...o,isDragging:!1})}function P(e){const{environment:t,store:o,collectionStore:n,collectionContextStore:a,startDayOfWeek:c,transaction:d}=e,h=a.dateRangeStart.state,p=(0,l.r)(),u=a.normalizedQueryStore.state;if(!u||!u.calendar_by)return;const m=u.calendar_by,S=s.gQ(h,c,p),y=S.startOf("month"),v=S.endOf("month"),C=r.ou.now().startOf("day");let x;return x=r.Xp.fromDateTimes(y,v).contains(C)?s.hT(C.valueOf(),p):s.hT(s.em(h,c,p).valueOf(),p),f.sW({store:o.getPropertiesStore(),data:{[m]:i.d7(x)},transaction:d}),g.mp({environment:t,store:o,collectionStore:n,collectionContextStore:a,coerce:!0,groupsPointer:[],transaction:d}),o}function T(e){const{environment:t,store:o,propertyId:r,transaction:n}=e;let a;"timestamp"===e.type?a=s.hT(e.timestampMs.valueOf(),(0,l.r)()):"dateValue"===e.type?a=e.dateValue:(0,d.t1)(e);const c=o.getPropertyValue(r),h=i.d7(a);f.sW({store:o.getPropertiesStore(),data:{[r]:h},transaction:n}),S.H({environment:t,store:o,dateProperty:{id:r,oldValue:c,newValue:h}})}function R(e){const{environment:t,collectionStore:o,calendarBy:r,store:i,insertStores:n,collectionContextStore:s,transaction:l}=e,a=i.getPropertyStore(r).getValue();for(const c of n)g.mp({environment:t,store:c,collectionStore:o,collectionContextStore:s,coerce:!0,groupsPointer:[],transaction:l}),f.sO({store:c.getPropertyStore(r),value:a,transaction:l});return n.map((e=>m.G.createChildStore(o,e.pointer)))}},10912:(e,t,o)=>{o.d(t,{Z:()=>x});o(57658),o(67294);var r=o(83355),i=o(27531),n=o(41432),s=o(80951),l=o(95538),a=o(21202),c=o(97880),d=o(78316),h=o(17311),p=o(35328),u=o(90106),m=o(865),g=o(12981),S=o(81865),y=o(35541),v=o(85893);function f(e){return"number"==typeof e}class C extends r.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t,renderAdditionalBlocks:o}=this.props,r=u.G.createChildStore(t,{table:a.iU,id:e}),n=r.getType(),s=o&&void 0!==n?(0,y.u)(r):(0,m.h)(r);if(s)return(0,v.jsx)(i.D,{value:this.restrictedContentStore,children:(0,v.jsx)(s,{store:r,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,p.BX)(r),style:{fontSize:12,opacity:.8,pointerEvents:"none"},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))},e)})},this.coverStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,o=(0,d.NU)(e,t);return o.image?o.image:o.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e,renderAdditionalBlocks:t=!1}=this.props,o=(0,d.wK)(e,t);return o.image?void 0:o.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,o=[];if(Array.isArray(t)){let r=0;for(;r<t.length;){let i=t[r],s=u.G.createChildStore(e,{table:a.iU,id:i});if(s.getType()===n.Ti.numberedList){const l=[{blockId:i,idx:1}],c=[{id:i,format:void 0,depth:l.length-1,index:l[0].idx}];for(r+=1;r<t.length&&(i=t[r],s=u.G.createChildStore(e,{table:a.iU,id:i}),s.getType()===n.Ti.numberedList);){{const e=s.getParentId();if(s.getParentId()===l[l.length-1].blockId)l.push({blockId:i,idx:1});else{let t=l[l.length-1].idx;for(;l.length>0&&l[l.length-1].blockId!==e;)t=l[l.length-1].idx,l.pop();l.push({blockId:i,idx:t+1})}c.push({id:i,format:void 0,depth:l.length-1,index:l[l.length-1].idx})}r+=1}o.push(c)}else r+=1}}return o}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?this.renderPageCover():"page_content"===e.type?this.renderPageContent():"property"===e.type?this.renderProperty(e.property):void 0}renderPageCover(){var e;const{store:t}=this.props,o=null===(e=t.getCover())||void 0===e?void 0:e.cover;return o?(0,v.jsxs)("div",{style:this.getImageCoverWrapStyle(),children:[(0,v.jsx)(S.Z,{url:o,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),render:(e,t)=>{if(t)return(0,v.jsx)(g.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()]}):this.props.showEmptyGalleryCover?this.renderEmptyGalleryCover():void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state;if(e){if(!Array.isArray(e))return(0,v.jsxs)("div",{style:this.getImageCoverWrapStyle(),children:[(0,v.jsx)(S.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return(0,v.jsx)(g.Z,{style:{...this.getImageStyle(),...this.getPageContentImageStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()]});if(e.length>0)return(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("div",{style:this.getContentWrapStyle(),children:[t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&(0,v.jsx)("div",{style:this.getContentFadedOverlayStyle()})]})});if(this.props.showEmptyGalleryCover)return this.renderEmptyGalleryCover()}else if(this.props.showEmptyGalleryCover)return this.renderEmptyGalleryCover()}renderProperty(e){const{store:t}=this.props,o=(0,s.g)(t.getPropertyValue(e)).find((e=>(0,l.SR)({url:e.url})));return o?(0,v.jsxs)("div",{style:this.getImageCoverWrapStyle(),children:[(0,v.jsx)(S.Z,{onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),url:o.url,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return(0,v.jsx)(g.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()]}):this.props.showEmptyGalleryCover?this.renderEmptyGalleryCover():void 0}renderEmptyGalleryCover(){return(0,v.jsx)("div",{style:{height:this.getCoverHeight(),...this.props.emptyGalleryCoverStyle}})}renderImageBorder(){switch(this.props.variant){case"default":return null;case"gallery":return(0,v.jsx)("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${this.theme.regularDividerColor}`}});default:(0,c.t1)(this.props.variant)}}get imagePosition(){const{coverPosition:e,store:t}=this.props;if(f(e))return e;if(t.getFormatStore().isDefined()){const{page_cover_position:e,card_cover_position:o}=t.getFormat();if(f(o))return o;if(f(e))return e}return.5}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const o of t)if(o.find((t=>t.id===e)))return o;return[]}getImageStyle(){return this.props.style||{}}getCoverHeight(){const{coverHeight:e,coverSizeFormat:t}=this.props;if(e)return e;switch(t){case"large":return h.Z.card.desktop.large.height;case"small":return h.Z.card.desktop.small.height;case"medium":default:return h.Z.card.desktop.medium.height}}getCoverWidth(){const{coverWidth:e,coverSizeFormat:t}=this.props;return e||(0,d.rD)(t)}getImageCoverWrapStyle(){return{height:this.getCoverHeight(),position:"relative",pointerEvents:"none",overflow:"hidden",...this.props.imageCoverWrapStyle}}getContentWrapVariantStyle(){const{ThemeStore:e}=this.environment,t="dark"===e.state.mode;switch(this.props.variant){case"default":return{};case"gallery":return{background:this.theme.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:t?"transparent":`inset 0 -1px 0 0 ${this.theme.regularDividerColor}`,...this.props.contentWrapStyle};default:(0,c.t1)(this.props.variant)}}getContentWrapStyle(){return{height:this.getCoverHeight(),pointerEvents:"none",overflow:"hidden",position:this.props.coverContentFadedOverlay?"relative":"static",...this.getContentWrapVariantStyle(),...this.props.contentWrapStyle}}getContentFadedOverlayStyle(){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${this.theme.accentColors.gray[30]} 100%)`,...this.props.coverContentFadedOverlayStyle}}getCoverVariantStyle(){switch(this.props.variant){case"default":return{border:`1px solid ${this.theme.stroke.regular}`,borderRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,c.t1)(this.props.variant)}}getCoverStyle(){return{width:"100%",height:this.getCoverHeight(),...this.getCoverVariantStyle(),objectPosition:"center"}}getCoverAspectStyle(){const{coverAspectFormat:e}=this.props;return{objectFit:void 0===e?"cover":e}}getPageContentImageStyle(){return{...this.getCoverStyle(),objectPosition:"center center"}}}C.displayName="CollectionItemCover";const x=C},64255:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>md,FULL_SCREEN_PADDING_BOTTOM:()=>cd,default:()=>gd});o(21703);var r=o(67294),i=o(73935),n=o(83355),s=o(1302),l=o(6740),a=o(49085),c=o(15145),d=o(45433),h=o(42509),p=o(65422),u=o(49019),m=o(56666),g=o(45238),S=o(85893);const y=(0,g.I)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,S.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})});var v=o(58810),f=o(15157),C=o(72126),x=o(44615),b=o(21202),w=o(13493),k=o(12139),P=o(82990),T=o(51454),R=o(5366),M=o(50906),I=o(8406),V=o(54642),B=o(48299),F=o(26797),j=o(49865),D=o(5149),A=o(98834),_=o(76427),L=o(32603),Z=o(18957),E=o(52989),O=o(34602),z=o(61045),G=o(87531),H=o(24677),N=o(98104),W=o(39699),K=o(88492),U=o(78454);function $(e){let{origin:t,onPrimaryButtonClick:o,displayStore:r,hasAutomations:i}=e;return(0,S.jsx)(K.r,{origin:t,placementToOrigin:"bottom",alignmentToOrigin:U.v2.End,pointerPosition:"98%",style:{minWidth:240},tutorialId:"database-automations-announcement",tutorialStepId:"database-automations-tooltip",displayStore:r,onPrimaryButtonClick:o,header:(0,S.jsx)(R.FormattedMessage,{id:"DatabaseAutomationsTutorialTooltip.header",defaultMessage:"Put Notion to work"}),content:(0,S.jsx)(R.FormattedMessage,{id:"DatabaseAutomationsTutorialTooltip.content",defaultMessage:"Automatically set status, assignees, and more with automations"}),finalButtonContent:i?(0,S.jsx)(R.FormattedMessage,{id:"DatabaseAutomationsTutorialTooltip.finalButton.viewAutomations",defaultMessage:"View automations"}):(0,S.jsx)(R.FormattedMessage,{id:"DatabaseAutomationsTutorialTooltip.finalButton.createAutomations",defaultMessage:"Create automation"})})}var q=o(92650),Q=o(66890),Y=o(66213),X=o(28020),J=o(93959),ee=o(43250),te=o(97004),oe=o(70764),re=o(75079),ie=o(68641),ne=o(11335),se=o(65742),le=o(78316),ae=o(75081),ce=o(73744),de=o(84210),he=o(12534),pe=o(33929),ue=o(39500),me=o(77546),ge=o(2688),Se=o(18245),ye=o(24646),ve=o(34859),fe=o(80444),Ce=o(61766),xe=o(4926),be=o(886),we=o(58421),ke=o(88632),Pe=o(77080),Te=o(30874),Re=o(96049),Me=o(28209),Ie=o(77144),Ve=o(31792),Be=o(19671),Fe=o(82136),je=o(85844),De=o(13023),Ae=o(88923),_e=o(90106),Le=o(29026),Ze=o(77794),Ee=o(35057),Oe=o(2834),ze=o(14714),Ge=o(97058),He=o(71644),Ne=o(96802),We=o(9953),Ke=o(81849);function Ue(e){const{collectionContextStore:t,groupsPointer:o,hasPartialResults:r}=e,i=t.shouldShowSpinner.state,n="load_general"===t.loadingDetails.state.type&&!r||"load_more_blocks"===t.loadingDetails.state.type&&C.Xy(t.loadingDetails.state.group,o);return i&&n}function $e(e){const{collectionContextStore:t,isForColumnGroups:o}=e,r=o?"load_more_columns":"load_more_groups";return t.isLoading.state&&t.loadingDetails.state.type===r}function qe(e){const{collectionContextStore:t,groupsPointer:o}=e;return t.shouldShowSpinner.state&&"load_more_blocks"===t.loadingDetails.state.type&&C.Xy(t.loadingDetails.state.group,o)}var Qe=o(17504),Ye=function(e){return e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e}(Ye||{});const Xe=Ye;var Je=o(47453),et=o(34583),tt=(o(57658),o(2032)),ot=o(14248),rt=o(42875),it=o(47853),nt=o(16187),st=o(87279),lt=o(98742),at=o(75498),ct=o(86628);function dt(e,t){const{calculating:o,aggregation:r}=e.asyncAggregationStatus.state;return r?o&&(null==t?void 0:t.property)===(null==r?void 0:r.property):o}function ht(e){let{collectionContextStore:t,aggregation:o,children:r}=e;window.__c={n:"AggregationCalculatingIndicator"};return(0,ct.VK)((()=>dt(t,o)),[t,o])?(0,S.jsx)("span",{style:{opacity:.5},children:r}):(0,S.jsx)(S.Fragment,{children:r})}const pt=(0,R.defineMessages)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var ut=o(52275),mt=o(31945),gt=o(78140),St=o(32163),yt=o(40721),vt=o(89728),ft=o(53437),Ct=o(72495),xt=o(26388),bt=o(42782);class wt extends n.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:st.og.Modal,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:e.close}:{menuType:st.og.Popup,width:200},(0,S.jsx)(gt.Z,{...o,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:this.getAggregationActions()}],onAccept:e.close})})},this.handleChangeAggregation=e=>{const{onChange:t,collectionContextStore:o}=this.props;o.isLoading.state||o.loadingDetails.setState({type:"load_aggregation"}),o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:e}),t(e),I.wd({environment:this.environment,collectionContextStore:o,action:"board_change_aggregation"})},this.renderAggregationMenuItem=(e,t,o)=>{const r=nt.Sn[e];return(0,S.jsx)(xt.Z,{placement:ft.GI.Placement.Right,delayThreshold:0,render:e=>(0,S.jsx)(ut.Z,{title:t,...(0,lt.Z)(e,o)}),renderTooltip:()=>(0,S.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r&&(0,S.jsx)("img",{src:(0,it.D)(r),style:{borderRadius:3,width:140,marginTop:4}}),nt.BG[e]]})},o.key)},this.reducerStore=this.createComputedStore((()=>{const{aggregation:e,schema:t,groupFormat:o}=this.props;if(e){return{type:"aggregation",filter:(0,ot.zk)({schema:t,group:o,timeZone:(0,rt.r)()}),aggregation:e}}}))}renderComponent(){const{device:e}=this.environment;return(0,S.jsx)(xt.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>(0,S.jsx)(mt.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,renderOrigin:e=>(0,S.jsx)(vt.Z,{disabled:this.props.disabled,style:{fontWeight:P.Z.fontWeight.regular,color:this.props.color||this.theme.lightTextColor,paddingTop:4,paddingBottom:4,height:void 0,lineHeight:void 0},...(0,lt.Z)(t,e),children:this.renderValue()}),disabled:this.props.disabled,render:this.renderMenu})})}renderTooltipText(){const{aggregation:e,schema:t,collectionContextStore:o}=this.props;if(e){const r=nt.VN[(0,tt.OV)(e)],i=dt(o,e);if((0,tt.pK)(e)){const o=t[e.property];if(o){const e=o.name;return pe.default.formatMessage(pt.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})}}return pe.default.formatMessage(pt.aggregationType,{aggregationType:r,calculating:i})}return(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}renderValue(){const{schema:e,aggregation:t,collectionContextStore:o,groupFormat:r}=this.props,i=this.reducerStore.state;if(t&&i)return(0,S.jsx)(at.Z,{id:`board:${(0,ze.mD)(r)}`,collectionContextStore:o,reducer:i,groupsPointer:[r],render:o=>{const r=o.state;if(!r||"aggregation"!==r.type)return null;let i;if((0,tt.pK)(t)){const o=e[t.property];!o||"formula"!==o.type&&"number"!==o.type||(i=o.number_format)}return(0,S.jsx)(ht,{aggregation:t,collectionContextStore:this.props.collectionContextStore,children:(0,nt.Ol)({numberFormat:i,dateFormat:void 0,aggregationType:t.aggregator,userTimeZone:(0,rt.r)(),value:r.aggregationResult,roundDecimal:5})})}})}getAggregationActions(){const e=[];for(const n of tt.o5)e.push(this.createCountAggregationAction(n));const t=this.getDefaultProperties();if(t.length>0)for(const n of tt.Sy)"show_unique"!==n&&e.push(this.getAggregationGroupAction(n,t));const o=this.getNumericProperties();if(o.length>0)for(const n of tt.k$)e.push(this.getAggregationGroupAction(n,o));const r=this.getDateProperties();if(r.length>0)for(const n of tt.f8)e.push(this.getAggregationGroupAction(n,r));const i=this.getCheckboxProperties();if(i.length>0)for(const n of tt.gC)e.push(this.getAggregationGroupAction(n,i));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,r=nt.VN[e],i=C.oA(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+r,render:(e,t)=>(0,S.jsx)(bt.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,S.jsx)(ut.Z,{...e,ref:t,title:r}),renderExtension:(e,n)=>{let s;return s=o.isMobile?{menuType:st.og.Modal,title:r,right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:n.close,...e}:{menuType:st.og.Popup,width:200,...e},(0,S.jsx)(gt.Z,{...s,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:i}],onAccept:t.onAccept})})}}),action:()=>null}}getDefaultProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}getNumericProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.O4)(o)}))}getDateProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.dN)(o)}))}getCheckboxProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.Mv)(o)}))}createCountAggregationAction(e){const t=nt.VN[e];return{key:e,render:o=>this.renderAggregationMenuItem(e,t,o),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const r=o.name;return{key:`${e} ${t}`,render:e=>this.renderAggregationMenuItem(t,r,e),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}}wt.displayName="BoardAggregation";const kt=wt;var Pt=o(70203);function Tt(e){var t;const{transaction:o,environment:r,collectionContextStore:i,isFullScreen:n,groupsPointer:s,insertAtIndex:l,from:a,transient:d}=e,h=null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore;if(!h)return;i.searchQuery.state&&_.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const p=j.IW({environment:r,collectionContextStore:i,groupsPointer:s,insertAtIndex:l,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:a});if(!p)return;const u=p.coercionSucceeded,m=p.newStore;if(r.device.isMobile)O.navigateToBlock({environment:r,store:m,pageVisitSource:c.tY.Create});else if(u){const e=m.getBlockTitleStore();H.eP({environment:r,store:m}),N.NX({store:e}),_.Z5({store:m,transient:d})}else O.peekBlock({environment:r,store:m,peekMode:(0,le.kr)(i.collectionViewStore()),resultsStore:h,collectionContextStore:i,pageVisitSource:c.tY.Create});M.W2j(r,{from:a,type:"page",new_page_id:m.id,...(0,re.Pn)(i)})}var Rt=o(52821),Mt=o(68785);class It extends n.Z{constructor(){super(...arguments),this.handleClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupsPointer:o}=this.props;"collectionTypedView"!==e.contextType&&et.M_(this.environment)&&e.collectionStore()&&W.createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:this.environment,perform:r=>{Tt({transaction:r,environment:this.environment,collectionContextStore:e,isFullScreen:t,groupsPointer:o,from:"board_group_add_item_bottom",transient:!1})}})}}renderComponent(){const{shouldShowSpinner:e}=this.props,t=this.theme.lightTextColor;return(0,S.jsxs)(vt.Z,{icon:e=>(0,Je.R)({...e,fill:this.props.color||t}),isLightGray:!0,isLarge:!0,style:{width:"100%",color:this.props.color||t},onClick:this.handleClick,onMouseDown:he.$0,children:[(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"database.boardView.addItemButtonTitle"}),e&&(0,S.jsx)("div",{style:{margin:"0 0 0 auto"},children:(0,S.jsx)(Mt.Z,{style:{width:12,height:12}})})]})}}It.displayName="BoardGroupAddItemButton";const Vt=It;var Bt=o(99036),Ft=o(6695),jt=o(25651),Dt=o(95855),At=o(54497),_t=o(6404),Lt=o(51365),Zt=o(49616),Et=o(68056),Ot=o(65598),zt=o(19511),Gt=o(22294),Ht=o(27724),Nt=o(24666),Wt=o(87636),Kt=o(10912),Ut=o(97039),$t=o(78030),qt=o(65089),Qt=o(64921),Yt=o(3386),Xt=o(84076),Jt=o(31278),eo=o(50919),to=o(65187),oo=o(56282);const ro=(0,R.defineMessages)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}});class io extends Oe.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={mouseStore:Ve.Z,editModeStore:a.default},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:r,handleRepositionClick:i,handleSavePositionClick:n}=e;const{store:s,coverFormat:l,coverAspectFormat:a,collectionContextStore:c}=this.props,{device:d}=this.environment,{isMobile:h}=d,p=this.lastProxiedUrl&&l&&"contain"!==a,u=c.permissionScopes.state,g=s.canEdit()&&("collectionTypedView"===c.contextType||u.canEditContent);if(t&&!this.shouldShowActionButton.state)return;const y=Ae.default.state.open&&Ae.default.state.target.id===s.id,v=le.kr(null==c?void 0:c.collectionViewStore()),f=(0,Zt.X9)(v,!1);return(0,S.jsxs)(Wt.Z,{isVisible:t,position:"top",children:[p&&!o&&!h&&(0,S.jsx)(Qt.Z,{style:eo.Z.actionButtonStyle,onClick:e=>i(e,this.lastProxiedUrl),children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}),p&&o&&!h&&(0,S.jsx)(Qt.Z,{style:eo.Z.actionButtonStyle,onClick:n,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}),p&&o&&!h&&(0,S.jsx)(Qt.Z,{style:eo.Z.actionButtonStyle,onClick:r,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}),this.shouldShowEditButton.state&&g&&!this.normalizedCardSelectionStore.state&&!u.isSyncedCollection&&(0,S.jsx)(xt.Z,{renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:e=>(0,S.jsx)(Qt.Z,{style:eo.Z.actionButtonStyle,onClick:()=>{this.handleEditButtonClick("click")},...e,children:(0,jt.R)({width:16,height:16})})}),this.normalizedCardSelectionStore.state&&!y&&(0,S.jsx)(xt.Z,{renderTooltip:()=>f.tooltip,render:e=>(0,S.jsx)(Qt.Z,{style:eo.Z.actionButtonStyle,onClick:()=>{this.peekUrl.state&&(O.navigate({environment:this.environment,url:this.peekUrl.state}),this.disallowEmptyDelete())},...e,children:f.icon({width:14,height:14})})}),!o&&(0,S.jsx)(xt.Z,{renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:e=>(0,S.jsx)(Qt.Z,{style:eo.Z.actionButtonStyle,onClick:this.handleActionButtonClick,...e,children:(0,m.o)({width:14,height:14})})})]})},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=t.getAssociatedCollectionStore();if(!n)return;const s=this.normalizedCardSelectionStore.state,l="gallery"===this.getViewType()?$t.C.GalleryView:$t.C.Board,a=Boolean(i.normalizedFormatStore.state.table_wrap);return(0,S.jsx)(Ut.Z,{store:t,property:e.property,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:l,tableWrap:a||Boolean(e.wrap),blockPropertyValueOverlayStore:r,collectionStore:n,showIfEmpty:s,onEnter:this.handleBlockPropertyEsc,onEsc:this.handleBlockPropertyEsc,onBgClick:this.handleBlockPropertyEsc,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e.property)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=Ot.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return(0,S.jsxs)("div",{style:this.getDiscussionIndicatorWrapStyle(),children:[(0,Dt.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]})},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;W.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{Ne.bf({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleBlockEnter=()=>{const{store:e,onTextEnter:t}=this.props;t&&t(e)},this.handleBlockSpace=()=>{this.handleEditButtonClick("space")},this.handleEditButtonClick=e=>{const{store:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores,i=(0,Rt.JI)(t);H.eP({environment:this.environment,store:t}),N.NX({store:i}),_.Z5({store:t}),e&&M.sdb(this.environment,"board_item_edit_mode_enter",{...(0,re.Pn)(o),block_id:t.id,from:e,view_type:this.getViewType()}),r.setState("existing")},this.handleClick=e=>{this.normalizedCardSelectionStore.state?e.preventDefault():(this.props.handleOpenPeekPage(),this.disallowEmptyDelete())},this.handleActionButtonClick=e=>{const{collectionContextStore:t}=this.props;H.Ys({environment:this.environment,store:this.props.store}),_t.Qn({environment:this.environment,stores:Ht.default.state.stores,left:e.clientX,top:e.clientY,showInput:!0,actionSectionGroupKey:"default",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:t}})},this.handleTextEnter=()=>{const{store:e,onTextEnter:t,onTextEsc:o,collectionContextStore:r}=this.props,{editModeStore:i}=this.stores;_.MO(),N.ZH(this.environment);e.canEdit()&&r.permissionScopes.state.canEditContent&&("new_empty"===i.state?o(e):"new"===i.state?t(e):H.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextEsc=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;_.MO();e.canEdit()&&o.permissionScopes.state.canEditContent&&("new_empty"===r.state?t(e):H.Ys({environment:this.environment,store:e}),this.disallowEmptyDelete())},this.handleTextTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=this.getShowProperties().map((e=>e.property));o.length>0&&Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:o[0],format:$t.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleTrackTitlePropertyEdit=()=>{const e=this.getViewType();if(!e)return;const{store:t,collectionContextStore:o}=this.props;I.rv({environment:this.environment,collectionContextStore:o,block_id:t.id,property:"title",property_type:"text",from:e}),this.disallowEmptyDelete()},this.handleTextUntab=()=>{const e=this.getShowProperties().map((e=>e.property)),t=C.dF(e,((e,t)=>this.canOpenProperty(e)));t&&Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:t,format:$t.C.Page,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyDelete()},this.handleBlockPropertyEsc=()=>{Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),H.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyDelete()},this.handleBlockPropertyTab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state,r=this.getShowProperties().map((e=>e.property)),i=o.isOpen?r.findIndex((e=>e===o.property)):-1,n=r.find(((e,t)=>t>i&&this.canOpenProperty(e)))||r.find(((e,t)=>!this.normalizedCardSelectionStore.state&&this.canOpenProperty(e)));n?s.default.afterNextFlush((()=>{Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:$t.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&s.default.afterNextFlush((()=>{this.handleEditButtonClick()})),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleBlockPropertyUntab=()=>{const{store:e,blockPropertyValueOverlayStore:t}=this.props,o=t.state;if(!o.isOpen)return;const r=this.getShowProperties().map((e=>e.property)),i=r.findIndex((e=>e===o.property)),n=C.dF(r,((e,t)=>t<i&&this.canOpenProperty(e)))||C.dF(r,((e,t)=>!this.normalizedCardSelectionStore.state&&this.canOpenProperty(e)));n?s.default.afterNextFlush((()=>{Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:t,store:e,property:n,format:$t.C.Page,collectionContextStore:this.props.collectionContextStore})})):this.normalizedCardSelectionStore.state&&s.default.afterNextFlush((()=>{this.handleEditButtonClick()})),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:t}),this.disallowEmptyDelete()},this.handleMouseMove=()=>{if(!Re.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=C.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=C.Ds(this.handleMouseLeave,100),this.handleRecordIconChange=async e=>{const{store:t}=this.props,o=t.getIconStore();if(o){const{serverCommitResult:t}=W.createAndCommit({userAction:"PageViewBlock.handleRecordIconChange",environment:this.environment,perform:t=>{We.sO({store:o,value:e,transaction:t})}});await t}this.disallowEmptyDelete()},this.tryDeleteEmptyOnBlur=()=>{const{store:e,onTextEsc:t,collectionContextStore:o}=this.props,{editModeStore:r}=this.stores;"new_empty"!==r.state||this.normalizedCardSelectionStore.state||o.defaultPageTemplateStore.state||(t(e),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur))},this.getViewType=()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();return null==t?void 0:t.getType()},this.normalizedCardSelectionStore=this.createComputedStore((()=>{const e=zt.Z.state;return e.isActive&&e.store===this.props.store})),this.isItemSelectedStore=this.createComputedStore((()=>Ht.default.state.stores.includes(this.props.store))),this.shouldShowEditButton=this.createComputedStore((()=>{const e=this.isEditingTitle.state,t=this.getVisibleProperties(),o=this.getShowProperties();return!e&&(this.props.shouldShowTitle||t.length>0&&t.length!==o.length)})),this.isEditingTitle=this.createComputedStore((()=>{var e;const{blockPropertyValueOverlayStore:t}=this.props,o=Nt.default.state;return"editing"===o.mode&&(null===(e=(0,Et.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,Rt.JI)(this.props.store)&&!t.state.isOpen})),this.peekUrl=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=fe.default.state;return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.pageUrl=this.createComputedStore((()=>{const{store:e}=this.props;return(0,de.ZP)({store:e,fullyQualified:!1,pageVisitSource:c.tY.LinkInPage})})),this.shouldShowActionButton=this.createComputedStore((()=>{const{device:e}=this.environment,{isKeyboardMode:t}=Gt.Z.state;return!e.isMobile&&this.canEdit()&&!t})),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered&&!Re.Z.state)),this.disallowEmptyDelete=()=>{const{editModeStore:e}=this.stores;"new_empty"===e.state&&(e.setState("new"),zt.Z.state.isActive&&zt.Z.setState({...zt.Z.state,transient:!1}))}}activate(){const e=this.peekUrl.state;e&&(this.props.handleOpenPeekPage(),O.navigate({environment:this.environment,url:e}))}willMount(){var e;const{editModeStore:t}=this.stores,o=Nt.default.state,r="editing"===o.mode&&(null===(e=(0,Et.QY)(o.multiSelection))||void 0===e?void 0:e.store)===(0,Rt.JI)(this.props.store),i=zt.Z.state,n=i.isActive&&i.transient;r&&n?t.setState("new_empty"):r?t.setState("new"):t.setState("existing")}didMount(){const{editModeStore:e}=this.stores;super.didMount(),this.normalizedCardSelectionStore.state&&"new_empty"===e.state&&this.normalizedCardSelectionStore.addListener(this.tryDeleteEmptyOnBlur)}willUnmount(){super.willUnmount(),this.normalizedCardSelectionStore.removeListener(this.tryDeleteEmptyOnBlur)}renderComponent(){const{device:e}=this.environment,{store:t,coverFormat:o,coverAspectFormat:i,coverWidth:n,coverHeight:s,coverSizeFormat:l,shouldShowTitle:a,colorStyle:c,onShiftEnter:d}=this.props,h=this.pageUrl.state,p=this.peekUrl.state,u=this.mouseIsEntered.state,m=this.normalizedCardSelectionStore.state,g=this.getViewType(),y=(0,r.createRef)(),v=(0,S.jsxs)(Xt.Z,{ref:y,style:{...this.getStyle(),position:u?"relative":"static",..."gallery"===g&&{height:"100%"}},innerStyle:{userSelect:m?void 0:"none",WebkitUserSelect:m?void 0:"none",height:"100%",..."board"===g&&{minHeight:40},..."gallery"===g&&{display:"flex",flexDirection:"column"}},hoveredStyle:{background:m?"transparent":(null==c?void 0:c.cardHoveredBackgroundColor)||this.theme.cardHoveredBackground},pressedStyle:{background:m?"transparent":(null==c?void 0:c.cardPressedBackgroundColor)||this.theme.cardPressedBackground},href:h,metaHref:e.isMobile?h:p,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,onClick:this.handleClick,children:[(0,S.jsx)(oo.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,source:g,small:"small"===l,store:this.props.store,renderControl:this.renderControl,render:e=>{let{imagePosition:r}=e;return o&&(0,S.jsx)(Kt.Z,{variant:"gallery",store:t,coverWidth:n,coverHeight:s,coverFormat:o,coverAspectFormat:i,coverSizeFormat:l,coverPosition:r,showEmptyGalleryCover:"gallery"===g,onLoadProxiedImage:e=>{this.lastProxiedUrl=e}})}}),a&&this.renderTitle(),this.renderProperties(),this.renderDiscussionIndicator()]}),f=this.isItemSelectedStore.state;return(0,S.jsx)(Yt.Z,{capture:m,onEsc:()=>{_.MO(),this.disallowEmptyDelete()},onEnter:this.handleBlockEnter,onSpace:this.handleBlockSpace,onTab:this.handleBlockPropertyTab,onUntab:this.handleEditButtonClick,children:(0,S.jsxs)(Yt.Z,{capture:f,onShiftEnter:()=>{W.createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{d({blocks:Ht.default.state.stores,transaction:e})}})},children:[v,this.showTutorialTooltip()&&(0,S.jsx)(qt.bZ,{origin:y})]})})}renderTitle(){const{device:e}=this.environment,{store:t,collectionContextStore:o}=this.props,r=(0,Rt.JI)(t),i=t.hasIcon()||!t.isEmptyPage(),n=t.hasError(),s=t.canEdit()&&o.permissionScopes.state.canEditContent,l=this.normalizedCardSelectionStore.state,a=this.getViewType(),c=s?(0,S.jsx)(Jt.Z,{disabled:!1,bucket:"secure",style:{...this.getRecordIconStyle(),...e.isMobile?io.mobileTitleIconStyle:io.desktopTitleIconStyle,..."board"===a&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}},progressContainerStyle:this.getRecordIconProgressStyle(),icon:t.getIcon(),store:t,onChange:this.handleRecordIconChange,size:e.isMobile?24:20,isEmptyPage:t.isEmptyPage()}):(0,S.jsx)(Jt.Z,{disabled:!0,bucket:"secure",style:{...this.getRecordIconStyle(),...e.isMobile?io.mobileTitleIconStyle:io.desktopTitleIconStyle},progressContainerStyle:this.getRecordIconProgressStyle(),icon:t.getIcon(),store:t,size:e.isMobile?24:s?20:18,isEmptyPage:t.isEmptyPage()}),d=(0,S.jsx)(to.Z,{store:r,disabled:!l,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnter,onEsc:this.handleTextEsc,onTab:this.handleTextTab,onUntab:this.handleTextUntab,onChange:this.handleTrackTitlePropertyEdit,placeholder:l?pe.default.formatMessage(ro.typeAName):pe.default.formatMessage(ro.untitledBlock),style:{...e.isMobile?io.mobileTitleTextStyle:io.desktopTitleTextStyle,..."board"===a&&{flexGrow:1,padding:2},pointerEvents:l?void 0:"none",cursor:l?"text":void 0,..."gallery"===a&&{whiteSpace:"pre-wrap"}},disableSelectAllBlocks:!0,pasteBehavior:"inline"});return(0,S.jsxs)("div",{style:this.getTitleWrapStyle(),children:[(i||l)&&!n&&c,n&&(0,At.t)({fill:this.theme.accentColors.orange[500],width:e.isMobile?20:16,marginLeft:e.isMobile?2:4,marginRight:e.isMobile?4:6,paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom"}),d]})}renderProperties(){const e=this.getShowProperties();if(0!==e.length)return(0,S.jsx)("div",{style:this.getPropertiesWrapStyle(),children:e.map(this.renderProperty)})}canOpenProperty(e){const{schema:t}=this.props,o=t[e];return Boolean(o&&!Bt.uk.includes(o.type))}getVisibleProperties(){const{format:e}=this.props;return(("board"===this.getViewType()?e.board_properties:e.gallery_properties)||[]).filter((e=>e.visible))}getShowProperties(){const{store:e,schema:t}=this.props,o=this.getVisibleProperties();if(!e.isDefined())return[];return o.filter((o=>{const r=this.normalizedCardSelectionStore.state&&"title"!==o.property;return Ft.XU({block:e.getModel(),property:o.property,schema:t,getRecordModel:this.props.store.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,rt.r)(),intl:pe.default.getIntl()})||r}))}hasNoProperties(){return 0===this.getShowProperties().length}showTutorialTooltip(){var e,t,o;const{store:r,collectionContextStore:i}=this.props;return!(r.getSpaceId()!==(null===(e=fe.default.state.currentSpaceStore)||void 0===e?void 0:e.id))&&((null===(t=i.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===d.g3&&r.getFormat().app_config_uri===d.z3&&"sprint_board"===(null===(o=fe.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch))}getStyle(){const{colorStyle:e}=this.props,t=this.getViewType();return{boxShadow:e?this.theme.selectTypeBoardBoxShadow:this.theme.lightBoxShadow,borderRadius:"board"===t?4:3,background:"board"===t?(null==e?void 0:e.cardBackgroundColor)||this.theme.boardItemDefaultBackground:this.theme.collectionGalleryPreviewCardBackground,overflow:"hidden",transition:"background 100ms ease-out",..."board"===t&&{marginBottom:ri}}}getRecordIconStyle(){return{..."board"===this.getViewType()&&{marginTop:1,marginLeft:0,marginRight:2,borderRadius:5,padding:2,width:24,height:24}}}getRecordIconProgressStyle(){return{top:14,bottom:"unset",right:"unset",fontSize:12}}getTitleWrapStyle(){const e=this.getViewType();return{..."gallery"===e&&{width:"100%"},display:"flex",paddingTop:8,paddingLeft:"board"===e?6:10,paddingRight:10,paddingBottom:"gallery"===e&&this.hasNoProperties()?10:6,position:"relative"}}getDiscussionIndicatorWrapStyle(){const e=this.getViewType();return{display:"flex",alignItems:"center",color:this.theme.lightTextColor,fill:this.theme.lightTextColor,fontWeight:P.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10,paddingBottom:8,..."gallery"===e&&{paddingTop:this.hasNoProperties()&&!this.props.shouldShowTitle?8:0}}}getPropertiesWrapStyle(){const{shouldShowTitle:e}=this.props;return{paddingTop:e?0:8,paddingBottom:10,..."board"===this.getViewType()&&{lineHeight:1.5,paddingBottom:4,display:"flex",flexDirection:"column"}}}}io.displayName="CollectionViewCardItem",io.desktopTitleIconStyle={float:"left",marginTop:2,marginRight:4,marginLeft:-2},io.mobileTitleIconStyle={float:"left",marginTop:0,marginRight:4,marginLeft:-2},io.desktopTitleTextStyle={fontSize:14,lineHeight:1.5,minHeight:21,fontWeight:P.Z.fontWeight.medium,width:"auto"},io.mobileTitleTextStyle={fontSize:16,lineHeight:1.5,minHeight:24,fontWeight:P.Z.fontWeight.medium,width:"auto"};const no=io;class so extends Oe.Z{renderComponent(){return(0,S.jsx)(no,{store:this.props.store,disabled:this.props.disabled,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,hideContent:this.props.hideContent,blockResizerStore:this.props.blockResizerStore,isQuickFind:this.props.isQuickFind,style:this.props.style,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore,bulletedListFormatStore:this.props.bulletedListFormatStore,format:this.props.format,schema:this.props.schema,coverFormat:this.props.coverFormat,coverAspectFormat:this.props.coverAspectFormat,coverSizeFormat:this.props.coverSizeFormat,coverHeight:void 0,coverWidth:void 0,shouldShowTitle:this.props.shouldShowTitle,colorStyle:this.props.colorStyle,onTextEnter:this.props.onTextEnter,onTextEsc:this.props.onTextEsc,onShiftEnter:this.props.onShiftEnter,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isLast:this.props.isLast,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionContextStore:this.props.collectionContextStore})}}so.displayName="BoardItem";const lo=so;var ao=o(34232),co=o(24405);class ho extends a.default{getInitialState(){return{}}}const po=ho;var uo=o(480);class mo extends Oe.Z{renderComponent(){return(0,S.jsx)(no,{store:this.props.store,disabled:this.props.disabled,isFirstItem:this.props.isFirstItem,isLastItem:this.props.isLastItem,hideContent:this.props.hideContent,blockResizerStore:this.props.blockResizerStore,isQuickFind:this.props.isQuickFind,style:this.props.style,disableCommentMenu:this.props.disableCommentMenu,disableHoverMenu:this.props.disableHoverMenu,disableDrag:this.props.disableDrag,numberedListCounterStore:this.props.numberedListCounterStore,bulletedListFormatStore:this.props.bulletedListFormatStore,format:this.props.format,schema:this.props.schema,coverFormat:this.props.coverFormat,coverAspectFormat:this.props.coverAspectFormat,coverSizeFormat:this.props.coverSizeFormat,coverHeight:this.props.coverHeight,coverWidth:this.props.coverWidth,shouldShowTitle:this.props.shouldShowTitle,colorStyle:void 0,onTextEnter:this.props.onTextEnter,onTextEsc:this.props.onTextEsc,onShiftEnter:this.props.onShiftEnter,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,isLast:this.props.isLast,handleOpenPeekPage:this.props.handleOpenPeekPage,collectionContextStore:this.props.collectionContextStore})}}mo.displayName="CollectionGalleryViewItem";const go=mo;var So=o(76205),yo=o(59054),vo=o(40745),fo=o(95371),Co=o(77181),xo=o(40150),bo=o(73807),wo=o(20144),ko=o(48543),Po=o(79954);class To extends n.Z{constructor(){super(...arguments),this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;return s?j.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,insertStores:t,store:r,before:!1,transaction:o}):[]},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;return s?j.$T({environment:this.environment,collectionStore:s,collectionContextStore:i,groupsPointer:n,insertStores:t,store:r,before:!0,transaction:o}):[]},this.handleRemove=e=>{const{store:t,collectionContextStore:o,groupsPointer:r}=this.props,{transaction:i}=e;r.length>0&&j.BN({store:t,transaction:i,groupsPointer:r,collectionContextStore:o,environment:this.environment}),j.Od({store:t,transaction:i})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{store:i,collectionContextStore:n,groupsPointer:s,subitemPath:l}=this.props,a=this.associatedCollectionStore.state;if(!a)return[];const c=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(c,{environment:this.environment,getData:()=>re.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})}),W.createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:this.environment,perform:e=>{j.by({environment:this.environment,collectionStore:a,targetStore:i,droppedDirection:t,collectionContextStore:n,groupsPointer:s,droppedStores:o,duplicate:r,transaction:e,subitemPath:l})}})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{store:r,collectionContextStore:i,groupsPointer:n}=this.props,s=this.associatedCollectionStore.state;if(!s)return[];const l=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>re.yr({collectionContextStore:i,is_native_drop:!0,is_empty:!1})}),W.createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:this.environment,perform:e=>{j.tQ({environment:this.environment,collectionStore:s,targetStore:r,droppedDirection:o,collectionContextStore:i,groupsPointer:n,files:t,transaction:e})}})},this.handleInsertRow=e=>t=>{var o;let{transaction:r}=t;const{store:i,collectionContextStore:n,groupsPointer:l,subitemPath:a,blockPropertyValueOverlayStore:c,onSelectableInsertRow:d}=this.props,h=this.associatedCollectionStore.state;if(!h)return[];const p=j.yk({environment:this.environment,collectionContextStore:n,groupsPointer:l,store:i,before:"above"===e,collectionStore:h,transaction:r,subitemPath:a,subitemInsertDirection:"below"});M.W2j(this.environment,{type:"page",from:"below"===e?"table_insert_below":"table_insert_above",collection_view_type:null===(o=n.collectionViewStore())||void 0===o?void 0:o.getType(),new_page_id:null==p?void 0:p.id}),p&&d&&d(i,p),p&&c&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{Lt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:c,store:p,property:"title",format:$t.C.Table,collectionContextStore:n})}))}))},this.handleOpenPeekPage=()=>{const{collectionContextStore:e,handleOpenPeekPage:t}=this.props,o=e.collectionViewStore();Se.default.mark("collections.open_item_page_lag"),t&&t(),Z.Xd({collectionContextStore:e,resultsStore:this.resultsStore.state});const r=null==o?void 0:o.getType();if(r){const e=null==o?void 0:o.getFormat().collection_peek_mode,t=e||ko.Ls[r];M.hym(this.environment,{is_peek:!0,from:r,peek_mode:t})}},this.canEditStore=this.createComputedStore((()=>this.props.store.canEdit())),this.associatedCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore())),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore})),this.shouldShowHighlightHalo=this.createComputedStore((()=>le.Sc(this.props.store))),this.normalizedCollectionViewSelectionStore=this.createComputedStore((()=>{const e=zt.Z.state;return e.isActive&&e.store===this.props.store}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){const{store:e,resultProps:t,resultComponent:o,collectionContextStore:i,canDrag:n,canDrop:s,getItemSelectableStyle:l,belowDropZoneMargin:a,analyticsName:c,disabled:d,direction:h,onSelectableEnter:p,disableScrollToRevealHorizontal:u,touchDragOnly:m,isLast:g,groupsPointer:y,toggleButton:v,subitemPath:f,disableSelectable:C,itemSelectableHaloStyle:x}=this.props,b=!d&&this.canEditStore.state,w=this.props.shouldShowHoverMenu&&b,k=h!==Fo.Vertical&&s,P=h!==Fo.Vertical&&s,T=h===Fo.Vertical&&s,R=r.createElement(o,{handleOpenPeekPage:this.handleOpenPeekPage,collectionContextStore:i,...t,store:e,key:e.id,isLast:g,toggleButton:v,subitemPath:f});return C?R:(0,S.jsx)(Po.Z,{style:l?l(g):void 0,store:e,canSelect:b,shouldShowHalo:!this.normalizedCollectionViewSelectionStore.state,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,haloStyle:{...le.pB(this.shouldShowHighlightHalo.state,this.theme),...x},canDrag:n,canDropBelow:T,canDropLeft:k,canDropRight:P,canNativeDropBelow:T,canNativeDropLeft:k,canNativeDropRight:P,canDropOnto:s,canTriggerContextMenu:b,showBlockMenuInput:!0,shouldShowHoverMenu:w,shouldShowCommentMenu:!1,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onRemove:this.handleRemove,canInsertAbove:s,canInsertBelow:s,onInsertRowBelow:this.handleInsertRow("below"),onInsertRowAbove:this.handleInsertRow("above"),belowDropZoneMargin:a,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:c,shouldShowDropZone:s,dropzoneGap:this.props.dropzoneGap,onEnter:p,className:ee.K4T,disableScrollToRevealHorizontal:u,touchDragOnly:m,groupsPointer:y,children:R})}}To.displayName="CollectionGroupResultsItem";const Ro=To;var Mo=o(5210);const Io=function e(t){window.__c={n:"CollectionGroupResultsNestedItem"};const{store:o,collectionContextStore:i,subitemPath:n,titleColumnIndex:s,nestedCreateSubitemButton:l,getItemSelectableStyle:a}=t,{currentSubitemFormatStore:c,subitemExpandedStore:d,subitemTreeStore:h}=i,p=(0,ct.VK)((()=>le.Bm({store:o,collectionContextStore:i})),[i,o]),u=(0,ct.VK)((()=>n&&n.length>0?n:(0,fo.DY)(h.state.children,(e=>e.value.store===o))),[n,h,o],{useDeepEqual:!0}),m=u?(0,Co.Af)(u.map((e=>e.value.store))):"",g=(0,ct.VK)((()=>d.state.get(m)),[d,m]),y=Boolean(null==g?void 0:g.isExpanded),v=(0,uo.O7)(),f=(0,ct.VK)((()=>{const e=c.state;if(!e||!p)return;const t=p.getSchema()[e.property];return void 0!==t&&(0,Bt.p_)(t)?t:void 0}),[c,p]),C=(0,ct.VK)((()=>{var e;return f&&"relation"===f.type&&(0,Bt.F0)(f)===(null===(e=i.collectionStore())||void 0===e?void 0:e.id)&&f.property}),[i,f]),x=(0,ct.VK)((()=>{var e;return null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType()}),[i]),b=(0,ct.VK)((()=>{const e=!C||x&&(0,Co.Av)(x)?void 0:{property:C,filter:{operator:"is_empty"}};return!(!c.state||!p)&&(0,Co.kC)({store:o,collectionStore:p,subitemFormat:c.state,subitemPathKey:m,collectionContextStore:i,propertyFilters:[...e&&C?[{id:C,filter:e}]:[],...i.currentPropertyFiltersStore.state],combinatorFilter:i.currentCombinatorFilterStore.state,currentUserId:v.currentUser.id}).length>0}),[i,x,c,v.currentUser.id,C,p,m,o]),w=(0,ct.VK)((()=>{var e;if(!c.state||!p)return!1;const t=null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType();return b||y||v.device.isMobile||"timeline"===t}),[c,v.device.isMobile,p,b,y,i]),k=(0,ct.VK)((()=>wo.Z.getState().hoveredStore===o),[o]),P=(0,ct.VK)((()=>{const e=(0,te.m1)({collectionContextStore:i,environment:v});if(e)return(0,So.q)(e)}),[i,v]),T=(0,r.useCallback)((()=>{const e=d.state;if(y)e.delete(m),M.iwE(v,{...(0,re.Pn)(i),depth:(null==u?void 0:u.length)||0}),d.emit();else{e.set(m,{isExpanded:!0,limit:20}),M.uCY(v,{...(0,re.Pn)(i),depth:(null==u?void 0:u.length)||0});const t=c.state;P&&e&&f&&t?(0,Co.fd)({blockStore:o,subitemExpandedStore:d,subitemFormat:t,propertySchema:f,compiledFilter:P,pathKey:m,forceStoresToLoad:!1,visitedIds:new Set}).then((()=>{d.emit()})):d.emit()}}),[P,d,y,m,i,c,v,u,o,f]),R=(0,ct.VK)((()=>{const e=h.state;return e&&u?(0,Co.Ns)(e).value.store===o:t.isLast}),[h,t.isLast,o,u]),I=(0,bo._)(),V=(0,ct.VK)((()=>{var e;const t=o.getModel(),r=o.getRecordModel;if(!P||!t)return!0;const i=null===(e=o.getParentCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return P({block:t,getRecordModel:r,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+I})}),[P,o,I]),B=(0,ct.VK)((()=>a&&!V?()=>({...a?a(R):{},...V?{}:{opacity:.5}}):a),[a,V,R]);(0,yo.r5)((async()=>{const e=o.getModel();await o.load();const t=o.getRecordModel,r=c.state;if(!w||!e||!P||!f||!t||!r||V)return;(0,Co.xb)({store:o,subitemFormat:r,propertySchema:f}).length>0||(await(0,Co.fd)({blockStore:o,subitemExpandedStore:d,subitemFormat:r,propertySchema:f,compiledFilter:P,pathKey:m,forceStoresToLoad:!0,visitedIds:new Set}),d.emit())}),[w,P,c,V,m,o,d,f]);const F=(0,co.Fg)(),j=(0,S.jsx)(Ro,{...t,isLast:R,getItemSelectableStyle:B,subitemPath:u,toggleButton:(w||k)&&(0,S.jsx)(Mo.Z,{isSidebar:!1,open:y,fill:!0,onClick:T,color:b||y?F.regularIconColor:F.mediumIconColor,disabled:u&&u.length>=Co.F0})});if(!y||!u||0===u.length||u.length>=Co.F0)return j;const D=u[u.length-1].children;return(0,S.jsxs)(S.Fragment,{children:[j,D.map((o=>{const i=o.value.store;return(0,r.createElement)(e,{...t,key:i.id,store:i,subitemPath:[...u,o]})})),p&&l&&l({store:o,parentStore:p,subitemPath:u,indentLevel:u.length,titleColumnIndex:s}),g&&D.length>0&&D.length===g.limit&&(0,S.jsx)(Vo,{collectionContextStore:t.collectionContextStore,pathKey:m,titleColumnIndex:s,limit:g.limit,indentLevel:u.length})]})},Vo=r.memo((function(e){window.__c={n:"NestedTableLoadMoreButton"};const{collectionContextStore:t,pathKey:o,titleColumnIndex:i,limit:n,indentLevel:s}=e,l=(0,r.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:n+20}),e.emit()}),[t,n,o]),a=(0,uo.O7)(),c=(0,ct.VK)((()=>le.fk({environment:a,collectionContextStore:t})),[t,a]),d=(0,ct.VK)((()=>{var e;return(0,J.$4)()&&"title"===(null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[t]),h=(0,co.yK)((e=>({button:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:8+(0,xo.f2)({columnIndex:0,titleColumnIndex:i,shouldShowBulkActionsToolbar:c,indentLevel:s+1,isSubitemToggleOnTitleColumn:d}),fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,borderTop:`1px solid ${e.tableDividerColor}`,borderBottom:`1px solid ${e.tableDividerColor}`,background:e.cardContentBackground},icon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:e.lightIconColor},label:{color:e.lightTextColor}})),[s,c,i,d]);return(0,S.jsxs)(Qt.Z,{onClick:l,onMouseDown:he.$0,style:h.button,children:[(0,vo.M)(h.icon),(0,S.jsx)("span",{style:h.label,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Load more",id:"database.loadMoreButtonTitle"})})]})})),Bo=r.memo(Io);let Fo=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});class jo extends n.Z{constructor(){super(...arguments),this.instanceCollectionViewBlockStore=void 0,this.renderResult=(e,t,o)=>{const r=t===o.length-1,{collectionContextStore:i,resultProps:n,resultComponent:s,groupsPointer:l,shouldShowHoverMenu:a,canDrag:c,disabled:d,format:h,getItemSelectableStyle:p,handleOpenPeekPage:u,belowDropZoneMargin:m,analyticsName:g,direction:y,onSelectableEnter:v,canDrop:f,disableScrollToRevealHorizontal:C,touchDragOnly:x,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,titleColumnIndex:P,nestedCreateSubitemButton:T,itemSelectableHaloStyle:R}=this.props;if(le.Bm({store:e,collectionContextStore:i}))return(0,S.jsx)(Bo,{getItemSelectableStyle:p,itemSelectableHaloStyle:R,store:e,canDrag:c,resultProps:n,resultComponent:s,collectionContextStore:i,groupsPointer:l,shouldShowHoverMenu:a,canDrop:f&&!d,format:h,handleOpenPeekPage:u,belowDropZoneMargin:m,analyticsName:g,disabled:d,direction:y,dropzoneGap:this.props.dropzoneGap,onSelectableEnter:v,disableScrollToRevealHorizontal:C,touchDragOnly:x,isLast:r,subitemPath:jo.subResultSubitemPath,titleColumnIndex:P,blockPropertyValueOverlayStore:b,onSelectableInsertRow:w,disableSelectable:k,nestedCreateSubitemButton:T},e.id)},this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{collectionContextStore:i,groupsPointer:n}=this.props,s=this.emptyDroppableIntoStore.state;if(!s)return;const l=i.collectionViewBlockStore();if(!l)return;const a=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(a,{environment:this.environment,getData:()=>re.yr({collectionContextStore:i,is_native_drop:!1,is_empty:!0})}),W.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{j.by({environment:this.environment,collectionStore:s,targetStore:l,droppedDirection:t,collectionContextStore:i,groupsPointer:n,droppedStores:o,duplicate:r,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupsPointer:i}=this.props,n=this.emptyDroppableIntoStore.state;if(!n)return;const s=r.collectionViewBlockStore();if(!s)return;const l=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>re.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),W.createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{j.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:i,files:t,transaction:e})}})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t,loadContentCover:o}=this.props,r=e.groupsStore.getGroupState(t);if(!r)return;const i=r.currentLimit.state,n=e.normalizedSchemaStore.state,s=C.oA(t.map((e=>(0,ot.Ko)({schema:n,group:e,timeZone:(0,rt.r)()}))));return{type:"results",filter:s.length>0?{operator:"and",filters:s}:void 0,limit:i,loadContentCover:o}})),this.resultStores=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props,o=e.groupsStore.getGroupState(t);return(null==o?void 0:o.resultsStore.state)??[]})),this.emptyDroppableIntoStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupsPointer:t}=this.props;var o;return"collectionTypedView"===e.contextType?null===(o=e.groupsStore.getGroupState(t))||void 0===o||null===(o=o.resultsStore.state)||void 0===o?void 0:o[0].getAssociatedCollectionStore():e.collectionStore()}))}getNode(){return super.getNode()}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.instanceCollectionViewBlockStore=new _e.G(this.environment,t.pointer))}didMountOrUpdate(){this.props.collectionContextStore.renderEmitter.emit()}renderComponent(){const{emptyDroppableStyle:e,direction:t}=this.props,o=this.props.emptyDroppableSize||"none",r=t===Fo.Vertical;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{...r?{height:o}:{width:o},...e},children:this.renderEmptyDroppable()}),this.resultStores.state.map(this.renderResult),this.renderReducerRequest()]})}renderReducerRequest(){const{collectionContextStore:e,groupsPointer:t,disableRequest:o}=this.props;if(o)return;const r=this.resultsReducerStore.state;if(!r)return;const i=e.groupsStore.getGroupState(t);return i?(0,S.jsx)(at.Z,{id:t.length>0?`results:${(0,ze.KW)(t)}`:"collection_group_results",reducer:r,groupsPointer:t,collectionContextStore:e,resultStore:i.reducerResultStore}):void 0}renderEmptyDroppable(){const{disabled:e,analyticsName:t,direction:o,onSelectableEnter:r,canDrop:i,groupsPointer:n}=this.props;if(this.instanceCollectionViewBlockStore){const s=o!==Fo.Vertical&&(!e&&0===this.resultStores.state.length),l=o===Fo.Vertical&&!e;return(0,S.jsx)(Po.Z,{store:this.instanceCollectionViewBlockStore,canSelect:!1,canEditText:!1,shouldShowHalo:!0,canDrag:!1,canDropLeft:i&&s,canNativeDropLeft:i&&s,canDropBelow:i&&l,canNativeDropBelow:i&&l,canTriggerContextMenu:!1,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:t,shouldShowDropZone:i,onEnter:r,groupsPointer:n,style:o===Fo.Vertical?void 0:{width:"100%",height:"100%"}})}}}jo.displayName="CollectionGroupResults",jo.subResultSubitemPath=[];const Do=jo,Ao=r.memo((function(e){let{collectionContextStore:t,groupFormat:o,format:i,schema:n,disabled:s,store:l,blockPropertyValueOverlayStore:a,collectionGalleryViewStore:c,isSingleColumn:d}=e;const h=(0,uo.O7)(),p=(0,r.useMemo)((()=>o?[o]:[]),[o]),u=(0,ct.VK)((()=>t.permissionScopes.state),[t.permissionScopes]),m=(0,ct.VK)((()=>l.canEdit()&&("collectionTypedView"===t.contextType||u.canEditContent)),[t,u.canEditContent,l]),g=(0,r.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();H.eP({environment:h,store:e}),N.NX({store:o}),_.Z5({store:e})}}),[h]),y=(0,r.useCallback)((e=>{const o=t.collectionStore(),r=e.getTitleStore();if(!r)return;Pt.QaF(r.getValue())?H.Ys({environment:h,store:e}):o&&W.createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:h,perform:t=>{j.Od({store:e,transaction:t})}})}),[t,h]),v=(0,r.useMemo)((()=>d?{position:"absolute",top:6,left:0,right:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[d]),{gallery_cover:f,gallery_cover_aspect:C,gallery_cover_size:x}=i,b=!s&&m&&!u.isSyncedCollection,{coverHeight:w,coverWidth:k}=(0,ct.VK)((()=>c.state),[c]),P=(0,r.useMemo)((()=>({format:i,schema:n,onTextEnter:y,onTextEsc:y,onShiftEnter:g,disabled:s,coverFormat:f,coverAspectFormat:C,coverSizeFormat:x,coverHeight:w,coverWidth:k,shouldShowTitle:Rt.K8(i,"gallery"),blockPropertyValueOverlayStore:a,collectionContextStore:t})),[a,t,w,k,C,f,x,s,i,g,y,n]);return(0,S.jsx)(Do,{collectionContextStore:t,groupsPointer:p,format:i,canDrag:b,onSelectableEnter:g,resultProps:P,resultComponent:go,canDrop:!0,disabled:s,shouldShowHoverMenu:!1,direction:d?Fo.Vertical:Fo.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:v,loadContentCover:f&&"page_content"===f.type})}));var _o=o(8848),Lo=o(45453),Zo=o(9056),Eo=o(37612),Oo=o(47307),zo=o(33846),Go=o(93405),Ho=o(9050);class No extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:zo.Z},this.handleSelectPropertyColorPickerChange=e=>{const{groupFormat:t,schema:o,collectionContextStore:r}=this.props,i=o[t.property];if(!i)return;if(!Bt.cu(i))return;const n=r.collectionStore();if(!n)return;const s=t.value;if(s.type!==i.type)return;const l=(i.options||[]).map((t=>t.value===s.value?{...t,color:e}:t)),a={...i,options:l},c={...o,[t.property]:a};W.createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:this.environment,perform:e=>{_.Rm({environment:this.environment,collectionStore:n,update:{schema:c},transaction:e})}}),M.wds(this.environment,{view_type:this.getCurrentViewType(),action:"group_change_color"})},this.handleHide=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:r}=this.props,i={...e,hidden:!0},n=(0,Ke.ar)(r,i);W.createAndCommit({userAction:"CollectionGroupActionMenu.handleHide",environment:this.environment,perform:e=>{j.A6({collectionContextStore:t,newGroups:n,groupsFormatKey:o,transaction:e})}}),M.wds(this.environment,{view_type:this.getCurrentViewType(),action:"hide_group"})},this.handleShow=()=>{const{groupFormat:e,collectionContextStore:t,groupsFormatKey:o,currentGroups:r,groupsLimitStore:i}=this.props,n={...e,hidden:!1},s=(0,Ke.nr)(r,n,i.state);W.createAndCommit({userAction:"CollectionGroupActionMenu.handleShow",environment:this.environment,perform:e=>{j.A6({collectionContextStore:t,newGroups:s,groupsFormatKey:o,transaction:e})}}),M.wds(this.environment,{view_type:this.getCurrentViewType(),action:"show_group"})},this.handleDelete=()=>{Oo.showDialog({message:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:this.handleDeleteAccept}]})},this.handleDeleteAccept=async()=>{const{collectionContextStore:e,currentGroups:t,groupFormat:o,groupsFormatKey:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=o.value;if("relation"===s.type&&(0,ze.RA)(s.value)){const e=_e.G.createChildStore(n,{id:s.value.id,table:b.iU});await e.load();const t=e.getParentCollectionStore();await(null==t?void 0:t.load())}W.createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:this.environment,perform:s=>{j.iE({environment:this.environment,collectionStore:n,property:o.property,groupFormat:o,currentGroups:t,groupsFormatKey:r,collectionContextStore:e,transaction:s,intl:i})}}),M.wds(this.environment,{view_type:this.getCurrentViewType(),action:"delete_group"})}}renderComponent(){const{device:e}=this.environment,{parent:t}=this.props,o=C.oA([this.getGroupActionsSection(),this.getSelectColorSection()]);let r;return r=e.isMobile?{menuType:st.og.Modal,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:t.close}:{menuType:st.og.Popup},(0,S.jsx)(gt.Z,{...r,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:0,sections:o,onAccept:e=>{"string"==typeof e.key&&e.key.includes(No.colorActionKeyPrefix)||t.close()}})})}getGroupActionsSection(){const{groupFormat:e,collectionContextStore:t}=this.props,o=[],r=e.value,i=t.permissionScopes.state;(0,ze.eF)(e)?o.push({key:"show",render:e=>(0,S.jsx)(Go.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Show",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:Zo.g}),action:this.handleShow}):o.push({key:"hide",render:e=>(0,S.jsx)(Go.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Hide",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:Lo.p}),action:this.handleHide}),void 0!==r.value&&i.canEditContent&&!i.isSyncedCollection&&"collectionTypedView"!==t.contextType&&o.push({key:"delete",render:e=>(0,S.jsx)(Go.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:Eo.y}),action:this.handleDelete});return{key:"collection group",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:o}}getSelectColorSection(){const{schema:e,groupFormat:t}=this.props,o=t.value;if(void 0===o.value)return;const r=e[t.property];if(!r)return;if("select"!==r.type&&"multi_select"!==r.type)return;if(o.type!==r.type)return;const i=(r.options||[]).find((e=>e.value===o.value));if(!i)return;return{key:"collection color section",render:e=>(0,S.jsx)(Ct.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:_o.AP.map((e=>({key:`${No.colorActionKeyPrefix}_${e}`,render:t=>(0,S.jsx)(Ho.Z,{...t,color:e,checkState:i.color===e}),action:()=>{this.handleSelectPropertyColorPickerChange(e)}})))}}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}}No.displayName="CollectionGroupActionMenu",No.colorActionKeyPrefix="color";const Wo=(0,R.injectIntl)(No);class Ko extends n.Z{constructor(){super(...arguments),this.renderMenu=e=>{const{device:t}=this.environment;let o;return o=t.isMobile?{menuType:st.og.Modal,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:e.close}:{menuType:st.og.Popup,width:200},(0,S.jsx)(gt.Z,{...o,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:0,sections:[{key:"aggregation section",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:this.getAggregationActions()}],onAccept:e.close})})},this.handleChangeAggregation=e=>{const{collectionContextStore:t,format:o,groupAggregationKey:r}=this.props,i=t.collectionViewStore();i&&(t.isLoading.state||t.loadingDetails.setState({type:"load_aggregation"}),t.isClientModeEnabled.state||t.asyncAggregationStatus.setState({calculating:!0,aggregation:e}),W.createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:this.environment,perform:t=>{_.iG({collectionViewStore:i,update:{format:{...o,[r]:e}},transaction:t})}})),M.wds(this.environment,{view_type:this.getCurrentViewType(),action:"change_aggregation"})},this.renderAggregationMenuItem=(e,t,o)=>{const r=nt.Sn[e];return(0,S.jsx)(xt.Z,{placement:ft.GI.Placement.Right,delayThreshold:0,render:e=>(0,S.jsx)(ut.Z,{title:t,...(0,lt.Z)(e,o)}),renderTooltip:()=>(0,S.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r&&(0,S.jsx)("img",{src:(0,it.D)(r),style:{borderRadius:3,width:140,marginTop:4}}),nt.BG[e]]})},o.key)},this.aggregationStore=this.createComputedStore((()=>{const{format:e,groupAggregationKey:t}=this.props;return e[t]||{aggregator:"count"}}),!0),this.reducerStore=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.aggregationStore.state;return{type:"aggregation",filter:(0,ot.zk)({schema:e,group:t,timeZone:(0,rt.r)()}),aggregation:o}}))}renderComponent(){const{device:e}=this.environment;return(0,S.jsx)(xt.Z,{renderTooltip:()=>this.renderTooltipText(),render:t=>(0,S.jsx)(mt.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,renderOrigin:e=>(0,S.jsx)(vt.Z,{disabled:this.props.disabled,style:{fontWeight:P.Z.fontWeight.medium,color:this.theme.lightTextColor,height:24},...(0,lt.Z)((0,lt.Z)(t,e),{onClick:he.Wi}),children:this.renderValue()}),disabled:this.props.disabled,render:this.renderMenu})})}renderTooltipText(){const{schema:e,collectionContextStore:t}=this.props,o=this.aggregationStore.state,r=nt.VN[(0,tt.OV)(o)],i=dt(t,o);if((0,tt.pK)(o)){const t=e[o.property];if(t){const e=t.name;return pe.default.formatMessage(pt.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})}}return pe.default.formatMessage(pt.aggregationType,{aggregationType:r,calculating:i})}renderValue(){const{schema:e,collectionContextStore:t,groupFormat:o}=this.props,r=this.aggregationStore.state,i=this.reducerStore.state;if(i)return(0,S.jsx)(at.Z,{id:`group_aggregation:${(0,ze.mD)(o)}`,collectionContextStore:t,reducer:i,groupsPointer:[o],render:t=>{const o=t.state;if(!o||"aggregation"!==o.type)return;let i;if((0,tt.pK)(r)){const t=e[r.property];!t||"formula"!==t.type&&"number"!==t.type||(i=t.number_format)}return(0,S.jsx)(ht,{aggregation:r,collectionContextStore:this.props.collectionContextStore,children:(0,nt.Ol)({numberFormat:i,dateFormat:void 0,aggregationType:r.aggregator,userTimeZone:(0,rt.r)(),value:o.aggregationResult,roundDecimal:5})})}})}getAggregationActions(){const e=[];for(const n of tt.o5)e.push(this.createCountAggregationAction(n));const t=this.getDefaultProperties();if(t.length>0)for(const n of tt.Sy)"show_unique"!==n&&e.push(this.getAggregationGroupAction(n,t));const o=this.getNumericProperties();if(o.length>0)for(const n of tt.k$)e.push(this.getAggregationGroupAction(n,o));const r=this.getDateProperties();if(r.length>0)for(const n of tt.f8)e.push(this.getAggregationGroupAction(n,r));const i=this.getCheckboxProperties();if(i.length>0)for(const n of tt.gC)e.push(this.getAggregationGroupAction(n,i));return e}getAggregationGroupAction(e,t){const{device:o}=this.environment,r=nt.VN[e],i=C.oA(t.map((t=>this.createPropertyAggregationAction(t,e))));return{key:e+r,render:(e,t)=>(0,S.jsx)(bt.Z,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,S.jsx)(ut.Z,{...e,ref:t,title:r}),renderExtension:(e,n)=>{let s;return s=o.isMobile?{menuType:st.og.Modal,title:r,right:o.isPhone?(0,S.jsx)(yt.DoneMenuText,{}):void 0,onClickRight:n.close,...e}:{menuType:st.og.Popup,width:200,...e},(0,S.jsx)(gt.Z,{...s,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:i}],onAccept:t.onAccept})})}}),action:()=>null}}getDefaultProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.iV)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}getNumericProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.O4)(o)}))}getDateProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.dN)(o)}))}getCheckboxProperties(){const{schema:e}=this.props;return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,tt.Mv)(o)}))}createCountAggregationAction(e){const t=nt.VN[e];return{key:e,render:o=>this.renderAggregationMenuItem(e,t,o),action:()=>{this.handleChangeAggregation({aggregator:e})}}}createPropertyAggregationAction(e,t){const o=this.props.schema[e];if(!o)return;const r=o.name;return{key:`${e} ${t}`,render:e=>this.renderAggregationMenuItem(t,r,e),action:()=>{this.handleChangeAggregation({aggregator:t,property:e})}}}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=null==t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}}Ko.displayName="CollectionGroupAggregation";var Uo=o(26055),$o=o(45697),qo=o.n($o),Qo=o(55010);function Yo(e){const{element:t,container:o}=e,r=function(e){for(;;){const t=tr(e);if(!t)return e;e=t}}(o),{store:i}=r.stores,{containerMap:n}=i.state,s=n.get(o);s?s.add(t):n.set(o,new Set([t])),i.emit()}function Xo(e,t,o,r){return e<-r||e>t?0:e>=t-o-1?t-o+r-1:e+r}function Jo(e,t,o,r){return e-r<0||e>t?0:e<o?o-t:e-t}function er(e){const t=[];for(;;){const o=tr(e);if(!o)break;e=o,t.push(e)}return t}function tr(e){if(e.context.computedStickyContainer&&!e.props.ignoreAncestorContainer)return e.context.computedStickyContainer}function or(e,t){for(const o in t)e.style[o]=t[o]||""}o(95477);class rr extends n.Z{constructor(){super(...arguments),this.element=void 0}didMount(){const{computedStickyContainer:e}=this.context;e&&Yo({element:this,container:e});const t=i.findDOMNode(this);if(t){this.element=t;const e=this.props.getComputedStyle?this.props.getComputedStyle(!1):void 0;e&&or(t,e)}}willUnmount(){const{computedStickyContainer:e}=this.context;e&&function(e){const{element:t,container:o}=e,{store:r}=o.stores,{containerMap:i}=r.state,n=i.get(o);n&&n.delete(t),r.emit()}({element:this,container:e}),this.element=void 0}renderComponent(){if(this.props.children)return r.Children.only(this.props.children)}}rr.displayName="ComputedStickyElement",rr.contextTypes={computedStickyContainer:qo().any,...n.w};const ir=rr;var nr=o(73063);class sr extends n.Z{constructor(){super(...arguments),this.storeTypes={hovered:a.default.createClass(!1)},this.renderActionMenu=e=>{const{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:s}=this.props;return(0,S.jsx)(Wo,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsLimitStore:n.groupsLimit,groupsFormatKey:s})},this.handleAddItemClick=()=>{const{groupFormat:e,collectionContextStore:t,isFullScreen:o,onGroupHeaderAddItem:r}=this.props;t.groupsStore.getGroupState(e)&&et.M_(this.environment)&&(t.searchQuery.state&&_.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o}),W.createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:this.environment,perform:o=>{const i=j.IW({environment:this.environment,collectionContextStore:t,groupsPointer:[e],insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"group_header"});i&&(r(i.newStore,i.coercionSucceeded,this.props),M.W2j(this.environment,{from:"group_add_item_top",type:"page",new_page_id:i.newStore.id,...(0,re.Pn)(t)}))}}))},this.handleCollectionGroupValueChange=e=>{const t=this.props.collectionContextStore.collectionStore();t&&(j.w$({...e,environment:this.environment,collectionStore:t,...this.props}),M.wds(this.environment,{view_type:this.getCurrentViewType(),action:"rename_group"}))},this.handleToggleButtonClick=()=>{const{groupFormat:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);if(!o)return;H.ZH(this.environment);const r=!o.toggleStateStore.state;if(j.uo({environment:this.environment,groupFormat:e,toggleStateStore:o.toggleStateStore,newValue:r,collectionContextStore:t}),!r){const e=i.findDOMNode(this),o=null==e?void 0:e.parentElement;o&&s.default.afterNextFlush((()=>{(0,me.Oc)({el:o,windowHeight:this.environment.WindowSizeStore.state.height,minEdgeDist:50}),t.renderEmitter.emit()}))}},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:n}=this.props,s=i.findDOMNode(this);s&&s instanceof Element&&W.createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:this.environment,perform:e=>j.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e})})}}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new _e.G(this.environment,{table:b.iU,id:t.id}))}didMount(){var e,t;null===(e=(t=this.props).onMount)||void 0===e||e.call(t)}renderComponent(){const{disabled:e,getComputedStickyStyle:t,groupFormat:o,collectionContextStore:r}=this.props,i=r.groupsStore.getGroupState(o);if(!i)return;const n=i.toggleStateStore.state,s=r.permissionScopes.state,l=r.shouldAllowNewItemCreation();return(0,S.jsx)(ir,{position:Xe.Top,getComputedStyle:t,children:(0,S.jsxs)("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,children:[(0,S.jsx)("div",{style:this.getStickyWrapStyle(n),children:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",position:this.props.stickyLeft?"sticky":void 0,left:this.props.paddingLeft},children:(0,S.jsxs)(Po.Z,{store:this.selectableBlockStore,canDropOnto:!e&&!n,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[o],style:{display:"flex",alignItems:"center",height:"100%"},children:[this.renderToggleButton(i.toggleStateStore),this.renderValue(),this.renderAggregation(),!e&&s.canConfigureBlock&&this.renderActionButton(),l&&this.renderAddButton()]})})}),this.props.children]})})}renderToggleButton(e){const t=e.state;return(0,S.jsx)(Mo.Z,{isSidebar:!1,open:t,fill:!0,onClick:this.handleToggleButtonClick,onMouseDown:he.$0,style:{flexShrink:0}})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:r,groupBy:i,collectionContextStore:n}=this.props,s=n.permissionScopes.state;return(0,S.jsx)(Uo.Z,{groupBy:i,groupFormat:e,currentGroups:r,schema:t,disabled:o||!s.canConfigureCollection||s.isSyncedCollection,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginLeft:2},collectionContextStore:n})}renderAggregation(){const{disabled:e,format:t,schema:o,collectionContextStore:r,groupFormat:i,groupAggregationKey:n}=this.props,s=r.permissionScopes.state;return(0,S.jsx)(Ko,{groupFormat:i,disabled:e||!s.canConfigureBlock,groupAggregationKey:n,format:t,schema:o,collectionContextStore:r})}renderActionButton(){const{device:e}=this.environment;return(0,S.jsx)(mt.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,renderOrigin:e=>(0,S.jsx)(nr.Z,{icon:m.o,...e}),onClick:he.Wi,render:this.renderActionMenu})}renderAddButton(){return(0,S.jsx)(xt.Z,{renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:e=>(0,S.jsx)(nr.Z,{icon:Je.R,onClick:this.handleAddItemClick,...e})})}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}getStyle(){var e;const t=(null===(e=this.props.collectionContextStore.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||void 0,o=this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground;return{position:"relative",zIndex:T.sL+2,width:"100%",background:void 0===t?o:t,fontSize:14,...this.props.style}}getStickyWrapStyle(e){const{isFullScreen:t,isRootChild:o,paddingLeft:r}=this.props,{paddingTop:i,toggleClosedMarginBottom:n}=this.props;return{display:"flex",alignItems:"center",height:this.getHeight(),paddingTop:i,...this.props.stickyLeft&&{position:"sticky",left:t||o?r:0},...!e&&{marginBottom:n}}}getHeight(){return this.props.height||33}getToggleButtonWidth(){return(0,Mo.q)({isSidebar:!1,isMobile:this.environment.device.isMobile})}}sr.displayName="CollectionGroupHeader";const lr=sr;class ar extends n.Z{renderComponent(){const{limit:e}=this.props;return(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{limit} pages",values:{limit:e.limit},id:"database.FirstLoadLimitSelectOption.limitPagesTitle"})}}ar.displayName="FirstLoadLimitSelectOption";const cr=(0,R.injectIntl)(ar);class dr extends n.Z{renderComponent(){const{device:e}=this.environment,{currentLimit:t,onAccept:o,onClose:r,showTitle:i}=this.props,n=[{key:0,render:e=>(0,S.jsx)(Ct.Z,{enableActionSheetTitle:!0,title:i&&(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Show on first load",id:"database.firstLoadLimitSelectMenu.firstLoadLimitSetting"}),...e}),items:C.oA(Ft.jk.map(((e,r)=>({key:r,render:o=>(0,S.jsx)(ut.Z,{...o,disabled:!1,title:(0,S.jsx)(cr,{limit:e}),checkState:C.Xy(t,e)}),action:()=>o(e)}))))}];let s;return s=e.isMobile?{menuType:st.og.ActionSheet}:{menuType:st.og.Popup,width:200},(0,S.jsx)(gt.Z,{...s,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,sections:n,onAccept:r,initialFocus:void 0})})}}dr.displayName="FirstLoadLimitSelectMenu";const hr=(0,R.injectIntl)(dr);class pr extends n.Z{constructor(){super(...arguments),this.renderPopup=e=>(0,S.jsx)(hr,{currentLimit:this.getCurrentFirstLoadLimit(),onAccept:this.handleFirstLoadLimitAccept,onClose:e.close,showTitle:!0}),this.handleFirstLoadLimitAccept=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o)return;const r=o.getType();r&&(W.createAndCommit({userAction:"FirstLoadLimitActionButton.handleFirstLoadLimitAccept",environment:this.environment,perform:t=>{Ne.FH({stores:[o],update:{inline_collection_first_load_limit:e},transaction:t})}}),t.groupsStore.resetAllLimits(),M.wds(this.environment,{view_type:r,action:"set_first_load_limit"}))}}renderComponent(){const{device:e}=this.environment;return(0,S.jsx)(mt.ZP,{popupType:e.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,renderOrigin:e=>(0,S.jsx)(nr.Z,{icon:m.o,style:{marginLeft:4,marginRight:4},...e}),alignmentToOrigin:mt.vR.End,placementToOrigin:mt.pO.Bottom,originGap:8,render:this.renderPopup})}getCurrentFirstLoadLimit(){const{format:e}=this.props;return(0,Ft.rx)(e.inline_collection_first_load_limit,Boolean(e.collection_group_by))}}pr.displayName="FirstLoadLimitActionButton";const ur=pr;class mr extends n.Z{constructor(){super(...arguments),this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupsPointer:o,incrementLimitsInRelatedGroups:r}=this.props,i=t.groupsStore.getGroupState(o);if(!i)return;const n=i.reducerResultStore.state;(0,he.Wi)(e),H.ZH(this.environment),n&&j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:n.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:r}}),M.uDZ(this.environment)}}renderComponent(){const{style:e,store:t,format:o,collectionContextStore:r,groupsPointer:i}=this.props;if(!r.groupsStore.getGroupState(i))return;const n=qe({collectionContextStore:r,groupsPointer:i});return(0,S.jsxs)(Qt.Z,{onClick:this.handleLoadMoreClick,onMouseDown:he.$0,disabled:n,hoveredStyle:n?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:30,borderRadius:3,whiteSpace:"break-spaces",fontSize:14,...e},children:[(0,vo.M)(this.getLoadMoreButtonIconStyle()),(0,S.jsx)("div",{style:{color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),n?(0,S.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,S.jsx)(Mt.Z,{style:{width:12,height:12}})}):t.canEdit()&&(0,S.jsx)(ur,{collectionContextStore:r,format:o})]})}getLoadMoreButtonIconStyle(){return{width:14,height:14,marginLeft:4,marginRight:6,fill:this.theme.lightIconColor}}}mr.displayName="CollectionGroupLoadMoreButton";const gr=mr;var Sr=o(80951),yr=o(4615),vr=o(97880),fr=o(68500);class Cr extends n.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Ce.Z},this.renderPopup=()=>{const{schema:e,currentGroups:t,groupBy:o}=this.props;return(0,S.jsx)(fr.Z,{groupFormat:void 0,groupBy:o,currentGroups:t,schema:e,onChange:this.handleEditMenuChange,onClose:this.handleEditMenuClose,parentStore:this.props.parentStore})},this.handleEditMenuChange=e=>{const{collectionContextStore:t,groupBy:o,schema:r,currentGroups:i,onAccept:n,groupsLimitStore:s}=this.props,{newGroupValue:l}=e,a=r[o.property],c=s.state;if(a&&(0,ze.LG)(a))if(I.wd({environment:this.environment,collectionContextStore:t,action:"board_add_group"}),this.stores.buttonPopupStore.reset(),Bt.cu(a)){if(a.type!==l.type)return;if(void 0===l.value)return;const e=a.options||[],t={id:(0,yr.ZP)(),value:l.value,color:(0,Bt.TL)(e)},s=[...e,t],d={...a,options:s},h={...r,[o.property]:d},p={property:o.property,value:l,hidden:!1};n({newGroups:(0,Ke.nr)(i,p,c),newSchema:h})}else if("person"===a.type||"relation"===a.type||(0,ze.HB)(a.type)){const t={property:o.property,value:l,hidden:!1};n({newGroups:(0,Ke.nr)(i,t,c),newPage:e.newPage})}else(0,ze.A1)(a.type)||"status"===a.type||"number"===a.type||"created_by"===a.type||"last_edited_by"===a.type||"formula"===a.type||"checkbox"===a.type||"location"===a.type||(0,vr.t1)(a.type)},this.handleEditMenuClose=()=>{this.stores.buttonPopupStore.reset()},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,Ke.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{groupBy:e,schema:t,type:o}=this.props,{buttonPopupStore:r}=this.stores,i=t[e.property];if(i&&(0,ze.LG)(i))return(0,S.jsx)(mt.ZP,{render:this.renderPopup,buttonPopupStore:r,popupType:this.environment.device.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,renderOrigin:e=>{return"default"===o?(0,S.jsx)(vt.Z,{isLightGray:!0,icon:Je.R,style:{display:"flex",height:28,marginTop:12,marginBottom:4,width:"max-content",position:this.props.stickyLeft?"sticky":void 0,left:this.props.stickyLeft&&this.props.paddingLeft?this.props.paddingLeft:0,...this.props.style},...e,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Add a group",id:"database.boardView.addGroupButtonTitle"})}):(0,S.jsx)(nr.Z,{icon:e=>(0,Je.R)({...e,fill:this.theme.mediumTextColor}),style:{width:35,background:null===(t=this.boardColorStore.state)||void 0===t?void 0:t.backgroundColor,paddingLeft:10,paddingRight:10,paddingTop:ri,paddingBottom:ri,marginRight:ni,borderRadius:ii,height:33,...this.props.style},...e});var t}})}}Cr.displayName="CollectionAddGroupButton";const xr=Cr;var br=o(54087),wr=o.n(br);class kr extends a.default{getInitialState(){return{containerMap:new Map}}}const Pr=kr;class Tr extends n.Z{constructor(){super(...arguments),this.element=void 0,this.scrollableAncestor=void 0,this.resizingAncestor=void 0,this.callbackQueued=!1,this.resizeObserver=new ResizeObserver((()=>{this.handleScroll()})),this.storeTypes={store:Pr},this.handleScroll=()=>{this.callbackQueued||(this.callbackQueued=!0,wr()((()=>{this.callbackQueued=!1,this.mutateDOM((()=>{!function(e){const{environment:t,container:o}=e,{device:r}=t,{store:i}=o.stores,{containerMap:n}=i.state,s=Array.from(n.keys()).sort(((e,t)=>{if(e.element&&t.element)return(0,Qo.Z)(e.element,t.element);throw new Error("Element not found")})),l=new Map;for(const a of s){const{element:e,scrollableAncestor:t}=a,o=n.get(a);if(!e||!t||!o)continue;const i=er(a).reduce(((e,t)=>e+(l.get(t)||0)),0),s=t.getBoundingClientRect(),c=e.getBoundingClientRect(),d=s.height,h=Math.floor(s.top-c.top),p=Math.floor(s.top+d-c.top),u=Math.floor(c.height)+(a.props.isFullScreen&&!r.isSafari?xe.Z.state:0),m=Array.from(o.values()).sort(((e,t)=>{if(e.element&&t.element)return(0,Qo.Z)(e.element,t.element);throw new Error("Element not found")}));let g=i,S=0;for(const r of m){if(!r.element)continue;const e=r.element.getBoundingClientRect(),t=g+e.height;r.props.position===Xe.Top&&(S+=e.height);const o=Xo(h,u,t,i),n=Jo(p,u,t,S);if(r.props.position===Xe.Top){const e=0!==o,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;e?(r.element.style.transform=`translate3d(0, ${o}px, 0)`,r.element.style.bottom=""):(r.element.style.transform="",r.element.style.bottom=""),t&&or(r.element,t)}else{const e=0!==n,t=r.props.getComputedStyle?r.props.getComputedStyle(e):void 0;if(e?(r.element.style.transform=`translate3d(0, ${n}px, 0)`,r.element.style.top=""):(r.element.style.transform="",r.element.style.top=""),t)for(const o in t)r.element.style[o]=t[o]||""}g=t}l.set(a,g)}}({environment:this.environment,container:this})}))})))},this.handleResizeThrottled=C.P2(this.handleScroll,100)}didMount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.has(t)||r.state.containerMap.set(t,new Set),r.emit()}({container:this,parentContainer:tr(this)}),(0,me.Gf)(this.environment)&&this.attachEvents()}willUnmount(){!function(e){const{container:t,parentContainer:o}=e,r=o?o.stores.store:t.stores.store;r.state.containerMap.delete(t),r.emit()}({container:this,parentContainer:tr(this)}),(0,me.Gf)(this.environment)&&this.removeEvents(),this.element=void 0,this.scrollableAncestor=void 0}getChildContext(){return{...this.context,computedStickyContainer:this}}renderComponent(){if(this.props.children)return this.props.children}attachEvents(){const e=tr(this),t=i.findDOMNode(this);if(t){this.element=t;const o=(0,me.VW)(t);o&&(this.scrollableAncestor=o,e||((0,ce.lj)(o,"scroll",this.handleScroll),(0,ce.lj)(window,"resize",this.handleResizeThrottled),this.resizeObserver.observe(this.element)));const r=(0,me.Ez)(this.element);r&&(this.resizingAncestor=r,this.resizeObserver.observe(this.resizingAncestor))}this.props.renderEmitter&&this.props.renderEmitter.addListener(this.handleScroll)}removeEvents(){this.scrollableAncestor&&((0,ce.ZV)(this.scrollableAncestor,"scroll",this.handleScroll),(0,ce.ZV)(window,"resize",this.handleResizeThrottled),this.element&&this.resizeObserver.unobserve(this.element)),this.resizingAncestor&&this.resizeObserver.unobserve(this.resizingAncestor),this.props.renderEmitter&&this.props.renderEmitter.removeListener(this.handleScroll)}}Tr.displayName="ComputedStickyContainer",Tr.contextTypes={computedStickyContainer:qo().any,...n.w},Tr.childContextTypes={computedStickyContainer:qo().any,...n.w};const Rr=Tr;class Mr extends n.Z{willMount(e){super.willMount(e);const{groupFormat:t,collectionContextStore:o}=this.props;j.V$({environment:this.environment,collectionContextStore:o,groupFormat:t})}renderComponent(){const{renderGroup:e,groupFormat:t,groupsDisplayState:o,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:s,schema:l,collectionContextStore:a,onGroupHeaderAddItem:c,renderHeader:d,getGroupStyle:h,stickyLeft:p,ignoreAncestorStickyContainer:u,paddingLeft:m,isFullScreen:g,index:y,isRootChild:v,isInPeekRenderer:f,groupBy:C,isLast:x}=this.props,b=a.groupsStore.getGroupState(t);if(!b)return;const{toggleStateStore:w}=b,k=w.state,P={groupFormat:t,currentGroups:o.currentGroups,disabled:r,groupsFormatKey:i,groupAggregationKey:n,format:s,schema:l,collectionContextStore:a,isFullScreen:g,isInPeekRenderer:f,onGroupHeaderAddItem:c,stickyLeft:p,index:y,paddingLeft:m,isRootChild:v,groupBy:C};return(0,S.jsx)(Rr,{ignoreAncestorContainer:u,renderEmitter:a.renderEmitter,isFullScreen:g,children:(0,S.jsxs)("div",{style:{width:"100%",position:"relative",...h?h({groupFormat:t,...o,index:y,isLast:x,toggleStateStore:w}):void 0},children:[d?d(P):(0,S.jsx)(lr,{...P}),k&&e(t)]})})}}Mr.displayName="CollectionGroup";const Ir=Mr;class Vr extends n.Z{constructor(){super(...arguments),this.handleClickLoadMoreGroups=()=>{const{collectionContextStore:e,groupsLimitStore:t}=this.props;t.setState(t.state+Ke.kW),e.loadingDetails.setState({type:"load_more_groups"}),I.tf(this.environment)},this.handleClickLoadMoreColumnGroups=()=>{const{collectionContextStore:e,groupsLimitStore:t}=this.props;t.setState(t.state+Ke.kW),e.loadingDetails.setState({type:"load_more_columns"}),I.tf(this.environment)},this.boardColorStore=this.createComputedStore((()=>{const{schema:e,collectionContextStore:t}=this.props;return(0,Ke.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t.normalizedFormatStore.state,collectionContextStore:t,theme:this.theme})}),!0)}renderComponent(){const{collectionContextStore:e,visibleGroups:t,total:o,hiddenGroups:r,type:i}=this.props,n=Math.min(Ke.kW,o-r.length-t.length),s=$e({collectionContextStore:e,isForColumnGroups:"board"===i});return"default"===i?(0,S.jsxs)(vt.Z,{onClick:this.handleClickLoadMoreGroups,onMouseDown:he.$0,disabled:s,hoveredStyle:s?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",fontSize:14,borderRadius:3,height:30,marginTop:4,marginBottom:4,paddingLeft:2,paddingTop:2,paddingBottom:2,paddingRight:8,...this.props.style},children:[(0,m.o)({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1,marginRight:8}),(0,S.jsx)(R.FormattedMessage,{id:"database.groups.loadMoreButtonDefault.text",defaultMessage:"Show {loadMoreAmount, plural, one {{loadMoreAmount} more group} other {{loadMoreAmount} more groups}}",values:{loadMoreAmount:n}}),s&&(0,S.jsx)("div",{style:{marginTop:1,marginLeft:8},children:(0,S.jsx)(Mt.Z,{style:{width:12,height:12}})})]}):(0,S.jsxs)(vt.Z,{onClick:this.handleClickLoadMoreColumnGroups,onMouseDown:he.$0,disabled:s,hoveredStyle:s?{background:this.theme.whiteButtonBackground}:{},style:{background:null===(l=this.boardColorStore.state)||void 0===l?void 0:l.backgroundColor,color:this.theme.mediumTextColor,fontWeight:P.Z.fontWeight.medium,paddingLeft:8,paddingRight:8,height:33,marginRight:2*ni,borderRadius:ii,width:90,...this.props.style},children:[(0,S.jsx)("span",{style:{flexGrow:1},children:(0,S.jsx)(R.FormattedMessage,{id:"database.groups.loadMoreButton.text",defaultMessage:"{loadMoreAmount} more",values:{loadMoreAmount:n}})}),s?(0,S.jsx)("div",{style:{marginLeft:4},children:(0,S.jsx)(Mt.Z,{style:{width:12,height:12}})}):(0,m.o)({width:14,fill:this.theme.mediumTextColor,marginLeft:4,marginTop:1})]});var l}}Vr.displayName="CollectionGroupsLoadMoreButton";const Br=Vr;var Fr=o(42853);function jr(e){window.__c={n:"CollectionHiddenGroupsButton"};const t=(0,ct.VK)((()=>e.hiddenGroupsVisible.state),[e.hiddenGroupsVisible]);return(0,S.jsx)(vt.Z,{onClick:function(){e.hiddenGroupsVisible.setState(!e.hiddenGroupsVisible.state)},onMouseDown:he.$0,style:{height:30,marginBottom:4,...e.style},icon:e=>(0,Fr.i)({...e,...t&&{transform:"rotate(180deg)"}}),isLightGray:!0,children:(0,S.jsx)(R.FormattedMessage,{id:"collectionHiddenGroupsButton.hiddenGroupsButton.text",defaultMessage:"{numberOfHiddenGroups, plural, one {{numberOfHiddenGroups} hidden group} other {{numberOfHiddenGroups} hidden groups}}",values:{numberOfHiddenGroups:e.hiddenGroups.length}})})}const Dr=(0,g.I)("collectionGroupAccordion",{svg:(0,S.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"});var Ar=o(36596);function _r(e){window.__c={n:"GalleryItemShimmer"};const t=e.minHeight||Xr,o=(0,co.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:e.largeShimmerColor,minHeight:t}})),[t]);return(0,S.jsx)(Ar.Z,{style:o.card})}function Lr(e){window.__c={n:"GalleryGroupShimmer"};const{width:t}=e,o=(0,uo.O7)(),r=(0,ct.VK)((()=>o.WindowSizeStore.state.width<=Yr),[o]),i=(0,co.yK)((e=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${r?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,marginLeft:8,borderRadius:12,backgroundColor:e.lightDividerColor}})),[t,r]);return(0,S.jsxs)("div",{style:i.container,children:[(0,S.jsxs)("div",{style:i.groupContainer,children:[(0,S.jsx)("div",{style:i.iconContainer,children:Dr(i.icon)}),(0,S.jsx)(Ar.Z,{style:i.groupShimmer})]}),(0,S.jsxs)("div",{style:i.itemsContainer,children:[(0,S.jsx)(_r,{}),(0,S.jsx)(_r,{}),(0,S.jsx)(_r,{})]})]})}function Zr(e){const{isFullScreen:t,galleryCoverSize:o}=e,r=t?2:1,i=(0,le.rD)(o),n=C.DZ(r,(e=>(0,S.jsx)(Lr,{width:i},e)));return(0,S.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:n})}var Er=o(95550);function Or(){window.__c={n:"ListGroupShimmer"};const e=(0,co.yK)((e=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor}})),[]),t=["50%","30%","40%"].map(((e,t)=>(0,S.jsx)(Er.G,{widthPercentage:e},t)));return(0,S.jsxs)("div",{style:e.container,children:[(0,S.jsxs)("div",{style:e.groupContainer,children:[(0,S.jsx)("div",{style:e.iconContainer,children:Dr(e.icon)}),(0,S.jsx)(Ar.Z,{style:e.groupShimmer})]}),(0,S.jsx)("div",{style:e.rowsContainer,children:t})]})}function zr(e){const{isFullScreen:t}=e,o=t?2:1,r=C.DZ(o,(e=>(0,S.jsx)(Or,{},e)));return(0,S.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:r})}function Gr(){window.__c={n:"TableGroupShimmer"};const e=(0,co.yK)((e=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingRight:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingLeft:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${e.regularDividerColor}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},icon:{width:8,height:8,flexShrink:0,fill:e.icon.tertiary},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:e.lightDividerColor},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,S.jsxs)("div",{style:e.container,children:[(0,S.jsxs)("div",{style:e.groupContainer,children:[(0,S.jsx)("div",{style:e.iconContainer,children:Dr(e.icon)}),(0,S.jsx)(Ar.Z,{style:e.groupShimmer})]}),(0,S.jsxs)("div",{style:e.rowsContainer,children:[(0,S.jsxs)("div",{style:e.rowContainer,children:[(0,S.jsxs)("div",{style:e.firstColumn,children:[(0,S.jsx)(Ar.Z,{style:e.circleShimmer}),(0,S.jsx)(Ar.Z,{style:e.rowShimmerShort})]}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmerShort})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmerShort})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmerShort})})]}),(0,S.jsxs)("div",{style:e.rowContainer,children:[(0,S.jsxs)("div",{style:e.firstColumn,children:[(0,S.jsx)(Ar.Z,{style:e.circleShimmer}),(0,S.jsx)(Ar.Z,{style:e.rowShimmerLong})]}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})})]}),(0,S.jsxs)("div",{style:e.lastRowContainer,children:[(0,S.jsxs)("div",{style:e.firstColumn,children:[(0,S.jsx)(Ar.Z,{style:e.circleShimmer}),(0,S.jsx)(Ar.Z,{style:e.rowShimmerLong})]}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})}),(0,S.jsx)("div",{style:e.column,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})})]})]})]})}function Hr(e){const{isFullScreen:t}=e,o=t?2:1,r=C.DZ(o,(e=>(0,S.jsx)(Gr,{},e)));return(0,S.jsx)("div",{style:{display:"flex",paddingTop:8,paddingLeft:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:r})}function Nr(){window.__c={n:"TimelineTableGroupsShimmer"};const e=(0,co.yK)((e=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,S.jsxs)("div",{style:e.rowsContainer,children:[(0,S.jsx)("div",{style:e.rowContainer,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmerShort})}),(0,S.jsx)("div",{style:e.rowContainer,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})})]})}function Wr(e){window.__c={n:"GroupsShimmer"};const{viewType:t,isFullScreen:o,galleryCoverSize:r}=e;if(!(0,ao.Z)(!0,0,100))return null;switch(t){case"table":return(0,S.jsx)(Hr,{isFullScreen:o});case"list":return(0,S.jsx)(zr,{isFullScreen:o});case"gallery":return(0,S.jsx)(Zr,{isFullScreen:o,galleryCoverSize:r});case"timeline":return(0,S.jsx)(Nr,{});case"calendar":case"board":default:return null}}class Kr extends n.Z{constructor(){super(...arguments),this.storeTypes={reducerResultStore:a.default.createClass(void 0),hiddenGroupsVisible:a.default.createClass(!1)},this.renderResult=e=>{var t;const{disabled:o,collectionContextStore:r,groupBy:i,isFullScreen:n,shouldSurpressShimmer:s,format:l}=this.props,a=r.groupsLimit.state,c=e.hiddenGroups.slice(0,Ke.ew),d=r.permissionScopes.state,h=!s&&function(e){const{collectionContextStore:t,displayState:o}=e;return t.shouldShowSpinner.state&&0===o.visibleGroups.length}({collectionContextStore:r,displayState:e}),p=null===(t=r.collectionViewStore())||void 0===t?void 0:t.getType(),{visibleGroups:u,hiddenGroups:m,total:g}=e,y=0===u.length&&!r.shouldShowSpinner.state||u.length>0,v=a<g-m.length&&y||$e({collectionContextStore:r,isForColumnGroups:!1}),f=!o&&!d.isLocked&&d.canConfigureBlock&&!h&&(0,ze.Wz)(i,d.canConfigureCollection)&&"collectionTypedView"!==r.contextType&&!(0,Sr.wl)(i.property)&&y;return(0,S.jsxs)("div",{style:{position:"relative"},children:[this.renderGroups(e.visibleGroups),h&&(0,S.jsx)(Wr,{viewType:p,isFullScreen:n,galleryCoverSize:l.gallery_cover_size}),v&&this.renderGroupsLoadMoreButton(e),c.length>0&&(0,S.jsxs)(S.Fragment,{children:[this.renderHiddenGroupsButton(c),this.stores.hiddenGroupsVisible.state&&this.renderGroups(c)]}),f&&this.renderAddGroupButton()]})},this.renderGroup=(e,t,o)=>{const{renderGroup:r,disabled:i,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,onGroupHeaderAddItem:h,renderHeader:p,getGroupStyle:u,stickyLeft:m,stickyTopHeaderOffset:g,ignoreAncestorStickyContainer:y,paddingLeft:v,isRootChild:f,groupBy:C,isInPeekRenderer:x}=this.props,b=t===o.length-1;if(c.groupsStore.getGroupState(e))return(0,S.jsx)(Ir,{groupBy:C,groupFormat:e,groupsDisplayState:this.groupsDisplayStateStore.state,disabled:i,groupsFormatKey:n,groupAggregationKey:s,format:l,schema:a,collectionContextStore:c,isFullScreen:d,isRootChild:f,renderGroup:r,onGroupHeaderAddItem:h,renderHeader:p,getGroupStyle:u,stickyLeft:m,stickyTopHeaderOffset:g,ignoreAncestorStickyContainer:y,paddingLeft:v,index:t,isLast:b,isInPeekRenderer:x},(0,ze.mD)(e))},this.handleGroupsChange=()=>{const{format:e,groupsFormatKey:t,collectionContextStore:o}=this.props,r=this.groupsDisplayStateStore.state.currentGroups;j.$D({environment:this.environment,format:e,groupsFormatKey:t,collectionContextStore:o,currentGroups:r})},this.handleGroupsChangeDebounced=C.Ds(this.handleGroupsChange,5e3),this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,groupsFormatKey:o,groupBy:r,schema:i}=this.props,n=t.collectionStore();n&&j.tH({update:e,collectionContextStore:t,groupsFormatKey:o,collectionStore:n,environment:this.environment,groupBy:r,schema:i})},this.reducerStore=this.createComputedStore((()=>{const{groupBy:e,disableReducerRequest:t,schema:o,format:r,groupsFormatKey:i,collectionContextStore:n}=this.props,s=n.remoteRequestStore.state;if(!t)return(0,Ke.ej)({groupBy:e,schema:o,format:r,filter:null==s?void 0:s.loader.filter,groupsFormatKey:i,limit:n.groupsLimit.state})})),this.schemaGroupsStore=this.createComputedStore((()=>{const{schema:e,groupBy:t}=this.props;return(0,ze.Qq)({schema:e,groupBy:t})}),!0),this.groupsDisplayStateStore=this.createComputedStore((()=>{var e;const{groupBy:t,groupsFormatKey:o,format:r,schema:i,collectionContextStore:n}=this.props,s=n.groupsLimit.state,l=n.collectionViewBlockStore();if(!l)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const a=this.schemaGroupsStore.state,c=this.stores.reducerResultStore.state,d=c?c.results:void 0,h=c?c.total:0,p=(0,Ke.Cz)({groupBy:t,schema:i,formatGroups:r[o]||[],schemaGroups:a,reducerResults:d,getRecordModel:l.getRecordModel,relativeVariableResult:n.relativeVariableStore.state,viewAppConfigUri:null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}),u=p.filter((e=>!(0,ze.eF)(e))).slice(0,s),m=p.filter((e=>(0,ze.eF)(e)));return{currentGroups:[...u,...m],visibleGroups:u,hiddenGroups:m,total:h}}),!0)}willMount(e){const{disableReducerRequest:t}=this.props;t||this.groupsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.groupsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}renderComponent(){const e=this.reducerStore.state,t=this.groupsDisplayStateStore.state;return e?(0,S.jsx)(at.Z,{id:this.props.id,reducer:e,collectionContextStore:this.props.collectionContextStore,resultStore:this.stores.reducerResultStore,render:()=>this.renderResult(t)}):this.renderResult(t)}renderGroups(e){return e.map(this.renderGroup)}renderGroupsLoadMoreButton(e){const{renderGroupsLoadMoreButton:t,collectionContextStore:o,schema:r}=this.props,{groupsLimit:i}=o;return t?t({visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:i,type:"default",schema:r,collectionContextStore:o}):(0,S.jsx)("div",{style:{display:"flex"},children:(0,S.jsx)(Br,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:i,type:"default",schema:r,collectionContextStore:o})})}renderHiddenGroupsButton(e){const{renderHiddenGroupsButton:t}=this.props;return t?t({hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e}):(0,S.jsx)("div",{style:{display:"flex"},children:(0,S.jsx)(jr,{style:{marginTop:10},hiddenGroupsVisible:this.stores.hiddenGroupsVisible,hiddenGroups:e})})}renderAddGroupButton(){const{schema:e,groupBy:t,renderAddGroupButton:o,collectionContextStore:r,paddingLeft:i}=this.props,n=this.groupsDisplayStateStore.state.currentGroups;return o?o({groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r}):(0,S.jsx)(xr,{groupBy:t,schema:e,currentGroups:n,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:r.groupsLimit,parentStore:this.props.store,type:"default",collectionContextStore:r,paddingLeft:i,stickyLeft:!0})}}Kr.displayName="CollectionGroups";const Ur=Kr;var $r=o(43145),qr=o(17311);function Qr(e){window.__c={n:"GalleryShimmer"};const{hasPartialResults:t}=e;if(!(0,ao.Z)(!0,0,100))return null;const o=e.coverHeight??qr.Z.card.desktop.medium.height,r=t?void 0:o+40,i=t?1:3,n=C.DZ(i,(e=>(0,S.jsx)(_r,{minHeight:r},e)));return(0,S.jsx)(S.Fragment,{children:n})}const Yr=480,Xr=40;class Jr extends n.Z{constructor(){super(...arguments),this.storeTypes={collectionGalleryViewStore:po},this.selectableContainer=null,this.renderGroupHeader=e=>(0,S.jsx)(lr,{...e,height:48,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle}),this.renderGroup=e=>{const{store:t,format:o,disabled:r,collectionContextStore:i,schema:n,blockPropertyValueOverlayStore:s,isFullScreen:l}=this.props,{collectionGalleryViewStore:a}=this.stores,c=this.isSingleColumnStore.state,d=this.isReady.state,h=e?[e]:[],p=i.groupsStore.getGroupState(h);if(!p)return;const u=p.reducerResultStore.state,m=void 0!==e,g=void 0!==u&&(null==u?void 0:u.blockIds.length)>0,y=Ue({collectionContextStore:i,groupsPointer:h,hasPartialResults:g}),v=le.VM({collectionContextStore:i,reducerResult:u,isFullScreen:l}),f=i.permissionScopes.state,C=f.isSyncedCollection,x=t.canEdit()&&("collectionTypedView"===i.contextType||f.canEditContent),b=d&&!r&&x&&!C&&(g||!i.isLoading.state);return(0,S.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,S.jsxs)("div",{style:this.getGroupWrapStyle(),children:[(0,S.jsx)(Ao,{collectionContextStore:i,groupFormat:e,format:o,schema:n,disabled:r,store:t,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:a,isSingleColumn:c}),y&&(0,S.jsx)(Qr,{hasGroups:m,hasPartialResults:g,coverHeight:a.state.coverHeight}),b&&this.renderAddItemButton(h)]}),v&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,S.jsx)(gr,{groupsPointer:h,store:t,collectionContextStore:i,format:o,isFullScreen:l,incrementLimitsInRelatedGroups:!1})]})]})},this.handleResize=()=>{const{collectionGalleryViewStore:e}=this.stores,t=this.getGalleryCardCoverHeight(),o=this.getGalleryCardActualWidth();e.state.coverHeight!==t&&this.setCardCoverHeight(t),e.state.coverWidth!==o&&this.setCardCoverWidth(o)},this.handleResizeDebounced=(0,C.Ds)(this.handleResize,1e3),this.handleResizeThrottled=(0,C.P2)(this.handleResize,100),this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o,isFullScreen:r}=this.props,i=o.isLoading.state,n=null===(t=this.getDefaultResultStore())||void 0===t?void 0:t.state;e<be.Z.incrementScrollOffset&&n&&!i&&null!=n&&n.hasMore&&j.ID({collectionContextStore:o,environment:this.environment,incrementLimitArgs:{isFullScreen:r,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleAddItemClick=e=>{if(!et.M_(this.environment))return;const{collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);o&&W.createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:this.environment,perform:r=>{const{mainEditorCurrentBlockStore:i}=fe.default.state,n=j.IW({environment:this.environment,collectionContextStore:t,groupsPointer:e,coerce:!0,initializeDefaultTemplate:!0,transaction:r,from:"gallery"});if(!n)return;const s=le.mb({store:n.newStore,mainEditorCurrentBlockStore:i,collectionContextStore:t})??(0,de.ZP)({store:n.newStore,pageVisitSource:c.tY.Create});this.navigate(s),Z.Xd({collectionContextStore:t,resultsStore:o.resultsStore}),M.W2j(this.environment,{from:"list_view_add_item_bottom",type:"page",new_page_id:n.newStore.id,...(0,re.Pn)(t)})}})},this.handleGroupHeaderAddItem=e=>{if(this.environment.device.isMobile)O.navigateToBlock({environment:this.environment,store:e,pageVisitSource:c.tY.Create});else{const{collectionContextStore:t}=this.props;O.peekBlock({environment:this.environment,store:e,peekMode:le.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:c.tY.Create})}},this.isSingleColumnStore=this.createComputedStore((()=>this.environment.WindowSizeStore.state.width<=Yr)),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getGroupStyle=e=>0===e.index?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.contentBackground}`:void 0})}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}didUpdate(e){(e.format||{}).gallery_cover_size!==(this.props.format||{}).gallery_cover_size&&(this.setCardCoverHeight(),this.setCardCoverWidth())}didMount(){this.setCardCoverWidth(),this.setCardCoverHeight(),(0,ce.lj)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ce.lj)(window,"orientationchange",this.handleResizeDebounced)}willUnmount(){(0,ce.ZV)(window,"resize",this.handleResizeThrottled),this.environment.device.isMobile&&(0,ce.ZV)(window,"orientationchange",this.handleResizeDebounced)}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=le.az(s,n),a=t.collection_group_by;return(0,Qe.Z)((t=>(0,S.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:ee.sbt,children:[(0,S.jsx)(Po.Z,{store:e,shouldShowHalo:!n,canSelect:!n,analyticsName:"gallery",...t,ref:e=>this.selectableContainer=e,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,S.jsx)(Ur,{store:t,id:"gallery_groups",groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,renderHeader:this.renderGroupHeader,getGroupStyle:this.getGroupStyle,paddingLeft:l,isRootChild:a,isInPeekRenderer:c})}renderAddItemButton(e){return(0,S.jsx)(Qt.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:he.$0,style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,borderRadius:3,boxShadow:"dark"===this.theme.mode?`${this.theme.darkDividerColor} 0px 0px 0px 1px inset`:`${this.theme.regularDividerColor} 0px 0px 0px 1px inset`,minHeight:Xr},children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:-6},children:[(0,Je.R)(this.getNewItemButtonIconStyle()),(0,S.jsx)("div",{style:{color:this.theme.lightIconColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"database.galleryView.addItemButtonTitle"})})]})})}setCardCoverHeight(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverHeight:e||this.getGalleryCardCoverHeight()})}setCardCoverWidth(e){const{collectionGalleryViewStore:t}=this.stores;t.setState({...t.state,coverWidth:e||this.getGalleryCardWidth()})}getGalleryCardWidth(){const{format:e}=this.props,t=e.gallery_cover_size;return le.rD(t)}getGalleryCardActualWidth(){if(this.selectableContainer){const e=this.selectableContainer.getNode();if(e){const t=e.querySelector(`.${ee.K4T}`);if(t)return t.offsetWidth}}return this.getGalleryCardWidth()}getGalleryCardCoverHeight(){return this.getGalleryCardActualWidth()*(9/16)}getDefaultResultStore(){var e;const{collectionContextStore:t}=this.props;return null===(e=t.groupsStore.getGroupState([]))||void 0===e?void 0:e.reducerResultStore}getGroupWrapStyle(){const e=this.props.format.collection_group_by;return{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${this.isSingleColumnStore.state?"100%":`${this.getGalleryCardWidth()}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4}}getNewItemButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}}Jr.displayName="CollectionGalleryView",Jr.contextTypes={...Y.wK,...n.w};const ei=Jr;function ti(e){window.__c={n:"BoardItemShimmer"};const t=e.minHeight||Xr,o=(0,co.yK)((e=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,backgroundColor:e.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,S.jsx)(Ar.Z,{style:o.card})}function oi(){window.__c={n:"BoardShimmer"};return(0,ao.Z)(!0,0,100)?(0,S.jsx)(ti,{}):null}const ri=5,ii=5,ni=5;function si(e){return e?8:12}class li extends n.Z{constructor(){super(...arguments),this.isReady=this.createComputedStore((()=>{const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return Boolean(null==o?void 0:o.reducerResultStore.state)})),this.handleGroupMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{e.preventDefault(),E.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleGroupClick=e=>{(0,he.ZP)({event:e,context:he.Af.EditorClick,callback:()=>{}})},this.handleItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupsPointer:r,collectionContextStore:i,isFullScreen:n}=this.props;if(0===t.length)return;const s=t[0];if(!et.M_(this.environment)||!i.collectionStore()||!i.shouldAllowNewItemCreation())return;const l=this.getResultsStore();if(!l)return;const a=l.state.findIndex((e=>e===s))+1;Tt({transaction:o,environment:this.environment,collectionContextStore:i,isFullScreen:n,groupsPointer:r,insertAtIndex:a,from:"board_group_enter_add_item",transient:!0})},this.handleItemTextEnter=e=>{const{groupsPointer:t,collectionContextStore:o,isFullScreen:r}=this.props;if(!et.M_(this.environment)||!o.collectionStore())return this.handleItemTextEsc(e);const i=this.getResultsStore();if(!i)return;const n=i.state.findIndex((t=>t===e))+1;W.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{Tt({transaction:e,environment:this.environment,collectionContextStore:o,isFullScreen:r,groupsPointer:t,insertAtIndex:n,from:"board_group_enter_add_item",transient:!0})}})},this.handleItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),r=e.getTitleStore();if(!r)return;if(Pt.QaF(r.getValue()))H.Ys({environment:this.environment,store:e});else if(o){const{store:t,collectionContextStore:o}=this.props,r=this.getResultsStore();if(!r)return;const i=r.state.findIndex((t=>t===e))-1,n=o.collectionViewStore(),s=o.collectionViewBlockStore();if(n&&s&&M.sGw(this.environment,{...(0,re.Pn)(o),block_id:t.id}),W.createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:this.environment,perform:t=>{j.Od({store:e,transaction:t})}}),i>=0){const e=r.state[i];H.Ys({environment:this.environment,store:e})}}},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o,groupsPointer:r}=this.props,i=t.isLoading.state,n=t.groupsStore.getGroupState(r),s=null==n?void 0:n.reducerResultStore.state;e<be.Z.incrementScrollOffset&&!i&&s&&s.hasMore&&(j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:s.blockIds.length,groupsPointer:r,incrementLimitsInRelatedGroups:!1}}),t.loadingDetails.setState({type:"load_general"}))},this.handleMouseMove=()=>{const e=C.Z$(this.props.groupsPointer);e&&this.props.hoveredGroupStore.state!==e&&this.props.hoveredGroupStore.setState(e)},this.colorStore=this.createComputedStore((()=>{const{groupsPointer:e,schema:t,format:o,collectionContextStore:r}=this.props,i=C.Z$(e);return(0,Ke.II)({environment:this.environment,groupFormat:i,schema:t,format:o,collectionContextStore:r,theme:this.theme})}),!0)}renderComponent(){var e;const{store:t,groupsPointer:o,collectionContextStore:r,disabled:i,format:n,schema:s,blockPropertyValueOverlayStore:l,isFullScreen:a,anyGroupHasResults:c}=this.props,d=r.groupsStore.getGroupState(o);if(!d)return;const h=this.isReady.state,p=this.getCoverFormat(),u=(0,le.az)(r,a),m=d.reducerResultStore.state,g=r.permissionScopes.state,y=!i&&h&&r.shouldAllowNewItemCreation(),v=!i&&!g.isSyncedCollection,f=(0,le.VM)({reducerResult:m,collectionContextStore:r,isFullScreen:a}),C=Boolean(n.collection_group_by),x=!c&&C&&Ue({collectionContextStore:r,groupsPointer:o,hasPartialResults:c}),b=c&&r.shouldShowSpinner.state&&"load_general"===r.loadingDetails.state.type;return(0,S.jsxs)("div",{style:this.getStyle(),onMouseDown:this.handleGroupMouseDown,onClick:this.handleGroupClick,className:ee.GfL,onMouseMove:this.handleMouseMove,children:[(0,S.jsx)(Do,{collectionContextStore:r,groupsPointer:o,format:n,canDrag:v,onSelectableEnter:this.handleItemEnter,resultProps:{format:n,schema:s,onTextEnter:this.handleItemTextEnter,onShiftEnter:this.handleItemEnter,coverFormat:p,coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),shouldShowTitle:Rt.K8(this.props.format,"board"),colorStyle:this.colorStore.state,onTextEsc:this.handleItemTextEsc,disabled:i,blockPropertyValueOverlayStore:l,collectionContextStore:r},canDrop:!0,resultComponent:lo,disabled:i,direction:Fo.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:C?ri:3,analyticsName:"board",loadContentCover:p&&"page_content"===p.type}),x&&(0,S.jsx)(oi,{}),f&&(0,S.jsx)(gr,{groupsPointer:o,store:t,collectionContextStore:r,format:n,isFullScreen:a,incrementLimitsInRelatedGroups:!0}),y&&(0,S.jsxs)(S.Fragment,{children:[f&&(0,S.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),(0,S.jsx)(Vt,{groupsPointer:o,collectionContextStore:r,isFullScreen:a,color:null===(e=this.colorStore.state)||void 0===e?void 0:e.textColor,shouldShowSpinner:b})]}),!u&&(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})}getCoverFormat(){const{format:e}=this.props;return e?e.board_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.board_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.board_cover_size:void 0}getBoardCardWidth(){const{format:e}=this.props,t=e.board_cover_size;return(0,le.rD)(t)}getStyle(){const{format:e}=this.props,t=this.isReady.state,o=this.colorStore.state,r=Boolean(e.collection_group_by);return{flex:"none",paddingLeft:ri,paddingRight:ri,paddingBottom:ri,marginRight:2*ni,boxSizing:"content-box",width:this.getBoardCardWidth(),height:r?void 0:"max-content",...o&&t&&{backgroundColor:this.props.isInPeekRenderer?o.peekBackgroundColor:o.backgroundColor,...r?{borderRadius:ii}:{borderBottomLeftRadius:ii,borderBottomRightRadius:ii}}}}getResultsStore(){const{groupsPointer:e,collectionContextStore:t}=this.props,o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}}li.displayName="BoardGroupResults";const ai=(0,R.injectIntl)(li);class ci extends n.Z{constructor(){super(...arguments),this.renderActionMenu=e=>{const{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n}=this.props;return(0,S.jsx)(Wo,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:"board_columns",groupsLimitStore:n.boardColumnsLimit})},this.handleCollectionGroupValueChange=e=>{const{collectionContextStore:t,...o}=this.props,r=t.collectionStore();r&&(j.w$({...e,environment:this.environment,groupsFormatKey:"board_columns",collectionStore:r,collectionContextStore:t,...o}),I.wd({environment:this.environment,collectionContextStore:t,action:"rename_group"}))},this.handleAddItemClick=()=>{const{device:e}=this.environment;if(!et.M_(this.environment))return;const{format:t,groupFormat:o,onAddItem:r,collectionContextStore:i,isFullScreen:n}=this.props;if("collectionTypedView"===i.contextType)return;const s=Boolean(t.collection_group_by);i.searchQuery.state&&_.Ug({searchQuery:"",collectionContextStore:i,isFullScreen:n});const l=i.collectionStore(),a=i.groupsStore.getGroupState(o);if(!l||!a)return;const d=a.resultsStore;W.createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:this.environment,perform:t=>{const n=j.IW({environment:this.environment,collectionContextStore:i,groupsPointer:[o],insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"board_group_header"});if(!n)return;const l=n.coercionSucceeded,a=n.newStore;if(e.isMobile){const e=(0,de.ZP)({store:a,pageVisitSource:c.tY.Create});this.navigate(e)}else if(l&&!s){const e=a.getBlockTitleStore();H.eP({environment:this.environment,store:a}),N.NX({store:e}),_.Z5({store:a})}else O.peekBlock({environment:this.environment,store:a,peekMode:(0,le.kr)(i.collectionViewStore()),resultsStore:d,collectionContextStore:i,pageVisitSource:c.tY.Create});r&&r(a),M.W2j(this.environment,{from:"board_group_add_item_top",type:"page",new_page_id:a.id,...(0,re.Pn)(i)})}})},this.handleAggregationChange=e=>{const{collectionContextStore:t,query:o}=this.props,r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&W.createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:this.environment,perform:e=>{_.iG({collectionViewStore:r,update:{query2:i},transaction:e})}})},this.handleMouseMove=()=>{this.props.hoveredGroupStore.state!==this.props.groupFormat&&this.props.hoveredGroupStore.setState(this.props.groupFormat)},this.colorStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o,collectionContextStore:r}=this.props;return(0,Ke.II)({environment:this.environment,groupFormat:e,schema:t,format:o,collectionContextStore:r,theme:this.theme})}),!0),this.isHoveredStore=this.createComputedStore((()=>(0,ze.ZH)(this.props.hoveredGroupStore.state,this.props.groupFormat)))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}renderComponent(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state,r=t.shouldAllowNewItemCreation();return(0,S.jsxs)("div",{style:this.getStyle(),onMouseMove:this.handleMouseMove,children:[this.renderValue(),this.renderAggregation(),(0,S.jsx)("div",{style:{flexGrow:1}}),!e&&o.canConfigureBlock&&this.renderActionButton(),r&&this.renderAddButton()]})}renderAggregation(){const{disabled:e,query:t,schema:o,collectionContextStore:r,groupFormat:i}=this.props,n=t.aggregations?t.aggregations[0]:void 0,s=r.permissionScopes.state;return(0,S.jsx)(kt,{groupFormat:i,disabled:e||!s.canConfigureBlock,aggregation:n,schema:o,collectionContextStore:r,color:this.getTextColor(),onChange:this.handleAggregationChange})}renderValue(){const{groupFormat:e,schema:t,disabled:o,currentGroups:r,format:i,groupBy:n,collectionContextStore:s}=this.props,l=di(i),a=s.permissionScopes.state;if(s.groupsStore.getGroupState(e))return(0,S.jsx)(Uo.Z,{groupBy:n,groupFormat:e,currentGroups:r,schema:t,disabled:o||!a.canConfigureBlock,isHiddenGroup:!1,onChange:this.handleCollectionGroupValueChange,style:{maxWidth:l-70},collectionContextStore:s})}renderActionButton(){const{device:e}=this.environment;return(0,S.jsx)(mt.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,renderOrigin:e=>(0,S.jsx)(nr.Z,{icon:m.o,iconStyle:{fill:this.getTextColor()},style:this.getIconButtonStyle(),...e}),render:this.renderActionMenu})}renderAddButton(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri,r=(0,ae.sN)(o);return(0,S.jsx)(xt.Z,{renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Create new {newItemName}",values:{newItemName:r},id:"database.boardView.actions.addNewItem.tooltip"}),render:e=>(0,S.jsx)(nr.Z,{icon:Je.R,onClick:this.handleAddItemClick,style:this.getIconButtonStyle(),iconStyle:{fill:this.getTextColor()},...e})})}getStyle(){const{hidden:e,format:t}=this.props,{device:o}=this.environment,r=di(t),i=this.colorStore.state,n=Boolean(t.collection_group_by);return{display:"flex",alignItems:"center",fontSize:14,width:r,paddingLeft:ri,paddingRight:ri,marginRight:2*ni,marginBottom:e?4:0,boxSizing:"content-box",flexShrink:0,cursor:"pointer",...this.props.isPopup&&{padding:o.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:r},...i&&!e&&{backgroundColor:this.props.isInPeekRenderer?i.peekBackgroundColor:i.backgroundColor,...n?{borderRadius:ii}:{borderTopLeftRadius:ii,borderTopRightRadius:ii}}}}getTextColor(){const e=this.colorStore.state;return!this.props.hidden&&e?e.textColor:this.theme.lightTextColor}getIconButtonStyle(){const{hidden:e}=this.props;if(!e)return{transition:"opacity 100ms ease-in-out",opacity:this.isHoveredStore.state?1:0}}}function di(e){return(0,le.rD)(e.board_cover_size)}ci.displayName="BoardGroupHeader",ci.contextTypes={...Y.wK,...n.w};const hi=ci;function pi(e){window.__c={n:"BoardGroupsShimmer"};const{isFullScreen:t,boardCoverSize:o,showGroupHeader:r,areColumnsColored:i}=e,n=e.numBoardColumns||3,s=t?480:360,l=function(e){const t=ri+ri;return(0,le.rD)(e)+t}(o),a=(0,co.yK)((e=>({container:{display:"flex",alignItems:"flex-start",paddingTop:10},groupHeader:{backgroundColor:e.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%"},group:{marginTop:i?20:8,marginRight:10,width:"100%",minWidth:l}})),[l,i]),c=C.DZ(n,(e=>(0,S.jsxs)("div",{style:a.group,children:[r&&(0,S.jsx)(Ar.Z,{style:a.groupHeader}),(0,S.jsx)(ti,{minHeight:s})]},e)));return(0,S.jsx)("div",{style:a.container,children:c})}class ui extends a.default{getInitialState(){return{searchQuery:"",limit:ui.defaultLimit}}}ui.defaultLimit=20,ui.loadMoreScrollOffset=200,ui.loadMoreIncrement=20;const mi=ui;var gi=o(72087),Si=o(21199),yi=o(68894),vi=o(43765),fi=o(3553);const Ci=(0,R.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"boardHiddenGroup.searchPlaceholder"}});class xi extends n.Z{constructor(){super(...arguments),this.createdStores=new Set,this.storeTypes={buttonPopupStore:Ce.Z,boardHiddenGroupStore:mi,requestStore:gi.Z},this.renderPopup=()=>{const{device:e}=this.environment,{groupFormat:t,schema:o,currentGroups:r,collectionContextStore:i,groupBy:n}=this.props;let s;s=e.isMobile?{menuType:st.og.Modal,title:(0,S.jsx)(Uo.Z,{groupBy:n,groupFormat:t,currentGroups:r,schema:o,disabled:!0,isHiddenGroup:!0,collectionContextStore:i}),left:(0,S.jsx)(mt.ZP,{popupType:ft.kQ.SlideUp,renderOrigin:e=>(0,S.jsx)("div",{...e,children:(0,m.o)({width:18,height:18,color:this.theme.lightTextColor})}),render:this.renderActionButtonPopup}),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:this.handlePopupClose,header:this.renderHeader()}:{menuType:st.og.Popup,header:this.renderHeader(),width:(0,le.rD)(this.getCoverSizeFormat())+20};const l=this.reducerStore.state;if(l)return(0,S.jsx)(fi.Z,{store:this.selectableBlockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:o}=e;return(0,S.jsxs)(gt.Z,{...s,...o,children:[(0,S.jsx)(at.Z,{id:`board_hidden_group:${(0,ze.mD)(t)}`,reducer:l,groupsPointer:[t],collectionContextStore:i,resultStore:this.reducerResultStore(),render:this.renderResults}),(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})}})},this.renderResults=()=>{var e,t;const{device:o}=this.environment,{groupFormat:r,disabled:i,format:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=this.props,c=null===(e=this.reducerResultStore())||void 0===e?void 0:e.state,d=null===(t=this.resultsStore())||void 0===t?void 0:t.state;return c&&d?0===d.length?(0,S.jsx)(Ct.Z,{children:(0,S.jsx)(vi.Z,{title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No results",id:"database.boardView.searchResults.noResults.label"})})}):(0,S.jsx)("div",{style:{padding:o.isMobile?"8px 16px":"6px 14px 8px"},children:(0,S.jsx)(Do,{collectionContextStore:s,groupsPointer:[r],format:n,canDrag:!i,onSelectableEnter:this.handleBoardItemEnter,disableRequest:!0,resultProps:{format:n,schema:l,disabled:i,coverFormat:this.getCoverFormat(),coverAspectFormat:this.getCoverAspectFormat(),coverSizeFormat:this.getCoverSizeFormat(),shouldShowTitle:Rt.K8(this.props.format,"board"),colorStyle:void 0,blockPropertyValueOverlayStore:a,onTextEnter:this.handleBoardItemTextEnter,onTextEsc:this.handleBoardItemTextEsc,onShiftEnter:this.handleBoardItemEnter,collectionContextStore:s},resultComponent:lo,handleOpenPeekPage:Ae.default.isSidePeekOpen()?void 0:this.handlePopupClose,canDrop:!0,disabled:i,shouldShowHoverMenu:!1,direction:Fo.Vertical,belowDropZoneMargin:2,emptyDroppableSize:4,analyticsName:"board"})}):(0,S.jsx)(Ct.Z,{children:(0,S.jsx)(vi.Z,{title:(0,S.jsx)(Mt.Z,{})})})},this.renderActionButtonPopup=e=>{const{groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n}=this.props;if(n.collectionStore())return(0,S.jsx)(Wo,{parent:e,groupFormat:t,currentGroups:o,format:r,schema:i,collectionContextStore:n,groupsFormatKey:"board_columns",groupsLimitStore:n.boardColumnsLimit})},this.handlePopupClose=()=>{this.stores.buttonPopupStore.setState({open:!1})},this.handleSearchInputChange=e=>{this.stores.boardHiddenGroupStore.setState({searchQuery:e.target.value,limit:mi.defaultLimit}),this.clearSelectionIfBlockIsSelected()},this.handleSearchClearButtonClick=()=>{this.stores.boardHiddenGroupStore.reset(),this.clearSelectionIfBlockIsSelected()},this.handleButtonPopupClick=()=>{this.stores.boardHiddenGroupStore.reset(),this.clearSelectionIfBlockIsSelected()},this.handleDrop=e=>{const{droppedStores:t,duplicate:o}=e,{collectionContextStore:r,groupFormat:n}=this.props,s=i.findDOMNode(this);s&&s instanceof Element&&W.createAndCommit({userAction:"BoardHiddenGroup.handleDrop",environment:this.environment,perform:e=>j.BO({environment:this.environment,collectionContextStore:r,groupsPointer:[n],droppedStores:t,duplicate:o,transaction:e})})},this.handleBoardAggregationChange=e=>{const{collectionContextStore:t,query:o}=this.props,r=t.collectionViewStore(),i={...o,aggregations:e?[e]:[]};r&&W.createAndCommit({userAction:"BoardHiddenGroup.handleBoardAggregationChange",environment:this.environment,perform:e=>{_.iG({collectionViewStore:r,update:{query2:i},transaction:e})}})},this.handleBoardGroupHeaderAddItem=e=>{this.createdStores.add(e)},this.handleScrollOffsetChange=e=>{var t;const{collectionContextStore:o}=this.props,{boardHiddenGroupStore:r}=this.stores,i=r.state,n=null===(t=this.reducerResultStore())||void 0===t||null===(t=t.state)||void 0===t?void 0:t.blockIds,s=o.isLoading.state;e<mi.loadMoreScrollOffset&&!s&&n&&i.limit<=n.length&&r.setState({...i,limit:i.limit+mi.loadMoreIncrement})},this.handleBoardItemEnter=e=>{const{blocks:t,transaction:o}=e,{groupFormat:r,collectionContextStore:i,isFullScreen:n}=this.props,s=i.groupsStore.getGroupState(r);if(!s)return;const l=s.resultsStore;if(t.length>0&&l.state.length>0){const e=t[0];if(!et.M_(this.environment)||!i.collectionStore()||!i.shouldAllowNewItemCreation())return;const s=l.state.findIndex((t=>t===e))+1;Tt({transaction:o,environment:this.environment,collectionContextStore:i,isFullScreen:n,groupsPointer:[r],insertAtIndex:s,from:"board_group_enter_add_item",transient:!0})}},this.handleBoardItemTextEnter=e=>{const{collectionContextStore:t,isFullScreen:o,groupFormat:r}=this.props,i=this.resultsStore();if(!i)return;if(!et.M_(this.environment)||!t.collectionStore())return this.handleBoardItemTextEsc(e);const n=i.state.findIndex((t=>t===e))+1;W.createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:this.environment,perform:e=>{Tt({transaction:e,environment:this.environment,collectionContextStore:t,isFullScreen:o,groupsPointer:[r],insertAtIndex:n,from:"board_group_enter_add_item",transient:!0})}})},this.handleBoardItemTextEsc=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore(),r=e.getTitleStore();if(Pt.QaF(r.getValue()))return void H.Ys({environment:this.environment,store:e});if(!o)return;const i=this.resultsStore();if(!i)return;const n=i.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),l=t.collectionViewBlockStore();if(s&&l&&M.sGw(this.environment,{...(0,re.Pn)(t),block_id:e.id}),W.createAndCommit({userAction:"BoardHiddenGroup.handleBoardItemTextEsc",environment:this.environment,perform:t=>{j.Od({store:e,transaction:t})}}),n>=0){const e=i.state[n];H.Ys({environment:this.environment,store:e})}},this.reducerStore=this.createComputedStore((()=>{const{groupFormat:e,schema:t,format:o}=this.props,{boardHiddenGroupStore:r}=this.stores,{searchQuery:i,limit:n}=r.state,s=(0,ot.zk)({schema:t,group:e,timeZone:(0,rt.r)()});if(!s)return;return{type:"results",filter:s,limit:n,searchQuery:i,loadContentCover:Boolean(o&&o.board_cover&&"page_content"===o.board_cover.type)}}))}willMount(e){super.willMount(e);const t=e.collectionContextStore.collectionViewBlockStore();t&&(this.selectableBlockStore=new _e.G(this.environment,{table:b.iU,id:t.id}))}renderComponent(){const{device:e}=this.environment,{groupBy:t,groupFormat:o,disabled:r,query:i,schema:n,currentGroups:s,collectionContextStore:l}=this.props,a=i.aggregations?i.aggregations[0]:void 0;return(0,S.jsx)(Po.Z,{store:this.selectableBlockStore,canDropOnto:!r,onSelectableDrop:this.handleDrop,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,children:(0,S.jsx)(mt.ZP,{popupType:e.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,renderOrigin:e=>(0,S.jsxs)(Qt.Z,{style:xi.buttonStyle,...e,children:[(0,S.jsx)(Uo.Z,{groupBy:t,groupFormat:o,currentGroups:s,schema:n,disabled:!0,isHiddenGroup:!0,collectionContextStore:l}),(0,S.jsx)(kt,{groupFormat:o,aggregation:a,schema:n,collectionContextStore:l,disabled:!0,onChange:this.handleBoardAggregationChange})]},(0,ze.mD)(o)),render:this.renderPopup,buttonPopupStore:this.stores.buttonPopupStore,onClick:this.handleButtonPopupClick})})}renderHeader(){const{device:e}=this.environment,{groupFormat:t,disabled:o,format:i,schema:n,query:s,currentGroups:l,collectionContextStore:a,isFullScreen:c,hoveredGroupStore:d,groupBy:h,isInPeekRenderer:p}=this.props,{searchQuery:u}=this.stores.boardHiddenGroupStore.state;return(0,S.jsxs)(r.Fragment,{children:[!e.isMobile&&(0,S.jsx)(hi,{groupBy:h,currentGroups:l,groupFormat:t,query:s,schema:n,format:i,collectionContextStore:a,disabled:o||Boolean(u),hidden:!0,isPopup:!0,onAddItem:this.handleBoardGroupHeaderAddItem,isFullScreen:c,hoveredGroupStore:d,isInPeekRenderer:p},(0,ze.mD)(t)),(0,S.jsx)("div",{style:{margin:e.isMobile?0:"6px 0"},children:(0,S.jsx)(Si.Z,{capture:!0,render:t=>(0,S.jsx)(yi.ZP,{value:u,placeholder:pe.default.formatMessage(Ci.searchPlaceholder),autoFocus:!e.isMobile,showClearButton:!0,onChange:this.handleSearchInputChange,onClearButtonClick:this.handleSearchClearButtonClick,...t})})})]})}clearSelectionIfBlockIsSelected(){Ht.default.state.stores.length>0&&H.ZH(this.environment)}getCoverFormat(){const{format:e}=this.props;return e?e.board_cover:void 0}getCoverAspectFormat(){const{format:e}=this.props;return e?e.board_cover_aspect:void 0}getCoverSizeFormat(){const{format:e}=this.props;return e?e.board_cover_size:void 0}reducerResultStore(){const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.reducerResultStore}resultsStore(){const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.resultsStore}}xi.displayName="BoardHiddenGroup",xi.buttonStyle={display:"flex",alignItems:"center",justifyContent:"flex-start",height:32,padding:4,borderRadius:3};const bi=xi;var wi=o(79131);class ki extends Oe.Z{constructor(e,t){super(e,t),this.storeTypes={groupsResultStore:a.default.createClass(void 0),hoveredGroupStore:a.default.createClass(void 0),subgroupsMountedStore:a.default.createClass(!1),lastColumnsBy:a.default.createClass(void 0),lastGroupBy:a.default.createClass(void 0)},this.hiddenGroupsContainerRef=void 0,this.hiddenGroupsHeaderRef=void 0,this.hiddenGroupsHeaderLastOffset=void 0,this.renderGroupHeader=(e,t)=>{const{schema:o,collectionContextStore:r,format:i,query:n,disabled:s,isFullScreen:l}=this.props;if(this.getGroupStateForGroupFormat(e)&&i.board_columns_by)return(0,S.jsx)(hi,{currentGroups:t,groupFormat:e,query:n,schema:o,format:i,groupBy:i.board_columns_by,collectionContextStore:r,hoveredGroupStore:this.stores.hoveredGroupStore,disabled:s,hidden:!1,isPopup:!1,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:l},(0,ze.mD)(e))},this.subGroupMinWidth=()=>{const{format:e}=this.props;return this.columnsDisplayStateStore.state.visibleGroups.length*(di(e)+2*ri+2*ni)},this.renderBoardHiddenGroupsButton=e=>(0,S.jsx)("div",{style:{display:"flex",minWidth:this.subGroupMinWidth()},children:(0,S.jsx)(jr,{...e})}),this.renderSubGroupHeader=e=>(0,S.jsx)(lr,{...e,height:36,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle,style:{...e.style,minWidth:this.subGroupMinWidth()},onMount:()=>this.stores.subgroupsMountedStore.setState(!0)}),this.renderHiddenGroup=e=>{const{collectionContextStore:t,query:o,schema:r,format:i,disabled:n,blockPropertyValueOverlayStore:s,isFullScreen:l,isInPeekRenderer:a}=this.props,c=this.columnsDisplayStateStore.state.currentGroups;if(!this.getGroupStateForGroupFormat(e)||!i.board_columns_by)return;const d=t.permissionScopes.state;return(0,S.jsx)(bi,{query:o,schema:r,format:i,groupFormat:e,groupBy:i.board_columns_by,currentGroups:c,collectionContextStore:t,disabled:n||!this.canEdit()||!d.canEditContent,blockPropertyValueOverlayStore:s,isFullScreen:l,hoveredGroupStore:this.stores.hoveredGroupStore,isInPeekRenderer:a},(0,ze.mD)(e))},this.handleGroupReorder=(e,t)=>{const{collectionContextStore:o}=this.props,r=this.columnsDisplayStateStore.state.currentGroups,i=r.filter((t=>e.indexOf((0,ze.mD)(t))<0)),n=r.filter((t=>e.indexOf((0,ze.mD)(t))>=0)),s=C.MR(n,(t=>{const o=e.indexOf((0,ze.mD)(t));return o>=0?o:1/0})),l=t?[...i,...s]:[...s,...i];W.createAndCommit({userAction:"Board.handleGroupReorder",environment:this.environment,perform:e=>{j.A6({collectionContextStore:o,newGroups:l,groupsFormatKey:"board_columns",transaction:e})}}),I.wd({environment:this.environment,collectionContextStore:o,action:t?"board_reorder_hidden_groups":"board_reorder_groups"})},this.handleCollectionAddGroupButtonAccept=e=>{const{collectionContextStore:t,schema:o,format:r}=this.props,i=t.collectionStore();if(!i)return;const n=r.board_columns_by;n&&j.tH({update:e,collectionContextStore:t,groupsFormatKey:"board_columns",collectionStore:i,schema:o,groupBy:n,environment:this.environment})},this.handleEditorMouseDown=e=>{const{device:t}=this.environment;t.isMobile||(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{e.preventDefault(),E.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleGroupsChange=()=>{const{format:e,collectionContextStore:t}=this.props,o=this.columnsDisplayStateStore.state.currentGroups;j.$D({environment:this.environment,format:e,groupsFormatKey:"board_columns",collectionContextStore:t,currentGroups:o})},this.handleGroupsChangeDebounced=C.Ds(this.handleGroupsChange,5e3),this.handleGroupHeaderAddItem=e=>{const{collectionContextStore:t}=this.props,{device:o}=this.environment;o.isMobile?O.navigateToBlock({environment:this.environment,store:e,pageVisitSource:c.tY.Create}):O.peekBlock({environment:this.environment,store:e,peekMode:le.kr(t.collectionViewStore()),resultsStore:void 0,collectionContextStore:t,pageVisitSource:c.tY.Create})},this.handleMouseLeave=()=>{this.stores.hoveredGroupStore.setState(void 0)},this.subgroupsOnChangeStore=this.createComputedStore((()=>{var e,t;const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=null==r||null===(e=r.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),n=null==r||null===(t=r.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue();C.Xy(i,this.stores.lastGroupBy.state)&&C.Xy(n,this.stores.lastColumnsBy.state)||this.stores.subgroupsMountedStore.setState(!1),this.stores.lastGroupBy.setState(i),this.stores.lastColumnsBy.setState(n)})),this.anyVisibleGroupHasResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,format:o,schema:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n}=i,s=o.collection_group_by,l=t.collectionViewBlockStore(),a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=void 0!==l?(0,Ke.Cz)({groupBy:s,schema:r,formatGroups:o.collection_groups||[],schemaGroups:this.schemaGroupsStore.state,reducerResults:c,getRecordModel:l.getRecordModel,relativeVariableResult:t.relativeVariableStore.state,viewAppConfigUri:null===(e=t.collectionViewStore())||void 0===e?void 0:e.getFormat().app_config_uri}):[];if(0===d.length){if(void 0!==s)return!1;for(const e of n){const o=t.groupsStore.getGroupState(e);if(null!=o&&o.reducerResultStore.state)return!0}}else for(const h of d)for(const e of n){const o=[h,e],r=t.groupsStore.getGroupState(o);if(null!=r&&r.reducerResultStore.state)return!0}return!1})),this.schemaGroupsStore=this.createComputedStore((()=>{const{format:e,schema:t}=this.props,o=e.board_columns_by;if(o)return(0,ze.Qq)({schema:t,groupBy:o})}),!0),this.groupsReducerStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=o.remoteRequestStore.state,i=e.board_columns_by;if(i)return(0,Ke.ej)({groupBy:i,schema:t,format:e,filter:null==r?void 0:r.loader.filter,groupsFormatKey:"board_columns",limit:o.boardColumnsLimit.state})})),this.columnsDisplayStateStore=this.createComputedStore((()=>{const{format:e,schema:t,collectionContextStore:o}=this.props,r=e.board_columns_by;if(!r)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const i=o.collectionViewBlockStore();if(!i)return{currentGroups:[],visibleGroups:[],hiddenGroups:[],total:0};const n=o.collectionViewStore(),s=o.boardColumnsLimit.state,l=this.schemaGroupsStore.state,a=this.stores.groupsResultStore.state,c=a?a.results:void 0,d=a?a.total:0,h=(0,Ke.Cz)({groupBy:r,schema:t,formatGroups:e.board_columns||[],schemaGroups:l,reducerResults:c,getRecordModel:i.getRecordModel,relativeVariableResult:o.relativeVariableStore.state,viewAppConfigUri:null==n?void 0:n.getFormat().app_config_uri}),p=h.filter((e=>!(0,ze.eF)(e))).slice(0,s),u=h.filter((e=>(0,ze.eF)(e)));return{currentGroups:[...p,...u],visibleGroups:p,hiddenGroups:u,total:d}}),!0),this.disableBoardColorColumnsStore=this.createComputedStore((()=>{const{schema:e,format:t,collectionContextStore:o}=this.props;return!Boolean((0,Ke.II)({environment:this.environment,groupFormat:void 0,schema:e,format:t,collectionContextStore:o,theme:this.theme}))}),!0),this.getGroupHeaderComputedStickyStyle=e=>({background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,boxShadow:e?`0 1px 0 ${this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}`:void 0}),this.getGroupStyle=e=>({marginTop:4,...e.isLast&&{paddingBottom:12}}),this.hiddenGroupsContainerRef=r.createRef(),this.hiddenGroupsHeaderRef=r.createRef(),this.hiddenGroupsHeaderLastOffset=0}willMount(){this.columnsDisplayStateStore.addListener(this.handleGroupsChangeDebounced)}willUnmount(){this.columnsDisplayStateStore.removeListener(this.handleGroupsChangeDebounced),this.handleGroupsChangeDebounced.cancel()}willMountOrUpdate(e){const{format:t,store:o,collectionContextStore:r}=e,i=r.collectionStore();i&&(!t.board_columns_by&&o.isDefined()&&i.isDefined()&&this.updateOrCreateColumnsByProperty(e),s.default.afterNextFlush((()=>this.updateHiddenGroupsHeaderOffset())))}renderPersisted(){const{format:e}=this.props;return e.board_columns_by?this.renderBoard():(0,S.jsx)("div",{style:this.getBoardStyle(),className:ee.EGJ,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a select property.",id:"database.boardView.missingSelectProperty"})})}renderBoard(){const{store:e,format:t,isFullScreen:o,collectionContextStore:r}=this.props,i=this.columnsDisplayStateStore.state,{visibleGroups:n,hiddenGroups:s}=i,l=t.collection_group_by,a=this.anyVisibleGroupHasResultsStore.state,c=this.stores.subgroupsMountedStore.state;this.subgroupsOnChangeStore.state;const d=r.shouldShowSpinner.state&&!c&&!a;return this.renderBoardColumnsReducerRequest((()=>(0,Qe.Z)((c=>(0,S.jsx)(Rr,{isFullScreen:o,renderEmitter:r.renderEmitter,children:(0,S.jsx)("div",{style:this.getBoardStyle(),className:ee.EGJ,...c,children:(0,S.jsxs)(Po.Z,{style:this.getColumnsWrapStyle(),store:e,shouldShowHalo:!o,canSelect:!o,onMouseDown:this.handleEditorMouseDown,analyticsName:"board",onMouseLeave:this.handleMouseLeave,children:[this.renderHeader(i),d&&(0,S.jsx)(pi,{isFullScreen:o,numBoardColumns:n.length,boardCoverSize:t.board_cover_size,areColumnsColored:!this.disableBoardColorColumnsStore.state,showGroupHeader:!0}),n.length>0&&(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{height:34+si(this.disableBoardColorColumnsStore.state)}}),l?this.renderBoardColumnsForGroups(l,n,a):this.renderBoardColumnsForGroup(void 0,n,a)]}),this.shouldRenderGroupsLoadMoreButton(i)&&(0,S.jsx)("div",{style:{width:90,marginLeft:ni,marginRight:ni}}),this.shouldRenderAddGroupButton(i)&&(0,S.jsx)("div",{style:{width:35,marginLeft:ni,marginRight:ni}}),s.length>0&&this.renderHiddenGroups(s)]})})})))))}renderBoardColumnsReducerRequest(e){const{collectionContextStore:t}=this.props,o=this.groupsReducerStore.state;return o?(0,S.jsx)(at.Z,{id:"board_columns",reducer:o,collectionContextStore:t,resultStore:this.stores.groupsResultStore,render:e}):e()}renderHeader(e){const{format:t,isFullScreen:o,isRootChild:r,collectionContextStore:i}=this.props,{hiddenGroups:n,visibleGroups:s,currentGroups:l}=e;if(0===s.length&&0===n.length)return;const a=s.map((e=>(0,ze.mD)(e))),c=t.board_columns_by;if(!c)return;const d=(0,ze.mu)(c),h=i.permissionScopes.state,p="manual"===d.type&&h.canConfigureBlock,u=(0,Ke.qW)({device:this.environment.device,isFullScreen:o,isRootChild:r});return(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{style:this.getHeaderStyle(),children:[u&&(0,S.jsx)("div",{style:this.getHeaderSpacerStyle()}),p?(0,S.jsx)(wi.ZP,{direction:"horizontal",keys:a,renderKey:(e,t)=>this.renderGroupHeader(s[t],l),onDrop:e=>this.handleGroupReorder(e,!1)}):a.map(((e,t)=>this.renderGroupHeader(s[t],l))),this.shouldRenderGroupsLoadMoreButton(e)&&this.renderGroupsLoadMoreButton(e),this.shouldRenderAddGroupButton(e)&&this.renderAddGroupButton(),n.length>0&&(0,S.jsx)("div",{style:this.getHiddenGroupsCaptionStyle(),ref:this.hiddenGroupsHeaderRef,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Hidden groups",id:"collection.boardView.hiddenGroups.label"})})]})})}renderHiddenGroups(e){const{device:t}=this.environment,{collectionContextStore:o}=this.props,r=this.canEdit()&&!t.isMobile&&!o.permissionScopes.state.isLocked,i=e.slice(0,Ke.ew),n=i.map((e=>(0,ze.mD)(e)));return(0,S.jsx)("div",{style:this.getHiddenGroupsWrapStyle(),ref:this.hiddenGroupsContainerRef,children:i.length>0&&(r?(0,S.jsx)(wi.ZP,{direction:"vertical",keys:n,renderKey:(e,t)=>this.renderHiddenGroup(i[t]),onDrop:e=>this.handleGroupReorder(e,!0)}):(0,S.jsx)("div",{children:i.map(this.renderHiddenGroup)}))})}renderGroupsLoadMoreButton(e){const{collectionContextStore:t,schema:o}=this.props,r=t.boardColumnsLimit;return(0,S.jsx)(Br,{visibleGroups:e.visibleGroups,hiddenGroups:e.hiddenGroups,total:e.total,groupsLimitStore:r,type:"board",schema:o,collectionContextStore:t})}renderAddGroupButton(){const{format:e,schema:t,collectionContextStore:o}=this.props;if(!e.board_columns_by)return;if("collectionTypedView"===o.contextType)return;const r=this.columnsDisplayStateStore.state.currentGroups;return(0,S.jsx)(xr,{groupBy:e.board_columns_by,schema:t,currentGroups:r,onAccept:this.handleCollectionAddGroupButtonAccept,groupsLimitStore:o.boardColumnsLimit,parentStore:this.props.store,type:"board",collectionContextStore:o})}renderBoardColumnsForGroups(e,t,o){const{store:r,format:i,collectionContextStore:n,schema:s,disabled:l,isFullScreen:a,paddingLeft:c,isRootChild:d,isInPeekRenderer:h}=this.props;return(0,S.jsx)(Ur,{store:r,id:Ge.M9,groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:i,schema:s,collectionContextStore:n,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:c,renderGroup:e=>this.renderBoardColumnsForGroup(e,t,o),renderHeader:this.renderSubGroupHeader,renderHiddenGroupsButton:this.renderBoardHiddenGroupsButton,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,stickyLeft:!this.environment.device.isMobile,getGroupStyle:this.getGroupStyle,isInPeekRenderer:h})}renderBoardColumnsForGroup(e,t,o){return(0,S.jsx)("div",{style:wi.l8,children:t.map(((r,i)=>{const n=i===t.length-1;return this.renderGroupResults(e?[e,r]:[r],n,o)}))})}renderGroupResults(e,t,o){const{store:r,collectionContextStore:i,isFullScreen:n,query:s,schema:l,format:a,disabled:c,blockPropertyValueOverlayStore:d}=this.props,{hiddenGroups:h}=this.columnsDisplayStateStore.state,p=0!==h.length;if(!i.groupsStore.getGroupState(e))return;const u=i.permissionScopes.state,m=this.canEdit()&&("collectionTypedView"===i.contextType||u.canEditContent);return(0,S.jsx)(ai,{store:r,hoveredGroupStore:this.stores.hoveredGroupStore,query:s,schema:l,format:a,groupsPointer:e,collectionContextStore:i,isFullScreen:n,isInPeekRenderer:this.props.isInPeekRenderer,disabled:c||!m,isLast:t&&!p,blockPropertyValueOverlayStore:d,anyGroupHasResults:o},(0,ze.KW)(e))}updateOrCreateColumnsByProperty(e){const{collectionContextStore:t,schema:o}=e,r=t.collectionStore(),i=t.permissionScopes.state;if(!r)return;const n=t.collectionViewStore();n&&i.canConfigureBlock&&W.createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:this.environment,perform:e=>{let s,l=le.Se(o);if(!l&&i.canConfigureCollection){l=(0,He.ZP)();s={[l]:{name:this.props.intl.formatMessage({id:"collection.boardView.selectProperty.defaultName",defaultMessage:"Status"}),type:"select",options:[]}}}if(!l)return;const a=(s||o)[l];a&&(0,ze.LG)(a)&&(Ne.FH({stores:[n],update:{board_columns_by:(0,ze.fw)(l,a,"collectionTypedView"===t.contextType)},transaction:e}),We.sW({store:n,data:{type:"board"},transaction:e}),s&&_.xO({environment:this.environment,collectionStore:r,update:s,transaction:e}))}})}getGroupStateForGroupFormat(e){const{collectionContextStore:t}=this.props;return t.groupsStore.getGroupState([e])}shouldRenderGroupsLoadMoreButton(e){const{collectionContextStore:t}=this.props,{visibleGroups:o,hiddenGroups:r,total:i}=e,n=0===o.length&&!t.shouldShowSpinner.state||o.length>0,s=$e({collectionContextStore:t,isForColumnGroups:!0}),l=t.boardColumnsLimit.state<i-r.length;return n&&l||s}shouldRenderAddGroupButton(e){const{format:t,collectionContextStore:o}=this.props,{visibleGroups:r}=e,i=t.board_columns_by,n=o.permissionScopes.state,s=0===r.length&&!o.shouldShowSpinner.state||r.length>0;return n.canConfigureBlock&&i&&(0,ze.Wz)(i,n.canConfigureCollection)&&!n.isSyncedCollection&&s}getBoardStyle(){return{marginLeft:this.props.paddingLeft,marginRight:this.props.paddingRight,float:"left",minWidth:"100%"}}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,r=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),i=si(this.disableBoardColorColumnsStore.state);return{position:"absolute",background:r,height:34+i,paddingTop:i,zIndex:T.LN,display:"flex",boxShadow:`-3px 0 0 ${r}`,minWidth:"100%"}}getHeaderHeight(){return 34+si(this.disableBoardColorColumnsStore.state)}getColumnsWrapStyle(){return{display:"flex",position:"relative",flexGrow:1,paddingBottom:this.props.paddingBottom}}getHiddenGroupsWrapStyle(){return{width:220,flexShrink:0,marginTop:34+si(this.disableBoardColorColumnsStore.state),marginLeft:12}}getHiddenGroupsCaptionStyle(){return{position:"relative",width:220,flexShrink:0,display:"flex",alignItems:"center",fontSize:14,color:this.theme.lightTextColor,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,marginLeft:20}}getHeaderSpacerStyle(){return{height:"calc(100% + 17px)",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,width:20,marginLeft:-20,marginTop:-17}}updateHiddenGroupsHeaderOffset(){var e;if("function"==typeof this.hiddenGroupsHeaderRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current)return;const t=(this.getHiddenGroupsHeaderOffset()||0)+this.hiddenGroupsHeaderLastOffset;this.hiddenGroupsHeaderLastOffset=t,this.hiddenGroupsHeaderRef.current.style.left=`${t}px`}getHiddenGroupsHeaderOffset(){var e,t;if("function"==typeof this.hiddenGroupsHeaderRef||"function"==typeof this.hiddenGroupsContainerRef||null===(e=this.hiddenGroupsHeaderRef)||void 0===e||!e.current||null===(t=this.hiddenGroupsContainerRef)||void 0===t||!t.current)return;const o=this.hiddenGroupsHeaderRef.current.getBoundingClientRect().left;return this.hiddenGroupsContainerRef.current.getBoundingClientRect().left-o+8}}ki.displayName="Board";const Pi=(0,R.injectIntl)(ki);var Ti=o(13991),Ri=o(40506),Mi=o(7057),Ii=o(53877),Vi=o(2585),Bi=o(5257),Fi=o(40863),ji=o(77907),Di=o(95802),Ai=o(15723),_i=o(17746),Li=o(50628),Zi=o(30120),Ei=o(53876),Oi=o(6685),zi=o(76798);class Gi extends Oe.Z{activate(){const e=this.getPeekURL();e&&(this.props.handleOpenPeekPage(),O.navigate({environment:this.environment,url:e}))}didMount(){this.props.collectionContextStore.onItemMount()}renderComponent(){return(0,S.jsx)(Ni,{...this.props})}getPeekURL(){const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=fe.default.state;return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}}Gi.displayName="CalendarItem";const Hi=Gi;function Ni(e){window.__c={n:"CalendarItemFn"};const{store:t,row:o,schema:r,format:i,disabled:n,calendarBy:s,collectionContextStore:l,includeTime:a,resultsStore:c,handleOpenPeekPage:d,blockPropertyValueOverlayStore:h,calendarStore:p}=e,u=(0,uo.O7)(),m=r[s],g=(0,ct.VK)((()=>!n&&"date"===(null==m?void 0:m.type)&&!l.permissionScopes.state.isSyncedCollection),[l.permissionScopes,n,null==m?void 0:m.type]),{start:y,end:v,startOfWeek:f,endOfWeek:x,startColumn:b,columnCount:w}=(0,Fi.du)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),k=(0,ct.VK)((()=>{const e=i.calendar_properties?i.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[],o=e.filter((e=>Ft.XU({block:t.getModel(),property:e,schema:r,getRecordModel:t.getRecordModel,userId:u.currentUser.id,userTimeZone:(0,rt.r)(),intl:pe.default.getIntl()})));return o.concat(C.e5(e,o))}),[u.currentUser.id,i.calendar_properties,r,t]);if(!m||!Bt.Lt(m))return null;const P=k.length+1,T=y<f,R=void 0!==v&&v>x;return(0,S.jsxs)(Wi,{store:t,row:o,numRows:P,columnCount:w,startIsBeforeStartOfWeek:T,endIsAfterEndOfWeek:R,startColumn:b,disabled:n,isEditableDate:g,calendarBy:s,resultsStore:c,handleOpenPeekPage:d,children:[(0,S.jsx)(Ki,{store:t,disabled:n,start:y,startOfWeek:f,end:v,endOfWeek:x,includeTime:a,columnCount:w,propertySchema:m}),(0,S.jsx)($i,{store:t,sortedProperties:k,startIsBeforeStartOfWeek:T,disabled:n,blockPropertyValueOverlayStore:h}),g&&(0,S.jsx)(qi,{store:t,start:y,startOfWeek:f,end:v,endOfWeek:x,calendarBy:s,calendarStore:p})]})}function Wi(e){window.__c={n:"CalendarItemWrapper"};const{store:t,children:o,columnCount:i,row:n,numRows:s,startColumn:l,disabled:a,isEditableDate:d,calendarBy:h,resultsStore:p,handleOpenPeekPage:u,startIsBeforeStartOfWeek:m,endIsAfterEndOfWeek:g}=e,y=(0,uo.O7)(),v=(0,Q.Y$)(),f=(0,ct.VK)((()=>le.Sc(t)),[t]),C=s*Ei.ch+2*Yi+2*Xi,x=Qi+C*n,b=(0,ct.VK)((()=>wo.Z.state.hoveredStore===e.store),[e.store]),w=(0,co.yK)((e=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingLeft:m?0:6,paddingRight:g?0:6,width:g?`calc(100% / 7 * ${i} - 1px)`:`calc(100% / 7 * ${i})`,left:`calc(100% / 7 * ${l})`,height:C,top:x},haloStyle:{...le.pB(f,e),borderRadius:5,marginTop:2,marginBottom:2,marginLeft:m?0:5,marginRight:g?0:5},linkBoxStyle:{height:"100%",background:e.calendarItemBackground,borderTopLeftRadius:3,borderTopRightRadius:3,borderBottomLeftRadius:3,borderBottomRightRadius:3,boxShadow:e.lightBoxShadow,...m&&{borderTopRightRadius:0,borderBottomRightRadius:0},...g&&{borderTopLeftRadius:0,borderBottomLeftRadius:0}},linkBoxHoveredStyle:{opacity:1,background:e.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[i,g,C,f,l,m,x]),k=(0,r.useCallback)((e=>{const o=v.collectionStore();return o?F.QG({environment:y,collectionStore:o,collectionContextStore:v,store:t,insertStores:e.insertStores,calendarBy:h,transaction:e.transaction,results:p.state}):[]}),[h,v,y,p,t]),P=(0,r.useCallback)((e=>{const{transaction:o}=e;v.collectionStore()&&j.Od({store:t,transaction:o})}),[v,t]),[T,R]=(0,ct.VK)((()=>{const{mainEditorCurrentBlockStore:e}=fe.default.state,o=le.mb({store:t,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,de.ZP)({store:t,fullyQualified:!1,pageVisitSource:c.tY.LinkInPage}),o]}),[v,t]);return(0,S.jsx)(Po.Z,{store:t,style:w.selectable,canSelect:!a,shouldShowHalo:!0,shouldForceRenderSelectionHalo:f,haloStyle:w.haloStyle,canTriggerContextMenu:!a,showBlockMenuInput:!0,canDrag:d,onInsertAbove:k,onInsertBelow:k,onRemove:P,canInsertAbove:d,canInsertBelow:d,analyticsName:"calendar",shouldShowDropZone:!0,className:ee.K4T,children:(0,S.jsx)(Xt.Z,{style:w.linkBoxStyle,hoveredStyle:w.linkBoxHoveredStyle,pressedStyle:w.linkBoxHoveredStyle,innerStyle:w.linkBoxInnerStyle,onClick:u,href:T,metaHref:R,hovered:b,children:o})},t.id)}function Ki(e){window.__c={n:"CalendarItemTitleRow"};const{store:t,disabled:o,start:i,startOfWeek:n,end:s,endOfWeek:l,includeTime:a,columnCount:c,propertySchema:d}=e,h=(0,uo.O7)(),p=i<n,u=s&&s>l,m="time_format"in d?d.time_format:Ri.c_,[g,y,v]=(0,ct.VK)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),f=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&W.createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:h,perform:t=>{We.sO({store:o,value:e,transaction:t})}})}),[h,t]),C=(0,co.yK)((e=>({titleContainer:{paddingLeft:6,paddingRight:6,overflow:"hidden",...p&&{paddingLeft:12},...u&&{paddingRight:11},width:a?100/c+"%":"100%"},titleInner:{display:"flex",alignItems:"center",height:24},titleTextStyle:{flexGrow:1,fontSize:14,fontWeight:P.Z.fontWeight.semibold},recordIconStyle:{flexShrink:0,marginRight:4,marginTop:2},iconWarningStyle:{marginLeft:1,marginRight:5,width:10,fill:e.accentColors.orange[500]},timeStyle:{color:e.mediumTextColor,flexShrink:0,fontSize:10,marginLeft:4,height:14},endTimeStyle:{marginLeft:"auto",paddingLeft:4,marginRight:4,color:e.mediumTextColor,fontSize:10,whiteSpace:"nowrap",marginTop:-1},endTimeAbsoluteStyle:{position:"absolute",right:4,top:6}})),[c,u,a,p]),x=a&&s&&Zi.Xp.fromDateTimes(n,l).contains(s)&&i.day!==s.day,b=!(void 0===g&&y||v);return(0,S.jsx)("div",{style:C.titleContainer,children:(0,S.jsxs)("div",{style:C.titleInner,children:[b&&(o?(0,S.jsx)(Jt.Z,{disabled:!0,icon:g,isEmptyPage:y,size:14,style:C.recordIconStyle}):(0,S.jsx)(Jt.Z,{disabled:!1,store:t,bucket:"secure",icon:g,isEmptyPage:y,size:14,style:C.recordIconStyle,onChange:f})),v&&(0,At.t)(C.iconWarningStyle),(0,S.jsx)(zi.Z,{style:C.titleTextStyle,store:t,enableHover:!0}),(0,S.jsx)(Ui,{store:t}),a&&Zi.Xp.fromDateTimes(n,l).contains(i)&&(0,S.jsx)("div",{style:C.timeStyle,children:(0,Mi.xE)({dateTime:i,humanReadable:!1,timeFormat:m})}),x&&(0,S.jsx)("div",{style:{...C.endTimeStyle,...c>1?C.endTimeAbsoluteStyle:void 0},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"ends {endTime}",id:"calendarItem.endsTime.message",values:{endTime:(0,Mi.xE)({dateTime:s,humanReadable:!1,timeFormat:m})}})})]})})}function Ui(e){window.__c={n:"DiscussionIndicator"};const{store:t}=e,o=(0,co.Fg)(),r=(0,ct.VK)((()=>Ot.Xp(t,{recursivelyLoadAllDiscussions:!1})),[t]);return 0===r?null:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",color:o.mediumTextColor,fontSize:12,marginLeft:4,flexShrink:0},children:[(0,Dt.z)({width:12,height:12,marginRight:4,fill:o.mediumIconColor}),r]})}function $i(e){window.__c={n:"CalendarItemPropertiesRows"};const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:r,disabled:i,blockPropertyValueOverlayStore:n}=e,s=(0,Q.Y$)(),l=(0,ct.VK)((()=>s.permissionScopes.state.isLocked),[s.permissionScopes]),[a,c]=(0,ct.VK)((()=>[s.collectionStore(),s.collectionViewStore()]),[s]);return a?(0,S.jsx)("div",{style:{paddingLeft:6,paddingRight:6,overflow:"hidden",width:"100%",...r&&{paddingLeft:12}},children:o.map((e=>(0,S.jsx)(Ut.Z,{store:t,property:e,disabled:i,locked:l,format:$t.C.Calendar,tableWrap:!1,blockPropertyValueOverlayStore:n,collectionStore:a,collectionViewStore:c},e)))}):null}function qi(e){window.__c={n:"CalendarItemDraggables"};const{store:t,calendarStore:o,start:i,startOfWeek:n,end:s,endOfWeek:l,calendarBy:a}=e,c=(0,uo.O7)(),d=(0,co.yK)((()=>({leftDragHandle:{position:"absolute",top:0,left:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,right:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),h=(0,r.useCallback)((e=>{F.td({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:a})}),[o,a]),p=(0,r.useCallback)((()=>{W.createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,perform:e=>{F.fX({environment:c,transaction:e,calendarStore:o,calendarBy:a})}})}),[a,o,c]),u=(0,r.useCallback)((()=>{F.cQ({calendarStore:o})}),[o]),m=i>n&&(0,S.jsx)(Oi.Z,{render:e=>(0,S.jsx)("div",{style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{F.f$({calendarStore:o,target:t,direction:_i.t.Left})},onDraggableDragMove:h,onDraggableDragEnd:p,onDraggableDragCancel:u}),g=(!s||s&&s<l)&&(0,S.jsx)(Oi.Z,{render:e=>(0,S.jsx)("div",{style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{F.f$({calendarStore:o,target:t,direction:_i.t.Right})},onDraggableDragMove:h,onDraggableDragEnd:p,onDraggableDragCancel:u});return(0,S.jsxs)(S.Fragment,{children:[m,g]})}const Qi=30,Yi=2,Xi=3;class Ji extends Oe.Z{constructor(){super(...arguments),this.headerEl=void 0,this.root=void 0,this.verticalScrollableAncestor=void 0,this.storeTypes={calendarStore:_i.Z,resultStore:a.default.createClass(void 0)},this.handleHeaderMount=e=>{this.headerEl=e},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,o=t.isLoading.state,r=this.shouldInfinitelyLoad();if(e<be.Z.incrementScrollOffset&&!o&&r){const{collectionContextStore:e}=this.props,t=e.dateRangeStart.state,o=e.dateRangeEnd.state,r=(0,Ii.V7)((0,Ii._)({date:o,monthsToAdd:2}),X.AK.state);_.t5({dateRangeStart:t,dateRangeEnd:r,collectionContextStore:e})}},this.handleScroll=()=>{if(!this.headerEl)return;if(!this.shouldInfinitelyLoad())return;const{calendarStore:e}=this.stores,t=e.state,o=this.headerEl.getBoundingClientRect();let r=[];t.dayStoreMap.forEach(((e,t)=>{r.push({store:e,timestamp:t})})),r=C.MR(r,(e=>{let{timestamp:t}=e;return t}));const i=r.find((e=>{let{store:t}=e;const r=Di.C.getRectFromStore(t);return Boolean(r&&r.top<=o.top+o.height&&r.top+r.height>=o.top+o.height)}));if(i){const o=(0,Ii.kl)((0,Ii.Xz)({date:(0,Ii.V7)(i.timestamp,X.AK.state),daysToAdd:1}));o!==t.startingMonth&&e.setState({...e.state,startingMonth:o})}},this.handleScrollThrottled=C.P2(this.handleScroll,100),this.handleMouseMove=e=>{const{calendarStore:t}=this.stores,o=t.state;if(!o.isDragging&&!Re.Z.state){const r=this.findHoveredDay(e.clientX,e.clientY);o.hoveredDay!==r&&t.setState({...o,hoveredDay:r})}},this.handleMouseMoveThrottled=C.P2(this.handleMouseMove,50),this.handleTodayClick=()=>{const e=this.getCalendarViewRange(this.props.collectionContextStore),t="month"===e?(0,Ii.IS)((0,Ii.kl)(Date.now()),X.AK.state):(0,Ii.IS)(Date.now(),X.AK.state);this.setNewCalendarStart(t,e)},this.handleEditorMouseDown=e=>{const{device:t}=this.environment;t.isPhone||(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{e.preventDefault(),E.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[this.props.store],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}})},this.handleOpenPeekPage=()=>{const{collectionContextStore:e}=this.props;Se.default.mark("collections.open_item_page_lag");const t=e.collectionViewStore();Z.Xd({collectionContextStore:e,resultsStore:this.sortedResultsStore});const o=null==t?void 0:t.getFormat().collection_peek_mode,r=o||ko.Ls.calendar;M.hym(this.environment,{is_peek:!0,from:"calendar",peek_mode:r})},this.startOfWeekSettingStore=this.createComputedStore((()=>{const{currentUserSettingsStore:e}=fe.default.state;if(!e)return 0;const t=e.getSettings();return null!=t&&t.start_day_of_week?t.start_day_of_week:0}),!0),this.reducerStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,Fi.Ft)({collectionContextStore:e})}),!0),this.resultsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore();if(!t)return[];const o=this.stores.resultStore.state;return o?o.blockIds.map((e=>_e.G.createChildStore(t,{id:e,table:b.iU}))):[]}),!0),this.weeksStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=pe.default.getIntl();return(0,Fi.y$)({collectionContextStore:e,results:this.resultsStore.state,getRecordValue:this.getRecordValue,intl:t})}),!0),this.sortedResultsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return o&&(null===(e=this.weeksStore.state)||void 0===e?void 0:e.flatMap((e=>e.items.map((e=>_e.G.createChildStore(o,{table:b.iU,id:e.id}))))))||[]}),!0),this.getRecordValue=this.props.store.getRecordValue}static getPropertyRowHeight(){return Ei.ch}willMount(e){super.willMount(e);const{collectionContextStore:t}=e;this.handleMount(t),X.AK.addListener((()=>{this.handleMount(this.props.collectionContextStore)}))}willMountOrUpdate(e){super.willMountOrUpdate(e),Re.Z.state&&(this.stores.calendarStore.state.isDragging||this.stores.calendarStore.setState({...this.stores.calendarStore.state,hoveredDay:void 0}));const{query:t}=e;t.calendar_by||this.updateOrCreateCalendarProperty(e)}didMountOrUpdate(){this.handleScrollThrottled(),this.root||(this.root=i.findDOMNode(this),this.root&&(this.verticalScrollableAncestor=(0,me.VW)(this.root),this.verticalScrollableAncestor&&ce.lj(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),ce.lj(this.root,"mousemove",this.handleMouseMoveThrottled)))}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&ce.ZV(this.verticalScrollableAncestor,"scroll",this.handleScrollThrottled),this.root&&ce.ZV(this.root,"mousemove",this.handleMouseMoveThrottled)}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}renderPersisted(){var e,t;const{device:o}=this.environment,{store:r,paddingBottom:i,paddingLeft:n,paddingRight:s,query:l,schema:a,collectionContextStore:c,isFullScreen:d}=this.props,{calendar_by:h}=l;if(!h)return this.renderMissingDateProperty();const p=a[h];if(!p||!Bt.Lt(p))return this.renderMissingDateProperty();const u=this.reducerStore.state;if(!u)return;const m=void 0===(null===(e=this.stores.resultStore.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=this.stores.resultStore.getState())||void 0===t?void 0:t.blockIds.length),g=m&&Ue({collectionContextStore:c,groupsPointer:[],hasPartialResults:!m}),y=this.getCalendarViewRange(c),v=this.weeksStore.state;return(0,Qe.Z)((e=>(0,S.jsx)(at.Z,{id:"calendar_results",resultStore:this.stores.resultStore,collectionContextStore:c,reducer:u,render:()=>(0,S.jsx)(Rr,{isFullScreen:d,children:(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange,children:(0,S.jsx)("div",{style:{paddingBottom:i,paddingLeft:n,paddingRight:s,minWidth:this.props.minWidth},className:ee.c7X,children:(0,S.jsxs)(Po.Z,{style:Ji.style,store:r,shouldShowHalo:!d,canSelect:!d,onMouseDown:this.handleEditorMouseDown,analyticsName:"calendar",...e,children:[this.renderHeader(this.getCurrentlyViewedMonth(),y),(0,S.jsx)("div",{style:o.isPhone?Ji.mobileHeaderSpacerStyle:Ji.headerSpacerStyle}),(0,S.jsx)("div",{style:o.isPhone?Ji.mobileRowsWrapStyle:this.getRowsWrapStyle(),children:v&&v.map((e=>o.isPhone?this.renderMobileWeek(e.start,e.items,h,y,g):this.renderWeek(e.start,e.end,e.items,h,p,y,g)))})]})})})})})))}renderMissingDateProperty(){const{paddingBottom:e,paddingLeft:t,paddingRight:o}=this.props;return(0,S.jsx)("div",{style:{paddingBottom:e,paddingLeft:t,paddingRight:o},className:ee.c7X,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a date property.",id:"database.calendarView.missingDateProperty"})})}renderHeader(e,t){const{device:o}=this.environment,{collectionContextStore:r}=this.props,i=pe.default.getIntl();return(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{style:o.isPhone?this.getHeaderMobileStyle():this.getHeaderStyle(),ref:this.handleHeaderMount,children:[(0,S.jsxs)("div",{style:{display:"flex",height:42,alignItems:"center",marginBottom:2},children:[(0,S.jsx)("div",{style:{fontWeight:P.Z.fontWeight.semibold,marginLeft:8,marginRight:8,lineHeight:1,fontSize:o.isPhone?16:14},children:this.getHeaderText(t,e,Ti.SP)}),(0,S.jsx)("div",{style:{flexGrow:1}}),(0,S.jsx)(nr.Z,{ariaLabel:i.formatMessage({id:"database.calendarView.previousMonthButton.label",defaultMessage:"Previous Month"}),mobileFeedback:o.isMobile,icon:Vi.f,onClick:()=>this.handleCalendarClick("left",r)}),(0,S.jsx)(vt.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Today",id:"database.calendarView.todayButton.label"})}),(0,S.jsx)(nr.Z,{ariaLabel:i.formatMessage({id:"database.calendarView.nextMonthButton.label",defaultMessage:"Next Month"}),mobileFeedback:o.isMobile,icon:Bi.o,onClick:()=>this.handleCalendarClick("right",r)})]}),(0,S.jsx)("div",{style:{display:"flex",marginTop:o.isPhone?8:0,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`},className:ee.GNl,children:(0,Mi.kv)(X.AK.state,Ti.SP).map((e=>{let[t,o]=e;return(0,S.jsx)("div",{style:this.getWeekDayNameStyle(),children:o},t)}))})]})})}renderWeek(e,t,o,r,i,n,s){const{collectionContextStore:l,format:a,schema:c,blockPropertyValueOverlayStore:d}=this.props,h=l.collectionViewStore();if(!h)return;const p=this.canEditCalendar(),{calendarStore:u}=this.stores,m=u.state,g=[...Array(7).keys()].map((t=>this.renderDay(t,(0,Ii.Xz)({date:e,daysToAdd:t}),r,i,n,s))),y=[];let v=0;for(const P of o){const o=_e.G.createChildStore(h,{table:b.iU,id:P.id});m.isDragging&&m.target===o&&m.temporaryValue||y.push((0,S.jsx)(Hi,{collectionContextStore:l,store:o,startOfWeek:e,endOfWeek:t,start:P.start,end:P.end,row:P.row,includeTime:P.includeTime,format:a,schema:c,calendarBy:r,disabled:!p,calendarStore:u,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},o.id)),P.row>v&&(v=P.row)}const f=m.isDragging&&m.temporaryValue&&(0,Ii.Y_)(m.temporaryValue,(0,rt.r)());if(m.isDragging&&m.temporaryValue&&f&&(0,Ri.b8)(e,t,f.start,f.end)){const{target:i,temporaryValue:n}=m,s=o.find((e=>e.id===i.id));y.push((0,S.jsx)(Hi,{collectionContextStore:l,store:i,startOfWeek:e,endOfWeek:t,start:f.start,end:f.end,row:s?s.row:0,includeTime:"datetime"===n.type||"datetimerange"===n.type,format:a,schema:c,calendarBy:r,disabled:!p,calendarStore:u,blockPropertyValueOverlayStore:d,resultsStore:this.resultsStore,handleOpenPeekPage:this.handleOpenPeekPage},i.id))}const C=(a.calendar_properties?a.calendar_properties.filter((e=>e.visible)).map((e=>e.property)):[]).length+1,x="week"===n?372:124,w=Ji.getPropertyRowHeight()*C+2*Yi+2*Xi,k=Math.max((v+1)*w+Qi+4,x);return(0,S.jsxs)("div",{style:{...Ji.weekWrapStyle,height:k},children:[g,y]},e.toString())}renderDay(e,t,o,r,i,n){const{store:s,collectionContextStore:l}=this.props,{calendarStore:a}=this.stores,{dayStoreMap:c}=a.state,d=pe.default.getIntl(),h=a.state,p="date"===r.type,u=l.shouldAllowNewItemCreation();let m=c.get(t);m||(m=new _e.G(this.environment,s.pointer,{userId:s.userId,inMemoryRecordCache:s.inMemoryRecordCache}),c.set(t,m));const g=!h.isDragging&&h.hoveredDay===t,y=(0,Ii.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),v=(0,Ii.Y3)(t),f=(0,Ii.LY)(t),C=!y&&!v&&"week"!==i,x=d.formatMessage({defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"});return(0,S.jsxs)(Po.Z,{style:f?this.getWeekendDayStyle():this.getDayStyle(),store:m,canDropOnto:this.canEditCalendar()&&p,onSelectableDrop:e=>{W.createAndCommit({userAction:"Calendar.renderDay",environment:this.environment,perform:r=>{const i=l.collectionStore();if(!i)return;const n=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(n,{environment:this.environment,getData:()=>re.yr({collectionContextStore:l,is_native_drop:!1,is_empty:!1})}),F.JN({...e,environment:this.environment,startOfDay:t,calendarBy:o,collectionStore:i,collectionContextStore:l,results:this.resultsStore.state,transaction:r})}})},onDoubleClick:()=>{if(this.canEditCalendar()&&et.M_(this.environment)&&u){const e=this.createBlockInDay(t,o);M.W2j(this.environment,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,...(0,re.Pn)(l)})}},analyticsName:"calendar_day",shouldShowDropZone:!0,children:[g&&(p||v)&&u&&this.canEditCalendar()&&(0,S.jsx)(xt.Z,{renderTooltip:()=>x,render:e=>(0,S.jsx)(nr.Z,{ariaLabel:x,icon:Je.R,showShadow:!0,hasBackground:!0,style:{position:"absolute",top:6,left:6,width:20,height:20},onClick:()=>{if(et.M_(this.environment)){const e=this.createBlockInDay(t,o);M.W2j(this.environment,{type:"page",from:"calendar_day_add_button",new_page_id:null==e?void 0:e.id,...(0,re.Pn)(l)})}},...(0,lt.Z)(e,{onMouseDown:he.$0})})}),(0,S.jsx)("div",{style:{...v?this.getTodayNumberStyle():Ji.dayNumberStyle,...C&&{color:this.theme.lightTextColor}},className:n?`${ee.irE} notion-shimmer-text animation-delay-${e} notion-shimmer-calendar-transition`:`${ee.irE} notion-shimmer-calendar-transition`,children:1!==(0,Ii.TE)(t)||v?(0,Ii.TE)(t):`${new Intl.DateTimeFormat(d.locale,{month:"short",day:"numeric"}).format(new Date(t))} `})]},t.toString())}renderMobileWeek(e,t,o,r,i){const n=[...Array(7).keys()].map((n=>{const s=(0,Ii.Xz)({date:e,daysToAdd:n});return this.renderMobileDay(n,s,(0,Ii.us)(s),t,o,r,i)}));return(0,S.jsx)("div",{style:this.getMobileWeekStyle(),children:n},e.toString())}renderMobileDay(e,t,o,r,i,n,s){const{collectionContextStore:l,query:a,format:c,schema:d,blockPropertyValueOverlayStore:h}=this.props,p=this.canEditCalendar(),u=r.find((e=>(0,Ri.b8)(t,o,e.start,e.end?e.end:void 0))),m=(0,Ii.TE)(t),g=(0,Ii.Bn)({firstDate:t,secondDate:this.getCurrentlyViewedMonth()}),y=(0,Ii.Y3)(t),v=!g&&!y&&"week"!==n;return(0,S.jsx)(mt.ZP,{popupType:mt.Z4.SlideUp,renderOrigin:t=>(0,S.jsxs)(Qt.Z,{style:Ji.mobileDayButtonStyle,...t,children:[(0,S.jsx)("div",{style:{...y?Ji.mobileTodayNumberStyle:Ji.mobileDayNumberStyle,...v&&{color:this.theme.lightTextColor}},className:s?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${e}`:"notion-shimmer-calendar-transition",children:m}),u&&(0,S.jsx)("div",{style:this.getMobileDayEventDotStyle()})]}),render:e=>(0,S.jsx)(ji.LazyMobileCalendarDayMenu,{collectionContextStore:l,initialStartOfDay:t,format:c,schema:d,query:a,calendarBy:i,disabled:!p,onDismiss:e.close,blockPropertyValueOverlayStore:h,resultsStore:this.resultsStore})},m.toString())}handleCalendarClick(e,t){const o=(0,Ii.V7)(t.dateRangeStart.state,X.AK.state),r=this.getCalendarViewRange(this.props.collectionContextStore);if("month"===r){const t="left"===e?-1:1,i=(0,Ii.IS)((0,Ii.kl)((0,Ii._)({date:o,monthsToAdd:t})),X.AK.state);this.setNewCalendarStart(i,r)}else{const o="left"===e?-7:7,i=(0,Ii.IS)((0,Ii.Xz)({date:t.dateRangeStart.state,daysToAdd:o}),X.AK.state);this.setNewCalendarStart(i,r)}}handleMount(e){const t=e.collectionViewStore();if(!t)return;const o=this.startOfWeekSettingStore.state;if(void 0===o)return;const r=this.getCalendarViewRange(e),i=_i.Z.getLocalDateRangeStart({collectionViewId:t.id,currentUserId:this.environment.currentUser.id}),n=(0,Ii.IS)(i,o),s=(0,Ii.IS)((0,Ii.kl)(i),o),l="month"===r?s:n;this.stores.calendarStore.setState({...this.stores.calendarStore.state,startingMonth:s.valueOf()}),this.setNewCalendarStart(l,r)}getHeaderText(e,t,o){var r;const i=(0,Mi.Yx)(t,"month_year_long",o);if("month"===e)return i;const n=null===(r=this.weeksStore)||void 0===r||null===(r=r.state)||void 0===r?void 0:r[0];if(void 0===n)return"";if((0,Ii.Bn)({firstDate:n.start,secondDate:n.end}))return i;return`${(0,Mi.Yx)(n.start,(0,Ii.Xh)({firstDate:n.start,secondDate:n.end})?"month_short":"month_year_short",o)} - ${(0,Mi.Yx)(n.end,"month_year_short",o)}`}setDateRange(e,t){const{collectionContextStore:o}=this.props,{calendarStore:r}=this.stores;_.t5({dateRangeStart:e,dateRangeEnd:t,collectionContextStore:o}),r.setState({...r.state,startingMonth:(0,Ii.kl)((0,Ii.V7)(e,X.AK.state))})}findHoveredDay(e,t){H.Ch();const{dayStoreMap:o}=this.stores.calendarStore.state,{selectableRectMap:r}=Li.Z.state,i=Array.from(o.keys()),n=Array.from(o.values());for(const[s,l]of r.entries())if(l&&Ai.uh(l,e,t)&&n.indexOf(s.props.store)>=0)return i.find((e=>o.get(e)===s.props.store))}createBlockInDay(e,t){const{collectionContextStore:o}=this.props,{mainEditorCurrentBlockStore:r}=fe.default.state,{performResult:i}=W.createAndCommit({userAction:"Calendar.createBlockInDay",environment:this.environment,perform:i=>{const n=j.IW({environment:this.environment,collectionContextStore:o,groupsPointer:[],insertAtIndex:0,coerce:!0,initializeDefaultTemplate:!0,transaction:i,from:"calendar"});if(!n)return;F.xD({type:"timestamp",environment:this.environment,store:n.newStore,propertyId:t,timestampMs:e,transaction:i});const s=le.mb({store:n.newStore,mainEditorCurrentBlockStore:r,collectionContextStore:o})??(0,de.ZP)({store:n.newStore,pageVisitSource:c.tY.Create});return this.navigate(s),Z.Xd({collectionContextStore:o,resultsStore:void 0}),n.newStore}});return i}setNewCalendarStart(e,t){const{collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=this.shouldInfinitelyLoad(),n=X.AK.state,s=(0,Ii.V7)(e,n),l=(0,Ii.IS)(e,n);if(_i.Z.setLocalDateRangeStart({collectionViewId:r.id,dateRangeStart:"month"===t?s:l,currentUserId:this.environment.currentUser.id}),"month"===t){const t=i?(0,Ii.V7)((0,Ii._)({date:s,monthsToAdd:1}),n):(0,Ii.V7)((0,Ii.RN)(s),n);this.setDateRange(e,t),this.verticalScrollableAncestor&&i&&(this.verticalScrollableAncestor.scrollTop=0)}else"week"===t&&this.setDateRange(e,s)}shouldInfinitelyLoad(){const{device:e}=this.environment,{collectionContextStore:t}=this.props,o="month"===this.getCalendarViewRange(t);return this.props.isFullScreen&&!e.isMobile&&o}isInMonth(e){const{startOfDay:t,startOfMonth:o}=e;return(0,Ii.AD)({date:t,startOfMonth:o})}updateOrCreateCalendarProperty(e){const{schema:t}=e,{collectionContextStore:o}=this.props,r=o.permissionScopes.state,i=pe.default.getIntl(),n=o.collectionStore();if(!n)return;const s=o.collectionViewStore();s&&r.canConfigureBlock&&W.createAndCommit({userAction:"Calendar.updateOrCreateCalendarProperty",environment:this.environment,perform:e=>{let o,l=le.PD(t);if(!l&&r.canConfigureCollection){l=(0,He.ZP)();o={[l]:{name:i.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}_.Es({collectionViewStore:s,update:{calendar_by:l},transaction:e}),We.sW({store:s,data:{type:"calendar"},transaction:e}),o&&_.xO({environment:this.environment,collectionStore:n,update:o,transaction:e})}})}canEditCalendar(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent}getHeaderStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{position:"absolute",left:0,right:0,background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:T.VT}}getHeaderMobileStyle(){return{position:"absolute",left:0,right:0,background:this.theme.contentBackground,zIndex:T.VT}}getRowsWrapStyle(){return{boxShadow:`-1px 0 0 ${this.theme.tableDividerColor}`,marginTop:1,overflow:"hidden"}}getWeekDayNameStyle(){return{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,height:24,color:this.theme.lightTextColor}}getDayStyle(){return{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderRight:`1px solid ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,cursor:"default"}}getWeekendDayStyle(){return{...this.getDayStyle(),background:this.props.isInPeekRenderer?this.theme.cardSidebarBackground:this.theme.sidebarBackground}}getTodayNumberStyle(){return{position:"absolute",fontSize:14,top:4,right:4,height:24,width:24,lineHeight:"24px",borderRadius:"100%",textAlign:"center",color:_o.ZP.white,background:this.theme.calendarTodayBackground}}getMobileWeekStyle(){return{display:"flex",boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,paddingTop:8,paddingBottom:8,fontSize:14}}getMobileDayEventDotStyle(){return{width:8,height:8,background:this.theme.mediumIconColor,borderRadius:"100%",marginTop:2,marginLeft:"auto",marginRight:"auto"}}getCalendarViewRange(e){const t=e.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_view_range").getValue())??"month"}getCurrentlyViewedMonth(){const e=this.props.collectionContextStore.dateRangeStart.state;return this.shouldInfinitelyLoad()||!e?this.stores.calendarStore.state.startingMonth:(0,Ii.kl)((0,Ii.V7)(e,X.AK.state))}}Ji.displayName="Calendar",Ji.contextTypes={...Y.wK,...n.w},Ji.style={position:"relative",paddingLeft:1},Ji.viewRangeSelectorButtonStyle={marginRight:6,paddingRight:6},Ji.headerSpacerStyle={height:66},Ji.mobileHeaderSpacerStyle={height:74},Ji.mobileRowsWrapStyle={},Ji.weekWrapStyle={position:"relative",display:"flex"},Ji.dayNumberStyle={position:"absolute",fontSize:14,top:4,right:10,height:24,lineHeight:"24px",textAlign:"right",transition:"color 100ms ease-out"},Ji.mobileDayButtonStyle={width:"100%",height:44,borderRadius:3},Ji.mobileDayNumberStyle={height:28,display:"flex",alignItems:"center",justifyContent:"center"},Ji.mobileTodayNumberStyle={height:28,width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",color:_o.ZP.white,background:_o.ZP.red,marginLeft:"auto",marginRight:"auto"},Ji.loadingSpinnerStyle={margin:"8px auto"};const en=Ji;var tn=o(6776);function on(e){const{environment:t,newStore:o,previousStore:r}=e;H.eP({environment:t,store:o}),_.Z5({store:o}),tn.Z.setState({store:o,editMode:"new",previousStore:r})}var rn=o(37190);class nn extends Oe.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:Ve.Z},this.renderProperty=e=>{const{store:t,disabled:o,blockPropertyValueOverlayStore:r,collectionContextStore:i}=this.props,n=le.Bm({store:t,collectionContextStore:i});if(n)return(0,S.jsx)(Ut.Z,{store:t,property:e,disabled:o||!t.canEdit(),locked:i.permissionScopes.state.isLocked,format:$t.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:n,collectionViewStore:this.props.collectionContextStore.collectionViewStore(),showIfEmpty:this.isEditing.state||(0,X.$A)(this.props.collectionViewBlockStore.id),onBgClick:this.handleBlockPropertyExit,onEnter:this.handleBlockPropertyExit,onEsc:this.handleBlockPropertyExit,onTab:this.handleBlockPropertyTab,onUntab:this.handleBlockPropertyUntab,onClick:this.disallowEmptyItemDelete},e)},this.renderDiscussionIndicator=()=>{const{store:e}=this.props,t=Ot.Xp(e,{recursivelyLoadAllDiscussions:!1});if(t>0)return(0,S.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",color:this.theme.lightTextColor,fontWeight:P.Z.fontWeight.semibold,fontSize:12,paddingLeft:10,paddingRight:10},children:[(0,Dt.z)({width:14,height:14,marginRight:4,fill:this.theme.mediumIconColor}),t]})},this.handleOpenPeekPage=()=>{this.disallowEmptyItemDelete(),this.props.handleOpenPeekPage()},this.handleRecordIconChange=e=>{const{store:t}=this.props,o=t.getIconStore();o&&W.createAndCommit({userAction:"CollectionListViewItem.handleRecordIconChange",environment:this.environment,perform:t=>{We.sO({store:o,value:e,transaction:t})}})},this.handleMouseMove=()=>{if(!Re.Z.state){const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})}},this.handleMouseLeave=()=>{const{mouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})},this.handleMouseMoveThrottled=C.P2(this.handleMouseMove,100),this.handleMouseLeaveDebounced=C.Ds(this.handleMouseLeave,100),this.mouseIsEntered=this.createComputedStore((()=>this.stores.mouseStore.state.mouseEntered)),this.isEditing=this.createComputedStore((()=>{const e=zt.Z.state;return Boolean(e.isActive&&e.store.id===this.props.store.id)})),this.newItemEditMode=this.createComputedStore((()=>{const e=tn.Z.state;return e.store&&e.store.id===this.props.store.id?e.editMode:void 0})),this.newItemPreviousStore=this.createComputedStore((()=>{const e=tn.Z.state;return e.store&&e.store.id===this.props.store.id?e.previousStore:void 0})),this.removeCollectionListViewItem=e=>{W.createAndCommit({userAction:"CollectionListViewItem.handleItemTextEsc",environment:this.environment,perform:t=>{j.Od({store:e,transaction:t})}})},this.disallowEmptyItemDelete=()=>{_.IH({store:this.props.store})},this.handleBlockPropertyExit=()=>{Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),(0,X.$A)(this.props.collectionViewBlockStore.id)||(H.Ys({environment:this.environment,store:this.props.store}),this.disallowEmptyItemDelete())},this.handleTitleTab=()=>{const e=this.getNonEmptyProperties(),t=this.findFirstOpenableProperty(e);this.handleTitleTabShortcuts(t)},this.handleTitleUntab=()=>{const e=this.getNonEmptyProperties(),t=this.findLastOpenableProperty(e);this.handleTitleTabShortcuts(t)},this.handleBlockPropertyTab=()=>{const e=this.findNextOpenableProperty();this.handlePropertyTabShortcuts(e)},this.handleBlockPropertyUntab=()=>{const e=this.findPreviousOpenableProperty();this.handlePropertyTabShortcuts(e)},this.shouldCaptureKeyboard=this.createComputedStore((()=>Ht.default.state.stores.length>0&&Ht.default.state.stores[0].id===this.props.store.id))}activate(){const e=this.getPeekUrl();e&&(this.props.handleOpenPeekPage(),O.navigate({environment:this.environment,url:e}))}didMount(){super.didMount(),this.isEditing.state&&"new"===this.newItemEditMode.state&&N.NX({store:this.props.store.getBlockTitleStore()})}willUnmount(){super.willUnmount(),tn.Z.reset(),zt.Z.reset()}renderComponent(){const{device:e}=this.environment,{showProperties:t}=this.props,o=e.isPhone&&this.props.showProperties.length>0,r=this.renderToggleButton();return o?(0,S.jsxs)("div",{style:{display:"flex"},children:[r,(0,S.jsxs)(Xt.Z,{href:this.getBlockUrl(),metaHref:this.getPeekUrl(),external:!1,style:this.getTwoLineMobileWrapStyle(),innerStyle:{paddingRight:4,marginTop:10,marginBottom:10},children:[(0,S.jsx)("div",{style:{display:"flex",alignItems:"center"},children:this.renderTitle()}),(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",paddingLeft:6,marginTop:4},children:t.map(this.renderProperty)})]})]}):(0,S.jsx)(Yt.Z,{capture:this.shouldCaptureKeyboard.state,onShiftEnter:this.props.onShiftEnter,children:(0,S.jsxs)("div",{style:{display:"flex"},children:[r,(0,S.jsxs)(Xt.Z,{href:this.getBlockUrl(),metaHref:this.getPeekUrl(),onClick:this.handleOpenPeekPage,external:!1,style:this.getInlineWrapStyle(this.isEditing.state?"multi":"single"),innerStyle:{display:"flex",alignItems:"center",paddingRight:4,userSelect:this.isEditing.state?void 0:"none",WebkitUserSelect:this.isEditing.state?void 0:"none",...(0,X.$A)(this.props.collectionViewBlockStore.id)?{display:"inline-grid",gridTemplateColumns:"2fr 1fr 1fr 1fr",gridColumnGap:16}:{}},hoveredStyle:{background:this.isEditing.state?"transparent":this.theme.buttonHoveredBackground},pressedStyle:{background:this.isEditing.state?"transparent":this.theme.buttonPressedBackground},onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,children:[this.renderTitle(),t.map(this.renderProperty)]})]})})}renderTitle(){const{store:e,disabled:t,collectionContextStore:o,blockPropertyValueOverlayStore:r}=this.props,i=le.Bm({store:e,collectionContextStore:o});if(!i)return;const{isSyncedCollection:n}=o.permissionScopes.state;return(0,S.jsx)(Ut.Z,{store:e,property:n?" title":"title",disabled:t||!e.canEdit(),locked:o.permissionScopes.state.isLocked,format:$t.C.ListView,tableWrap:!1,blockPropertyValueOverlayStore:r,collectionStore:i,collectionViewStore:o.collectionViewStore(),forceMouseEntered:this.mouseIsEntered.state&&!(0,X.aT)(this.props.collectionViewBlockStore.id),handleOpenPeekPage:this.handleOpenPeekPage,onTab:this.handleTitleTab,onUntab:this.handleTitleUntab})}renderToggleButton(){const{collectionContextStore:e,toggleButton:t,subitemPath:o}=this.props,r=e.currentSubitemFormatStore.state,i=(null==o?void 0:o.length)??0;if(!r)return;const n=Math.max((i-1)*Co.Hw,0)+Co.gY;return t?(0,S.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,S.jsx)("div",{style:{width:n}}),t]}):(0,S.jsx)("div",{style:{minWidth:n+Co.Hw}})}handlePropertyTabShortcuts(e){const{store:t,blockPropertyValueOverlayStore:o}=this.props;if(o.state.isOpen){if("title"===e){Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:o});const e=t.getBlockTitleStore();H.eP({environment:this.environment,store:t}),N.NX({store:e})}else e?(Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:o}),Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:o,store:t,property:e,format:$t.C.ListView,collectionContextStore:this.props.collectionContextStore})):Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:o});this.disallowEmptyItemDelete()}}handleTitleTabShortcuts(e){e&&Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:this.props.store,property:e,format:$t.C.ListView,collectionContextStore:this.props.collectionContextStore}),this.disallowEmptyItemDelete()}findPreviousOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=C.dF(o,((e,t)=>t<r&&this.canOpenProperty(e)));return i||(this.isEditing.state?"title":this.findLastOpenableProperty(o))}findNextOpenableProperty(){const{blockPropertyValueOverlayStore:e}=this.props,t=e.state,o=this.getNonEmptyProperties(),r=t.isOpen?o.findIndex((e=>e===t.property)):-1,i=o.find(((e,t)=>t>r&&this.canOpenProperty(e)));return i||(this.isEditing.state?"title":this.findFirstOpenableProperty(o))}findLastOpenableProperty(e){return C.dF(e,(e=>this.canOpenProperty(e)))}findFirstOpenableProperty(e){return e.find((e=>this.canOpenProperty(e)))}canOpenProperty(e){const{schema:t}=this.props,o=t[e];return Boolean(o&&!Bt.uk.includes(o.type))}getNonEmptyProperties(){const{store:e,schema:t,showProperties:o}=this.props;return e.isDefined()?o.filter((o=>{const r="title"!==o&&this.isEditing.state;return!Sr.wV({property:o,schema:t,block:e.getModel(),getRecordModel:e.getRecordModel,userId:this.environment.currentUser.id,userTimeZone:(0,rt.r)(),intl:pe.default.getIntl()})||r})):[]}getPeekUrl(){const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=fe.default.state;return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})}getBlockUrl(){return(0,de.ZP)({store:this.props.store,fullyQualified:!1,pageVisitSource:c.tY.LinkInPage})}getInlineWrapStyle(e){return{display:"flex",flexGrow:1,textDecoration:"none",overflow:"hidden",borderRadius:3,..."single"===e?{height:30}:{minHeight:30}}}getTwoLineMobileWrapStyle(){return{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:`1px solid ${this.theme.tableDividerColor}`}}getTitleWrapStyle(){const{device:e}=this.environment;return{display:"flex",marginRight:"auto",minWidth:e.isMobile?0:240}}getTitleStyle(){return{fontWeight:P.Z.fontWeight.medium,borderBottom:`1px solid ${this.theme.tableDividerColor}`,lineHeight:1.3}}}nn.displayName="CollectionListViewItem",nn.iconStyle={marginLeft:2,marginRight:6};const sn=nn;function ln(e){window.__c={n:"CollectionNestedCreateSubitemButton"};const t=(0,uo.O7)(),{store:o,collectionContextStore:i,disabled:n,groupsPointer:s,collectionStore:l,subitemPath:a,indentLevel:c,onSubitemCreate:d}=e,h=(0,ct.VK)((()=>(0,le.fk)({environment:t,collectionContextStore:i})),[i,t]),p=(0,ct.VK)((()=>{var e;return"timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i]),u=(0,ct.VK)((()=>{var e;return(0,J.$4)()&&"title"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormat().table_subitem_toggle_column)}),[i]),m=(0,ct.VK)((()=>(0,xo.f2)({columnIndex:0,titleColumnIndex:0,shouldShowBulkActionsToolbar:h,indentLevel:c+1,isSubitemToggleOnTitleColumn:u})),[c,u,h]),g=(0,co.yK)((t=>({newRowButton:{display:"flex",alignItems:"center",height:32,width:"100%",paddingLeft:m+8,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${t.tableDividerColor}`,background:t.contentBackground,left:0,right:0,...p&&{background:"none",borderTop:"none"},...e.styles},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",left:m+8,color:t.lightTextColor},newIcon:{width:14,height:14,marginLeft:-1,marginRight:6,fill:t.lightIconColor},newText:{color:t.lightTextColor}})),[m,p,e.styles]),y=(0,ct.VK)((()=>{const e=i.permissionScopes.state,t=l.isSyncedCollection();return!n&&e.canEditContent&&!t}),[i,n,l]),v=(0,r.useCallback)((()=>{W.createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,perform:e=>{const r=j.yk({environment:t,collectionContextStore:i,groupsPointer:s,store:o,before:!1,collectionStore:l,transaction:e,subitemPath:a,subitemInsertDirection:"into"});r&&d(r)}}),M.y2U(t)}),[i,t,s,l,o,a,d]);return y?(0,S.jsx)(Qt.Z,{onClick:v,onMouseDown:he.$0,style:g.newRowButton,children:(0,S.jsxs)("span",{style:g.newRowContainer,children:[(0,Je.R)(g.newIcon),(0,S.jsx)("span",{style:g.newText,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})}):null}function an(){return{marginTop:1,marginBottom:1,borderRadius:3}}const cn=r.memo((function(e){let{groupFormat:t,store:o,format:i,disabled:n,collectionContextStore:s,schema:l,blockPropertyValueOverlayStore:a}=e;const c=(0,uo.O7)(),d=(0,r.useMemo)((()=>t?[t]:[]),[t]),h=(0,r.useMemo)((()=>(i.list_properties?i.list_properties:[]).filter((e=>e.visible)).map((e=>{let{property:t}=e;return t}))),[i]),{permissionScopes:p}=(0,ct.VK)((()=>({permissionScopes:s.permissionScopes.state})),[s]),u=(0,ct.VK)((()=>s.groupsStore.getGroupState(d)),[d,s]),m=(0,ct.VK)((()=>!n&&o.canEdit()&&p.canEditContent&&!p.isSyncedCollection),[n,o,p]),g=(0,r.useCallback)((()=>{if(!u)return;const e=s.collectionStore();if(!e||!s.shouldAllowNewItemCreation())return;const t=Ht.default.state.stores[0];if(!t)return;const o=s.subitemTreeStore.state,r=(0,fo.DY)(o.children,(e=>e.value.store===t));if(!r)return;const i=r?(0,Co.Af)(r.map((e=>e.value.store))):"",n=s.subitemExpandedStore.state.get(i),l=Boolean(null==n?void 0:n.isExpanded);W.createAndCommit({userAction:"CollectionListView.onItemShiftEnter",environment:c,perform:o=>{const i=j.yk({environment:c,collectionContextStore:s,groupsPointer:u.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:l?"into":"below"});i&&on({environment:c,newStore:i,previousStore:t})}}),M.sdb(c,"list_item_edit_mode_enter",{...(0,re.Pn)(s),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[s,c,u]),y=(0,r.useCallback)(((e,t)=>{on({environment:c,newStore:t,previousStore:e})}),[c]),v=(0,r.useMemo)((()=>({schema:l,collectionViewBlockStore:o,showProperties:h,disabled:n,blockPropertyValueOverlayStore:a,collectionContextStore:s,onShiftEnter:g})),[a,s,n,g,l,h,o]),f=(0,r.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:r,indentLevel:i}=e;if(o)return(0,S.jsx)(ln,{store:t,collectionStore:o,subitemPath:r,indentLevel:i,collectionContextStore:s,disabled:n,groupsPointer:d,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{_.Z5({store:e,transient:!1}),tn.Z.setState({store:e,editMode:"new",previousStore:void 0})}})}),[s,n,d]);return u?(0,S.jsx)(Do,{collectionContextStore:s,groupsPointer:d,format:i,canDrag:m,resultProps:v,canDrop:!0,resultComponent:sn,disabled:n,shouldShowHoverMenu:!0,direction:Fo.Vertical,analyticsName:"list",getItemSelectableStyle:an,emptyDroppableSize:0,onSelectableInsertRow:y,nestedCreateSubitemButton:f}):null}));var dn=o(21547);class hn extends n.Z{constructor(){super(...arguments),this.renderGroupHeader=e=>(0,S.jsx)(lr,{...e,height:48,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle}),this.renderGroup=e=>{const{store:t,format:o,isFullScreen:r,disabled:i,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l}=this.props,a=e?[e]:[],c=this.isReady.state,d=n.groupsStore.getGroupState(a);if(!d)return;const h=n.permissionScopes.state,p=d.reducerResultStore.state,u=h.isSyncedCollection,m=le.VM({collectionContextStore:n,reducerResult:p,isFullScreen:r}),g=c&&!i&&t.canEdit()&&h.canEditContent&&!u,y=void 0!==p&&(null==p?void 0:p.blockIds.length)>0,v=""!==n.searchQuery.state,f=void 0!==e,C=Ue({collectionContextStore:n,groupsPointer:a,hasPartialResults:y});return(0,S.jsxs)("div",{style:{paddingBottom:e?16:void 0},children:[(0,S.jsx)(cn,{groupFormat:e,store:t,format:o,disabled:i,collectionContextStore:n,schema:s,blockPropertyValueOverlayStore:l}),C&&(0,S.jsx)(dn.h,{isFullScreen:r,hasGroups:f,hasPartialResults:y,hasSearchQuery:v}),m&&(0,S.jsx)(gr,{groupsPointer:a,store:t,collectionContextStore:n,format:o,isFullScreen:r,incrementLimitsInRelatedGroups:!1}),g&&(0,S.jsxs)(S.Fragment,{children:[m&&(0,S.jsx)("div",{style:{width:"100%",borderTop:e?void 0:`1px solid ${this.theme.tableDividerColor}`,marginTop:4,marginBottom:4}}),this.renderAddItemButton(d)]})]})},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]);if(!i)return;const n=i.reducerResultStore.state;e<be.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleAddItemClick=e=>{if(!et.M_(this.environment))return;const{collectionContextStore:t}=this.props;t.collectionStore()&&W.createAndCommit({userAction:"CollectionListView.handleAddItemClick",environment:this.environment,perform:o=>{t.collectionStore()&&function(e){var t;const{transaction:o,environment:r,results:i,collectionContextStore:n,isFullScreen:s,groupsPointer:l,insertAtIndex:a,from:d}=e;n.searchQuery.state&&_.Ug({searchQuery:"",collectionContextStore:n,isFullScreen:s});const h=null===(t=n.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!h)return;let p;a>0&&(p=i[a]);const u=j.IW({environment:r,collectionContextStore:n,groupsPointer:l,insertAtIndex:a,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:d});if(!u)return;const m=u.coercionSucceeded,g=u.newStore;r.device.isMobile?O.navigateToBlock({environment:r,store:g,pageVisitSource:c.tY.Create}):m?on({environment:r,newStore:g,previousStore:p}):O.peekBlock({environment:r,store:g,peekMode:(0,le.kr)(n.collectionViewStore()),resultsStore:h,collectionContextStore:n,pageVisitSource:c.tY.Create}),M.W2j(r,{from:d,type:"page",new_page_id:g.id,...(0,re.Pn)(n)})}({transaction:o,environment:this.environment,results:e.resultsStore.state,collectionContextStore:t,isFullScreen:this.props.isFullScreen,groupsPointer:e.groupsPointer,insertAtIndex:e.resultsStore.state.length,from:"list_view_add_item_bottom"})}})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)O.navigateToBlock({environment:this.environment,store:e,pageVisitSource:c.tY.Create});else if(t)on({environment:this.environment,newStore:e,previousStore:void 0});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);O.peekBlock({environment:this.environment,store:e,peekMode:le.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:c.tY.Create})}},this.onSelectableInsertRow=(e,t)=>{on({environment:this.environment,newStore:t,previousStore:e})},this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getGroupStyle=e=>0===e.index?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.contentBackground}`:void 0})}renderComponent(){const{store:e,format:t,paddingBottom:o,paddingLeft:r,paddingRight:i,isFullScreen:n,collectionContextStore:s}=this.props,l=le.az(s,n),a=t.collection_group_by;return(0,Qe.Z)((t=>(0,S.jsxs)("div",{style:{paddingBottom:o,paddingLeft:r,paddingRight:i,minWidth:this.props.minWidth},className:ee.nM$,children:[(0,S.jsx)(Po.Z,{store:e,shouldShowHalo:!n,canSelect:!n,analyticsName:"list",style:this.getWrapStyle(),...t,children:a?this.renderGroups(a):this.renderGroup(void 0)}),!l&&(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,S.jsx)(Ur,{store:t,id:"list_groups",groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderGroup,renderHeader:this.renderGroupHeader,getGroupStyle:this.getGroupStyle,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,onSelectableInsertRow:this.onSelectableInsertRow})}renderAddItemButton(e){return(0,S.jsxs)(Qt.Z,{onClick:()=>this.handleAddItemClick(e),onMouseDown:he.$0,ref:e=>{e&&rn.registerElementForShadowCursor("db-new-in-list",e)},style:{display:"flex",alignItems:"center",height:30,borderRadius:3,fontSize:14},children:[(0,Je.R)(this.getNewItemButtonIconStyle()),(0,S.jsx)("div",{style:{color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"database.listView.addItemButtonTitle"})})]})}getWrapStyle(){const{format:e}=this.props;return{display:"flex",flexDirection:"column",paddingTop:e.collection_group_by?void 0:8,paddingBottom:4}}getNewItemButtonIconStyle(){return{width:14,height:14,marginLeft:4,marginRight:6,fill:this.theme.lightIconColor}}}hn.displayName="CollectionListView",hn.contextTypes={...Y.wK,...n.w};const pn=hn;var un=o(18514);class mn extends a.default{getInitialState(){return{query:"",limit:20}}}const gn=mn;var Sn=o(81870),yn=o(26909),vn=o(44514),fn=o(45669),Cn=o(11470);const xn=(0,R.defineMessages)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionNoDateMenu.searchPlaceholder"}});class bn extends n.Z{constructor(){super(...arguments),this.storeTypes={store:gn,resultStore:a.default.createClass(void 0)},this.renderResults=()=>{const{collectionViewType:e}=this.props,{store:t}=this.stores,{query:o}=t.state,r=this.getCurrentResult(),i="calendar"===e?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Click to add to the calendar",id:"collectionNoDateMenu.addResultToCalendar.prompt"}):(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Click to add to the timeline",id:"collectionNoDateMenu.addResultToTimeline.prompt"});return r?r&&0===r.blockIds.length?(0,S.jsx)(Ct.Z,{title:i,children:(0,S.jsx)(vi.Z,{title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No results",id:"collectionNoDateMenu.noResults.title"})})}):(0,S.jsx)(St.Z,{type:St.i.Vertical,sections:[{key:"results",render:e=>(0,S.jsx)(Ct.Z,{...e,title:i}),items:this.getMenuListItems(r.blockIds)}],initialFocus:o?0:void 0}):(0,S.jsx)(Ct.Z,{title:i,loading:!0,children:(0,S.jsx)(vi.Z,{title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Loading…",id:"collectionNoDateMenu.loading.message"})})})},this.handleQueryChange=e=>{this.stores.store.setState({query:e.target.value,limit:bn.loadMoreIncrement})},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t}=this.props,{store:o}=this.stores,r=this.getCurrentResult(),i=o.state.limit,n=t.isLoading.state;e<bn.loadMoreScrollOffset&&r&&r.hasMore&&!n&&o.setState({...o.state,limit:i+bn.loadMoreIncrement})},this.reducerStore=this.createComputedStore((()=>{const{property:e}=this.props,{store:t}=this.stores,{query:o,limit:r}=t.state;return{type:"results",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},limit:r,searchQuery:o}}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.environment,{store:o,resultStore:r}=this.stores,{query:i}=o.state;return(0,S.jsxs)(yn.ZP,{title:this.renderTitle(),onCancel:this.props.onClose,helpButton:(0,S.jsx)(Sn.Z,{helpButtonContext:"collection_no_date_menu",href:(0,un.UY)("guides.databaseCalendar")}),desktopWidth:450,children:[(0,S.jsx)(Ct.Z,{isInput:!0,children:(0,S.jsx)(yi.ZP,{placeholder:pe.default.formatMessage(xn.searchPlaceholder),focus:!t.isMobile||void 0,focusAfterAnimation:!0,value:i,onChange:this.handleQueryChange})}),(0,S.jsx)(at.Z,{id:"no_date_results",reducer:this.reducerStore.state,collectionContextStore:e,render:this.renderResults,resultStore:r}),(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})}renderTitle(){const{noDateTotal:e}=this.props;return this.environment.device.isMobile?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Pages with no date",id:"collectionNoDateMenu.mobileMenuTitle"}):(0,S.jsx)(vn.Q,{prefix:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{noDateTotal, plural, one {{noDateTotal} page with no date in} other {{noDateTotal} pages with no date in}}",id:"collectionNoDateMenu.pagesWithNoDateInPrefix",values:{noDateTotal:e}}),viewType:this.props.collectionViewType,viewName:(0,S.jsx)(fn.Z,{collectionViewName:this.props.collectionViewName,collectionViewType:this.props.collectionViewType})})}renderMenuListItem(e,t,o){const{device:r}=this.environment;return(0,S.jsx)(Cn.Z,{...e,store:t,hidePath:!0,right:(0,S.jsx)(Xt.Z,{href:o,innerStyle:{display:"flex",alignItems:"center",borderRadius:3,paddingLeft:r.isMobile?8:6,paddingRight:r.isMobile?8:6,height:r.isMobile?44:22},onClick:()=>{M.tMA(this.environment)},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"View",id:"collectionNoDateMenu.view.button.label"})},t.id),dontShrinkRight:!0})}getMenuListItems(e){const{collectionStore:t,property:o}=this.props,r=e.map((e=>_e.G.createChildStore(t,{table:b.iU,id:e}))).filter((e=>!Sr.Gl(e.getPropertyStore(o).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:t}=fe.default.state;if(!t)return;const o=(0,de.ZP)({store:t,peekViewBlockId:e.id,pageVisitSource:c.tY.LinkInPage});return{key:e.id,render:t=>this.renderMenuListItem(t,e,o),action:()=>{this.props.onAddPage(e),M.zes(this.environment)}}}));return C.oA(r)}getCurrentResult(){return this.stores.resultStore.state}}bn.displayName="CollectionNoDateMenu",bn.loadMoreScrollOffset=200,bn.loadMoreIncrement=20;const wn=bn;var kn=o(65669),Pn=o(74487);const Tn=Pn.undefinable(Pn.object({required:{blockIdToVersion:Pn.record(Pn.string(),Pn.number())},optional:{hasMore:Pn.boolean()}}));var Rn=o(29477),Mn=o(36054);class In{constructor(e,t){this.queuedCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.isServerQueryCollectionRequired=(e,t)=>{if(!Pe.default.checkGate("client_handle_query_collection_locally"))return!0;const o=this.collectionContextStore.isClientModeEnabled.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextType)return!0;const r=Boolean(e&&(0,Mn.P9)(Tn,e)&&e.hasMore);if(o&&!r)return!1;const i=this.collectionContextStore.remoteRequestStore.state;if(!i)return!0;return!!(0,vr.qP)(i.loader.reducers||{}).some((e=>{let[t,o]=e;return"results"!==o.type}))||!(e&&(0,Mn.P9)(Tn,e)&&!e.hasMore)},this.throttledRefetch=(0,kn.Z)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;this.reset(),o?this.throttledRefetch({src:e}):I.bW(this.environment),t&&await _.fI({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=Pe.default.getEligibleGroup({experimentId:"collection_client_refetch_throttle_time_ms",defaultGroup:"control"}),o="control"===t?1e3:parseInt(t);await Promise.all([_.dj(this.environment,this.collectionContextStore,e),(0,Rn.Vs)(o)])},this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.queuedCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldQueueCollectionEmit:r,isCollectionTypeChange:i}=e;if((0,Mn.P9)(Tn,o)&&null!=o&&o.blockIdToVersion&&(0,vr.qP)(o.blockIdToVersion).forEach((e=>{let[t,o]=e;return this.addBlockIdToRefetch(t,o)})),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequired(o,i),!r)return await this.processCollectionRefetch(t);this.queuedCollectionEmit=!0}async maybeProcessQueuedCollectionEmit(e){if(this.queuedCollectionEmit)return await this.processCollectionRefetch(e)}}var Vn=o(91007),Bn=o(20302),Fn=o(62967),jn=o(43664),Dn=o(42858),An=o(58202),_n=o(96620),Ln=o(13966),Zn=o(68709),En=o(23063),On=o(97820);function zn(e){return{boxShadow:`1px 0 0 ${e.regularDividerColor}`,marginRight:1}}const Gn=(0,R.defineMessages)({delete:{id:"CollectionsBulkActionsToolbar.deleteButton.tooltip",defaultMessage:"Delete"}});function Hn(e){window.__c={n:"CollectionsBulkActionsToolbar"};const t=(0,Q.Y$)(),{marginLeft:o}=e,i=(0,uo.O7)(),n=(0,ct.qz)(void 0,_n.Z),s=(0,r.useRef)(null),[l,a]=(0,r.useState)(!1),c=(0,ct.VK)((()=>n.state.lastBlockPropertyValueOverlayCloseTime),[n]),d=(0,ct.VK)((()=>Ht.default.state.stores.filter((e=>An.R.findBlockFromStore(e)))),[c]),h=d.length,p=(0,ct.VK)((()=>n.getNumberOfTextStoresBeingEdited()),[n]),u=(0,ct.VK)((()=>{var e;return!!(0,le.fk)({environment:i,collectionContextStore:t})&&(p>0||d.length>=1&&(0,le.v_)(d,null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id))}),[t,i,p,d]),m=(0,co.yK)((e=>({inner:{position:"absolute",top:1,left:0+(o??0),display:"inline-flex",justifyContent:"center",alignItems:"center",borderRadius:5,background:e.popoverBackground,boxShadow:e.lightBoxShadow,height:32},outer:{position:"sticky",top:0,left:0,zIndex:T.mJ,visibility:l?"visible":"hidden"},blockActionMenuButton:{width:30,height:"100%",borderRadius:void 0,borderTopRightRadius:5,borderBottomRightRadius:5},blockActionMenuButtonIcon:{fill:e.regularTextColor},trashButton:{borderRadius:0,height:"100%",border:0,...zn(e),width:28},trashButtonIcon:{width:16},trashButtonIconHovered:{fill:e.accentColors.red[500]}})),[l,o]);return(0,S.jsx)(En.Z,{isVisible:u,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},onAnimationEnd:e=>{e||a(!1)},render:()=>(0,S.jsx)(Si.Z,{capture:!0,render:e=>(0,S.jsx)("div",{ref:s,...e,style:m.outer,children:(0,S.jsx)(Zn.p,{allowSelectionWithin:!1,children:(0,S.jsxs)("div",{style:m.inner,children:[(0,S.jsx)(Nn,{selectedItemCount:h,collectionsBulkActionsToolbarStore:n}),(0,S.jsx)(Kn,{collectionsBulkActionsToolbarStore:n,selectedItems:d,marginLeft:o,setIsReadyToRender:a,outerContainerRef:s}),(0,S.jsx)(xt.Z,{renderTooltip:()=>(0,S.jsx)("div",{children:pe.default.formatMessage(Gn.delete)}),render:e=>(0,S.jsx)(nr.Z,{...e,ariaLabel:pe.default.formatMessage(Gn.delete),icon:()=>(0,Eo.y)(m.trashButtonIcon),style:m.trashButton,hoveredStyle:m.trashButtonIconHovered,hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{M.dhV(i,{analyticsName:Fn.RE.deleteName.defaultMessage,from:"bulk_actions_toolbar",block_type:"page"}),await Dn.Qw({environment:i,blocks:d})}}),placement:xt.Z.Placement.Top}),(0,S.jsx)(Ln.Z,{store:d[0],fadeIn:!1,style:m.blockActionMenuButton,hoveredStyle:m.blockActionMenuButton,iconStyle:m.blockActionMenuButtonIcon,extraAnalyticsData:{isFromBulkActionsToolbar:!0}})]})})})})})}function Nn(e){window.__c={n:"SelectedItemCountWidget"};const{collectionsBulkActionsToolbarStore:t,selectedItemCount:o}=e,r=(0,uo.O7)(),i=(0,ct.VK)((()=>t.getNumberOfTextStoresBeingEdited()),[t]),n=(0,ct.VK)((()=>i>0?i:o),[i,o]),s=(0,co.yK)((e=>({button:{color:e.blueColor,fontSize:14,whiteSpace:"nowrap",height:"100%",alignItems:"center",display:"flex",paddingRight:10,paddingLeft:10,borderTopLeftRadius:5,borderBottomLeftRadius:5,fontVariantNumeric:"tabular-nums",...zn(e)}})),[]);return(0,S.jsx)(Qt.Z,{style:s.button,onClick:()=>H.ZH(r),children:(0,S.jsx)(R.FormattedMessage,{id:"SelectedItemCountWidget.numItemsSelected",defaultMessage:"{itemsSelectedCount} selected",values:{itemsSelectedCount:n}})})}const Wn=["title","rollup","formula","button"];function Kn(e){window.__c={n:"EditPropertyButtons"};const{outerContainerRef:t,collectionsBulkActionsToolbarStore:o,selectedItems:i,marginLeft:n,setIsReadyToRender:s}=e,l=(0,Q.Y$)(),a=(0,ct.VK)((()=>l.normalizedSchemaStore.state),[l]),c=(0,r.useRef)(null),h=(0,ct.VK)((()=>l.databaseType===d.Fi&&i.some((e=>e.getPropertyValue(Bn.C.MeetingNoteToCalendarEventRelation)))),[l,i]),p=(0,ct.VK)((()=>{var e;const t=l.normalizedFormatStore.state;return(null==t||null===(e=t.table_properties)||void 0===e?void 0:e.filter((e=>{if((0,Sr.LC)(e.property))return!h;const t=a[e.property];return e.visible&&t&&!Wn.includes(t.type)&&(0,Rt.Sb)({propertySchema:t,property:e.property,blockStores:i,collectionSchema:a})})))??[]}),[l,a,i,h]).slice(0,6),u=(0,r.useRef)([]),[m,g]=(0,r.useState)(6),[y,v]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{u.current.length>0&&u.current.forEach((e=>{var t;e&&(e.rightEdge=(null===(t=e.element)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect().right)??0)}))}),[u]),function(e){let{outerContainerRef:t,propertyButtonsContainerRef:o,propertyButtonRefs:i,marginLeft:n,setIsReadyToRender:s,setShowIconsOnly:l,setHiddenButtonsIndex:a}=e;(0,r.useEffect)((()=>{const e=C.Ds((()=>{var e,r,c;const d=(null===(e=t.current)||void 0===e?void 0:e.getBoundingClientRect().right)??window.innerWidth,h=((null===(r=t.current)||void 0===r?void 0:r.getBoundingClientRect().width)??window.innerWidth)-(n??0),p=(null===(c=o.current)||void 0===c?void 0:c.getBoundingClientRect().left)??0,u=d-150;let m=i.current.findIndex((e=>e.rightEdge>u));m=-1!==m?m:6;let g=i.current.findIndex(((e,t)=>p+32*t>u));g=-1!==g?g:6;const S=m<2||h<=450;l(S),a(S?g:m),s(!0)}),150,{maxWait:150,leading:!0,trailing:!1});if(t.current){const o=new ResizeObserver((t=>{e()}));return e(),o.observe(t.current),()=>{o.disconnect()}}}),[n,t,i,o,a,s,l])}({propertyButtonsContainerRef:c,propertyButtonRefs:u,outerContainerRef:t,marginLeft:n,setIsReadyToRender:s,setHiddenButtonsIndex:g,setShowIconsOnly:v}),(0,S.jsx)("div",{ref:c,style:{display:"flex"},children:p.map(((e,t)=>{var i;let n=null===(i=u.current[t])||void 0===i?void 0:i.element;if(!n){const e=r.createRef();u.current[t]={element:e,rightEdge:0},n=e}const s=t>=m;return(0,S.jsx)("div",{ref:n,children:(0,S.jsx)(Un,{collectionsBulkActionsToolbarStore:o,schema:a,property:e.property,isHidden:s,showIconsOnly:y},e.property)},e.property)}))})}function Un(e){window.__c={n:"EditPropertyButton"};const{property:t,schema:o,collectionsBulkActionsToolbarStore:i,isHidden:n,showIconsOnly:s}=e,l=(0,Q.Y$)(),a=o[t],c=(0,uo.O7)(),d=(0,ct.VK)((()=>!(l.permissionScopes.state.canEditContent||"collectionTypedView"===l.contextType)),[l]),h=(0,co.yK)((e=>({button:{display:n?"none":"flex",padding:8,...zn(e)}})),[n]),p=(0,r.useRef)(null),u=(0,ct.qz)(void 0,Ve.Z),m=(0,r.useCallback)((async e=>{var o,r;if(!p.current)return;const n=Ht.default.state.stores;e.stopPropagation(),e.preventDefault();const s=null===(o=p.current)||void 0===o?void 0:o.getBoundingClientRect(),a=n[0].getAssociatedCollectionStore();l&&s&&a&&await jn.z({environment:c,store:n[0],additionalStores:n.slice(1),property:t,rect:s,format:$t.C.Table,collectionStore:a,blockPropertyValueOverlayStore:X._H(),collectionContextStore:l,statusSetCheckbox:"checkbox"===(null===(r=l.getPropertyFormat(t))||void 0===r?void 0:r.statusShowAs),mouseStore:u,preventClearSelection:!0,collectionsBulkActionsToolbarStore:i})}),[p,l,c,t,u,i]),g=(0,co.Fg)();return a?(0,S.jsx)(xt.Z,{renderTooltip:()=>a.name,render:e=>(0,S.jsx)(Qt.Z,{...e,ariaLabel:a.name,ref:p,style:h.button,disabled:d,onClick:m,children:(0,S.jsx)(On.Z,{style:{maxWidth:"250px",textOverflow:"ellipsis"},propertySchema:a,hideName:s,showIcon:!0,property:t,iconStyle:{fill:g.regularTextColor}})}),disableTooltip:!s,placement:xt.Z.Placement.Top}):null}var $n=o(51774),qn=o(49670),Qn=o(13005),Yn=o(91496),Xn=o(54281),Jn=o(64815);class es extends a.default{getInitialState(){return{}}}const ts=es;var os=o(96310),rs=o(35431),is=o(92595);class ns extends rs.Z{findCollectionTimelineViewItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}}const ss=new ns;(0,is.exposeDebugValue)("GlobalCollectionTimelineViewItemRegistry",ss);var ls=o(20294),as=o(53465),cs=o(55367),ds=o(43350);const hs={position:"absolute",left:0,top:0,zIndex:T.Gt,width:"100%",height:"100%",pointerEvents:"none"};function ps(e){const{startItemPosition:t,value:o}=e;return t&&o?(o&&t&&o.left<=t.left&&(o.right<t.left?o.left=o.right:(o.left=t.left+12,o.top=o.top-15)),o):o}function us(e){window.__c={n:"CollectionTimelineRelationArrow"};const{startItem:t,endItem:o,endRelationPointer:i,timelineState:n,disabled:l,isFullScreen:a,isRootChild:c,relationType:d,isUserDrawnTemp:h,isNewSubitemPlaceholder:p,renderEmitter:u}=e,m=(0,Q.Y$)(),g=(0,uo.O7)(),y=(0,ls.k)(),[v,f]=(0,r.useState)(!1),C=(0,co.Fg)(),[x,b]=(0,r.useState)(null),[w,k]=(0,r.useState)(null),P=(0,r.useCallback)((e=>{b(e.state)}),[]),R=(0,r.useCallback)((e=>{k(e.state)}),[]),M=(0,r.useCallback)((()=>{s.default.afterNextFlush((()=>{y()}))}),[y]);(0,r.useEffect)((()=>(b(t.stores.node.state),k(o?o.stores.node.state:null),t.stores.node.addListener(P),null==o||o.stores.node.addListener(R),null==u||u.addListener(M),m.filtersBarOpenStore.addListener(M),()=>{t.stores.node.removeListener(P),null==o||o.stores.node.removeListener(R),null==u||u.removeListener(M),m.filtersBarOpenStore.removeListener(M)})),[t,o,u,P,R,M,m.filtersBarOpenStore]);const I=(0,ct.VK)((()=>cs.ZP.state.isDragging&&cs.ZP.state.draggedStores.includes(t.props.store)),[t]),V=(0,ct.VK)((()=>o&&cs.ZP.state.isDragging&&cs.ZP.state.draggedStores.includes(o.props.store)),[o]),B=(0,ct.VK)((()=>{const e=cs.ZP.state;return e.isDragging?e.currentY-e.startY:0}),[]),F=x&&x.getBoundingClientRect().y+(I?B:0),j=(0,ct.VK)((()=>{const e=t.itemPositionStore.state;return F&&e?{left:e.left,right:"subitem"===d?e.left+12:e.right,top:"subitem"===d?F+15:F}:void 0}),[d,t.itemPositionStore,F]),D=w&&w.getBoundingClientRect().y+(V?B:0),A=(0,ct.VK)((()=>{const e=D&&null!=o&&o.itemPositionStore.state?{...o.itemPositionStore.state,top:D}:void 0;return"subitem"===d?ps({startItemPosition:t.itemPositionStore.state,value:e}):e}),[o,D,d,t.itemPositionStore]),_=(0,ct.VK)((()=>t.dateValueStore.state),[t]),L=(0,ct.VK)((()=>null==o?void 0:o.dateValueStore.state),[o]),Z=(0,ct.VK)((()=>void 0!==n.dragState.state),[n]),E=(0,ct.VK)((()=>void 0!==n.drawState.state),[n]),O=(0,ct.VK)((()=>n.hoveredItem.state),[n.hoveredItem]),z=v&&!Z&&!E,G=(0,r.useCallback)((()=>{i&&!l&&Xn.IL({dependency:{store:t.props.store,relationPointer:i},collectionContextStore:m,environment:g,timelineState:n,isFullScreen:a,isRootChild:c})}),[t,l,i,m,g,n,a,c]),H=(0,r.useCallback)((()=>{f(!0)}),[f]),N=(0,r.useCallback)((()=>{f(!1)}),[f]),W=(0,r.useCallback)((e=>{if(A)return(0,S.jsx)(ms,{topOffset:e,endPosition:A,handleCloseButtonClick:G})}),[A,G]),K=O===t.props.store,U=o&&O===o.props.store,$=K||U||z||"subitem"===d?1:.7;let q,Y=!0;"subitem"===d?(q=C.collectionUnsetDependencyArrow,Y=!1):_&&L&&(q=_<=L?C.collectionValidDependencyArrow:C.collectionInvalidDependencyArrow);const X=(0,co.yK)((()=>({svgStyle:{zIndex:z||U?T.Gt:T.wx}})),[z,U]);return j?h?(0,S.jsx)(gs,{startPosition:j,timelineState:n}):p?(0,S.jsx)(Ss,{startPosition:j,timelineState:n}):t!==o&&A?(0,S.jsx)(ys,{startPosition:j,endPosition:A,strokeOpacity:$,strokeColorOverride:q,svgStyle:X.svgStyle,cornerRadiusOverride:"subitem"===d?8:void 0,relationType:d,handleMouseMove:H,handleMouseLeave:N,renderChildren:Y&&z?W:void 0}):null:null}function ms(e){window.__c={n:"RemoveDependencyButton"};const{topOffset:t,endPosition:o,handleCloseButtonClick:r}=e,i=(0,co.yK)((e=>({icon:{background:e.white,borderRadius:5,fill:e.accentColors.red[500],height:14,width:14}})),[]);return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)("foreignObject",{width:16,height:16,x:o.left-16,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:r,children:(0,as.X)(i.icon)})})}function gs(e){window.__c={n:"UserDrawnTempDependencyArrow"};const{startPosition:t,timelineState:o}=e,r=(0,ct.VK)((()=>{const e=o.drawState.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;return{left:t.right+e.xOffsetPx+18,top:t.top+e.yOffsetPx}}),[t,o.drawState]);return r?(0,S.jsx)(ys,{startPosition:t,endPosition:r,strokeOpacity:1,relationType:"dependency"}):null}function Ss(e){var t;window.__c={n:"NewSubitemPlaceholderArrow"};const{startPosition:o,timelineState:r}=e,i=(0,co.Fg)(),n=(0,ct.VK)((()=>r.dateRangePlaceholder.state),[r.dateRangePlaceholder]),s=(0,ct.VK)((()=>null!=n&&n.active?n.date:void 0),[n]),l=null!=n&&n.active?null===(t=n.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,a=l?l[l.length-1].children.length:0,c=o.top+33*a+15+5,d=(0,ct.VK)((()=>{const e=(0,se.HZ)({timelineState:r,dateValue:s,placeholderDate:s,subitemPlaceholderDate:void 0}),t=c&&e?{...e,top:c}:void 0;return ps({startItemPosition:o,value:t})}),[s,c,o,r]);return d?(0,S.jsx)(ys,{startPosition:o,endPosition:d,strokeOpacity:1,strokeColorOverride:i.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function ys(e){window.__c={n:"RelationArrowBase"};const{startPosition:t,endPosition:o,strokeColorOverride:i,cornerRadiusOverride:n,strokeOpacity:s,relationType:l,svgStyle:a,handleMouseMove:c,handleMouseLeave:d}=e,h=(0,Q.Y$)(),p=(0,co.Fg)(),[u,m]=(0,r.useState)(0),g=t.right,y=t.top+15-u,v=o.left-3,f=o.top+15-u,C=(0,ct.VK)((()=>{if(i)return i;return(0,se.H5)(h)&&t.right&&o.left?t.right<o.left?p.collectionValidDependencyArrow:p.collectionInvalidDependencyArrow:p.collectionUnsetDependencyArrow}),[h,o.left,t.right,i,p]);return(0,S.jsx)("svg",{style:{...hs,...a},ref:e=>{e&&m(e.getBoundingClientRect().top)},children:(0,S.jsx)(ds.Z,{startPoint:{x:g,y},endPoint:{x:v,y:f},style:{stroke:C,strokeWidth:se.lf,strokeOpacity:s},useRightAngles:"subitem"===l,showArrowHead:"dependency"===l&&!e.renderChildren,cornerRadiusOverride:n,handleMouseMove:c,handleMouseLeave:d,children:e.renderChildren&&e.renderChildren(u)})})}function vs(e){window.__c={n:"CollectionTimelineDependenciesOverlay"};const{timelineState:t,disabled:o,isReady:i,isFullScreen:n,isRootChild:s,renderEmitter:l}=e,a=(0,Q.Y$)(),c=(0,r.useCallback)((()=>{t.drawState.setState(void 0)}),[t.drawState]),d=(0,ct.VK)((()=>a.collectionViewBlockStore()),[a]),h=(0,ct.VK)((()=>a.settingsStore.state.open),[a]);if((0,r.useEffect)((()=>{var e;!h&&null!==(e=t.drawState.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[h,t.drawState,c]),!i||!d)return null;const p=ss.findCollectionTimelineViewItems(d);return(0,S.jsx)(S.Fragment,{children:p.map((e=>{const{store:i,groupFormat:a}=e.props,c=null==a?void 0:a.value,d=c?(0,ze.Hd)(c):"noGroup";return(0,S.jsxs)(r.Fragment,{children:[(0,S.jsx)(fs,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"dependency"},`${i.id}-${d}-${i.key}-dependency`),(0,S.jsx)(fs,{startItem:e,timelineState:t,disabled:o,isFullScreen:n,isRootChild:s,renderEmitter:l,relationType:"subitem"},`${i.id}-${d}-${i.key}-subitem`)]},`${i.id}-${d}-${i.key}`)}))})}function fs(e){window.__c={n:"CollectionTimelineRelationAnnotationItem"};const{startItem:t,timelineState:o,disabled:i,isFullScreen:n,isRootChild:s,relationType:l,renderEmitter:a}=e,{store:c,schema:d}=t.props,h=(0,Q.Y$)(),p=(0,ct.VK)((()=>"dependency"===l?o.drawState.state:void 0),[o.drawState,l]),u=(0,ct.VK)((()=>(null==p?void 0:p.startStore)===c),[c,p]),m=(0,ct.VK)((()=>u&&!(null!=p&&p.tryToCompleteDrawnArrow)),[p,u]),g=(0,ct.VK)((()=>{if("dependency"===l)return u&&p?p.temporaryDependencyRelationPointers:(0,se.YE)(h,c,d);if("subitem"===l){return Pe.default.checkGate("collection_level_subitems_setting")?(0,se.f2)(h,c,d):(0,se.wI)(h,c,d)}return[]}),[l,u,p,h,c,d]),y=(0,ct.VK)((()=>h.collectionViewBlockStore()),[h]),v=(0,ct.VK)((()=>{var e;const r=o.dateRangePlaceholder.state;if("subitem"!==l||null==r||!r.active||!r.newTimelineItemProps)return;const i=r.newTimelineItemProps.subitemPath;return(i?null===(e=i[i.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?r:void 0}),[l,t.props.store,o.dateRangePlaceholder]);if(!y)return null;const f=ss.findCollectionTimelineViewItems(y);return(0,S.jsxs)(S.Fragment,{children:[g.map((e=>{if(c.id===e.id)return null;const d=f.filter((t=>t.props.store.id===e.id));return(0,S.jsx)(r.Fragment,{children:d.map((r=>{const c=r.props.store,d=r.props.groupFormat;return(0,S.jsx)(us,{startItem:t,endItem:r,endRelationPointer:e,timelineState:o,disabled:i,isFullScreen:n,isRootChild:s,renderEmitter:a,relationType:l},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===l&&m&&(0,S.jsx)(us,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"dependency"}),"subitem"===l&&v&&(0,S.jsx)(us,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:n,isRootChild:s,relationType:"subitem"})]})}var Cs=o(7525),xs=o(36488);class bs extends n.Z{constructor(){super(...arguments),this.renderZoomLevelMenu=e=>{const{zoomLevel:t,onChange:o}=this.props,{device:r}=this.environment,i=[{key:"calendar by section",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:Ft.H.map((t=>({key:t,render:e=>(0,S.jsx)(ut.Z,{...e,title:this.renderZoomLevelText(t)}),action:()=>{o(t),e.close()}})))}];return(0,S.jsx)(xs.Z,{capture:!0,allowEsc:!0,render:o=>{let n;return n=r.isMobile?{menuType:st.og.Modal,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:e.close,...o}:{menuType:st.og.Popup,width:180,...o},(0,S.jsx)(gt.Z,{...n,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,sections:i,initialFocus:Ft.H.indexOf(t)})})}})}}renderComponent(){const{zoomLevel:e}=this.props,{device:t}=this.environment;return(0,S.jsx)(mt.ZP,{popupType:t.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,renderOrigin:t=>(0,S.jsxs)(vt.Z,{isSmall:!0,isGray:!0,...t,children:[this.renderZoomLevelText(e),(0,Fr.i)({width:10,marginLeft:4,fill:this.theme.mediumIconColor})]}),originGap:8,render:this.renderZoomLevelMenu})}renderZoomLevelText(e){return"hours"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===e?(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):void(0,vr.t1)(e)}}bs.displayName="CollectionTimelineViewZoomLevelButtonPopup";const ws=bs;var ks=o(33411);class Ps extends n.Z{constructor(){super(...arguments),this.handleLeftArrowClick=()=>{const{timelineState:e,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i,collectionContextStore:n}=this.props,s=e.zoomLevel.state,l=(e.outerSizeObserver.rect.state.width-(0,se.xI)({environment:this.environment,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i}))/2,a=(0,se.al)(e)-(0,se.x2)(s,l);Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:s,centerTimestamp:a}),M.Al4(this.environment,{...(0,se.Ii)({environment:this.environment,collectionContextStore:n,timelineState:e,isFullScreen:r,isRootChild:i}),type:"left"})},this.handleRightArrowClick=()=>{const{timelineState:e,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i,collectionContextStore:n}=this.props,s=e.zoomLevel.state,l=(e.outerSizeObserver.rect.state.width-(0,se.xI)({environment:this.environment,paddingLeft:t,format:o,isFullScreen:r,isRootChild:i}))/2,a=(0,se.al)(e)+(0,se.x2)(s,l);Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:s,centerTimestamp:a}),M.Al4(this.environment,{...(0,se.Ii)({environment:this.environment,collectionContextStore:n,timelineState:e,isFullScreen:r,isRootChild:i}),type:"right"})},this.handleTodayClick=()=>{const{timelineState:e,paddingLeft:t,format:o,collectionContextStore:r,isFullScreen:i,isRootChild:n}=this.props,s=e.zoomLevel.state,l=(0,se.bK)({timestamp:Date.now(),environment:this.environment,timelineState:e,paddingLeft:t,format:o});Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:s,centerTimestamp:l}),M.H6t(this.environment,(0,se.Ii)({environment:this.environment,collectionContextStore:r,timelineState:e,isFullScreen:i,isRootChild:n}))},this.handleZoomLevelChange=e=>{const{timelineState:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props;Xn.Nf({timelineState:t,environment:this.environment,zoomLevel:e,centerTimestamp:(0,se.al)(t)}),M.zIF(this.environment,(0,se.Ii)({environment:this.environment,collectionContextStore:o,timelineState:t,isFullScreen:r,isRootChild:i}))},this.handleShowTableClick=()=>{const{format:e,timelineState:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props,n=o.collectionViewStore();n&&(W.createAndCommit({userAction:"CollectionTimelineViewControlBar.handleShowTableClick",environment:this.environment,perform:t=>{const o=(0,se.YP)(e,!0);Ne.FH({stores:[n],update:o,transaction:t})}}),M.CBn(this.environment,{...(0,se.Ii)({environment:this.environment,collectionContextStore:o,timelineState:t,isFullScreen:r,isRootChild:i}),show:!0}))},this.currentScrolledSecondaryDisplayUnitStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,paddingLeft:o,showTable:r,isFullScreen:i}=this.props,n=e.zoomLevel.state,{primaryDisplayUnit:s,secondaryDisplayUnit:l}=se.BJ[n],a=e.scrollLeft.state,{startTimestamp:c}=e.currentRange.state;if(void 0!==a){const e=c+(0,se.x2)(n,a+t+(!r&&i?o:0));return(0,se.DS)(Zi.ou.fromMillis(e),s).startOf(l).valueOf()}}))}renderComponent(){var e;const{timelineState:t,showTable:o,isFullScreen:r,isRootChild:i,isReady:n,collectionContextStore:s,isInPeekRenderer:l}=this.props,{device:a}=this.environment,c=t.zoomLevel.state,{secondaryDisplayUnit:d}=se.BJ[c],h=this.currentScrolledSecondaryDisplayUnitStore.state,p=(0,se.d$)({environment:this.environment,isFullScreen:r,isRootChild:i}),u=s.permissionScopes.state,m=!o&&p&&u.canConfigureBlock,g=(null===(e=s.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(l?this.theme.cardContentBackground:this.theme.contentBackground),y=l?this.theme.cardContentBackgroundTransparent:this.theme.contentBackgroundTransparent;return(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{style:this.getStyle(),children:[h&&(0,S.jsxs)("div",{style:this.getCurrentScrolledSecondaryDisplayUnitStyle(),children:[m&&(0,S.jsx)(xt.Z,{render:e=>(0,S.jsx)(vt.Z,{isSmall:!0,onClick:this.handleShowTableClick,style:{paddingLeft:4,paddingRight:4,marginLeft:2,marginRight:4,marginTop:a.isIOS?0:1,height:22,fill:this.theme.lightIconColor},...e,children:(0,Cs.t)({width:14})}),renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}),(0,S.jsx)("span",{style:{paddingLeft:m||this.environment.device.isPhone?0:r||o?16:2},children:(0,se.qG)(h,d)}),!n&&!o&&this.renderLoadingSpinner(),(0,S.jsx)("div",{style:{width:30,marginRight:-30,height:"100%",backgroundImage:`linear-gradient(to right, ${g} 20%, ${y} 100%)`}})]}),(0,S.jsxs)("div",{style:this.getControlBarRightStyle(),children:[(0,S.jsx)("div",{style:{width:30,marginLeft:-30,height:"100%",backgroundImage:`linear-gradient(to left, ${g} 20%, ${y} 100%)`}}),(0,S.jsx)(ws,{zoomLevel:c,onChange:this.handleZoomLevelChange}),(0,S.jsx)(vt.Z,{isSmall:!0,isGray:!0,onClick:this.handleLeftArrowClick,style:{marginLeft:4,paddingLeft:4,paddingRight:4},children:(0,Vi.f)({width:12,fill:this.theme.mediumIconColor})}),(0,S.jsx)(vt.Z,{isSmall:!0,onClick:this.handleTodayClick,children:(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,S.jsx)(vt.Z,{isSmall:!0,isGray:!0,onClick:this.handleRightArrowClick,style:{paddingLeft:4,paddingRight:4},children:(0,Bi.o)({width:12,fill:this.theme.mediumIconColor})})]})]})})}renderLoadingSpinner(){return(0,S.jsx)(ks.Z,{show:!0,showDelay:400,showHold:0,render:e=>e?(0,S.jsx)(Mt.Z,{style:{marginLeft:8,marginTop:1}}):void 0})}getStyle(){const{timelineState:e}=this.props,{outerSizeObserver:t}=e;return{position:"sticky",left:0,width:t.rect.state.width,zIndex:T.Qm,height:0}}getCurrentScrolledSecondaryDisplayUnitStyle(){var e;const{scrollerLeftOffset:t,paddingLeft:o,isFullScreen:r,showTable:i,collectionContextStore:n,isInPeekRenderer:s}=this.props,l=(null===(e=n.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(s?this.theme.cardContentBackground:this.theme.contentBackground);return{position:"absolute",top:1,left:0,paddingLeft:r&&!i?t+o:t,display:"flex",alignItems:"center",height:32,paddingTop:6+(this.environment.device.isMobile?2:0),background:l,fontSize:14,fontWeight:P.Z.fontWeight.medium}}getControlBarRightStyle(){var e;const{paddingRight:t,collectionContextStore:o,isInPeekRenderer:r}=this.props;return{position:"absolute",top:1,right:0,paddingRight:t,display:"flex",alignItems:"center",height:32,paddingTop:7,background:(null===(e=o.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(r?this.theme.cardContentBackground:this.theme.contentBackground)}}}Ps.displayName="CollectionTimelineViewControlBar";const Ts=Ps;var Rs=o(97439);class Ms extends n.Z{constructor(){super(...arguments),this.handleHideTableClick=()=>{const{format:e,collectionContextStore:t,isFullScreen:o,isRootChild:r,timelineState:i}=this.props,n=t.collectionViewStore();n&&(W.createAndCommit({userAction:"CollectionTimelineViewHideTableButton.handleHideTableClick",environment:this.environment,perform:t=>{const o=(0,se.YP)(e,!1);Ne.FH({stores:[n],update:o,transaction:t})}}),M.CBn(this.environment,{...(0,se.Ii)({environment:this.environment,collectionContextStore:t,timelineState:i,isFullScreen:o,isRootChild:r}),show:!1}))}}renderComponent(){const{device:e}=this.environment,{isGrouped:t}=this.props;return(0,S.jsx)(xt.Z,{render:o=>(0,S.jsx)(vt.Z,{isSmall:!0,onClick:this.handleHideTableClick,style:{position:"absolute",top:t?e.isIOS?3:4:e.isIOS?7:8,right:t?6:8,zIndex:T.MC,fill:this.theme.lightIconColor},...o,children:(0,Rs.D)({width:14})}),renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})}}Ms.displayName="CollectionTimelineViewHideTableButton";const Is=(0,R.injectIntl)(Ms);var Vs=o(24211);function Bs(e){window.__c={n:"TimelineShimmerWrapper"};const{shouldShowShimmer:t,children:o}=e,r=(0,ao.Z)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,S.jsx)("div",{className:r,style:{height:"100%"},children:o})}const Fs=22,js=32;class Ds extends n.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()},this.activeRangeStore=this.createComputedStore((()=>{const{collectionContextStore:e,timelineState:t,query:o,schema:r,intl:i}=this.props,n=e.collectionStore();if(!n)return;const s=t.dragState.state,l=t.zoomLevel.state,a=t.hoveredItem.state,c=t.dateRangePlaceholder.state,{activeRangeType:d}=se.BJ[l];if(!d)return;let h;if(s)h=s.temporaryValues.map((e=>(0,se.XO)(e,"day")));else if(c.active)h=[(0,se.XO)(c.date,"day")];else{const{stores:t}=Ht.default.state,s=t.filter((e=>e.getParentCollectionId()===n.id)),l=C.jj(C.oA([...s,a]));h=C.oA(l.map((t=>{const n=(0,se.bk)({store:t,query:o,schema:r,userId:e.getCurrentUserId(),intl:i});if(n)return(0,se.XO)(n,"day")})))}const p=C.F(h,(e=>{let{start:t}=e;return t.valueOf()})),u=C.UT(h,(e=>{let{end:t}=e;return t.valueOf()}));return p&&u?{start:p.start.valueOf(),end:u.end.valueOf()}:void 0}),!0)}willMount(e){super.willMount(e)}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){const{collectionContextStore:e,timelineState:t}=this.props,o=t.zoomLevel.state,r=se.BJ[o],{primaryDisplayUnit:i,activeRangeType:n}=r,s=(0,se.ST)(i),l=Zi.ou.now(),a=s?l.startOf("minute"):l.startOf("day"),c=l.startOf("minute"),{device:d}=this.environment,h=!e.groupsStore.anyGroupHasNonEmptyResults()&&Ue({collectionContextStore:e,groupsPointer:[],hasPartialResults:!1});return(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{style:this.getStyle(),children:[(0,S.jsx)("div",{style:{height:32,position:"relative",overflow:"hidden"},children:!d.isPhone&&this.renderSecondaryIndicators()}),(0,S.jsxs)("div",{style:{height:js,position:"relative",overflow:"hidden"},children:[(0,S.jsx)(Bs,{shouldShowShimmer:h,children:this.renderPrimaryIndicators(a)}),"highlight_days"===n&&this.renderActiveRange(),this.renderNowIndicator(a),"display_range"===n&&this.renderActiveRange()]}),this.renderNowCircle(c)]})})}renderPrimaryIndicators(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r,endTimestamp:i}=t.currentRange.state,n=se.BJ[o],{primaryDisplayUnit:s,hidePrimaryIndicatorIntersectionOffset:l}=n,a=l||0,c=this.getPrimaryDisplayUnitPosition(e,!1),d=c.left+a,h=c.left+c.width-a,p=[];let u=(0,se.DS)(Zi.ou.fromMillis(r),s);for(;u.valueOf()<i;){const e=this.getPrimaryDisplayUnitPosition(u,!1),t=e.left+a,o=e.left+e.width-a;void 0!==l&&(d>=t&&d<=o||h>=t&&h<=o)||p.push(this.renderPrimaryIndicator(u,!1));u=(0,se.Ip)(u,s)}return p}renderSecondaryIndicators(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state,i=se.BJ[t],{primaryDisplayUnit:n,secondaryDisplayUnit:s}=i,l=[];let a=(0,se.DS)(Zi.ou.fromMillis(o),s);for(;a.valueOf()<r;){l.push(this.renderSecondaryIndicator(a));const e=(0,se.Ip)(a,s);a=(0,se.xP)(e,n)}return l}renderActiveRange(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state,i=se.BJ[t],{activeRangeType:n}=i,s=this.activeRangeStore.state;if(s){const e=(0,se.DS)(Zi.ou.fromMillis(s.start),"day"),i=(0,se.e$)(t,e.valueOf()-o);if("highlight_days"===n){const n=[];let l=Zi.ou.fromMillis(Math.max(e.valueOf(),(0,se.DS)(Zi.ou.fromMillis(o),"day").valueOf()));for(;l.valueOf()<s.end&&l.valueOf()<r;){n.push(l);l=(0,se.Ip)(l,"day")}const a=(0,se.e$)(t,l.valueOf()-o)-i+8,c=n.map(((e,t)=>this.renderPrimaryIndicator(e,0===t||t===n.length-1)));return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{position:"absolute",top:0,left:i-4,width:a,marginTop:3,height:Fs,background:this.theme.timelineDarkerBackground,borderRadius:11}}),c]})}{const r=(0,se.DS)(Zi.ou.fromMillis(s.end),"day"),n=(0,se.cK)(Zi.ou.fromMillis(s.end),"day"),l=(0,se.e$)(t,r.valueOf()-o)-i+8;return(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,left:i-4,minWidth:l,marginTop:3,height:Fs,background:this.theme.timelineDarkerBackground,borderRadius:11,paddingLeft:6,paddingRight:6},children:this.renderActiveDisplayRangeIndicator(e,e.valueOf()!==n.valueOf()?n:void 0,l)})}}}renderPrimaryIndicator(e,t){const{timelineState:o}=this.props,r=o.zoomLevel.state,{primaryDisplayUnit:i}=se.BJ[r],{left:n,width:s}=this.getPrimaryDisplayUnitPosition(e,!1);return(0,S.jsx)("div",{style:{position:"absolute",top:0,left:n,width:s,height:28,display:"flex",alignItems:"start",lineHeight:"28px"},children:(0,S.jsx)("div",{style:{fontSize:12,margin:"0 auto"},children:this.formatPrimaryDisplayUnit(e,r,i,t)})},n)}renderNowIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{primaryDisplayUnit:r}=se.BJ[o],{left:i,width:n}=this.getPrimaryDisplayUnitPosition(e,!0);return(0,S.jsx)("div",{style:{position:"absolute",top:0,left:i,width:n,height:28,display:"flex",alignItems:"center",fontWeight:500},children:(0,S.jsx)("div",{style:{fontSize:12,margin:"0 auto",display:"flex"},children:this.formatNowIndicator(e,o,r)})},i)}renderNowCircle(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,i=Math.floor((0,se.e$)(o,e.valueOf()-r));return(0,S.jsx)("div",{style:{position:"absolute",left:i-3.5+.5,top:Math.floor(61),width:7,height:7,background:this.theme.timelineRed,borderRadius:"100%"}})}renderSecondaryIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,{secondaryDisplayUnit:i}=se.BJ[o],n=(0,se.e$)(o,e.valueOf()-r);return(0,S.jsx)("div",{style:{position:"absolute",top:0,left:n,height:js,color:this.theme.regularTextColor,fontSize:14,fontWeight:P.Z.fontWeight.medium,verticalAlign:"middle",paddingTop:6+(this.environment.device.isMobile?2:0),display:"flex",alignItems:"center"},children:(0,se.EW)((0,Vs.E2)(this.props.intl),e.valueOf(),i)},n)}renderActiveDisplayRangeIndicator(e,t,o){return e&&t?o>=110?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:this.getActiveDisplayRangeIndicatorStyle(),children:(0,Mi.Yx)(e.valueOf(),"month_day",Ti.SP)}),(0,S.jsx)("div",{style:{flexGrow:1}}),(0,S.jsx)("div",{style:this.getActiveDisplayRangeIndicatorStyle(),children:(0,Mi.Yx)(t.valueOf(),"month_day",Ti.SP)})]}):(0,S.jsxs)("div",{style:this.getActiveDisplayRangeIndicatorStyle(),children:[(0,Mi.Yx)(e.valueOf(),"month_day",Ti.SP)," – ",e.month===t.month?(0,Mi.Yx)(t.valueOf(),"day",Ti.SP):(0,Mi.Yx)(t.valueOf(),"month_day",Ti.SP)]}):(0,S.jsx)("div",{style:this.getActiveDisplayRangeIndicatorStyle(),children:(0,Mi.Yx)(e.valueOf(),"month_day",Ti.SP)})}formatPrimaryDisplayUnit(e,t,o,r){const i=e.setLocale(Ti.SP),n=(0,se.xJ)(),s=r?this.theme.regularTextColor:this.theme.lightTextColor,l=r?this.theme.regularTextColor:this.theme.mediumTextColor,a=r?this.theme.mediumTextColor:this.theme.lightTextColor,c=i.toFormat("t").startsWith(i.toFormat("a"));if("fifteen_minutes"===o){if(n)return(0,S.jsx)("span",{style:{color:s},children:i.toFormat("H:mm")});{const e=(0,S.jsx)("span",{style:{color:l,paddingRight:c?void 0:3},children:i.toFormat("h:mm")}),t=(0,S.jsx)("span",{style:{color:a,paddingRight:c?3:void 0},children:i.toFormat("a")});return c?(0,S.jsxs)(S.Fragment,{children:[t,e]}):(0,S.jsxs)(S.Fragment,{children:[e,t]})}}if("hour"===o){if(n)return(0,S.jsx)("span",{style:{color:s},children:i.toFormat("H:mm")});{const e=(0,S.jsx)("span",{style:{color:l,paddingRight:c?void 0:3},children:i.toFormat("h")}),t=(0,S.jsx)("span",{style:{color:a,paddingRight:c?3:void 0},children:i.toFormat("a")});return c?(0,S.jsxs)(S.Fragment,{children:[t,e]}):(0,S.jsxs)(S.Fragment,{children:[e,t]})}}if("day"===o||"week"===o)return"week"===t||"bi_week"===t?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:{color:a,paddingRight:3},children:i.toFormat("ccccc")}),(0,S.jsx)("span",{style:{color:l,padding:"2px 7px"},children:i.toFormat("d")})]}):(0,S.jsx)("span",{style:{color:s},children:i.toFormat("d")});(0,vr.t1)(o)}formatNowIndicator(e,t,o){const r=e.setLocale(Ti.SP),i=(0,se.ST)(o),n=(0,se.xJ)();return i?n?(0,S.jsx)("span",{style:{color:this.theme.timelineRed},children:r.toFormat("H:mm")}):(0,S.jsx)("span",{style:{color:this.theme.timelineRed,paddingRight:3},children:r.toFormat("t")}):"week"===t||"bi_week"===t?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:{color:this.theme.lightTextColor,paddingRight:3},children:r.toFormat("ccccc")}),(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:this.getNowIndicatorCircleStyle()}),(0,S.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})]}):(0,S.jsxs)("div",{style:{position:"relative"},children:[(0,S.jsx)("div",{style:this.getNowIndicatorCircleStyle()}),(0,S.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:r.toFormat("d")})]})}getPrimaryDisplayUnitPosition(e,t){const{timelineState:o}=this.props,r=o.zoomLevel.state,{startTimestamp:i}=o.currentRange.state,{primaryDisplayUnit:n,primaryDisplayUnitAlignment:s}=se.BJ[r],l=(0,se.DS)(e,n),a=(0,se.Ip)(e,n),c=(0,se.e$)(r,l.valueOf()-i),d=(0,se.e$)(r,e.valueOf()-i),h=(0,se.e$)(r,a.valueOf()-i)-c,p=t?4:0;return{left:("range_start"===s?d-h/2:d)-p,width:h+2*p}}getStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{position:"absolute",left:0,top:0,width:"100%",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),borderTop:t.viewIsFlushToTopbar()?`1px solid ${this.theme.tableDividerColor}`:"1px solid transparent",borderBottom:`1px solid ${this.theme.tableDividerColor}`}}getActiveDisplayRangeIndicatorStyle(){return{color:this.theme.regularTextColor,fontSize:12}}getNowIndicatorCircleStyle(){return{background:this.theme.timelineRed,width:22,height:22,borderRadius:11,position:"absolute",left:"calc(50% - 11px)",top:"calc(50% - 11px)"}}}Ds.displayName="CollectionTimelineViewTimeBar";const As=(0,R.injectIntl)(Ds);var _s=o(1742),Ls=o(29376),Zs=o(4023),Es=o(50959),Os=o(3072);function zs(e){window.__c={n:"TableAggregation"};const{disabled:t,property:o,schema:i,collectionContextStore:n,groupFormat:s,isHovered:l,aggregation:a,onChange:c}=e,d=(0,ct.qz)(void 0,Ce.Z),h=(0,uo.O7)(),p=(0,R.useIntl)(),{isMobile:u}=(0,uo.Fy)(),m=(0,ct.VK)((()=>{if(!a)return;return{type:"aggregation",filter:s?(0,ot.zk)({schema:i,group:s,timeZone:(0,rt.r)()}):void 0,aggregation:a}}),[i,s,a]),g=(0,r.useCallback)((e=>{e?(c(o,{aggregator:e,property:o}),M.wds(h,{view_type:"table",action:"table_change_aggregation"})):(c(o,void 0),M.wds(h,{view_type:"table",action:"table_remove_aggregation"}))}),[h,c,o]),y=(0,r.useCallback)((()=>{d.update((e=>({...e,open:!1})))}),[d]),v=(0,co.yK)((e=>({buttonStyle:{display:"flex",alignItems:"center",justifyContent:"flex-end",width:"100%",height:32,paddingRight:8,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto"}})),[]),f=(0,ct.VK)((()=>dt(n,a)),[n,a]);return(0,S.jsx)(xt.Z,{alignment:Zs.v.End,disableTooltip:!f,renderTooltip:()=>p.formatMessage(pt.aggregationCalculating),render:e=>(0,S.jsx)(mt.ZP,{popupType:u?mt.Z4.SlideUp:mt.Z4.Popup,buttonPopupStore:d,disabled:t,renderOrigin:r=>(0,S.jsx)(Qt.Z,{disabled:t,style:v.buttonStyle,...(0,lt.Z)(e,r),children:m?(0,S.jsx)(at.Z,{id:`table:${(0,ze.mD)(s)}:${o}:${m.aggregation.aggregator}`,collectionContextStore:n,reducer:m,groupsPointer:s?[s]:void 0,render:e=>(0,S.jsx)(Gs,{reducerResult:e,aggregation:a,schema:i,property:o,isHovered:l,disabled:t,buttonPopupStore:d})}):(0,S.jsx)(Gs,{aggregation:a,schema:i,property:o,isHovered:l,disabled:t,buttonPopupStore:d})}),render:()=>(0,S.jsx)(Os.Z,{property:o,schema:i,onChange:g,onClose:y,source:"tableAggregation"})})})}function Gs(e){window.__c={n:"TableAggregationButtonContent"};const{aggregation:t,reducerResult:o,schema:i,property:n,isHovered:s,disabled:l,buttonPopupStore:a}=e,{isMobile:c}=(0,uo.Fy)(),d=(0,Q.Y$)(),h=(0,ct.VK)((()=>a.getState().open),[a]),p=(0,co.yK)((e=>({valueStyle:{display:"flex",alignItems:"center",height:"100%",fontSize:14},aggregationTypeNameStyle:{fontSize:10,textTransform:"uppercase",letterSpacing:1,color:e.mediumTextColor,marginTop:2,marginRight:4,userSelect:"none",WebkitUserSelect:"none"},placeholderWrapper:{display:"flex",alignItems:"center"},placeholderText:{marginBottom:2,color:e.lightTextColor},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),u=(0,ct.VK)((()=>null==o?void 0:o.state),[o]),m=(0,r.useMemo)((()=>{if(!t)return;let e=nt.v6[(0,tt.OV)(t)];return(0,tt.en)(t.aggregator)&&(e=t.aggregator.groupName in Es.ZA?Es.ZA[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),g=i[n],y=(0,ct.VK)((()=>{if(g&&("formula"===g.type||"number"===g.type))return g.number_format;if("rollup"===(null==g?void 0:g.type)&&g.relation_property&&g.target_property&&"number"===g.target_property_type){if(i[g.relation_property]){var e;const t=(0,Ls.ny)(d,i[g.relation_property]),o=null==t||null===(e=t.getModel())||void 0===e?void 0:e.getNormalizedSchema(),r=null==o?void 0:o[g.target_property];if("number"===(null==r?void 0:r.type))return r.number_format}}}),[g,i,d]);return m?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{style:p.aggregationTypeNameStyle,children:m},"type"),(0,S.jsx)("span",{style:p.valueStyle,children:u&&t?(0,S.jsx)(ht,{aggregation:t,collectionContextStore:d,children:(0,nt.Ol)({numberFormat:y,dateFormat:void 0,aggregationType:t.aggregator,value:u.aggregationResult,userTimeZone:(0,rt.r)(),roundDecimal:5})}):null},"value")]}):!l&&(c||s||h)?(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},render:()=>(0,S.jsxs)("div",{style:p.placeholderWrapper,children:[(0,S.jsx)("span",{style:p.placeholderText,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder"),(0,Fr.i)(p.chevronIcon)]})}):null}class Hs extends n.Z{constructor(){super(...arguments),this.storeTypes={mouseStore:Ve.Z},this.renderAggregation=(e,t)=>{var o;const{schema:r,disabled:i,collectionContextStore:n,showHoverActionsStore:s,groupFormat:l,query:a}=this.props,{mouseEntered:c}=this.stores.mouseStore.state,d=(0,le.fk)({environment:this.environment,collectionContextStore:n});return(0,S.jsx)("div",{style:{display:"flex",width:void 0!==e.width?e.width+(0===t&&d?xo.Xx+1:0):void 0},children:(0,S.jsx)(zs,{groupFormat:l,disabled:i,isHovered:(c||0===t&&!l&&s.state)&&!i,aggregation:null===(o=a.aggregations)||void 0===o?void 0:o.find((t=>t.property===e.property)),property:e.property,collectionContextStore:n,schema:r,onChange:this.handleTableAggregationChange})},e.property)},this.handleTableAggregationChange=(e,t)=>{const{collectionContextStore:o,query:r}=this.props,i=o.collectionViewStore();if(!i)return;let n=r.aggregations?[...r.aggregations]:[];const s=(r.aggregations||[]).findIndex((t=>t.property===e));n=s<0?C.oA([...n,t]):C.oA(n.map(((e,o)=>s===o?t:e)));const l={...r,aggregations:n};o.isClientModeEnabled.state||o.asyncAggregationStatus.setState({calculating:!0,aggregation:t}),W.createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:this.environment,perform:e=>{_.iG({collectionViewStore:i,update:{query2:l},transaction:e})}})},this.captureEditorMouseDown=e=>{(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{}})},this.handleAggregationRowEnter=()=>{this.stores.mouseStore.enter()},this.handleAggregationRowLeave=()=>{this.stores.mouseStore.exit()},this.frozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.frozoneStore.state.frozenIndex}))}renderComponent(){const{showPropertyFormatsStore:e,collectionContextStore:t}=this.props,o=e.state,r=(0,le.bW)(this.frozenIndex.state),[i,n]=(0,le.Ql)(this.frozenIndex.state)?[o.slice(0,r),o.slice(r)]:[[],o];return(0,S.jsx)(ir,{position:Xe.Bottom,children:(0,S.jsx)(Zn.p,{allowSelectionWithin:!1,style:this.getAggregationsRowStyle(),onMouseMove:this.handleAggregationRowEnter,onMouseLeave:this.handleAggregationRowLeave,onMouseDown:this.captureEditorMouseDown,children:(0,S.jsx)("div",{style:{display:"flex",paddingRight:!this.props.disabled&&this.props.showRightActionsSpacer?32:0},children:(0,S.jsxs)("div",{style:{display:"flex"},children:[(0,le.Ql)(this.frozenIndex.state)&&(0,S.jsx)("div",{style:{...(0,xo.oc)({environment:this.environment,collectionContextStore:t,isMobile:this.environment.device.isMobile,theme:this.theme}),display:"flex"},children:i.map(this.renderAggregation)}),n.map(((e,t)=>this.renderAggregation(e,t+r)))]})})})})}getAggregationsRowStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props;return{display:"flex",position:"absolute",background:(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground),zIndex:T.RJ,fontSize:14,height:xa+(this.props.isFullScreen?xe.Z.state:0)+1,minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",left:0,borderTop:`1px solid ${this.theme.tableDividerColor}`,...this.props.style}}}Hs.displayName="TableAggregationRow";const Ns=Hs;function Ws(e){window.__c={n:"TableEmptyPlaceholder"};const{collectionContextStore:t,shouldShowAddRowButton:o,paddingLeft:r,handleAddRowClick:i}=e,n=(0,ct.VK)((()=>Boolean(t.currentCombinatorFilterStore.state||t.currentPropertyFiltersStore.state.length>0)),[t]),s=(0,co.yK)((e=>({button:{display:"flex",alignItems:"center",height:Ca+1,width:"100%",paddingLeft:ba,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,background:e.contentBackground,left:0,right:0,textAlign:"center",borderBottom:`1px solid ${e.tableDividerColor}`},buttonInner:{color:e.lightTextColor,position:"sticky",left:r+ba}})),[r]);return(0,S.jsx)(Qt.Z,{className:ee.Gcz,onClick:i,onMouseDown:he.$0,disabled:!o,style:s.button,children:o?(0,S.jsx)("span",{style:s.buttonInner,children:n?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No filter results. Click to add a row.",id:"database.tableView.emptyTablePlaceholderWithFilters"}):(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.tableView.emptyTablePlaceholder"})}):(0,S.jsx)("span",{style:s.buttonInner,children:n?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No filter results.",id:"database.tableView.cannotEdit.emptyTablePlaceholderWithFilters"}):(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Empty.",id:"database.tableView.cannotEdit.emptyTablePlaceholder"})})})}var Ks=o(46328),Us=o(87085),$s=o(73060);class qs extends a.default{getInitialState(){return{}}}const Qs=qs;var Ys=o(25962),Xs=o(84939);function Js(e){window.__c={n:"FrozenColumnDivider"};const{isScrolled:t,isCheckbox:o,isShimmerRow:r}=e,i=(0,uo.Fy)().isMobile,n=(0,co.yK)((e=>({border:{position:"absolute",top:-1,right:0,width:2,height:r?35:"calc(100% + 2px)",background:e.tableDividerColor},shadow:{position:"absolute",top:0,right:-3,width:3,height:r?34:"100%",background:"dark"===e.mode?"transparent":`linear-gradient(to right, ${(0,Xs.Fq)(_o.se[e.mode].gray,.15)},\n                                ${(0,Xs.Fq)(_o.se[e.mode].gray,.1)},  transparent)`}})),[r]);return i?null:(0,S.jsxs)(S.Fragment,{children:[o&&!t?null:(0,S.jsx)("div",{style:n.border}),(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:t?1:0},render:()=>(0,S.jsx)("div",{style:n.shadow})})]})}function el(e){window.__c={n:"MultiSelectCheckbox"};const{checkedState:t,onClick:o,checkboxType:i,collectionContextStore:n,isShimmerRow:s,frozoneProps:l}=e,a=(0,uo.O7)(),c=(0,ct.qz)(void 0,Ve.Z),d=(0,ct.VK)((()=>c.state.mouseEntered),[c]),h=(0,r.useRef)(null);(0,r.useEffect)((()=>{h.current&&(h.current.indeterminate="indeterminate"===t)}),[t]);const p=(0,ct.VK)((()=>cs.ZP.state.isDragging),[]),u=(0,r.useCallback)((e=>{o(e),I.Ac({environment:a,collectionContextStore:n,checkbox_type:i})}),[i,n,a,o]),m=(0,ct.VK)((()=>{const e=n.frozoneStore.state.frozenIndex;return(null==l?void 0:l.shouldFreeze)&&!(0,le.Ql)(e)}),[null==l?void 0:l.shouldFreeze,n]),g=(0,ct.VK)((()=>Boolean(n.frozoneStore.state.isScrolled)),[n]),y=(0,ct.VK)((()=>g&&m?5:0),[g,m]),v=(0,ct.VK)((()=>!1===t&&!d||p?g&&m&&null!=l&&l.shouldShowStickyMultiSelectColumn?.4:0:1),[t,p,d,g,m,null==l?void 0:l.shouldShowStickyMultiSelectColumn]),f=(0,co.yK)((e=>({multiSelectCheckbox:{background:null==l?void 0:l.frozenStyles.background,borderBottom:e.tableDividerColor,height:"100%"}})),[null==l?void 0:l.frozenStyles.background]);return(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:v>0?1:0},render:()=>(0,S.jsxs)("div",{style:f.multiSelectCheckbox,onMouseEnter:()=>{c.enter()},onMouseLeave:()=>{c.exit()},children:[(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:v,paddingLeft:y,paddingRight:y},render:()=>(0,S.jsx)("label",{style:{height:"100%",marginRight:`${xo._n}px`,alignItems:"flex-start",justifyContent:"center",display:"flex",cursor:"pointer",zIndex:1},onClick:he.Wi,onMouseDown:he.$0,children:(0,S.jsx)("div",{style:{width:`${xo.bu}px`,height:xo.bu-1+"px",display:"flex",justifyContent:"center",alignItems:"center",paddingRight:y},children:(0,S.jsx)("input",{type:"checkbox",style:{width:xo.tA,height:xo.tA,cursor:"pointer",position:"relative",right:"2px"},ref:h,checked:!0===t,onChange:u})})})}),m&&(0,S.jsx)(Js,{isShimmerRow:Boolean(s),isCheckbox:!0,isScrolled:g})]})})}var tl=o(39068),ol=o(79362),rl=o(8597),il=o(88437),nl=o(44643),sl=o(21197),ll=o(44495),al=o(16184),cl=o(20669),dl=o(4635),hl=o(23903),pl=o(79310),ul=o(59753),ml=o(40778),gl=o(16956),Sl=o(80402),yl=o(44866),vl=o(58449),fl=o(43224),Cl=o(12921),xl=o(67695),bl=o(30905),wl=o(26122),kl=o(65326),Pl=o(28992),Tl=o(74420),Rl=o(86825),Ml=o(42402);class Il extends n.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Ce.Z,resultStore:a.default.createClass(void 0)},this.renderPopup=e=>(0,S.jsx)(Vl,{...this.props,parent:e}),this.handleClick=()=>{N.ZH(this.environment),H.ZH(this.environment),_.wG()},this.handleContextMenu=e=>{this.environment.device.isMobile||(e.preventDefault(),(0,he.ZP)({event:e,context:he.Af.EditorContextMenu,callback:()=>{this.handleClick(),this.stores.buttonPopupStore.setState({open:!0})}}))},this.isRightMostFrozenColumn=this.createComputedStore((()=>{const{collectionContextStore:e,columnIndex:t}=this.props,o=e.frozoneStore.state.frozenIndex;return(0,le.Ql)(o)&&o===t})),this.isScrolled=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.frozoneStore.state.isScrolled}))}get registries(){return[xl.Z]}renderComponent(){const{property:e,schema:t,disabled:o,collectionContextStore:r,renderSpacer:i,paddingTop:n,isLast:s}=this.props,l=t[e],{device:a}=this.environment;if(!l)return;const c=r.permissionScopes.state;return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)("div",{style:this.getStyle(),className:ee.VMO,onContextMenu:this.handleContextMenu,children:(0,S.jsx)(mt.ZP,{popupType:a.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,disabled:!c.canConfigureBlock,originGap:1,alignmentToOrigin:mt.vR.Start,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:t=>(0,S.jsx)(xt.Z,{renderTooltip:e=>{const t=(0,Bt.qQ)(l)&&("text"===l.type||(0,Cl.KZ)())&&(0,Bt.q3)(l);return(0,S.jsxs)("div",{...e,style:fl.F,children:[(0,S.jsx)("div",{children:l.name}),void 0!==(null==l?void 0:l.description)&&l.description.length>0?(0,S.jsx)("div",{style:{color:this.theme.mediumInvertedTextColor},children:l.description}):null,t&&t.auto_update_on_edit&&(0,S.jsx)("div",{style:{color:this.theme.mediumInvertedTextColor},children:(0,S.jsx)(R.FormattedMessage,{...kl.sY.keptUpToDateWithNotionAITooltip})})]})},delayThreshold:500,placement:xt.Z.Placement.Right,render:r=>(0,S.jsxs)(Qt.Z,{style:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingLeft:8,paddingRight:8,paddingTop:n},disabled:o,...(0,lt.Z)(r,t),children:[i&&i(s),(0,S.jsx)(On.Z,{propertySchema:l,showIcon:!0,showBadge:!0,style:Il.propertyStyle,property:e}),this.isRightMostFrozenColumn.state&&(0,S.jsx)(Js,{isScrolled:Boolean(this.isScrolled.state)})]})}),render:this.renderPopup,onClick:this.handleClick})})})}getStyle(){const{width:e,disableCellRightBorder:t}=this.props;return{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:e,borderRight:t?void 0:`1px solid ${this.theme.tableDividerColor}`}}}Il.displayName="TableHeaderCell",Il.propertyStyle={fontSize:14};class Vl extends n.Z{constructor(){super(...arguments),this.storeTypes={propertyTypeButtonPopupStore:Ce.Z,inputStore:a.default.createClass("")},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,r=o.collectionStore();if(!r)return;const i=r.getSchema()[t];(null==i?void 0:i.name)!==e&&(W.createAndCommit({userAction:"TableHeaderCell.handlePropertyNameSubmit",environment:this.environment,perform:o=>{gl.Bv({collectionStore:r,property:t,name:e,transaction:o})}}),I.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handleHide=()=>{const{collectionContextStore:e,property:t,format:o,formatKey:r,columnIndex:i}=this.props,n=e.collectionViewStore();if(!n)return;const s=(o[r]||[]).map((e=>e.property===t?{...e,visible:!1}:e)),l={...o,[r]:s};W.createAndCommit({userAction:"TableHeaderCell.updatePropertyFormat",environment:this.environment,perform:t=>{_.iG({collectionViewStore:n,update:{format:l},transaction:t}),Sl.oz({environment:this.environment,collectionContextStore:e,currentIndex:i,entrypoint:"TableHeaderCell",transaction:t,propertyAction:"hide"})}})},this.handleFreezeColumns=()=>{const{collectionContextStore:e}=this.props;W.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:this.environment,perform:t=>{Sl.oz({environment:this.environment,collectionContextStore:e,currentIndex:this.props.columnIndex,transaction:t,entrypoint:"TableHeaderCell",propertyAction:"toggle"})}})},this.getPropertyFormat=()=>{var e;const{format:t,formatKey:o,property:r}=this.props;return null===(e=t[o])||void 0===e?void 0:e.find((e=>e.property===r))},this.handleDelete=async()=>{const{collectionContextStore:e,property:t}=this.props;await gl.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme,from:"table_column"})},this.handleDeleteAccept=()=>{const{property:e,schema:t,collectionContextStore:o,columnIndex:r}=this.props,i=o.collectionStore();if(!i)return;const n=i.getSchema()[e];W.createAndCommitAsync({environment:this.environment,userAction:"TableHeaderCell.handleDeleteAccept",waitForServerCommit:!1,perform:async n=>{await gl.yV({environment:this.environment,collectionStore:i,schema:t,property:e,transaction:n}),Sl.oz({environment:this.environment,collectionContextStore:o,currentIndex:r,entrypoint:"TableHeaderCell",transaction:n,propertyAction:"delete"})}}),n&&I.y9({environment:this.environment,collectionContextStore:o,property_type:n.type,from:"table_column",property:e})},this.handleDuplicate=async()=>{const{property:e,collectionContextStore:t,formatKey:o,columnIndex:r}=this.props,i=this.getPropertyFormat(),n=t.collectionStore(),s=t.collectionViewStore(),l=t.normalizedFormatStore.state[o]||[],a=null==n?void 0:n.getSpaceId();if(!(n&&s&&a&&i))return;const c=n.getSchema(),d=c[e];if(!d)return;const h=await(0,le.xy)({environment:this.environment,schema:c,property:e,properties:l,parentStore:n,spaceId:a});h&&(W.createAndCommit({userAction:"TableHeaderCell.handleDuplicate",environment:this.environment,perform:e=>{_.xO({environment:this.environment,collectionStore:n,update:{[h.newProperty]:h.newPropertySchema},transaction:e}),Sl.oz({environment:this.environment,collectionContextStore:t,currentIndex:r,entrypoint:"TableHeaderCell",transaction:e,propertyAction:"duplicate"}),h.automationUpdate&&_.Ki({environment:this.environment,collectionStore:n,update:h.automationUpdate,transaction:e}),o&&Ne.FH({stores:[s],update:{[o]:h.newProperties},transaction:e})}}),I.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==s?void 0:s.getType(),property_type:d.type}))},this.handleAddFilter=()=>{const{property:e,collectionContextStore:t,schema:o}=this.props,r=t.currentPropertyFiltersStore.state,i=t.collectionViewBlockStore(),n=(null==i?void 0:i.getRecordModel)??ul.om.constant(void 0);let s=r.find((t=>{let{filter:o}=t;return o.property===e}));if(!s){const i=(0,te.H_)({property:e,schema:o,getRecordModel:n});if(!i)return;const l={id:(0,yr.ZP)(),filter:i};t.filtersBarOpen.setState(!0),ml.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:[...r,l]}}}),s=l}if(!s)return;const l=t.getFilterBarItemSettingsStore(s);D.wl({collectionSettingsStore:l,item:{type:"filter"}}),_.n1({collectionContextStore:t})},this.handleSortAscending=()=>{this.createSort(!0)},this.handleSortDescending=()=>{this.createSort(!1)},this.handlePropertyIconSubmit=(e,t)=>{const{property:o,collectionContextStore:r}=this.props,i=r.collectionStore();i&&(W.createAndCommit({userAction:"TableHeaderCell.handlePropertyIconSubmit",environment:this.environment,perform:t=>{gl.OK({collectionStore:i,property:o,icon:e,transaction:t})}}),I.$q({environment:this.environment,collectionContextStore:r,property:o,icon:e,from:"table",action:"change_icon"}))},this.isFreezeColumnsEnabled=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.props.collectionContextStore.collectionViewStore();return(0,le.eL)(e.isMobile,null==t?void 0:t.getType())})),this.isRightmostFrozen=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return Boolean((0,le.Ql)(t)&&this.props.columnIndex===t)})),this.collectionViewType=this.createComputedStore((()=>{var e;return null===(e=this.props.collectionContextStore.collectionViewStore())||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getType()})),this.canFreezeThisColumn=this.createComputedStore((()=>{var e;const{collectionContextStore:t,columnIndex:o}=this.props,r=t.frozoneStore.state.scrollerWidth;return o>((null===(e=t.collectionViewStore())||void 0===e?void 0:e.getTableMaxFrozenColumnIndex(r,t.normalizedFormatStore.state))??-1)}))}willMountOrUpdate(e){const{property:t,schema:o,collectionContextStore:r}=e,i=o[t];if(i&&"relation"===i.type){const e=Ls.ny(r,i);null==e||e.load()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:st.og.ActionSheet}:{menuType:st.og.Popup,minWidth:220};const o=this.getMenuSections(this.props.parent);return(0,S.jsx)(gt.Z,{...t,children:(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:void 0,sections:C.oA(o.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,S.jsx)(Ct.Z,{...e,topBorder:0!==t}),items:e}})))})})}shouldShowDuplicateError(){const{property:e,schema:t}=this.props,{inputStore:o}=this.stores,r=o.state,i=Object.keys(t).find((o=>{var i;return o!==e&&(null===(i=t[o])||void 0===i?void 0:i.name)===r}));return Boolean(i)}getMenuSections(e){var t;const{property:o,schema:r,collectionContextStore:i,formatKey:n,allowHidingTitle:s,format:l}=this.props,{environment:a,theme:c}=this,{device:d}=a,h=r[o],p=i.permissionScopes.state,u=i.settingsStore,m=i.collectionViewStore(),g=i.collectionStore();if(!m||!h)return[];const y=(0,Sr.wl)(o),v=Boolean((null===(t=this.getPropertyFormat())||void 0===t?void 0:t.wrap)||m.getFormat().table_wrap)&&"timeline"!==m.getType(),f=i.databaseType,C=Boolean(g&&f&&J.cR((0,vl.appConfigs)(),f,o,g)),x="title"===h.type,b=[];if(y&&"person"===h.type){const e=[];b.push(e),e.push({key:"synced_person",render:e=>(0,S.jsx)(Pl.Z,{...e,title:h.name||"",icon:(0,ll.D)({width:14}),caption:(0,S.jsx)("div",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",minWidth:300,maxWidth:350},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"People synced from external sources may require additional set up. Visit <helpcenterlink>the help center</helpcenterlink> for more information.",id:"database.tableHeaderCell.syncedPersonPropertyCaption",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,S.jsx)(Ml.Z,{href:(0,un.UY)("guides.syncedContent"),children:t})}}})})}),action:()=>{}})}if(p.canConfigureCollection&&!y){const t=[];if(b.push(t),t.push({key:"rename",render:t=>(0,S.jsxs)(Ct.Z,{children:[(0,S.jsx)(wl.Z,{...t,initialValue:h.name||"",placeholder:pe.default.formatMessage(kl.sY.inputPlaceholder),focusInitial:!0,inputStore:this.stores.inputStore,onBlur:this.handlePropertyNameSubmit,onSubmit:t=>{this.handlePropertyNameSubmit(t),e.close()},iconButton:{icon:e=>(0,S.jsx)(tl.ZP,{type:h.type,icon:h.icon,size:16,theme:c,style:e}),iconStyle:{fill:ol.Lr[c.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}}),this.shouldShowDuplicateError()&&(0,S.jsx)(kl.mJ,{propertyName:this.stores.inputStore.state,styles:d.isMobile?{paddingBottom:5,paddingLeft:16,paddingRight:16,margin:0,boxShadow:`inset 0 -1px 0 ${c.regularDividerColor}`}:{}})]}),action:()=>{I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_rename"}),_.n1({collectionContextStore:i}),e.close()}}),t.push({key:"edit_property",render:e=>(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Left,render:t=>(0,S.jsx)(ut.Z,{disabled:void 0===g,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Edit property",id:"database.tableHeaderCell.editProperty"}),icon:(0,dl.W)({width:14}),...(0,lt.Z)(e,t)}),style:{whiteSpace:"normal"},renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Edit property name, type, and other options...",id:"database.tableHeaderCell.editPropertyTooltip"})}),action:()=>{g&&(I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_edit"}),_.n1({collectionContextStore:i}),e.close(),D.r$({collectionContextStore:i,collectionSettingsStore:u}),D.H4({collectionSettingsStore:u,item:{type:"properties",timelineViewTab:"table"}}),D.H4({collectionSettingsStore:u,item:{type:"property",formatKey:n,property:o}}))}}),g&&(0,Cl.Zt)(this.environment)&&(0,Bt.qQ)(h)&&("text"===h.type||(0,Cl.KZ)())){const r=(0,Bt.q3)(h),s=Ft.De(g.getFormat(),o);r?t.push({key:"fill_all_pages",render:e=>(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Left,renderTooltip:()=>(0,S.jsx)(bl.qQ,{collectionStore:g,propertySchema:h}),render:t=>(0,S.jsx)(ut.Z,{titleStyle:{color:s.isRunning?c.lightTextColor:void 0},disabled:s.isRunning||!g,icon:(0,S.jsx)(bl.Xh,{updateAiInferencesTaskStatus:s,iconStyle:{marginLeft:-1,marginRight:-1},progressIconStyle:{marginTop:4,marginLeft:0,marginRight:-3}}),title:(0,S.jsx)(bl.ZP,{updateAiInferencesTaskStatus:s}),caption:void 0!==s.numPagesFilled&&void 0!==s.numPagesRequested&&(0,S.jsx)(bl.Y7,{updateAiInferencesTaskStatus:s}),...(0,lt.Z)(e,t)})}),action:async()=>{await yl.autofillPropertyForCollection({environment:a,collectionStore:g,propertySchema:h,property:o})}}):t.push({key:"autofill_with_ai",render:e=>(0,S.jsx)(ut.Z,{disabled:void 0===g,title:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Set up AI autofill",id:"database.tableHeaderCell.autofillWithAI"}),(0,S.jsx)(Tl.Z,{style:{display:"inline-block"}})]}),icon:(0,cl.y)({width:14,fill:c.aiPurpleColor}),...e}),action:()=>{g&&(e.close(),D.r$({collectionContextStore:i,collectionSettingsStore:u}),D.H4({collectionSettingsStore:u,item:{type:"properties",timelineViewTab:"table"}}),D.H4({collectionSettingsStore:u,item:{type:"property",formatKey:n,property:o}}),"text"===h.type&&D.H4({collectionSettingsStore:u,item:{type:"propertyAiAutofill",propertySchema:h,property:o}}))}})}}if(p.canConfigureBlock){const t=[];b.push(t),t.push({key:"sort_asc",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Sort ascending",id:"database.tableHeaderCell.sortAscending"}),icon:(0,rl.Z)({width:14})}),action:()=>{I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_asc"}),e.close(),this.handleSortAscending()}}),t.push({key:"sort_desc",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Sort descending",id:"database.tableHeaderCell.sortDescending"}),icon:(0,vo.M)({width:14})}),action:()=>{I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_sort_desc"}),e.close(),this.handleSortDescending()}}),t.push({key:"filter",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Filter",id:"database.tableHeaderCell.filter"}),icon:(0,sl.Q)({width:14})}),action:()=>{"collectionVirtualView"!==i.contextType&&(I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_filter"}),e.close(),this.handleAddFilter())}})}const w=[];if(b.push(w),(s||"title"!==h.type)&&p.canConfigureBlock&&w.push({key:"hide",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Hide in view",id:"database.tableHeaderCell.hideInView"}),icon:(0,nl.L)({width:22,marginLeft:-4,marginRight:-4})}),action:()=>{I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_hide"}),e.close(),this.handleHide()}}),this.isFreezeColumnsEnabled.state&&p.canConfigureBlock){const e=this.canFreezeThisColumn.state;w.push({key:"freeze_column",render:t=>(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Left,disableTooltip:!e,renderTooltip:e=>(0,S.jsx)(R.FormattedMessage,{...e,defaultMessage:"Insufficient space to freeze columns",id:"database.tableHeaderCell.freezePropertyTooltip",description:"If the width of the frozen columns is wider than the screen, show the user this tooltip warning."}),render:o=>(0,S.jsx)(ut.Z,{...t,...o,disabled:e,buttonStyle:{color:e?this.theme.text.disabled:void 0},title:this.isRightmostFrozen.state?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{numberFrozenColumns, plural, one {Unfreeze column} other {Unfreeze columns}}",values:{numberFrozenColumns:this.props.columnIndex+1},id:"database.tableHeaderCell.unfreezeColumns"}):(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Freeze up to column",id:"database.tableHeaderCell.freezeUpToColumn"}),icon:this.isRightmostFrozen.state?(0,pl.A)({width:14}):(0,hl.P)({width:12,margin:"0px 1px"})})}),action:()=>{this.handleFreezeColumns()}})}if(!Rt.Tr.includes(h.type)||(0,Bt.dx)(h)||!p.canConfigureCollection||y||x||w.push({key:"duplicate",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.tableHeaderCell.duplicateProperty"}),icon:(0,il.a)({width:14})}),action:async()=>{I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_duplicate"}),e.close(),await this.handleDuplicate()}}),Rt.Tr.includes(h.type)&&p.canConfigureCollection&&!y&&!x&&w.push({key:"delete",render:e=>(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Left,disableTooltip:!C,renderTooltip:e=>(0,ae.A7)(f,e),render:t=>(0,S.jsx)(ut.Z,{...e,...t,disabled:C,disabledFeedback:C,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Delete property",id:"database.tableHeaderCell.deleteProperty"}),caption:this.environment.device.isMobile&&C?(0,ae.A7)(f):null,icon:C?(0,S.jsx)("div",{...t,children:(0,al.Q)({width:14})}):(0,Eo.y)({width:14})})}),action:async()=>{e.close(),await this.handleDelete()}}),p.canConfigureBlock&&"timeline"!==m.getType()){const e=[];b.push(e),e.push({key:"wrap_cell",render:e=>(0,S.jsx)(Rl.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Wrap column",id:"database.tableHeaderCell.wrapColumn"}),on:v}),action:()=>{Sl.K4({currentValue:v,environment:this.environment,property:o,collectionViewStore:m,format:l,formatKey:n}),I.wd({environment:this.environment,collectionContextStore:i,action:"table_header_wrap_column"})}})}return b}createSort(e){const{property:t,collectionContextStore:o,schema:r}=this.props;if(!r[t])return;const i=[{property:t,direction:e?"ascending":"descending"}];o.filtersBarOpen.setState(!0),ml.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,sorts:{value:i}}}),_.n1({collectionContextStore:o})}}Vl.displayName="TableHeaderCellMenu";const Bl=(0,R.injectIntl)(Il);var Fl=o(35011),jl=o(58299);class Dl extends n.Z{constructor(){super(...arguments),this.resizeStartLeftFormat=void 0,this.storeTypes={mouseStore:Ve.Z,resultStore:a.default.createClass(void 0)},this.handleDragStart=e=>{e.preventDefault(),this.resizeStartLeftFormat=this.props.leftFormat,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!0})},this.handleDragMove=e=>{const t=this.getNewFormat(e);t&&this.props.onTemporaryResize(t)},this.handleDragEnd=e=>{const t=this.getNewFormat(e);t&&this.props.onAccept(t),this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDragCancel=()=>{this.props.onCancel(),this.resizeStartLeftFormat=void 0,this.stores.mouseStore.setState({...this.stores.mouseStore.state,mousePressed:!1})},this.handleDoubleClick=()=>{const e=this.stores.resultStore.state?this.stores.resultStore.state.blockIds:[],t=C.oA(e.map((e=>{const t=jl.Z.findBlockPropertyValueByBlockId(e,this.props.leftFormat.property),o=null==t?void 0:t.getNode();if(o)return this.calculateMaxWidth(o)})));if(this.props.leftFormat.width){const e={...this.props.leftFormat,width:Math.min(800,Math.max(Math.max(...t),Al(this.props.propertySchema,this.props.leftFormat)))};this.props.onAccept(e)}}}renderComponent(){const{device:e}=this.environment,{mouseEntered:t,mousePressed:o}=this.stores.mouseStore.state,r=(o||t)&&!e.isPhone;return(0,S.jsx)("div",{style:Dl.style,onMouseMove:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}),onMouseLeave:()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}),children:(0,S.jsx)(Oi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:e=>(0,S.jsx)("div",{style:r?this.getInnerActiveStyle():this.getInnerStyle(),onDoubleClick:this.handleDoubleClick,...e})})})}getInnerStyle(){return{width:5,marginLeft:-3,marginTop:-1,height:this.props.height,transition:"background 200ms ease-out",background:_o.ZP.blueWithAlpha(0),cursor:"col-resize"}}getInnerActiveStyle(){return{...this.getInnerStyle(),background:_o.ZP.blueWithAlpha(.8)}}calculateMaxWidth(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const r=getComputedStyle(e);for(let s=0;s<r.length;s++){const e=r[s],o=r.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative"),t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const i=t.querySelectorAll("*");for(const s of i)s.style&&(s.style.pointerEvents="none",s.style.width="auto");document.body.appendChild(t);const n=t.getBoundingClientRect();return t.remove(),null!=n&&n.width?Math.ceil(n.width):void 0}getNewFormat(e){if(this.resizeStartLeftFormat&&this.resizeStartLeftFormat.width){const t=Math.max(this.resizeStartLeftFormat.width+e.diffX,Al(this.props.propertySchema,this.props.leftFormat));return{...this.resizeStartLeftFormat,width:t}}}getTableColumnMinWidth(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Fl.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}}function Al(e,t){if("checkbox"===(null==e?void 0:e.type)||"status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return 32;var o;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,Fl.mm)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return 32;return"auto_increment_id"===(null==e?void 0:e.type)?64:100}Dl.displayName="TableHeaderResizer",Dl.style={position:"absolute",right:0,width:0,flexGrow:0,zIndex:1};const _l=Dl;var Ll=o(81415),Zl=o(84169);function El(e){window.__c={n:"LearnMoreLink"};const{href:t,style:o}=e,r=(0,co.yK)((e=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:e.mediumTextColor}})),[]);return(0,S.jsxs)("a",{href:t,target:"_blank",style:{...r.default,...o},children:[(0,Zl.m)({width:14,marginRight:4}),(0,S.jsx)(R.FormattedMessage,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}var Ol=o(71424);function zl(e){window.__c={n:"WikiPropertiesOnboardingTooltip"};const{origin:t,propertyType:o}=e,r=(0,uo.O7)();return(0,S.jsx)(Ll.U,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,S.jsx)(R.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,S.jsx)(R.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,S.jsx)(R.FormattedMessage,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,vr.t1)(o)}}(),content:function(){switch(o){case"owner":return(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty",values:{bold:e=>(0,S.jsx)("span",{style:{fontWeight:P.Z.fontWeight.semibold},children:e})}});case"verification":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,S.jsx)(El,{href:(0,un.UY)("guides.wikis"),style:{color:_o.ZP.uiLightGray}})]});case"tags":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,S.jsx)(El,{href:(0,un.UY)("guides.databaseProperties"),style:{color:_o.ZP.uiLightGray}})]});default:(0,vr.t1)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,vr.t1)(o)}}(),onCloseClick:()=>{$s.nX(r)},onPrimaryButtonClick:()=>$s.Rg(r),onBackButtonClick:()=>$s.FO(r),shouldDismissUponOutsideClick:!0,pointerLength:Ol.EZ,pointerOffset:Ol.FD,style:{width:Ol.G5}})}class Gl extends n.Z{constructor(){super(...arguments),this.storeTypes={tableHeaderRowStore:Qs,resultStore:a.default.createClass(void 0)},this.propertyRef=r.createRef(),this.renderHeaderRowCells=(e,t,o)=>{var r,i,n,s;const{device:l}=this.environment,{store:a,collectionContextStore:c,schema:h,query:p,resultStore:u,disabled:m,formatKey:g,disableCellRightBorder:y,renderSpacer:v,allowHidingTitle:f,paddingTop:C}=this.props,x=this.getCurrentFormat(),b=this.props.showPropertyFormatsStore.state[t],w=t===o.length-1,k=$s.B1(),P=(null===(r=c.collectionStore())||void 0===r?void 0:r.getFormat().app_config_uri)===d.GZ&&a.isCollectionViewPageWithContent()&&a.id===(null===(i=c.collectionViewBlockStore())||void 0===i?void 0:i.id),T=P&&e===Ks.k.Owner&&"owner"===k,R=P&&"verification"===(null===(n=h[e])||void 0===n?void 0:n.type)&&"verification"===k,M=P&&"multi_select"===(null===(s=h[e])||void 0===s?void 0:s.type)&&"tags"===k,I=!l.isMobile&&(T||R||M),V=(0,S.jsxs)(S.Fragment,{children:[I&&(0,S.jsx)(zl,{origin:this.propertyRef,propertyType:k}),b&&b.width&&(0,S.jsx)(Bl,{format:x,schema:h,query:p,property:e,width:b.width,collectionViewBlockStore:a,collectionContextStore:c,disabled:m,formatKey:g,isLast:w,disableCellRightBorder:y,allowHidingTitle:f,renderSpacer:v,paddingTop:C,columnIndex:t,resultStore:u,groupsPointer:this.groupsPointerStore.state}),!m&&!l.isPhone&&(0,S.jsx)(_l,{leftFormat:b,onTemporaryResize:this.handleTemporaryColumnResize,onAccept:this.handleColumnResizeAccept,onCancel:this.handleTemporaryColumnResizeCancel,height:this.props.height,propertySchema:h[e],resultStore:u})]});return(0,S.jsx)("div",{style:this.getHeaderCellWrapStyle(),ref:I?this.propertyRef:void 0,children:V},e)},this.handleColumnReorder=e=>{const{collectionContextStore:t,formatKey:o}=this.props,r=t.collectionViewStore();if(!r)return;const i={...this.getCurrentFormat(),[o]:C.MR(this.getProperties(),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0}))};W.createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:this.environment,perform:e=>{_.iG({collectionViewStore:r,update:{format:i},transaction:e})}}),I.wd({environment:this.environment,collectionContextStore:t,action:"table_reorder_columns"})},this.handleTemporaryColumnResize=e=>{this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:this.getNewResizeFormat(e)})},this.handleColumnResizeAccept=e=>{const{collectionContextStore:t,formatKey:o}=this.props,r=t.collectionViewStore();if(!r)return;const i={...this.getCurrentFormat(),[o]:this.getProperties().map((t=>t.property===e.property?e:t))};W.createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:this.environment,perform:e=>{_.iG({collectionViewStore:r,update:{format:i},transaction:e})}}),this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:void 0}),I.wd({environment:this.environment,collectionContextStore:t,action:"table_resize_columns"})},this.handleTemporaryColumnResizeCancel=()=>{this.props.tableStore.setState({...this.props.tableStore.state,temporaryFormat:void 0})},this.handleAddColumnClick=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();t&&(N.ZH(this.environment),H.ZH(this.environment),_.wG(),I.wd({environment:this.environment,collectionContextStore:e,action:"click_new_property"}),D.wl({collectionSettingsStore:e.settingsStore,item:{type:"propertyType",propertyTypes:(0,Rt.TP)({isSyncedCollection:t.isSyncedCollection(),collectionContextStore:e,environment:this.environment}),onAccept:(t,o)=>{Us.PW({environment:this.environment,collectionContextStore:e,propertyType:t,propertyName:o,from:"table"})}}}))},this.handleConfigureColumnsClick=()=>{const{collectionContextStore:e}=this.props;D.r$({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),I.wd({environment:this.environment,collectionContextStore:e,action:"click_table_header_dot_menu"}),D.H4({collectionSettingsStore:e.settingsStore,item:{type:"properties",timelineViewTab:"timeline"}})},this.captureEditorMouseDown=e=>{(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{}})},this.shouldShowMultiSelectCheckboxStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,le.fk)({environment:this.environment,collectionContextStore:e})})),this.groupsPointerStore=this.createComputedStore((()=>{const{groupFormat:e}=this.props;return e?[e]:[]}),!0),this.showPropertiesStore=this.createComputedStore((()=>this.props.showPropertyFormatsStore.state.map((e=>e.property))),!0)}renderComponent(){const{disabled:e,showRightActions:t,disableHorizontalEdgeScroll:o,collectionContextStore:r,frozoneProps:i}=this.props,n=r.permissionScopes.state,s=this.environment.device.isMobile,l=r.frozoneStore.state,a=(0,le.bW)(l.frozenIndex),c={...(0,le.eL)(s,"table")?(0,xo.oc)({environment:this.environment,collectionContextStore:r,isMobile:s,stickyLeft:this.shouldShowMultiSelectCheckboxStore.state?xo.Xx:0,theme:this.theme}):{}},d=this.showPropertiesStore.state.slice(0,a),h=this.showPropertiesStore.state.slice(a),p=!e&&t?(0,S.jsxs)(S.Fragment,{children:[this.renderAddColumnButton(),this.renderConfigureColumnsButton()]}):null,u=this.shouldShowMultiSelectCheckboxStore.state&&(0,S.jsx)(Hl,{groupsPointer:this.groupsPointerStore.state,collectionContextStore:r,frozoneProps:i});return e||!n.canConfigureBlock?(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{className:ee.kUP,style:this.getHeaderRowStyle(),children:[(0,S.jsx)("div",{style:{...(0,xo.oc)({environment:this.environment,collectionContextStore:r,isMobile:s,stickyLeft:0,theme:this.theme}),...(0,le.Ql)(l.frozenIndex)?{}:{background:void 0}},children:u}),(0,S.jsxs)("div",{style:wi.l8,children:[(0,S.jsx)("div",{style:{display:"flex",...c},children:d.map(this.renderHeaderRowCells)}),h.map(((e,t,o)=>this.renderHeaderRowCells(e,t+a,o)))]}),p,this.props.children]})}):(0,le.Ql)(l.frozenIndex)?(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{className:ee.kUP,style:this.getHeaderRowStyle(),children:[(0,S.jsx)("div",{style:(0,xo.oc)({environment:this.environment,collectionContextStore:r,isMobile:s,stickyLeft:0,theme:this.theme}),children:u}),(0,S.jsx)(Ys.Z,{style:{display:"flex"},direction:"horizontal",keys:this.showPropertiesStore.state,sectionedKeys:{frozen:d,unfrozen:h},sectionStyles:{frozen:{display:"flex",...c},unfrozen:{display:"flex"}},renderKey:this.renderHeaderRowCells,onDrop:this.handleColumnReorder,disableHorizontalEdgeScroll:o}),p,this.props.children]})}):(0,S.jsx)(ir,{position:Xe.Top,children:(0,S.jsxs)("div",{className:ee.kUP,style:{...this.getHeaderRowStyle()},children:[u,(0,S.jsx)(wi.ZP,{direction:"horizontal",keys:this.showPropertiesStore.state,renderKey:this.renderHeaderRowCells,onDrop:this.handleColumnReorder,disableHorizontalEdgeScroll:o}),p,this.props.children]})})}renderAddColumnButton(){return(0,S.jsx)(Qt.Z,{style:this.getAddColumnStyle(),onMouseDown:this.captureEditorMouseDown,onClick:this.handleAddColumnClick,className:ee.V6y,children:(0,S.jsx)("div",{style:Gl.addColumnIconWrapStyle,children:(0,Je.R)({width:12,fill:this.theme.mediumIconColor})})})}renderConfigureColumnsButton(){return(0,S.jsx)(Qt.Z,{style:this.getConfigureColumnsStyle(),onMouseDown:this.captureEditorMouseDown,onClick:this.handleConfigureColumnsClick,className:ee.V6y,children:(0,S.jsx)("div",{style:Gl.addColumnIconWrapStyle,children:(0,m.o)({width:12,fill:this.theme.mediumIconColor})})})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.tableStore.state;return t||e}getNewResizeFormat(e){const{formatKey:t}=this.props;return{...this.getCurrentFormat(),[t]:this.getProperties().map((t=>t.property===e.property?e:t))}}getProperties(){const{formatKey:e}=this.props;return this.getCurrentFormat()[e]||[]}getHeaderCellWrapStyle(){return{display:"flex",position:"relative"}}getHeaderRowStyle(){var e;const{collectionContextStore:t,isInPeekRenderer:o,height:r,minWidth:i,disableTopBorder:n}=this.props,s=t.collectionViewStore();if(!s)return{};const l=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return{display:"flex",position:"absolute",background:l,zIndex:T.VT+1,height:r-1,color:this.theme.mediumTextColor,borderTop:n?void 0:`1px solid ${this.theme.tableDividerColor}`,boxShadow:`\n\t\t\t\t-3px 0 0 ${l},\n\t\t\t\t0 1px 0 ${this.theme.tableDividerColor}\n\t\t\t`,minWidth:i,left:"timeline"===s.getType()?void 0:0,right:"timeline"===s.getType()?void 0:0}}getAddColumnStyle(){return{display:"flex",justifyContent:"flex-start",width:32}}getConfigureColumnsStyle(){return{display:"flex",justifyContent:"flex-start",flexGrow:1,width:32}}}function Hl(e){window.__c={n:"GroupSelectCheckbox"};const{groupsPointer:t,collectionContextStore:o,frozoneProps:i}=e,n=(0,uo.O7)(),s=(0,r.useCallback)((()=>(0,Co.A7)(t[0],o)),[o,t]),l=(0,ct.VK)((()=>{const e=s(),t=e.length;if(0===t)return!1;const o=Ht.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")}),[s]),a=(0,ct.VK)((()=>o.frozoneStore.state.frozenIndex),[o]),c=(0,ct.VK)((()=>{var e;return(0,le.eL)(n.device.isMobile,null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType())&&!(0,le.Ql)(a)}),[o,n.device.isMobile,a]),d=(0,r.useCallback)((e=>{var t;const r=s(),i=Ht.default.state.stores,a=(0,xo.vg)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:i;!1===l||"indeterminate"===l?H.Z5({environment:n,stores:C.G0(a,r)}):!0===l&&H.Z5({environment:n,stores:C.zu(a,...r)}),e.stopPropagation()}),[l,o,n,s]),h=(0,co.Fg)(),p=(0,ct.VK)((()=>({...c?(0,xo.oc)({environment:n,collectionContextStore:o,isMobile:n.device.isMobile,stickyLeft:0,theme:h}):{},background:void 0})),[c,o,n,h]);return(0,S.jsx)("div",{style:p,children:(0,S.jsx)(el,{checkedState:l,onClick:d,checkboxType:"group",collectionContextStore:o,frozoneProps:i})})}Gl.displayName="TableHeaderRow",Gl.contextTypes={...n.w,...Q.xm},Gl.addColumnIconWrapStyle={display:"flex",width:32,height:"100%",alignItems:"center",justifyContent:"center"};const Nl=(0,R.injectIntl)(Gl);var Wl=o(73959),Kl=o(86486),Ul=o(29370);function $l(e){window.__c={n:"FrozenColumnSelection"};const t=(0,uo.Fy)().isMobile,o=(0,Q.DK)();return(0,ct.VK)((()=>{var e;const r=null==o||null===(e=o.collectionViewStore())||void 0===e?void 0:e.getType();return(0,le.eL)(t,r)}),[o,t])?(0,S.jsx)(En.Z,{enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:Po.Z.opacitySpringConfig},isVisible:!0,render:()=>(0,S.jsx)("div",{style:{display:"flex",background:e.isCollectionViewBlockSelected?_o.ZP.blueWithAlpha(.14):void 0},children:e.children})},"halo"):(0,S.jsx)(S.Fragment,{children:e.children})}class ql extends Oe.Z{activate(){const{collectionContextStore:e,handleOpenPeekPage:t,store:o}=this.props,{mainEditorCurrentBlockStore:r}=fe.default.state,i=le.mb({store:o,mainEditorCurrentBlockStore:r,collectionContextStore:e,fullyQualified:!1});i&&(t(),O.navigate({environment:this.environment,url:i}))}renderPersisted(){return(0,S.jsx)(Ql,{...this.props})}}function Ql(e){window.__c={n:"TableRowFunctional"};const{disabled:t,store:o,groupFormat:i,collectionContextStore:n,propertyFormats:s,showRightActionsSpacer:l,disableTableWrap:a,frozoneProps:c,...d}=e,h=(0,ct.VK)((()=>!t&&o.canEdit()),[t,o]),p=(0,ct.VK)((()=>(0,Co.A7)(i,n).findIndex((e=>e===o))),[n,i,o]),u=(0,ct.VK)((()=>{const e=n.collectionViewBlockStore();return!!e&&(0,Wl.sY)(e)}),[n]),m=(0,ct.VK)((()=>n.frozoneStore.state.frozenIndex),[n]),g=(0,ct.VK)((()=>{const{collectionContextStore:t,groupFormat:o}=e,r=Ul.Z.state,i=t.collectionViewBlockStore();if(!i)return!1;if(!r.isActive||!(0,Ul.N)(r.selectionKey,{collectionViewBlockStore:i,groupFormat:o}))return!1;const{selection:n}=r,{start:s}=n;return le.Ql(m)&&p===s.row&&s.col<=m}),[e,m,p]),y=(0,ct.VK)((()=>le.bW(m)),[m]),v=(0,r.useMemo)((()=>null!=c&&c.shouldFreeze?{...c.frozenStyles,...g?{zIndex:`${T.I5+1}`}:{},...le.Ql(m)?{}:{background:void 0}}:{}),[m,null==c?void 0:c.frozenStyles,null==c?void 0:c.shouldFreeze,g]),[f,C]=(0,r.useMemo)((()=>null!=c&&c.shouldFreeze&&void 0!==m?[s.slice(0,m+1),s.slice(m+1)]:[[],s]),[m,s,null==c?void 0:c.shouldFreeze]),x=(0,ct.VK)((()=>{var e;return Boolean(!a&&(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue()))}),[n,a]),b=(0,ct.VK)((()=>{var e;return Boolean("timeline"===(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType())||!x&&!s.some((e=>e.wrap)))}),[n,s,x]),w=(0,ct.VK)((()=>{const e=n.permissionScopes.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[n.permissionScopes]);return(0,S.jsxs)(r.Fragment,{children:[(0,S.jsx)("div",{className:ee.zwY,style:{display:"flex"},children:(0,S.jsxs)("div",{style:{display:"flex"},children:[(0,S.jsx)("div",{style:null!=c&&c.shouldFreeze?v:{},children:(0,S.jsx)($l,{isCollectionViewBlockSelected:u,children:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ea,{store:o,frozoneProps:c}),(0,S.jsx)(Yl,{store:o,canEdit:h,propertyFormats:f,shouldSetCellHeight:b,indexAddendum:0,rowIndex:p,disabled:t,groupFormat:i,disableTableWrap:a,isLocked:w,isCollectionViewBlockSelected:u,...d})]})})}),(0,S.jsx)(Yl,{store:o,canEdit:h,propertyFormats:C,shouldSetCellHeight:b,indexAddendum:y,rowIndex:p,disabled:t,groupFormat:i,disableTableWrap:a,isLocked:w,isCollectionViewBlockSelected:u,...d})]})}),l&&!w&&(0,S.jsx)(ta,{})]})}function Yl(e){window.__c={n:"TableRowValues"};const{blockPropertyValueOverlayStore:t,propertyFormats:o,store:r,disableTableWrap:i,shouldSetCellHeight:n,indexAddendum:s,...l}=e,a=(0,Q.Y$)(),c=(0,ct.VK)((()=>a.collectionViewStore()),[a]),d=(0,ct.VK)((()=>r.getAssociatedCollectionStore()),[r]),h=(0,ct.VK)((()=>!!c&&Boolean(!i&&c.getFormatStore().getKeyStore("table_wrap").getValue())),[c,i]),p=(0,ct.VK)((()=>{const e=Kl.default.state;return Boolean(e.isOpen&&e.currentStore===r)}),[r]),u=(0,ct.VK)((()=>!t.state.isOpen&&Ht.default.state.stores.length>0&&Ht.default.state.stores[0].id===r.id),[r.id,t]),m=(0,ct.VK)((()=>a.currentSubitemFormatStore.state),[a.currentSubitemFormatStore]),g=(0,ct.VK)((()=>(0,J.$4)()&&"title"===(null==c?void 0:c.getFormat().table_subitem_toggle_column)),[c]),y=(0,ct.VK)((()=>a.frozoneStore.state.frozenIndex),[a]);return(0,S.jsx)(S.Fragment,{children:o.map(((e,o)=>(0,S.jsx)(Xl,{index:o+(s??0),store:r,propertyFormat:e,isLastColumn:o+(s??0)===length-1,isRightMostFrozenColumn:le.Ql(y)&&y===o+(s??0),collectionViewStore:c,collectionStore:d,tableWrap:h,shouldSetCellHeight:n,isShowingHoverMenu:p,shouldCaptureKeyboard:u,subitemFormat:m,isSubitemToggleOnTitleColumn:g,blockPropertyValueOverlayStore:t,...l},e.property)))})}ql.displayName="TableRow";const Xl=e=>{window.__c={n:"TableRowValue"};const{propertyFormat:t,index:o,canEdit:i,isLastColumn:n,isRightMostFrozenColumn:s,store:l,schema:a,disabled:c,disableCellBorderRight:d,subitemPath:h,onShiftEnter:p,tableWrap:u,subitemFormat:m,isShowingHoverMenu:g,shouldCaptureKeyboard:y,isLocked:v,toggleButton:f,onPropertyClick:x,titleColumnIndex:b,isSubitemToggleOnTitleColumn:w,disableLastCellBorderRight:k,onPropertyTab:P,onPropertyUntab:T,onPropertyEnter:R,onPropertyEsc:M,onPropertyBgClick:I,onPropertyContextMenu:V,collectionViewStore:B,collectionStore:F,blockPropertyValueOverlayStore:j,shouldSetCellHeight:D,onOpenProperty:A,disableHorizontalEdgeScroll:_,handleOpenPeekPage:L,groupFormat:Z,rowIndex:E,isCollectionViewBlockSelected:O}=e,{width:z,property:G,wrap:H}=t,N=(0,Q.Y$)(),W=(null==h?void 0:h.length)??0,K=m&&(0,xo.lO)({columnIndex:o,titleColumnIndex:b,isSubitemToggleOnTitleColumn:w}),U=(0,r.useMemo)((()=>{if(void 0!==z)return K?z-(0,xo.lZ)({columnIndex:o,indentLevel:W,titleColumnIndex:b,isSubitemToggleOnTitleColumn:w}):z}),[W,o,w,K,b,z]),$=(0,r.useMemo)((()=>K&&(0,S.jsx)(Jl,{subitemFormat:m,toggleButton:f,subitemPath:h})),[K,m,h,f]),q=(0,r.useCallback)((()=>x(l,G,a)),[x,G,a,l]),Y=c||!i,X=(0,ct.VK)((()=>{const e=Ul.Z.state,t=N.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Ul.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:Z}))return!1;const{selection:r}=e,{start:i,end:n}=r,s=E===i.row||E===n.row||C.Z2(E,i.row,n.row),l=o===i.col||o===n.col||C.Z2(o,i.col,n.col);return s&&l}),[N,Z,o,E]),J=(0,ct.VK)((()=>{const e=Ul.Z.state,t=N.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,Ul.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:Z}))return!1;const{selection:r}=e,{start:i}=r;return E===i.row&&o===i.col}),[N,Z,o,E]),te=(0,ct.VK)((()=>Boolean(null==N?void 0:N.frozoneStore.state.isScrolled)),[N]),oe=(0,ct.VK)((()=>{const e=N.frozoneStore.state.frozenIndex;return void 0!==e&&o<=e}),[N,o]),re=(0,co.yK)((e=>{const t=O?e.tableFrozenSelectedDividerColor:e.tableDividerColor;return{tableCell:{width:z||void 0,height:"calc(100% + 1px)",position:"relative",borderRight:d||s||n&&k?"none":`1px solid ${t}`,boxShadow:oe?`0 -1px 0 ${t}`:void 0,background:X?_o.ZP.blueWithAlpha(.07):void 0},tableSelectionOverlay:{borderRadius:J?3:void 0,boxShadow:J?e.outlineBlueInputBoxShadow:void 0,position:"absolute",pointerEvents:"none",left:0,top:0,width:"100%",height:"100%"},propertyValueContainer:{display:"flex",overflowX:"hidden",height:"100%",width:z||void 0}}}),[O,d,k,X,n,s,J,oe,z]),ie=(0,S.jsxs)(Yt.Z,{capture:y,onShiftEnter:p,children:[(0,S.jsx)(Ut.Z,{collectionStore:F,store:l,property:G,disabled:Y,locked:v,width:U,format:$t.C.Table,forceMouseEntered:"title"===G&&i?g:void 0,tableWrap:Boolean(u||H),isLast:n,disableTableBorderRight:d||s||n&&k||K,indentLevel:0===o&&h?h.length:void 0,onTab:P,onUntab:T,onEnter:R,onClick:q,onEsc:M,onBgClick:I,onContextMenu:V,collectionViewStore:B,shouldSetCellHeight:D,onOpenProperty:A,blockPropertyValueOverlayStore:j,disableHorizontalEdgeScroll:_,handleOpenPeekPage:L},G),s&&(0,S.jsx)(Js,{isScrolled:te})]});return(0,S.jsxs)("div",{className:ee.mWS,"data-row-index":E,"data-col-index":o,style:re.tableCell,children:[(0,S.jsxs)("div",{style:re.propertyValueContainer,children:[K&&$,ie]}),J&&(0,S.jsx)("div",{style:re.tableSelectionOverlay})]})};function Jl(e){const{toggleButton:t,subitemPath:o}=e,r=(null==o?void 0:o.length)??0,i=Math.max((r-1)*Co.Hw,0)+Co.gY;return t?(0,S.jsxs)("div",{style:{paddingTop:4,display:"flex"},children:[(0,S.jsx)("div",{style:{width:i}}),t]}):(0,S.jsx)("div",{style:{minWidth:i+Co.Hw}})}const ea=r.memo((e=>{window.__c={n:"RowSelectCheckboxMaybe"};const{store:t,frozoneProps:o}=e,i=(0,Q.Y$)(),n=(0,uo.O7)(),s=(0,ct.VK)((()=>Ht.default.state.stores.includes(t)),[t]),l=(0,ct.VK)((()=>le.fk({environment:n,collectionContextStore:i})),[i,n]),a=(0,r.useCallback)((e=>{var o;(0,xo.vg)({collectionViewBlockId:null===(o=i.collectionViewBlockStore())||void 0===o?void 0:o.id})?H.Z5({environment:n,stores:[t]}):H.Ys({environment:n,store:t,toggle:!0}),e.stopPropagation()}),[i,n,t]);return l?(0,S.jsx)(el,{checkedState:s,onClick:a,checkboxType:"single_row",collectionContextStore:i,frozoneProps:o}):null}));function ta(){return(0,S.jsx)("div",{style:{display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}})}const oa=ql;var ra=o(12137),ia=o(55061),na=o(11302),sa=o(39865),la=o(4708),aa=o(80796),ca=o(11368);const da=function(e){window.__c={n:"FrozenColumnRepositioner"};const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:i,xForFirstCellInRow:n,showPropertyFormats:s,frozenSectionWidth:l}=e,a=(0,uo.O7)(),c=(0,Q.DK)(),d=(0,r.useRef)(null),h=(0,r.useRef)(null),[p,u]=r.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[m,g]=r.useState(0),[y,v]=r.useState(0),f=(0,ct.VK)((()=>t.state.isRepositioning||p.isMouseDown),[t,p.isMouseDown]),x=(0,ct.VK)((()=>t.state.newFrozenIndex),[t]),b=(0,ct.VK)((()=>null==c?void 0:c.frozoneStore.state.isScrolled),[c]),w=(0,ct.VK)((()=>b&&-1===o?10:0),[o,b]),k=(0,ct.VK)((()=>p.isEntered||f),[p.isEntered,f]),M=(0,ct.VK)((()=>t.state.newFrozenColumnXPosition),[t]),I=(0,r.useContext)(ca.Ue),V=(0,ct.VK)((()=>null==I?void 0:I.horizontalScroller),[I]),B=(0,r.useCallback)((()=>{var e,t,o;if(!V||!d.current)return 0;const r=(null===(e=d.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,i=null===(t=V.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(ee.kUP);return(i&&i.length>0?null===(o=i[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-r}),[V]),F=(0,r.useCallback)((()=>{var e,t,o,r,i;if(!V||!d.current)return 0;const n=(null===(e=d.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,s=null===(t=V.scrollerEl())||void 0===t?void 0:t.getElementsByClassName(ee.zwY),l=s&&s.length>0?null===(o=s[s.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,a=null===(r=V.scrollerEl())||void 0===r?void 0:r.getElementsByClassName(ee.Gcz),c=a&&a.length>0?null===(i=a[a.length-1].getBoundingClientRect())||void 0===i?void 0:i.bottom:0;return Math.max(l,c)-n}),[V]),j=(0,ct.VK)((()=>{var e;const t=null===(e=d.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==l?new DOMRect(t.x+l+p.x+10,t.y+p.y+10,3,3):void 0}),[l,p]),D=(0,ct.VK)((()=>{const e=(null==c?void 0:c.frozoneStore.state.scrollerLeftOffset)??0,t=(0,ye.Wk)(a),o=Math.max(t-e,0);return c&&(0,xo.iZ)(a,c)?o:0}),[c,a]),A=(0,r.useCallback)((e=>{if(void 0===o||void 0===i||void 0===l||null===d.current||null===h.current)return;const r=d.current.getBoundingClientRect(),a=e.clientX-r.x;if(null==c||c.frozoneStore.setState({...null==c?void 0:c.frozoneStore.state,tryShowHiddenFrozenColumn:a<42}),!k)return;const p=B();g(p);const m=F();v(m);const S=2+l,y=Math.max(a-S,-S),C=e.clientY-r.y-14,x=r.bottom-r.top-14+m,P=f?p:-14,T=Math.max(Math.min(C,x),P);if(u((e=>({...e,x:f?y:0,y:T}))),f){const e=s,r=h.current.getBoundingClientRect();let c=a,d=n+w,p=-1,u=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>i);t++){const i=e[t];d+=(null==i?void 0:i.width)??0,b&&t===o+1&&(c-=r.x);const n=Math.abs(d-c);n<m&&(m=n,u=d,p=t)}t.setState({...t.state,newFrozenIndex:p,newFrozenColumnXPosition:u-l-1})}}),[o,i,l,null==c?void 0:c.frozoneStore,k,B,F,f,s,n,w,t,b]);(0,r.useEffect)((()=>{const e=C.P2((e=>{A(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[A]);const _=(0,r.useCallback)((e=>{f||(A(e.nativeEvent),u((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[f,A]),L=(0,r.useCallback)((e=>{f||u((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[f]),Z=(0,r.useCallback)((e=>{u((e=>({...e,isMouseDown:!0})))}),[]),E=(0,r.useCallback)((e=>{f&&u((e=>({...e,isEntered:!0})))}),[f]),O=(0,r.useCallback)((e=>{u((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),z=(0,r.useCallback)((e=>{f&&u((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[f]),G=void 0!==x&&void 0!==o&&x<=o,H=(0,co.yK)((e=>({repositionerContainer:{zIndex:T.I5+4,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:f?"grabbing":"grab",pointerEvents:f?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",left:D,height:"100%"},tooltipContainer:{position:"absolute",left:l??0,zIndex:T.xP,height:"100%"},tooltipOrigin:{position:"absolute",left:-3,top:0,width:8,pointerEvents:"auto",cursor:f?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",left:f?p.x-1:-1,top:f?m:0,width:2,height:f?`calc(100% + ${y-m}px`:"100%",background:"dark"===e.mode?e.accentColors.gray[500]:e.accentColors.gray[200]},ghostColumnBase:{position:"absolute",top:f?m:0,width:1,height:f?`calc(100% + ${y-m}px`:"100%",background:e.accentColors.blue[300]},frozenGhostColumn:{left:M,opacity:f&&G?1:0},unfrozenGhostColumn:{left:(l??0)+(M??0),opacity:k&&f&&!G?1:0},tooltipDraggable:{position:"absolute",left:f?p.x-2:-2,top:p.y,width:4,height:28,background:e.accentColors.blue[400],borderRadius:3},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...P.Z.textOverflowStyle}})),[f,D,l,p,m,y,k,M,G]);return(0,S.jsx)("div",{className:ee.wXs,style:H.repositionerContainer,onMouseEnter:E,onMouseLeave:O,onMouseUp:z,children:(0,S.jsxs)("div",{style:H.repositionerOutsideStickyWrapper,ref:h,children:[(0,S.jsx)("div",{style:H.repositionerInsideStickyWrapper,ref:d,children:(0,S.jsx)(xt.Z,{renderTooltip:()=>f&&void 0!==x&&x!==o?(0,S.jsx)(R.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:x+1}}):(0,S.jsx)(R.FormattedMessage,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:f||void 0,placement:Zs.u.Right,originRect:j,render:e=>(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{translateX:w,opacity:k?1:0},render:()=>(0,S.jsxs)("div",{...e,style:H.tooltipContainer,children:[(0,S.jsx)("div",{style:H.tooltipOrigin,onMouseEnter:_,onMouseLeave:L,onMouseDown:Z}),(0,S.jsx)("div",{style:{...H.ghostColumnBase,...H.frozenGhostColumn}}),(0,S.jsx)("div",{style:H.tooltipColumn}),(0,S.jsx)("div",{style:H.tooltipDraggable})]})})})}),(0,S.jsx)("div",{style:{...H.ghostColumnBase,...H.unfrozenGhostColumn}})]})})};var ha=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}(ha||{});class pa extends n.Z{constructor(){super(...arguments),this.rowsWrapEl=null,this.observer=void 0,this.storeTypes={dragAndFillStore:a.default.createClass(void 0),frozenColumnRepositionStore:a.default.createClass({isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0})},this.handleDragStart=e=>{if(e.preventDefault(),this.isTargetWithinFrozenColumnRepositioner(e.target))this.stores.frozenColumnRepositionStore.setState({isRepositioning:!0,newFrozenIndex:this.frozenIndex.state,newFrozenColumnXPosition:void 0}),this.scrollToStart(),aa.Z.setState({...aa.Z.state,disableHorizontalEdgeScroll:!0,disableVerticalEdgeScroll:!0});else{const t=this.normalizedTableSelectionStore.state;if(t&&this.isDragAndFillEnabled()&&this.isTargetWithinDragAndFillHandle(e.target))return void this.stores.dragAndFillStore.setState({...t})}_.wG()},this.handleDragMove=e=>{if(this.stores.frozenColumnRepositionStore.state.isRepositioning);else if(ue.X9()){var t;const o=this.getTableCellPositionFromTarget(e.target);if(!o)return;const r=this.stores.dragAndFillStore.state,i=(null==r?void 0:r.start)??(null===(t=this.normalizedTableSelectionStore.state)||void 0===t?void 0:t.start)??o;if(!i)return;const n=o;if(this.stores.dragAndFillStore.state&&i.col!==n.col)return;this.setSelection({selection:{start:i,end:n},shouldNormalize:!0})}},this.handleDragEnd=()=>{this.repositionFrozenColumns(),this.dragAndFillCells()},this.handleDragCancel=()=>{this.stores.dragAndFillStore.reset(),this.stores.frozenColumnRepositionStore.reset(),_.wG()},this.handleLeft=e=>{e.preventDefault&&e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Sl.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1,columnCount:this.getCurrentColumnCount()}),this.updateSelectionScroll(ha.Left))},this.handleRight=e=>{e.preventDefault&&e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Sl.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.getCurrentColumnCount(),rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(ha.Right))},this.handleUp=e=>{e.preventDefault&&e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Sl.zJ({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(ha.Up))},this.handleDown=e=>{e.preventDefault&&e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Sl.DI({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,rowCount:this.allRowsStore.state.length,shiftKey:"shiftKey"in e&&e.shiftKey||!1}),this.updateSelectionScroll(ha.Down))},this.handleEnter=e=>{e.preventDefault&&e.preventDefault(),Gt.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const r=this.allRowsStore.state,i=r[o.start.row],n=this.props.showPropertyFormatsStore.state[o.start.col].property,s=t[n];if(s&&!this.props.disabled)if(Bt.uk.includes(s.type)){if("checkbox"===s.type){const e=i.getPropertyStore(n),t=Sr.Ml(e.getValue()),s=r.slice(o.start.row,o.end.row+1);W.createAndCommit({userAction:"TableSelectionOverlay.handleEnter",environment:this.environment,perform:e=>{for(const o of s)We.sO({store:o.getPropertyStore(n),value:Sr._I(!t),transaction:e})}})}}else Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i,property:n,format:$t.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore}),_.wG()},this.handleTab=e=>{e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Sl.FC({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,columnCount:this.getCurrentColumnCount(),rowCount:this.allRowsStore.state.length,shiftKey:!1}),this.updateSelectionScroll(ha.Right))},this.handleUntab=e=>{e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(!t)return;const o=this.props.collectionContextStore.collectionViewBlockStore();o&&(Sl.e2({environment:this.environment,selectionKey:{collectionViewBlockStore:o,groupFormat:this.props.groupFormat},selection:t,shiftKey:!1,columnCount:this.getCurrentColumnCount()}),this.updateSelectionScroll(ha.Left))},this.handleEsc=e=>{const{device:t}=this.environment;if(t.isMobile)return;e.preventDefault(),Gt.Z.setKeyboardMode(!0);const o=this.normalizedTableSelectionStore.state;if(_.wG(),o){const e=(0,xo.AV)(o),t=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);H.Z5({environment:this.environment,stores:t})}},this.handleMoveTo=e=>{e.preventDefault&&e.preventDefault(),Gt.Z.setKeyboardMode(!0);const t=this.normalizedTableSelectionStore.state;if(_.wG(),t){const e=(0,xo.AV)(t),o=this.allRowsStore.state.slice(e.minRow,e.maxRow+1);if(0===o.length)return;H.Z5({environment:this.environment,stores:o});const r=Di.C.getRectFromStore(o[0]);na.bA({environment:this.environment,blocks:o,originRect:r,moveToContext:"action_menu"})}},this.handleDelete=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state;t&&!this.props.disabled&&W.createAndCommit({userAction:"TableSelectionOverlay.handleDelete",environment:this.environment,perform:e=>{Sl.NE({selection:t,schema:o,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,transaction:e})}})},this.handleCut=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,r=this.props.collectionContextStore.collectionViewBlockStore();r&&t&&!this.props.disabled&&W.createAndCommit({userAction:"TableSelectionOverlay.handleCut",environment:this.environment,perform:i=>{Sl.nA({selectionKey:{collectionViewBlockStore:r,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,event:e,transaction:i})}})},this.handleCopy=e=>{const t=this.normalizedTableSelectionStore.state,o=this.props.collectionContextStore.normalizedSchemaStore.state,r=this.props.collectionContextStore.collectionViewBlockStore();r&&t&&Sl.qn({selectionKey:{collectionViewBlockStore:r,groupFormat:this.props.groupFormat},schema:o,selection:t,currentPropertyFormats:this.props.showPropertyFormatsStore.state,currentRows:this.allRowsStore.state,event:e})},this.handlePaste=e=>{const{collectionContextStore:t,groupFormat:o,schema:r,showPropertyFormatsStore:i,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:s}=this.props,l=this.normalizedTableSelectionStore.state,a=this.props.collectionContextStore.collectionViewBlockStore();a&&l&&!this.props.disabled&&W.createAndCommit({userAction:"TableSelectionOverlay.handlePaste",environment:this.environment,perform:c=>{Sl.j0({environment:this.environment,collectionContextStore:t,selectionKey:{collectionViewBlockStore:a,groupFormat:o},selection:l,currentPropertyFormats:i.state,currentRows:this.allRowsStore.state,event:e,transaction:c,schema:r,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:s})}})},this.handleCommandEnter=e=>{const{device:t}=this.environment,o=this.normalizedTableSelectionStore.state;if(t.isMobile||!o)return;const{collectionContextStore:r}=this.props,i=this.allRowsStore.state[o.start.row],{mainEditorCurrentBlockStore:n}=fe.default.state,s=le.mb({store:i,mainEditorCurrentBlockStore:n,collectionContextStore:r,fullyQualified:!1});s&&this.navigate(s)},this.handleShiftEnter=()=>{const{device:e}=this.environment;if(e.isMobile)return;const t=this.normalizedTableSelectionStore.state;if(!t)return;if(!et.M_(this.environment))return;const{collectionContextStore:o,groupFormat:r}=this.props;if(!o.shouldAllowNewItemCreation())return;const i=this.allRowsStore.state,n=i[t.start.row],l=o.subitemTreeStore.state,a=(0,fo.DY)(l.children,(e=>e.value.store===n)),d="table_selection_overlay_shift_enter";if(a){const e=a?(0,Co.Af)(a.map((e=>e.value.store))):"",l=o.subitemExpandedStore.state.get(e),h=Boolean(null==l?void 0:l.isExpanded),p=[...a].splice(0,a.length-1),u=p?(0,Co.Af)(p.map((e=>e.value.store))):"",m=o.subitemExpandedStore.state.get(u),g=Boolean(null==m?void 0:m.isExpanded);if(h||g)W.createAndCommit({userAction:"TableSelectionOverlay.handleNestedItemShiftEnter",environment:this.environment,perform:e=>{const t=o.collectionStore();if(!t)return;const i=j.yk({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],store:n,before:!1,collectionStore:t,transaction:e,subitemPath:a,subitemInsertDirection:g&&!h?"below":"into"});i&&this.props.blockPropertyValueOverlayStore&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{Lt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i,property:"title",format:$t.C.Table,collectionContextStore:o})}))}))}});else{const e={col:t.end.col,row:o.currentViewHasSort()?i.length:t.end.row+1};W.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const i=j.IW({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],insertAtIndex:e.row,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:d});if(i&&!i.coercionSucceeded){const e=r?[r]:[],t=o.groupsStore.getGroupState(e);O.peekBlock({environment:this.environment,store:i.newStore,peekMode:le.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:c.tY.Create})}}}),s.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}}else{const e={col:t.end.col,row:o.currentViewHasSort()?i.length:t.end.row+1};W.createAndCommit({userAction:"TableSelectionOverlay.handleShiftEnter",environment:this.environment,perform:t=>{const i=j.IW({environment:this.environment,collectionContextStore:o,groupsPointer:r?[r]:[],insertAtIndex:e.row,coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:d});if(i&&!i.coercionSucceeded){const e=r?[r]:[],t=o.groupsStore.getGroupState(e);O.peekBlock({environment:this.environment,store:i.newStore,peekMode:le.kr(o.collectionViewStore()),resultsStore:null==t?void 0:t.resultsStore,collectionContextStore:o,pageVisitSource:c.tY.Create})}}}),s.default.afterNextFlush((()=>{this.setSelection({selection:{start:e,end:e},shouldNormalize:!1})}))}this.updateSelectionScroll(ha.Down),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handleDuplicate=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;o&&o.start.col===o.end.col&&!this.props.disabled&&et.M_(this.environment)&&(e.preventDefault(),W.createAndCommit({userAction:"TableSelectionOverlay.handleDuplicate",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:o,start:o.start})}}))},this.handleCommandShiftEnter=e=>{const{device:t}=this.environment;if(t.isMobile)return;const o=this.normalizedTableSelectionStore.state;if(o){const e=this.allRowsStore.state[o.start.row],t=(0,de.ZP)({store:e,fullyQualified:!1,pageVisitSource:c.tY.LinkInPage});O.navigateToExternalURL({environment:this.environment,url:t})}},this.handleKeypress=e=>{if(!e.key||e.metaKey||e.ctrlKey)return;e.preventDefault(),Gt.Z.setKeyboardMode(!0);const{schema:t}=this.props,o=this.normalizedTableSelectionStore.state;if(!o)return;const r=this.allRowsStore.state[o.start.row],i=this.props.showPropertyFormatsStore.state[o.start.col].property,n=t[i];n&&!this.props.disabled&&Bt.ub.includes(n.type)&&e.key&&1===e.key.length&&(Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:r,property:i,format:$t.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,insertChar:e.key,collectionContextStore:this.props.collectionContextStore}),_.wG())},this.handlePropertyTab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,r=this.getCellPositionOfStore(t,o),i=this.props.showPropertyFormatsStore.state,n={col:Math.min(r.col+1,i.length-1),row:r.row};this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(ha.Right),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyUntab=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(e.isOpen){const{store:t,property:o}=e,r=this.getCellPositionOfStore(t,o),i={col:Math.max(r.col-1,0),row:r.row};this.setSelection({selection:{start:i,end:i},shouldNormalize:!0}),this.updateSelectionScroll(ha.Left),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})}},this.handlePropertyEnter=()=>{const e=this.props.blockPropertyValueOverlayStore.state;if(!e.isOpen)return;const{store:t,property:o}=e,r=this.getCellPositionOfStore(t,o),i={col:r.col,row:r.row+1};s.default.afterNextFlush((()=>{this.shouldMoveSelectionToNextRow()&&this.setSelection({selection:{start:i,end:i},shouldNormalize:!0})})),this.updateSelectionScroll(ha.Down),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore})},this.handlePropertyClick=(e,t,o)=>{var r;const{device:i}=this.environment;if("checkbox"!==(null===(r=o[t])||void 0===r?void 0:r.type)||i.isMobile)_.wG();else{const o=this.getCellPositionOfStore(e,t);this.setSelection({selection:{start:o,end:o},shouldNormalize:!0})}},this.dismissPropertyOverlay=e=>{const{device:t}=this.environment,o=this.props.blockPropertyValueOverlayStore.state;if(o.isOpen){const{store:r,property:i}=o,n=this.getCellPositionOfStore(r,i);t.isMobile?_.wG():this.shouldMoveSelectionToNextRow()&&this.setSelection({selection:{start:n,end:n},shouldNormalize:!0}),this.updateSelectionScroll(ha.Down),Lt.xv({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),null==e||e(o)}},this.handlePropertyBgClick=()=>{this.dismissPropertyOverlay()},this.handlePropertyEsc=()=>{this.dismissPropertyOverlay((e=>{const{isNewBlock:t,store:o}=e;t&&o.isEmptyTitle()&&o.isEmptyPage()&&W.createAndCommit({userAction:"TableSelectionOverlay.handlePropertyEsc",environment:this.environment,perform:e=>{sa.y8({environment:this.environment,blocks:[o],transaction:e}),e.postSubmitCallbacks.push((e=>{if(!e){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();M.dhV(this.environment,{analyticsName:"delete",from:"collection_esc_shortcut",block_id:o.id,block_type:"page",collection_id:null==e?void 0:e.id,collection_view_id:null==t?void 0:t.id})}}))}})}))},this.handlePropertyOpenProperty=e=>{const t=this.props.blockPropertyValueOverlayStore.state;if(t.isOpen){const{store:o}=t;Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:o,property:e,format:$t.C.Table,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,collectionContextStore:this.props.collectionContextStore})}},this.handlePropertyContextMenu=e=>{e.preventDefault();const t=this.allRowsStore.state,o=this.normalizedTableSelectionStore.state,r=this.getTableCellPositionFromTarget(e.target);let i=!1;if(o&&r){const n=Math.min(o.start.row,o.end.row),s=Math.max(o.start.row,o.end.row);if(r.row>=n&&r.row<=s){const o=t.slice(n,s+1);o.length>0&&(H.Z5({environment:this.environment,stores:o}),H.Ys({environment:this.environment,store:o[0]}),_t.Qn({environment:this.environment,stores:Ht.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:"content_block_menu"}),i=!0)}}if(!i&&r){const o=t[r.row];o&&(H.Ys({environment:this.environment,store:o}),_t.Qn({environment:this.environment,stores:Ht.default.state.stores,left:e.clientX,top:e.clientY,actionSectionGroupKey:"default",showInput:!0,analyticsFrom:"content_block_menu"}))}},this.handleRowSelectableEnter=e=>{const t=this.allRowsStore.state,o=e.blocks.map((e=>t.indexOf(e))),r=C.VV(o)||0,i=C.Fp(o)||0;r>=0&&i>=0&&this.setSelection({selection:{start:{col:0,row:r},end:{col:0,row:i}},shouldNormalize:!0})},this.handleRowsWrapMount=e=>{this.rowsWrapEl=e},this.handleRowsObserverChange=()=>{this.selectionStartRectStore.recompute()},this.allRowsStore=this.createComputedStore((()=>{const{groupFormat:e,collectionContextStore:t}=this.props;return(0,Co.A7)(e,t)})),this.normalizedTableSelectionStore=this.createComputedStore((()=>{const e=Ul.Z.state,t=this.props.collectionContextStore.collectionViewBlockStore();if(!t)return;const{groupFormat:o}=this.props;if(!e.isActive||!(0,Ul.N)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:o}))return;const{selection:r}=e;return this.normalizeTableSelection(r)}),!0),this.selectionStartRectStore=this.createComputedStore((()=>{const e=this.normalizedTableSelectionStore.state;if(e)return this.getCellRect(e.start)}),!0),this.isFrozenColumnsEnabledStore=this.createComputedStore((()=>{const e=this.props.collectionContextStore.collectionViewStore();return le.eL(this.environment.device.isMobile,null==e?void 0:e.getType())})),this.frozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.frozoneStore.state.frozenIndex;return this.isFrozenColumnsEnabledStore.state&&void 0===t?-1:t})),this.maxFrozenIndex=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionViewStore(),o=e.frozoneStore.state.scrollerWidth;return null==t?void 0:t.getTableMaxFrozenColumnIndex(o,e.normalizedFormatStore.state)})),this.frozenSectionWidthStore=this.createComputedStore((()=>{const e=this.frozenIndex.state;if(this.isFrozenColumnsEnabledStore.state){if(void 0!==e){let t=this.getXForFirstCellInRow();const{showPropertyFormatsStore:o}=this.props,r=o.state;for(let i=0;i<=e&&!(i>=r.length);i++){const e=r[i];e.width&&(t+=e.width)}return t-1}return this.getXForFirstCellInRow()}}),!0),this.multiSelectCheckedStore=this.createComputedStore((()=>{const e=this.getBlockStoresForGroup(),t=e.length;if(0===t)return!1;const o=Ht.default.state.stores.filter((t=>e.includes(t))).length;return 0!==o&&(o===t||"indeterminate")})),this.shouldRenderFrozenColumnRepositioner=this.createComputedStore((()=>this.isFrozenColumnsEnabledStore.state&&!this.stores.dragAndFillStore.state&&!this.multiSelectCheckedStore.state&&void 0===this.props.tableStore.state.temporaryFormat&&this.props.collectionContextStore.permissionScopes.state.canConfigureBlock))}willUnmount(){super.willUnmount(),this.observer&&this.observer.disconnect()}didMount(){super.didMount(),this.rowsWrapEl&&(this.observer=new MutationObserver(this.handleRowsObserverChange),this.observer.observe(this.rowsWrapEl,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}renderComponent(){const{store:e,schema:t,showPropertyFormatsStore:o,collectionContextStore:r}=this.props,i=this.normalizedTableSelectionStore.state,n=this.isDragAndFillEnabled()&&i&&(i.start.col===i.end.col&&i.start.row===i.end.row||this.stores.dragAndFillStore.state)?(0,S.jsx)(ua,{store:e,schema:t,selection:i,dragAndFillStore:this.stores.dragAndFillStore,showPropertyFormatsStore:o,selectionStartRectStore:this.selectionStartRectStore,rowsWrapRect:this.getRowsWrapRect(),frozenIndexStore:this.frozenIndex,currentRowsStore:this.allRowsStore,isScrolled:Boolean(r.frozoneStore.state.isScrolled)}):null,s=this.shouldRenderFrozenColumnRepositioner.state?(0,S.jsx)(da,{frozenColumnRepositionStore:this.stores.frozenColumnRepositionStore,frozenIndex:this.frozenIndex.state,maxFrozenIndex:this.maxFrozenIndex.state,xForFirstCellInRow:this.getXForFirstCellInRow(),showPropertyFormats:o.state,frozenSectionWidth:this.frozenSectionWidthStore.state}):null,l=this.props.render({onPropertyTab:this.handlePropertyTab,onPropertyUntab:this.handlePropertyUntab,onPropertyEnter:this.handlePropertyEnter,onPropertyClick:this.handlePropertyClick,onPropertyEsc:this.handlePropertyEsc,onPropertyBgClick:this.handlePropertyBgClick,onPropertyContextMenu:this.handlePropertyContextMenu,onOpenProperty:this.handlePropertyOpenProperty,onSelectableEnter:this.handleRowSelectableEnter});return(0,S.jsx)(Yt.Z,{capture:void 0!==this.normalizedTableSelectionStore.state,onLeft:this.handleLeft,onRight:this.handleRight,onUp:this.handleUp,onDown:this.handleDown,onEnter:this.handleEnter,onTab:this.handleTab,onUntab:this.handleUntab,onEsc:this.handleEsc,onDelete:this.handleDelete,onBackspace:this.handleDelete,onCut:this.handleCut,onCopy:this.handleCopy,onPaste:this.handlePaste,onCommandEnter:this.handleCommandEnter,onShiftEnter:this.handleShiftEnter,onCommandShiftEnter:this.handleCommandShiftEnter,onDuplicate:this.handleDuplicate,onKeypress:this.handleKeypress,onMoveTo:this.handleMoveTo,children:(0,S.jsx)(Oi.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disableHorizontalEdgeScroll:this.props.disableHorizontalEdgeScroll,render:e=>(0,S.jsxs)("div",{style:{position:"relative",minWidth:this.props.minWidth},...e,ref:this.handleRowsWrapMount,children:[s,n,l]})})})}getTableCellPositionFromTarget(e){let t=e;for(;null!==t&&!t.classList.contains(ee.mWS);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}repositionFrozenColumns(){const{collectionContextStore:e}=this.props;this.stores.frozenColumnRepositionStore.state.isRepositioning&&W.createAndCommit({userAction:"TableHeaderCell.handleFreezeColumns",environment:this.environment,perform:t=>{Sl.oz({environment:this.environment,collectionContextStore:e,currentIndex:this.stores.frozenColumnRepositionStore.state.newFrozenIndex,transaction:t,entrypoint:"TableSelectionOverlay.FrozenColumnRepositioner"}),this.stores.frozenColumnRepositionStore.reset()}})}dragAndFillCells(){var e;const t=this.stores.dragAndFillStore.state;if(!t)return;const{start:o,end:r}=t;if(o.col!==r.col||o.row!==r.row)return;const{showPropertyFormatsStore:i,schema:n,collectionContextStore:s}=this.props,l=null===(e=n[i.state[o.col].property])||void 0===e?void 0:e.type;if("verification"===l)return;const a=this.normalizedTableSelectionStore.state;if(!a)return;W.createAndCommit({userAction:"TableSelectionOverlay.handleDragAndFill",environment:this.environment,perform:e=>{this.copyValuesToSelectionFromStart({transaction:e,selection:a,start:o})}});const c=Math.min(a.start.row,a.end.row),d=Math.max(a.start.row,a.end.row);l&&d!==c&&I.qm({environment:this.environment,collectionContextStore:s,property_type:l,num_rows:d-c}),this.stores.dragAndFillStore.reset()}shouldMoveSelectionToNextRow(){if(!(0,la.zq)(this.environment))return!0;const e=this.props.blockPropertyValueOverlayStore.state;return!e.isOpen||0===e.additionalStores.length}isDragAndFillEnabled(){const{disabled:e,collectionContextStore:t}=this.props,o=t.permissionScopes.state;return!(e||!o.canEditContent)&&"on"===Pe.default.getEligibleGroup({experimentId:"collection_table_drag_and_fill",defaultGroup:"control"})}setSelection(e){const{selection:t,shouldNormalize:o}=e,r=this.props.collectionContextStore.collectionViewBlockStore();r&&(Sl.Z5({environment:this.environment,selectionKey:{collectionViewBlockStore:r,groupFormat:this.props.groupFormat},selection:o?this.normalizeTableSelection(t):t}),this.selectionStartRectStore.recompute())}getRowRect(e){const{rowsWrapEl:t}=this;if(!t)return;const o=Di.C.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}isTargetWithinFrozenColumnRepositioner(e){let t=e;for(;null!==t;){if(t.classList.contains(ee.wXs))return!0;t=t.parentElement}return!1}isTargetWithinDragAndFillHandle(e){let t=e;for(;null!==t;){if(t.classList.contains(ee.JR_))return!0;t=t.parentElement}return!1}getCurrentColumnCount(){return this.props.showPropertyFormatsStore.state.length}getCellPositionOfStore(e,t){const o=this.allRowsStore.state;return{col:this.props.showPropertyFormatsStore.state.findIndex((e=>e.property===t)),row:o.findIndex((t=>e===t))}}getRowsWrapRect(){return this.rowsWrapEl?this.rowsWrapEl.getBoundingClientRect():void 0}updateSelectionScroll(e){const t=this.normalizedTableSelectionStore.state;if(t){let o;o=e===ha.Down?t.start.row>t.end.row?t.start:t.end:e===ha.Up?t.start.row<t.end.row?t.start:t.end:e===ha.Right?t.start.col>t.end.row?t.start:t.end:t.start.col<t.end.row?t.start:t.end;const r=this.allRowsStore.state[o.row],i=this.props.showPropertyFormatsStore.state[o.col].property,n=jl.Z.findBlockPropertyValue(r,i),s=(null==n?void 0:n.getNode())??null;if(s){const e=this.frozenSectionWidthStore.state??0,o=this.frozenIndex.state,r=this.props.disableHorizontalEdgeScroll||o&&t.start.col<=o&&t.end.col<=o;z.bx({element:s,vertical:{reveal:"closest",paddingToTopEdge:96,paddingToBottomEdge:48},horizontal:r?void 0:{reveal:"closest",paddingToLeftEdge:e},scrollers:{verticalScroller:null==n?void 0:n.getContextVerticalScroller(),horizontalScroller:null==n?void 0:n.getContextHorizontalScroller()}})}}}scrollToStart(){var e;const{collectionContextStore:t}=this.props;if(!t.frozoneStore.state.isScrolled)return;const o=this.allRowsStore.state[0],r=this.props.showPropertyFormatsStore.state[0].property,i=jl.Z.findBlockPropertyValue(o,r),n=t.frozoneStore.state.scrollerLeftOffset??0,s=(0,ye.Wk)(this.environment),l=Math.max(s-n,0),a=(0,xo.iZ)(this.environment,t)?l:0;null==i||null===(e=i.getContextHorizontalScroller())||void 0===e||e.scrollTo(void 0,this.props.paddingLeft-a)}copyValuesToSelectionFromStart(e){const{transaction:t,selection:o,start:r}=e,{showPropertyFormatsStore:i}=this.props,n=this.allRowsStore.state,s=i.state[r.col],l=n[r.row].getPropertyValue(s.property)||[],a=Math.min(o.start.row,o.end.row),c=Math.max(o.start.row,o.end.row);n.slice(a,c+1).forEach((e=>{e.pointer!==n[r.row].pointer&&We.sO({store:e.getPropertyStore(s.property),value:l,transaction:t})}))}normalizeTableSelection(e){const t=this.getCurrentColumnCount(),o=this.allRowsStore.state.length;return{start:{col:(0,ra.Z)(e.start.col,0,t-1),row:(0,ra.Z)(e.start.row,0,o-1)},end:{col:(0,ra.Z)(e.end.col,0,t-1),row:(0,ra.Z)(e.end.row,0,o-1)}}}getXForFirstCellInRow(){const{collectionContextStore:e}=this.props;return(0,le.fk)({environment:this.environment,collectionContextStore:e})?xo.Xx:0}getCellRect(e){const{rowsWrapEl:t}=this;if(!t)return;const{showPropertyFormatsStore:o}=this.props,r=o.state,i=this.allRowsStore.state[e.row],n=this.getRowRect(i);if(!n)return;const s=t.getBoundingClientRect(),l=n.height,a=n.top-s.top-1,c=r[e.col].width||0,d=l+1;let h=this.getXForFirstCellInRow();for(let p=0;p<e.col;p++){const e=r[p];e.width&&(h+=e.width)}return new DOMRect(h-1,a,c+1,d)}getBlockStoresForGroup(){const{collectionContextStore:e,groupFormat:t}=this.props,o=t?[t]:[];return(0,Co.A7)(o[0],e)}}pa.displayName="TableSelectionOverlay",pa.contextTypes={...Y.wK,...n.w};function ua(e){var t;window.__c={n:"DragAndFillHandle"};const{store:o,schema:r,selection:i,dragAndFillStore:n,currentRowsStore:s,showPropertyFormatsStore:l,selectionStartRectStore:a,rowsWrapRect:c,frozenIndexStore:d,isScrolled:h}=e,p=(0,ct.VK)((()=>n.state),[n]),u=(0,ct.VK)((()=>{const e=(null==p?void 0:p.start)||i.start;return l.state[e.col]}),[p,i,l]),m=(0,R.useIntl)(),g=(0,ct.VK)((()=>{if(!p||!u)return[];const{start:e}=p,t=s.state[e.row].getModel();return t?(0,ia.v4)({property:u.property,schema:r,block:t,getRecordValue:o.getRecordValue,userTimeZone:(0,rt.r)(),baseURL:void 0,intl:m}):""}),[s,p,m,u,r,o]),y=u?null===(t=r[u.property])||void 0===t?void 0:t.type:void 0,v=(0,ct.VK)((()=>a.state),[a]),f=(0,ct.VK)((()=>d.state),[d]),C=(0,ct.VK)((()=>le.Ql(f)&&i.start.col<=f),[f,i]),x=(0,ct.VK)((()=>h&&-1===f?10:0),[f,h]),b=(0,co.yK)((e=>({dragAndFillContainer:{zIndex:C?T.I5+4:void 0,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:C?"sticky":void 0,left:"0"},tooltipContainer:{position:"absolute",left:v?v.left+v.width-5:void 0,zIndex:T.xP},tooltipOrigin:{position:"absolute",left:0,top:v?v.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",left:0,top:v?v.bottom-5:void 0,width:9,height:9,border:`2px solid ${_o.ZP.blueWithAlpha(.57)}`,transform:p?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:e.contentBackground,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:e.mediumInvertedTextColor,maxWidth:200,...P.Z.textOverflowStyle}})),[C,v,p]);if(!v)return null;if(!y||Bt.ZY(y)||"rollup"===y||"formula"===y||"verification"===y)return null;let w;return c&&(w=new DOMRect(v.x+c.x+v.width-4+x,v.y+c.y+v.height-4,7,7)),(0,S.jsx)(xt.Z,{renderTooltip:()=>{const e=(0,S.jsx)(R.FormattedMessage,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"});return p?(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e,(0,S.jsx)("div",{style:b.tooltipText,children:g})]}):e},delayThreshold:300,forceVisibleState:!!p||void 0,originRect:w,placement:Zs.u.Right,render:e=>(0,S.jsx)("div",{...e,className:ee.JR_,style:b.dragAndFillContainer,children:(0,S.jsx)("div",{style:b.dragAndFillOutsideStickyWrapper,children:(0,S.jsx)("div",{style:b.dragAndFillInsideStickyWrapper,children:(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{translateX:x},render:()=>(0,S.jsxs)("div",{style:b.tooltipContainer,children:[(0,S.jsx)("div",{style:b.tooltipOrigin}),(0,S.jsx)("div",{style:b.tooltipCircle})]})})})})})})}function ma(e){window.__c={n:"TableSelectionOverlayWithDeps"};const{value:t}=(0,ji.useDependency)(ji.deps.markdownLinkifyIt),{value:o}=(0,ji.useDependency)(ji.deps.tinyMceMicrosoftWordPasteFilter);return(0,S.jsx)(pa,{...e,markdownLinkifyIt:t,tinyMceMicrosoftWordPasteFilter:o})}function ga(e){window.__c={n:"TableShimmer"};const{isFullScreen:t,hasGroups:o,propertyWidths:r,hasPartialResults:i,hasSearchQuery:n}=e,s=(0,uo.O7)(),l=(0,co.Fg)(),a=(0,uo.Fy)().isMobile,c=(0,Q.DK)(),d=(0,ao.Z)(!0,0,100),h=(0,ct.VK)((()=>Boolean(null==c?void 0:c.normalizedFormatStore.state.hide_table_vertical_lines)),[c]),p=(0,ct.VK)((()=>{var e;return(0,le.eL)(a,null==c||null===(e=c.collectionViewStore())||void 0===e?void 0:e.getType())}),[c,a]),u=(0,ct.VK)((()=>Boolean(null==c?void 0:c.frozoneStore.state.isScrolled)),[c]),m=(0,ct.VK)((()=>null==c?void 0:c.frozoneStore.state.frozenIndex),[c]),g=(0,ct.VK)((()=>{if(!c)return!1;const e=c.collectionViewBlockStore();return!!e&&(0,Wl.sY)(e)}),[c]),y=(0,ct.VK)((()=>c?(0,xo.oc)({environment:s,collectionContextStore:c,isMobile:a,theme:l}):{}),[c,s,a,l]),v=(0,co.yK)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"flex-start"},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},frozenColumnsContainer:{display:"flex",flexDirection:"row",...y},multiselectCheckbox:{display:"flex",flexDirection:"row",pointerEvents:"none",cursor:"pointer",...y},rowContainer:{display:"flex",alignItems:"flex-start",padding:p?void 0:"0px 16px",borderBottom:`1px solid ${e.tableDividerColor}`,width:"100%"},rowShimmer:{height:10,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor,marginLeft:p?0:8},column:{display:"flex",height:32,padding:"0px 8px",alignItems:"center",borderRight:h?void 0:`1px solid ${e.tableDividerColor}`}})),[y,p,h]);if(!d||!c)return null;const f=r.map(((e,t)=>(0,S.jsx)("div",{style:{...v.column,width:e},children:(0,S.jsx)(Ar.Z,{style:{...v.rowShimmer,width:.6*(e-16)}})},t)));let C=null,x=[];if(p&&void 0!==m){const e=f.slice(0,m+1);C=(0,S.jsxs)("div",{style:v.frozenColumnsContainer,children:[(0,S.jsxs)($l,{isCollectionViewBlockSelected:g,children:[(0,S.jsx)(el,{isShimmerRow:!0,checkedState:!1,checkboxType:"single_row",onClick:()=>{},collectionContextStore:c}),e]}),e.length>0?(0,S.jsx)(Js,{isShimmerRow:!0,isScrolled:u}):null]}),x=f.slice(m+1,f.length)}else x=f;let b=1;o||i||n||(b=t?10:3);const w=[...Array(b)].map(((e,t)=>(0,S.jsxs)("div",{style:v.rowContainer,children:[C,x]},t)));return(0,S.jsx)("div",{style:v.container,children:(0,S.jsx)("div",{style:v.rowsContainer,children:w})})}class Sa extends Oe.Z{constructor(){super(...arguments),this.onItemShiftEnter=()=>{const e=this.groupStateStore.state;if(!e)return;const{collectionContextStore:t,blockPropertyValueOverlayStore:o}=this.props,r=t.collectionStore();if(!r||!t.shouldAllowNewItemCreation())return;const i=Ht.default.state.stores[0];if(!i)return;const n=t.subitemTreeStore.state,l=(0,fo.DY)(n.children,(e=>e.value.store===i));if(!l)return;const a=l?(0,Co.Af)(l.map((e=>e.value.store))):"",c=t.subitemExpandedStore.state.get(a);Boolean(null==c?void 0:c.isExpanded)&&W.createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:this.environment,perform:n=>{const a=j.yk({environment:this.environment,collectionContextStore:t,groupsPointer:e.groupsPointer,store:i,before:!1,collectionStore:r,transaction:n,subitemPath:l,subitemInsertDirection:"into"});a&&o&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{Lt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:o,store:a,property:"title",format:$t.C.Table,collectionContextStore:t})}))}))}})},this.handleAddRowClick=()=>{const e=new _s.sA(this.environment,"handleAddRowClick"),{collectionContextStore:t,isFullScreen:o,groupFormat:r}=this.props,{device:i}=this.environment,n=r?[r]:[],l=t.groupsStore.getGroupState(n);et.M_(this.environment)&&l?(t.searchQuery.state&&_.Ug({searchQuery:"",collectionContextStore:t,isFullScreen:o}),W.createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:this.environment,perform:o=>{const n=j.IW({environment:this.environment,collectionContextStore:t,groupsPointer:r?[r]:[],coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:"table_group_results",tracker:e});if(!n)return;const a=n.newStore;if(i.isMobile){const e=(0,de.ZP)({store:a,fullyQualified:!1,pageVisitSource:c.tY.Create});this.navigate(e)}else{s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{n.coercionSucceeded?Lt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:a,property:"title",format:$t.C.Table,collectionContextStore:this.props.collectionContextStore}):O.peekBlock({environment:this.environment,store:a,peekMode:le.kr(t.collectionViewStore()),resultsStore:l.resultsStore,collectionContextStore:t,pageVisitSource:c.tY.Create})}))}))}));const e=t.subitemTreeStore.state;M.W2j(this.environment,{from:e.children?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:a.id,...(0,re.Pn)(t)})}}})):e.fail("invalid_state")},this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,r=t.groupsStore.getGroupState(o);if(!r)return;const i=r.reducerResultStore.state;(0,he.Wi)(e),H.ZH(this.environment),i&&j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:i.blockIds.length,groupsPointer:r.groupsPointer,incrementLimitsInRelatedGroups:!1}}),M.uDZ(this.environment)},this.groupStateStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=t?[t]:[];return e.groupsStore.getGroupState(o)})),this.showPropertyFormatsStore=this.createComputedStore((()=>this.getTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return this.showPropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0)+(e.permissionScopes.getState().canEditContent?32:0)})),this.propertiesWidthStore=this.createComputedStore((()=>this.showPropertyFormatsStore.state.map((e=>e.width||Ft.Nx)))),this.titleColumnIndexStore=this.createComputedStore((()=>this.showPropertyFormatsStore.state.findIndex((e=>"title"===e.property)))),this.anyItemsInGroupsSelected=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,{groupFormat:t}=this.props,o=t?[t]:[],r=(0,Co.A7)(o[0],e);return Ht.default.state.stores.filter((e=>r.includes(e))).length>0})),this.frozonePropsStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,{device:o,ThemeModeStore:r}=this.environment,{isScrolled:i,frozenIndex:n,tryShowHiddenFrozenColumn:s}=t.frozoneStore.state,l=le.eL(o.isMobile,null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()),a=(0,_o.gh)({theme:r.state}),c=(()=>{if(l){const{isScrolled:e,frozenIndex:r}=t.frozoneStore.state;return{...(0,xo.oc)({environment:this.environment,collectionContextStore:t,isMobile:o.isMobile,theme:a}),display:"flex",...e&&-1===r&&{height:"calc(100% + 1px)",borderBottom:`1px solid ${a.tableDividerColor}`}}}return{}})(),d=Boolean(i&&!le.Ql(n)&&(s||this.anyItemsInGroupsSelected.state));return{shouldFreeze:l,frozenStyles:c,shouldShowStickyMultiSelectColumn:d}}),!0)}renderComponent(){const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,r=this.groupStateStore.state;if(!r)return;const i=r.reducerResultStore.state,n=void 0!==i,s=le.VM({collectionContextStore:e,reducerResult:i,isFullScreen:t}),l=void 0!==o,a=o?[o]:[],c=void 0!==i&&(null==i?void 0:i.blockIds.length)>0,d=""!==e.searchQuery.state,h=Ue({collectionContextStore:e,groupsPointer:a,hasPartialResults:c}),p=n&&!h&&0===(null==i?void 0:i.blockIds.length);return(0,S.jsxs)(S.Fragment,{children:[this.renderHeaderRow(r),(0,S.jsx)("div",{style:{height:fa}}),this.renderRows(),h&&(0,S.jsx)(ga,{isFullScreen:t,hasGroups:l,propertyWidths:this.propertiesWidthStore.state,hasPartialResults:c,hasSearchQuery:d}),p&&(0,S.jsx)(Ws,{collectionContextStore:this.props.collectionContextStore,shouldShowAddRowButton:this.shouldShowAddRowButton(),handleAddRowClick:this.handleAddRowClick,paddingLeft:this.props.paddingLeft}),(0,S.jsx)("div",{style:{width:this.tableWidthStore.state}}),s&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderAddRowButton(),this.renderAggregationRow(),(0,S.jsx)("div",{style:{height:xa}})]})}renderHeaderRow(e){const{store:t,schema:o,query:r,disabled:i,collectionContextStore:n,minWidth:s,paddingBottom:l,isInPeekRenderer:a,blockPropertyValueOverlayStore:c,groupFormat:d}=this.props,h=n.viewIsFlushToTopbar(),p=n.permissionScopes.state,u=Boolean(d),m=h&&!u,g=Boolean(n.normalizedFormatStore.state.hide_table_vertical_lines);return(0,S.jsx)(Nl,{store:t,format:this.getCurrentFormat(),groupFormat:d,schema:o,query:r,collectionContextStore:n,isInPeekRenderer:a,minWidth:s,paddingBottom:l,blockPropertyValueOverlayStore:c,resultStore:e.reducerResultStore,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActions:p.canConfigureCollection&&p.canConfigureBlock,allowHidingTitle:!1,tableStore:this.props.tableStore,formatKey:"table_properties",disabled:i||!p.canConfigureCollection&&!p.canConfigureBlock,disableTopBorder:!m,disableCellRightBorder:!m||g,height:fa,frozoneProps:this.frozonePropsStore.state})}renderRows(){const{device:e}=this.environment,{store:t,schema:o,query:r,disabled:i,collectionContextStore:n,minWidth:s,blockPropertyValueOverlayStore:l,groupFormat:a}=this.props,c=n.collectionViewStore();if(!c)return;const d=this.canEditTable()&&e.isMobile&&!c.isSyncedCollection(),h=this.titleColumnIndexStore.state;return(0,S.jsx)(ma,{store:t,format:this.getCurrentFormat(),schema:o,query:r,collectionContextStore:n,minWidth:s,blockPropertyValueOverlayStore:l,showPropertyFormatsStore:this.showPropertyFormatsStore,disabled:!this.canEditTable(),groupFormat:a,tableStore:this.props.tableStore,paddingLeft:this.props.paddingLeft,render:e=>(0,S.jsx)(ya,{args:e,collectionContextStore:n,collectionViewFormat:this.getCurrentFormat(),blockPropertyValueOverlayStore:l,groupFormat:a,propertyFormats:this.showPropertyFormatsStore.state,schema:o,canDrag:d,disabled:i,titleColumnIndex:h,onShiftEnter:this.onItemShiftEnter,frozoneProps:this.frozonePropsStore.state})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,groupFormat:o}=this.props,r=qe({collectionContextStore:e,groupsPointer:o?[o]:[]});return(0,S.jsx)(Qt.Z,{onMouseDown:he.$0,onClick:this.handleLoadMoreClick,disabled:r,hoveredStyle:r?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Ca+1,width:"100%",paddingLeft:ba,paddingBottom:2,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:(0,S.jsxs)("span",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,position:"sticky",left:(this.props.paddingLeft||0)+ba},children:[(0,vo.M)(this.getNewRowButtonIconStyle()),(0,S.jsx)(R.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"}),r?(0,S.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,S.jsx)(Mt.Z,{style:{width:12,height:12}})}):this.canEditTable()&&(0,S.jsx)(ur,{collectionContextStore:e,format:t})]})})}renderAggregationRow(){const{store:e,schema:t,query:o,disabled:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showHoverActionsStore:s,minWidth:l,paddingBottom:a,isInPeekRenderer:c,isFullScreen:d,groupFormat:h}=this.props,p=i.permissionScopes.state;return(0,S.jsx)(Ns,{store:e,groupFormat:h,disabled:r||!p.canConfigureBlock,format:this.getCurrentFormat(),schema:t,query:o,collectionContextStore:i,blockPropertyValueOverlayStore:n,isInPeekRenderer:c,isFullScreen:d,minWidth:l,paddingBottom:a,showPropertyFormatsStore:this.showPropertyFormatsStore,showRightActionsSpacer:p.canConfigureCollection,showHoverActionsStore:s,style:{...!this.isReady()&&{opacity:0,pointerEvents:"none",left:0,right:0}}})}renderAddRowButton(){var e;const{collectionContextStore:t,isInPeekRenderer:o}=this.props,r=(null===(e=t.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||(o?this.theme.cardContentBackground:this.theme.contentBackground);return(0,S.jsx)(Qt.Z,{onClick:this.handleAddRowClick,onMouseDown:he.$0,style:{display:"flex",alignItems:"center",height:Ca,width:"100%",paddingLeft:8,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,background:r,left:0,right:0},className:ee.tfM,children:(0,S.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",position:"sticky",left:this.props.paddingLeft+8,color:this.theme.lightTextColor},children:[(0,Je.R)(this.getNewRowButtonIconStyle()),(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"database.tableView.addRowButton"})]})})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.props.tableStore.state;return t||e}getTableProperties(){const e=this.getCurrentFormat();return e&&e.table_properties?e.table_properties:[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e}=this.props;return Boolean(this.isReady()&&this.canEditTable()&&e.shouldAllowNewItemCreation())}isReady(){var e;return void 0!==(null===(e=this.groupStateStore.state)||void 0===e?void 0:e.reducerResultStore.state)}canEditTable(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state;return!!this.canEdit()&&(!t.isSyncedCollection&&t.canEditContent)}getNewRowButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}}function ya(e){window.__c={n:"TableSelectionOverlayInner"};const t=(0,uo.O7)(),{args:o,collectionContextStore:i,collectionViewFormat:n,blockPropertyValueOverlayStore:l,groupFormat:a,propertyFormats:c,schema:d,canDrag:h,disabled:p,titleColumnIndex:u,onShiftEnter:m,frozoneProps:g}=e,y=(0,r.useMemo)((()=>a?[a]:[]),[a]),v=(0,ct.VK)((()=>i.permissionScopes.state),[i.permissionScopes]),f=(0,ct.VK)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),C=(0,co.yK)((e=>({itemSelectableHalo:{borderRadius:0,zIndex:T.I5+1}})),[]),x=(0,co.Fg)(),b=(0,r.useCallback)((()=>({display:"flex",height:"calc(100% + 2px)",borderBottom:`1px solid ${x.tableDividerColor}`})),[x.tableDividerColor]),w=(0,r.useCallback)((e=>{const{store:o,parentStore:r,subitemPath:n,indentLevel:a}=e;if(r)return(0,S.jsx)(ln,{store:o,collectionStore:r,subitemPath:n,indentLevel:a,collectionContextStore:i,disabled:p,groupsPointer:y,onSubitemCreate:e=>{l&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{Lt.bA({isNewBlock:!0,environment:t,blockPropertyValueOverlayStore:l,store:e,property:"title",format:$t.C.Table,collectionContextStore:i})}))}))}})}),[l,i,p,t,y]),k=(0,r.useMemo)((()=>({schema:d,collectionContextStore:i,propertyFormats:c,onPropertyTab:o.onPropertyTab,onPropertyUntab:o.onPropertyUntab,onPropertyEnter:o.onPropertyEnter,onPropertyClick:o.onPropertyClick,onPropertyEsc:o.onPropertyEsc,onPropertyBgClick:o.onPropertyBgClick,onPropertyContextMenu:o.onPropertyContextMenu,onOpenProperty:o.onOpenProperty,disabled:p,blockPropertyValueOverlayStore:l,showRightActionsSpacer:v.canConfigureCollection,disableCellBorderRight:f,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:!1,disableTableWrap:!1,onShiftEnter:m,titleColumnIndex:u,groupFormat:a,frozoneProps:g})),[o.onOpenProperty,o.onPropertyBgClick,o.onPropertyClick,o.onPropertyContextMenu,o.onPropertyEnter,o.onPropertyEsc,o.onPropertyTab,o.onPropertyUntab,l,i,p,f,m,v.canConfigureCollection,c,d,u,a,g]);return(0,S.jsx)(Do,{collectionContextStore:i,groupsPointer:y,format:n,canDrag:h,resultProps:k,canDrop:!0,resultComponent:oa,disabled:p,direction:Fo.Vertical,getItemSelectableStyle:b,itemSelectableHaloStyle:C.itemSelectableHalo,shouldShowHoverMenu:!0,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:o.onSelectableEnter,blockPropertyValueOverlayStore:l,titleColumnIndex:u,nestedCreateSubitemButton:w})}Sa.contextTypes={...Y.wK,...n.w};const va=(0,R.injectIntl)(Sa),fa=34,Ca=32,xa=32,ba=8;class wa extends Oe.Z{constructor(){super(...arguments),this.storeTypes={tableStore:ts},this.renderGroupHeader=e=>(0,S.jsx)(lr,{...e,height:42,paddingTop:8,toggleClosedMarginBottom:8,getComputedStickyStyle:this.getGroupHeaderComputedStickyStyle}),this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]),n=null==i?void 0:i.reducerResultStore.state;e<be.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)O.navigateToBlock({environment:this.environment,store:e,pageVisitSource:c.tY.Create});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);O.peekBlock({environment:this.environment,store:e,peekMode:le.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:c.tY.Create})}},this.viewSettingsSidebarOpen=this.createComputedStore((()=>{var e;return this.props.collectionContextStore.settingsStore.state.open&&"sidebar"===(null===(e=this.props.viewSettingsPlacementStore)||void 0===e?void 0:e.state)})),this.getGroupStyle=e=>{const{collectionContextStore:t}=this.props,o=t.viewIsFlushToTopbar();if(0===e.index&&!o)return{};return t.shouldShowSpinner.state&&e.index>0?{}:{borderTop:`1px solid ${this.theme.tableDividerColor}`}},this.getGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}`:void 0})}renderPersisted(){const{store:e,paddingBottom:t,paddingLeft:o,paddingRight:r,isFullScreen:i,collectionContextStore:n,format:s}=this.props,l=le.az(n,i),a=s.collection_group_by;return(0,Qe.Z)((s=>{const c=(0,S.jsx)(Po.Z,{store:e,shouldShowHalo:!i,canSelect:!i,analyticsName:"table",style:{position:"relative"},...s,children:a?this.renderGroups(a):this.renderGroupResults(void 0)});return(0,S.jsxs)("div",{style:{...wa.style,paddingBottom:t,paddingLeft:o,paddingRight:r+(this.viewSettingsSidebarOpen.state?Qn.nJ+20:0)},className:ee._so,children:[a?c:(0,S.jsx)(Rr,{renderEmitter:n.renderEmitter,isFullScreen:i,children:c}),!l&&(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})}))}renderGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,S.jsx)(Ur,{store:t,id:"table_groups",groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:e=>this.renderGroupResults(e),renderHeader:this.renderGroupHeader,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,paddingLeft:l,getGroupStyle:this.getGroupStyle,isRootChild:a,isInPeekRenderer:c,stickyLeft:!0})}renderGroupResults(e){const{store:t,format:o,schema:r,query:i,collectionContextStore:n,showHoverActionsStore:s,isFullScreen:l,isInPeekRenderer:a,disabled:c,blockPropertyValueOverlayStore:d,minWidth:h,paddingBottom:p,paddingLeft:u}=this.props;if(n.groupsStore.getGroupState(e?[e]:[]))return(0,S.jsx)(va,{tableStore:this.stores.tableStore,groupFormat:e,store:t,format:o,schema:r,query:i,collectionContextStore:n,showHoverActionsStore:s,isFullScreen:l,isInPeekRenderer:a,disabled:c,blockPropertyValueOverlayStore:d,minWidth:h,paddingBottom:p,paddingLeft:u})}}wa.displayName="Table",wa.style={position:"relative",float:"left",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums"};const ka=(0,R.injectIntl)(wa);class Pa extends n.Z{constructor(){super(...arguments),this.interval=void 0,this.handleSeconds=()=>{0===(new Date).getSeconds()&&this.enqueueForceUpdate()}}didMount(){super.didMount(),this.interval=setInterval(this.handleSeconds,1e3)}willUnmount(){super.willUnmount(),clearInterval(this.interval)}renderComponent(){return(0,S.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[this.renderWeekendIndicators(),this.renderVerticalDividers(),this.renderNowVerticalDivider()]})}renderWeekendIndicators(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{showWeekendIndicators:o}=se.BJ[t];if(!o)return;const{startTimestamp:r,endTimestamp:i}=e.currentRange.state;let n=(0,se.DS)(Zi.ou.fromMillis(r),"day");const s=[];for(;n.valueOf()<i;){6===n.weekday&&s.push(this.renderWeekendIndicator(n));n=(0,se.Ip)(n,"day")}return s}renderWeekendIndicator(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,i=e.plus({day:2}).startOf("day"),n=(0,se.e$)(o,e.valueOf()-r),s=(0,se.e$)(o,i.valueOf()-r);return(0,S.jsx)("div",{style:{position:"absolute",left:n,width:s-n,height:"100%",background:this.theme.timelineDarkerBackground}},e.valueOf())}renderVerticalDividers(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{verticalDividerUnit:o}=se.BJ[t];if(!o)return;const{startTimestamp:r,endTimestamp:i}=e.currentRange.state,n=[];let s=(0,se.DS)(Zi.ou.fromMillis(r),o);for(;s.valueOf()<i;){n.push(this.renderVerticalDivider(s.valueOf()));s=(0,se.Ip)(s,o)}return n}renderVerticalDivider(e){const{timelineState:t}=this.props,o=t.zoomLevel.state,{startTimestamp:r}=t.currentRange.state,i=(0,se.e$)(o,e-r);return(0,S.jsx)("div",{style:{position:"absolute",left:i,height:"100%",borderRight:`1px solid ${this.theme.regularDividerColor}`}},e)}renderNowVerticalDivider(){const{timelineState:e}=this.props,t=e.zoomLevel.state,{startTimestamp:o}=e.currentRange.state,r=Zi.ou.now().startOf("minute"),i=Math.floor((0,se.e$)(t,r.valueOf()-o));return(0,S.jsx)("div",{style:{position:"absolute",left:i,height:"100%",borderRight:`1px solid ${this.theme.timelineRed}`}})}}Pa.displayName="TimelineBackground";const Ta=Pa;class Ra extends n.Z{constructor(){super(...arguments),this.handleRemove=e=>{const{store:t,collectionContextStore:o}=this.props,{transaction:r}=e;o.collectionStore()&&j.Od({store:t,transaction:r})},this.handleDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{store:i,collectionContextStore:n,collectionStore:s,groupFormat:l}=this.props,a=n.subitemTreeStore.state,c=(0,fo.DY)(a.children,(e=>e.value.store===i)),d=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(d,{environment:this.environment,getData:()=>re.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!1})}),W.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleDrop",environment:this.environment,perform:e=>{j.by({environment:this.environment,collectionStore:s,targetStore:i,droppedDirection:t,collectionContextStore:n,groupsPointer:l?[l]:[],droppedStores:o,duplicate:r,transaction:e,subitemPath:c})}})},this.handleInsertBelow=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,collectionStore:n,groupFormat:s}=this.props;return j.$T({environment:this.environment,collectionStore:n,collectionContextStore:i,groupsPointer:s?[s]:[],insertStores:t,store:r,before:!1,transaction:o})},this.handleInsertAbove=e=>{const{insertStores:t,transaction:o}=e,{store:r,collectionContextStore:i,collectionStore:n,groupFormat:s}=this.props;return j.$T({environment:this.environment,collectionStore:n,collectionContextStore:i,groupsPointer:s?[s]:[],insertStores:t,store:r,before:!0,transaction:o})},this.handleNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,collectionStore:i,groupFormat:n}=this.props,s=r.collectionViewBlockStore(),l=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>re.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!1})}),s&&W.createAndCommit({userAction:"CollectionTimelineViewDroppableRow.handleNativeDrop",environment:this.environment,perform:e=>{j.tQ({environment:this.environment,collectionStore:i,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:n?[n]:[],files:t,transaction:e})}})}}renderComponent(){const{store:e}=this.props;return(0,S.jsx)(Po.Z,{store:e,style:{width:"100%",height:os.Z+1},canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:this.handleInsertBelow,onInsertAbove:this.handleInsertAbove,onSelectableDrop:this.handleDrop,onNativeDrop:this.handleNativeDrop,onRemove:this.handleRemove,analyticsName:"timeline"},e.id)}}Ra.displayName="CollectionTimelineViewDroppableRow";const Ma=Ra;class Ia extends n.Z{constructor(){super(...arguments),this.instanceStore=void 0,this.renderRowDropzoneSelectable=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,r=t.collectionStore();if(r)return(0,S.jsx)(Ma,{store:e,groupFormat:o,collectionStore:r,collectionContextStore:t,isLast:!1,handleOpenPeekPage:C.ZT},e.id)},this.handleEmptyDroppableDrop=e=>{const{droppedDirection:t,droppedStores:o,duplicate:r}=e,{groupFormat:i,collectionContextStore:n}=this.props,s=n.collectionStore();if(!s)return;const l=n.groupsStore.getGroupState(i);if(!l)return;const a=n.collectionViewBlockStore(),c=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(c,{environment:this.environment,getData:()=>re.yr({collectionContextStore:n,is_native_drop:!1,is_empty:!0})}),a&&W.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:this.environment,perform:e=>{j.by({environment:this.environment,collectionStore:s,targetStore:a,droppedDirection:t,collectionContextStore:n,groupsPointer:l.groupsPointer,droppedStores:o,duplicate:r,transaction:e})}})},this.handleEmptyDroppableNativeDrop=e=>{const{files:t,droppedDirection:o}=e,{collectionContextStore:r,groupFormat:i}=this.props,n=r.collectionStore();if(!n)return;const s=r.collectionViewBlockStore(),l=Se.default.mark("collections.drop_item_lag");Se.default.measureAfterNextFlush(l,{environment:this.environment,getData:()=>re.yr({collectionContextStore:r,is_native_drop:!0,is_empty:!0})}),s&&W.createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:this.environment,perform:e=>{j.tQ({environment:this.environment,collectionStore:n,targetStore:s,droppedDirection:o,collectionContextStore:r,groupsPointer:i?[i]:[],files:t,transaction:e})}})}}willMount(e){super.willMount(e),this.instanceStore=new _e.G(this.environment,e.store.pointer)}renderComponent(){const{device:e}=this.environment,{groupFormat:t,canEdit:o,disabled:r,format:i,collectionContextStore:n}=this.props,s=n.groupsStore.getGroupState(t);if(!s)return;const l=n.permissionScopes.state,a=n.collectionStore(),c=n.collectionViewStore(),d=o&&l.canEditContent&&!l.isSyncedCollection&&e.isMobile&&!(null!=c&&c.isSyncedCollection());return(0,S.jsxs)(S.Fragment,{children:[this.renderEmptyDroppable(),s&&a?(0,S.jsx)(Do,{collectionContextStore:n,groupsPointer:s.groupsPointer,format:i,canDrag:d,disableRequest:!0,resultProps:{groupFormat:t,collectionStore:a,collectionContextStore:n,isLast:!1,handleOpenPeekPage:C.ZT},canDrop:!0,resultComponent:Ma,disabled:r,direction:Fo.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:this.nestedCreateSubitemButton}):s.resultsStore.state.map(this.renderRowDropzoneSelectable)]})}nestedCreateSubitemButton(e){return(0,S.jsx)("div",{style:{width:"100%",height:os.Z+1}})}renderEmptyDroppable(){if(this.instanceStore){const{canEdit:e}=this.props;return(0,S.jsx)(Po.Z,{store:this.instanceStore,shouldShowDropZone:e,canDropBelow:e,canNativeDropBelow:e,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:this.handleEmptyDroppableDrop,onNativeDrop:this.handleEmptyDroppableNativeDrop,analyticsName:"timeline",style:{width:"100%"}})}}}Ia.displayName="TimelineDropzoneSelectableGroupResults";const Va=Ia;var Ba=o(62193),Fa=o(42239);function ja(e){window.__c={n:"TimelineItemDependencyDrawHandle"};const{store:t,schema:o,timelineState:i,dateValueStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=e,c=(0,r.useRef)(null),[d,h]=(0,r.useState)(!1),p=(0,uo.O7)(),u=(0,ct.VK)((()=>{const e=i.drawState.state;if(e)return e.startStore===t}),[t,i.drawState]),m=(0,ct.VK)((()=>!u&&i.hoveredItem.state===t&&!Re.Z.state),[u,t,i.hoveredItem]),g=(0,ct.VK)((()=>(0,se.H5)(s)),[s]),y=(0,r.useCallback)((e=>{if(e.preventDefault(),!i.scrollLeft.state||!c.current)return;const r=(0,me.VW)(c.current);Xn.J4({timelineState:i,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:s,verticalScroller:r}),h(!1)}),[s,o,t,i]),v=(0,r.useCallback)((e=>{if(!c.current)return;const t=(0,me.VW)(c.current);Xn.mz({timelineState:i,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[i]),f=(0,r.useCallback)((()=>{W.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:p,perform:e=>{Xn.$o({timelineState:i,environment:p,transaction:e,collectionContextStore:s,isFullScreen:l,isRootChild:a})}})}),[p,i,s,l,a]),C=(0,r.useCallback)((e=>{Xn.x({timelineState:i,environment:p})}),[p,i]),x=(0,r.useCallback)((()=>{h(!0)}),[h]),b=(0,r.useCallback)((()=>{h(!1)}),[h]),w=(0,co.yK)((e=>({draggableStyle:{position:"absolute",top:0,right:-24,width:24,height:"100%",zIndex:1},draggableSvgStyle:{position:"absolute",left:0,cursor:"pointer"},svgPathStyle:{stroke:g?e.collectionValidDependencyArrow:e.collectionUnsetDependencyArrow,strokeWidth:se.lf},svgCircleFill:{color:e.white}})),[g]),k=(0,r.useCallback)((e=>{if(!n.state)return;return(0,S.jsx)("div",{ref:c,style:w.draggableStyle,...e,children:m&&(0,S.jsx)(S.Fragment,{children:(0,S.jsx)("div",{style:w.draggableSvgStyle,children:(0,S.jsxs)("svg",{style:{width:22,height:30},onMouseMove:x,onMouseLeave:b,children:[(0,S.jsx)(ds.Z,{startPoint:{x:0,y:14},endPoint:{x:10,y:14},style:w.svgPathStyle,showArrowHead:d}),(0,S.jsx)("circle",{cx:d?10+se.S7:10,cy:14,r:d?se.S7:se.Wk,style:w.svgPathStyle,fill:w.svgCircleFill.color})]})})})})}),[n,b,x,m,w.draggableStyle,w.draggableSvgStyle,w.svgCircleFill.color,w.svgPathStyle,d]);return(0,S.jsx)(Oi.Z,{render:k,onDraggableDragStart:y,onDraggableDragMove:v,onDraggableDragEnd:f,onDraggableDragCancel:C})}class Da extends n.Z{constructor(){super(...arguments),this.storeTypes={hovered:a.default.createClass(!1)},this.renderDraggableInner=e=>{const{type:t,timelineState:o,dateValueStore:r}=this.props,i="left"===t,n=r.state,s=o.zoomLevel.state,l=this.isActiveStore.state;if(n)return(0,S.jsx)("div",{style:i?Da.leftDraggableStyle:Da.rightDraggableStyle,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,...e,children:l&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:i?this.getLeftDraggableIndicatorStyle():this.getRightDraggableIndicatorStyle()}),(0,S.jsx)("span",{style:i?this.getLeftDraggableLabelStyle():this.getRightDraggableLabelStyle(),children:(0,S.jsx)("span",{style:{background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,padding:4,borderRadius:4},children:i?(0,se.yk)(n,s):(0,se.fc)(n,s)})})]})})},this.handleLeftResizerDragStart=e=>{e.preventDefault();const{type:t,store:o,timelineState:r,query:i,schema:n,intl:s}=this.props;Xn.f$({timelineState:r,store:o,startX:e.startX,type:"left"===t?se.px.LeftResizer:se.px.RightResizer,query:i,schema:n,intl:s,environment:this.environment})},this.handleDraggableDragMove=e=>{const{timelineState:t}=this.props;Xn.td({timelineState:t,currentX:e.currentX})},this.handleDraggableDragEnd=()=>{const{timelineState:e,query:t,schema:o,intl:r,collectionContextStore:i,isFullScreen:n,isRootChild:s,type:l}=this.props;W.createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:this.environment,perform:i=>{Xn.fX({timelineState:e,query:t,schema:o,intl:r,environment:this.environment,transaction:i})}}),M.neX(this.environment,{...(0,se.Ii)({environment:this.environment,collectionContextStore:i,timelineState:e,isFullScreen:n,isRootChild:s}),type:l})},this.handleDraggableDragCancel=e=>{const{timelineState:t}=this.props;Xn.cQ({timelineState:t,environment:this.environment})},this.handleMouseMove=()=>{this.stores.hovered.setState(!0)},this.handleMouseLeave=()=>{this.stores.hovered.setState(!1)},this.isActiveStore=this.createComputedStore((()=>{const{store:e,type:t,timelineState:o}=this.props,r=this.stores.hovered.state,i=o.dragState.state;return i?i.stores[0]===e&&("left"===t?i.type===se.px.LeftResizer:i.type===se.px.RightResizer):r&&!Re.Z.state}))}renderComponent(){return(0,S.jsx)(Oi.Z,{render:this.renderDraggableInner,onDraggableDragStart:this.handleLeftResizerDragStart,onDraggableDragMove:this.handleDraggableDragMove,onDraggableDragEnd:this.handleDraggableDragEnd,onDraggableDragCancel:this.handleDraggableDragCancel})}getLeftDraggableIndicatorStyle(){return{position:"absolute",left:Math.ceil(3.5)+1,top:6,borderRadius:3,width:3,bottom:6,background:this.theme.regularTextColor}}getRightDraggableIndicatorStyle(){return{position:"absolute",left:Math.floor(.5),top:6,borderRadius:3,width:3,bottom:6,background:this.theme.regularTextColor}}getLeftDraggableLabelStyle(){return{fontSize:12,position:"absolute",right:12,textAlign:"right",width:200,lineHeight:`${os.Z}px`,pointerEvents:"none"}}getRightDraggableLabelStyle(){return{fontSize:12,position:"absolute",left:12,width:200,lineHeight:`${os.Z}px`,pointerEvents:"none"}}}Da.displayName="TimelineItemResizer",Da.leftDraggableStyle={position:"absolute",top:0,left:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},Da.rightDraggableStyle={position:"absolute",top:0,right:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"};const Aa=Da,_a=(0,R.defineMessages)({typeAName:{defaultMessage:"Type a name…",id:"timelineItem.itemName.placeholder"}});var La=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(La||{});class Za extends n.Z{constructor(){super(...arguments),this.propertiesWrapEl=r.createRef(),this.renderProperty=(e,t)=>{const{showProperties:o,store:r,disabled:i,blockPropertyValueOverlayStore:n,clonedStore:s}=this.props,l=t===o.length-1,a=null==r?void 0:r.getAssociatedCollectionStore();if(a){if("title"===e)return this.renderTitle(l);if(r&&s)return(0,S.jsx)(Ut.Z,{store:s,property:e,disabled:i||!r.canEdit(),locked:!1,format:$t.C.Timeline,tableWrap:!1,isLast:l,blockPropertyValueOverlayStore:n,enablePointerEventsForInteractiveTypes:!0,collectionStore:a,collectionViewStore:this.props.collectionContextStore.collectionViewStore()},e)}},this.handleSelectableDragStart=e=>{e.preventDefault()},this.handleSelectableDragMove=e=>{const{store:t,timelineState:o,query:r,schema:i,intl:n}=this.props;t&&(o.dragState.state||Xn.f$({timelineState:o,store:t,startX:e.startX,type:se.px.ItemDrag,query:r,schema:i,intl:n,environment:this.environment}),Xn.td({timelineState:o,currentX:e.currentX}))},this.handleSelectableDragEnd=()=>{const{timelineState:e,query:t,schema:o,intl:r}=this.props;W.createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:this.environment,perform:i=>{Xn.fX({timelineState:e,query:t,schema:o,intl:r,environment:this.environment,transaction:i})}})},this.handleSelectableDragCancel=()=>{const{timelineState:e}=this.props;Xn.cQ({timelineState:e,environment:this.environment})},this.handleDateRangeButtonMouseMove=()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state;(Re.Z.state||o)&&!this.isDrawingDependencyStore.state||this.environment.device.isPhone||t.hoveredItem.setState(e)},this.handleDateRangeButtonMouseLeave=()=>{const{timelineState:e}=this.props,t=e.dragState.state;(Re.Z.state||t)&&!this.isDrawingDependencyStore.state||e.hoveredItem.setState(void 0)},this.handleGetGhostElement=e=>{const t=Di.C.findSelectablesFromStore(e),o=C.oA(t.map((e=>e.getNode()))),r=C.oA(o.map((e=>e.closest(`.${ee.o4s}`))))[0];if(r){const e=Fa.eN(r),t=e.cloned.querySelector(`.${ee.ovr}`),o=e.cloned.querySelector(`.${ee.z_z}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.left=t.style.left),[e]}return o.map(Fa.eN)},this.handleTextEnterOrEsc=()=>{const{store:e}=this.props;e&&H.Ys({environment:this.environment,store:e})},this.handleAnimationStateChange=()=>{const{current:e}=this.propertiesWrapEl,t=this.animationStateStore.state;e&&t&&(e.style.position=t.position===La.Absolute?"absolute":"sticky",e.style.left=`${t.left}px`)},this.pageURLStore=this.createComputedStore((()=>{const{store:e}=this.props;if(e)return(0,de.ZP)({store:e,fullyQualified:!1,pageVisitSource:c.tY.LinkInPage})})),this.peekURLStore=this.createComputedStore((()=>{const{store:e,collectionContextStore:t}=this.props,{mainEditorCurrentBlockStore:o}=fe.default.state;if(e&&o)return le.mb({store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1})})),this.isHoveredStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props;return t.hoveredItem.state===e})),this.isDrawingDependencyStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.drawState.state;return o&&o.startStore!==e})),this.editingTitleStore=this.createComputedStore((()=>{var e;const{store:t}=this.props,o=Nt.default.state;if("editing"!==o.mode)return!1;const r=null===(e=(0,Et.QY)(o.multiSelection))||void 0===e?void 0:e.store;return t&&r&&r===t.getBlockTitleStore()})),this.animationStateStore=this.createComputedStore((()=>{const{timelineState:e,scrollerLeftOffset:t,itemPositionStore:o}=this.props,r=o.state;if(r){const{left:o,right:i}=r,n=i-o;if(!(this.canPerformantlyUpdateOnScroll()&&n>50))return{position:La.Absolute,left:o};{const r=e.scrollLeft.state;if(void 0!==r){const e=r+t-o+21;if(e<0)return{position:La.Absolute,left:o};if(e>n)return{position:La.Absolute,left:i};if(e>0)return{position:La.Sticky,left:t+21}}}}})),this.passesFilterStore=this.createComputedStore((()=>{var e,t;const o=(0,te.m1)({collectionContextStore:this.props.collectionContextStore,environment:this.environment}),r=null===(e=this.props.store)||void 0===e?void 0:e.getModel(),i=null===(t=this.props.store)||void 0===t?void 0:t.getRecordModel;if(!o||!r||!i)return!0;const n=Pe.default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,So.q)(o)({block:r,getRecordModel:i,propertyMapping:void 0,formulaTimeoutTimestampMs:Date.now()+n})})),this.shouldShowHighlightHalo=this.createComputedStore((()=>!!this.props.store&&le.Sc(this.props.store)))}didMount(){super.didMount(),this.animationStateStore.addListener(this.handleAnimationStateChange),this.handleAnimationStateChange()}willUnmount(){super.willUnmount(),this.animationStateStore.removeListener(this.handleAnimationStateChange)}willUpdate(){this.animationStateStore.enqueueRecompute()}renderComponent(){const{itemPositionStore:e,store:t,timelineState:o,query:r,schema:i,dateValueStore:n,disabled:s,isDraggingViaTimelineItemStore:l,collectionContextStore:a,isFullScreen:c,isRootChild:d,intl:h}=this.props,p=e.state;if(!p)return;const u=(0,se.H5)(a),{left:m,right:g,maskPercent:y}=p,v=this.isHoveredStore.state,f=this.pageURLStore.state,C=this.peekURLStore.state,x=!s&&(null==t?void 0:t.canEdit()),b=this.environment.device.isPhone,w=x&&!b&&(u||a.permissionScopes.state.canConfigureBlock),k=a.currentSubitemFormatStore.state?42:10,P=Math.max(g-m,k)+1,T=l.state,R=this.renderToggleButton(),M=this.passesFilterStore.state;return t&&!p.isPlaceholder?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(Po.Z,{style:this.getStyle(m,P,T,p,M),haloStyle:this.getHaloStyle(),className:ee.ovr,store:t,canSelect:!0,shouldShowHalo:!0,shouldForceRenderSelectionHalo:this.shouldShowHighlightHalo.state,canDrag:x,analyticsName:"timeline",onDraggableDragStart:this.handleSelectableDragStart,onDraggableDragMove:this.handleSelectableDragMove,onDraggableDragEnd:this.handleSelectableDragEnd,onDraggableDragCancel:this.handleSelectableDragCancel,canTriggerContextMenu:x,getGhostElement:this.handleGetGhostElement,disableScrollToReveal:!0,onMouseMove:this.handleDateRangeButtonMouseMove,onMouseLeave:this.handleDateRangeButtonMouseLeave,showBlockMenuInput:!0,children:[R,(0,S.jsx)(Xt.Z,{style:this.getLinkBoxStyle(),innerStyle:this.getLinkBoxInnerStyle(),onClick:this.props.handleOpenPeekPage,href:f,metaHref:C,hovered:v,ignoreLocalHoverState:!0}),w&&this.renderTimelineItemDependencyDrawHandle(),x&&!b&&(0,S.jsx)(Aa,{type:"left",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d,intl:h,resultStore:this.props.resultStore}),x&&!b&&(0,S.jsx)(Aa,{type:"right",store:t,query:r,schema:i,timelineState:o,dateValueStore:n,collectionContextStore:a,isFullScreen:c,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:d,intl:h,resultStore:this.props.resultStore})]}),this.renderProperties(y,T,M)]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:this.getStyle(m,P,T,p,M),className:ee.ovr}),this.renderProperties(y,T,M)]})}renderToggleButton(){const{collectionContextStore:e,toggleButton:t,itemPositionStore:o}=this.props,r=e.currentSubitemFormatStore.state,i=o.state;if(r&&t&&(null==i||!i.isExistingSubitemPlaceholder))return(0,S.jsx)("span",{style:{zIndex:1,paddingTop:3},children:t})}renderTimelineItemDependencyDrawHandle(){const{store:e,isFullScreen:t,isRootChild:o}=this.props;if(e)return(0,S.jsx)(ja,{store:e,schema:this.props.schema,timelineState:this.props.timelineState,dateValueStore:this.props.dateValueStore,collectionContextStore:this.props.collectionContextStore,isFullScreen:t,isRootChild:o})}renderProperties(e,t,o){const{showProperties:r}=this.props;return(0,S.jsx)("div",{style:this.getPropertiesWrapStyle(e,t,o),children:(0,S.jsx)("div",{style:this.getPropertiesWrapInnerStyle(),ref:this.propertiesWrapEl,className:ee.z_z,children:r.map(this.renderProperty)})})}renderTitle(e){var t;const{store:o}=this.props,r=o?o.getIcon():void 0,i=null==o?void 0:o.hasError(),n=!o||o.isEmptyPage(),s=this.editingTitleStore.state,{parentStore:l,collectionContextStore:a}=this.props,c=a.currentSubitemFormatStore.state,d=c&&l?null===(t=l.getSchema()[c.property])||void 0===t?void 0:t.name:"";return(0,S.jsxs)("div",{style:{display:"flex",marginRight:e?0:10,fontSize:14,fontWeight:P.Z.fontWeight.medium,alignItems:"center"},children:[r&&!i&&(0,S.jsx)(Jt.Z,{disabled:!0,icon:r,isEmptyPage:n,size:20,style:{marginLeft:2,marginRight:6}}),i&&(0,At.t)({display:"inline-block",verticalAlign:"text-top",marginLeft:4,marginRight:7,width:16,fill:this.theme.accentColors.orange[500]}),o&&!s&&(0,S.jsx)(zi.Z,{style:{whiteSpace:"nowrap",maxWidth:400},store:o}),s&&o&&(0,S.jsx)(to.Z,{store:o.getBlockTitleStore(),style:{whiteSpace:this.environment.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableEmbedMenu:!0,onEnter:this.handleTextEnterOrEsc,onEsc:this.handleTextEnterOrEsc,onTab:C.yR,placeholder:pe.default.formatMessage(_a.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline"}),!o&&(0,S.jsx)("span",{children:l&&d?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:d}}):(0,S.jsx)(R.FormattedMessage,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}canPerformantlyUpdateOnScroll(){return(0,se.Tp)(this.environment)}getStyle(e,t,o,r,i){const n=this.theme.mode;return{position:"absolute",left:e,marginTop:1,marginBottom:1,width:t,height:os.Z-2,borderRadius:4,display:"flex",...r.isExistingSubitemPlaceholder?void 0:{..."light"===n?{background:r.isPlaceholder?this.theme.buttonHoveredBackground:this.theme.contentBackground,boxShadow:r.isPlaceholder?void 0:this.theme.buttonBoxShadow}:{background:this.props.isInPeekRenderer?this.theme.calendarItemBackground:this.theme.popoverBackground,boxShadow:r.isPlaceholder?void 0:this.theme.lightBoxShadow}},...r.isPlaceholder&&{cursor:"crosshair"},...o&&{display:"none"},...!i&&{opacity:.5},zIndex:T.ov}}getPropertiesWrapStyle(e,t,o){return{width:"100%",WebkitMaskImage:e<1&&this.isHoveredStore.state?`linear-gradient(90deg, rgba(0,0,0,1) ${100*e}%, rgba(0,0,0,0.4) ${100*e}%)`:void 0,pointerEvents:"none",...t&&{display:"none"},zIndex:T.ov,opacity:o?1:.5}}getPropertiesWrapInnerStyle(){const{collectionContextStore:e,toggleButton:t}=this.props,o=e.currentSubitemFormatStore.state;return{display:"flex",height:os.Z-2+1,paddingLeft:o&&t?24:6,width:800,overflow:"hidden"}}getHaloStyle(){return{borderRadius:4,...le.pB(this.shouldShowHighlightHalo.state,this.theme)}}getLinkBoxStyle(){return{width:"100%",height:"100%",borderRadius:4}}getLinkBoxInnerStyle(){return{width:"100%",height:"100%",display:"flex",paddingLeft:6,paddingRight:6,borderRadius:4}}}Za.displayName="TimelineItemDateRange";const Ea=Za;var Oa=o(31505),za=o(39301),Ga=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Ga||{});class Ha extends n.Z{constructor(){super(...arguments),this.lastVisibilityState=Ga.NotDefined,this.buttonRef=r.createRef(),this.wrapRef=r.createRef(),this.arrowButtonHovered=a.default.createValue(!1),this.handleIsVisibleChange=()=>{const e=this.buttonRef.current,t=this.wrapRef.current;if(e&&t){const o=this.isVisibleStore.state,r=o===Ga.VisibleInItem||o===Ga.VisibleOutOfItem;e.style.opacity=""+(r?1:0),e.style.transform=`scale(${r?1:.3})`,t.style.pointerEvents=o===Ga.VisibleOutOfItem?"":"none";this.lastVisibilityState!==Ga.NotDefined&&o!==Ga.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),this.lastVisibilityState=o}},this.handleClick=()=>{const{store:e,type:t,timelineState:o,dateValueStore:r,paddingLeft:i,format:n,collectionContextStore:s,isFullScreen:l,isRootChild:a}=this.props,c=r.state,d=o.zoomLevel.state,{snapUnit:h}=se.BJ[d],p=(0,se.x2)(d,200);if(c)if("left"===t){const{start:e}=(0,se.XO)(c,h),t=(0,se.GK)({timestamp:e.valueOf(),environment:this.environment,timelineState:o,paddingLeft:i,format:n})-p;Xn.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}else{const{end:e}=(0,se.XO)(c,h),t=(0,se.PF)({timestamp:e.valueOf(),timelineState:o})+p;Xn.Nf({timelineState:o,environment:this.environment,zoomLevel:d,centerTimestamp:t})}this.arrowButtonHovered.setState(!1),H.Ys({environment:this.environment,store:e}),M.gw_(this.environment,{...(0,se.Ii)({environment:this.environment,collectionContextStore:s,timelineState:o,isFullScreen:l,isRootChild:a}),type:t})},this.handleMouseOver=()=>{this.environment.device.isPhone||Re.Z.state||this.arrowButtonHovered.setState(!0)},this.handleMouseOut=()=>{this.environment.device.isPhone||this.arrowButtonHovered.setState(!1)},this.isVisibleStore=this.createComputedStore((()=>{const{type:e,timelineState:t,scrollerLeftOffset:o,itemPositionStore:r,isDraggingViaTimelineItemStore:i}=this.props,n=r.state;if(n){const{left:r,right:s}=n;if(i.state)return Ga.Hidden;const l=t.scrollLeft.state;if(void 0!==l){if("left"===e){const e=l+o;if(e-s>0)return Ga.VisibleOutOfItem;if(e-r>0)return Ga.VisibleInItem}else{const{outerSizeObserver:e}=t,o=l+e.rect.state.width;if(r-o>0)return Ga.VisibleOutOfItem;if(s-o>0)return Ga.VisibleInItem}return Ga.Hidden}}return Ga.NotDefined}))}didMount(){super.didMount(),this.isVisibleStore.addListener(this.handleIsVisibleChange),this.handleIsVisibleChange()}willUnmount(){super.willUnmount(),this.isVisibleStore.removeListener(this.handleIsVisibleChange)}willUpdate(){this.isVisibleStore.enqueueRecompute()}renderComponent(){const{type:e}=this.props,t=this.arrowButtonHovered.state,o="left"===e?Oa.Y:za.n;return(0,S.jsxs)("div",{style:this.getWrapStyle(),onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onMouseDown:he.$0,onClick:this.handleClick,ref:this.wrapRef,children:[(0,S.jsx)("div",{style:this.getArrowStyle(),ref:this.buttonRef,children:o({height:6,fill:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground})}),t&&this.renderDateRange()]})}renderDateRange(){const{dateValueStore:e,timelineState:t}=this.props,o=e.state;if(!o)return;const r=t.zoomLevel.state;return(0,S.jsx)("span",{style:this.getDateRangeStyle(),children:(0,se._Q)(o,r)})}getWrapStyle(){const{type:e,scrollerLeftOffset:t,timelineState:o}=this.props,{outerSizeObserver:r}=o;return{position:"sticky",left:"left"===e?t:r.rect.state.width-220,width:220,height:fa-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===e?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",zIndex:T.fQ}}getArrowStyle(){const{type:e}=this.props;return{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:this.arrowButtonHovered.state?this.theme.regularIconColor:this.theme.mediumIconColor,borderRadius:3,border:`1px solid ${this.theme.contentBackground}`,..."left"===e&&{marginLeft:8,marginRight:4},..."right"===e&&{marginRight:8,marginLeft:4}}}getDateRangeStyle(){return{fontSize:12,paddingLeft:4,paddingRight:4,borderRadius:4,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,pointerEvents:"none"}}}Ha.displayName="TimelineScrollArrow";const Na=Ha;class Wa extends n.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.dateRangeRef=r.createRef(),this.storeTypes={node:a.default.createClass(null)},this.handleEditorMouseDown=e=>{this.environment.device.isMobile||(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{e.preventDefault(),E.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleMouseMove=e=>{const{timelineState:t,store:o,groupFormat:r,disabled:i,query:n,schema:s}=this.props,l=t.dragState.state,a=t.drawState.state,{horizontalScroller:c}=t,d=t.scrollLeft.state,h=t.zoomLevel.state,p=t.currentRange.state,{snapUnit:u,getDateRangePlaceholderDuration:m}=se.BJ[h];if(!a&&Re.Z.state||l||this.getPersistedDateValue()||!c||void 0===d||i)return;const g=c.getBoundingClientRect(),S=d+(e.clientX-g.left),y=(0,se.x2)(h,S),v=Zi.ou.fromMillis(p.startTimestamp+y),f=(0,se.DS)(v,u),C=(0,se.DS)(m(v),u),x=(0,Ii.hT)(f.valueOf(),(0,rt.r)()),b=(0,se.AZ)({startValue:x,snapUnit:u,desiredStart:f,desiredEnd:C});t.dateRangePlaceholder.setState({active:!0,store:o,parentStore:this.parentCollectionStore.state,groupFormat:r,date:b,newTimelineItemProps:void 0,existingTimelineItemProps:{query:n,schema:s}})},this.handleMouseLeave=()=>{const{timelineState:e}=this.props;e.dateRangePlaceholder.setState({active:!1})},this.handleClick=e=>{const{store:t,query:o,schema:r,timelineState:i,groupFormat:n,collectionContextStore:s}=this.props,l=i.dateRangePlaceholder.state,a=s.groupsStore.getGroupState(n);if(a)if(l.active){const{date:e}=l;W.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:i=>{Xn.oP({environment:this.environment,store:t,query:o,schema:r,date:e,transaction:i})}}),i.dateRangePlaceholder.setState({active:!1})}else{const{timelineState:o,collectionContextStore:r}=this.props,{horizontalScroller:i}=o,n=o.scrollLeft.state,s=this.itemPositionStore.state,l=this.dateRangeRef.current;if(!i||void 0===n||!s||!l)return;const d=i.getBoundingClientRect(),h=n+(e.clientX-d.left),p=l.propertiesWrapEl.current;if(!p)return;const u=p.lastElementChild;if(!u)return;const m=n+(u.getBoundingClientRect().right-d.left);h>s.right&&h<=m&&(0,he.ZP)({event,context:he.Af.EditorClick,callback:()=>{(0,ue.X9)()||O.peekBlock({environment:this.environment,store:t,openInNew:ce.DJ(e),peekMode:(0,le.kr)(r.collectionViewStore()),resultsStore:a.resultsStore,collectionContextStore:r,pageVisitSource:c.tY.PeekOpen})}})}},this.onRefChange=e=>{this.stores.node.setState(e)},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,se.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:this.subitemPlaceholderDateStore.state})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.shouldRenderScrollArrowsStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e&&!e.isPlaceholder)})),this.subitemPlaceholderDateStore=this.createComputedStore((()=>{const{subitemPath:e}=this.props,t=(0,fo.ub)(e);if(!t||Boolean(this.dateValueStore.state))return;const o=t.value.store,r=ss.findCollectionTimelineViewItems(o);if(r.length>0){return r[0].dateValueStore.state}})),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,timelineState:t,groupFormat:o}=this.props,r=t.dateRangePlaceholder.state;if(r.active&&r.store===e&&!r.newTimelineItemProps&&(0,ze.ZH)(r.groupFormat,o))return r.date})),this.dateValueStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=this.placeholderDateStore.state;if(r)return r;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return this.getPersistedDateValue()}),!0),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>{const{store:e,timelineState:t}=this.props,o=t.dragState.state,r=cs.ZP.state;return Boolean(o&&o.stores.includes(e)&&r.isDragging&&r.draggedStores.includes(e))})),this.parentCollectionStore=this.createComputedStore((()=>this.props.store.getAssociatedCollectionStore()))}get registries(){return[ss]}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){var e;const{store:t,timelineState:o,scrollerLeftOffset:r,paddingLeft:i,format:n,query:s,schema:l,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,collectionContextStore:h,isFullScreen:p,isRootChild:u,toggleButton:m,groupFormat:g}=this.props,y=this.shouldRenderDateRangeStore.state,v=this.shouldRenderScrollArrowsStore.state,f=null===(e=h.groupsStore.getGroupState(g))||void 0===e?void 0:e.reducerResultStore;if(f)return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{style:{display:"flex",height:0},children:[v&&(0,S.jsx)(Na,{store:t,type:"left",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:h,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:u,resultStore:f}),v&&(0,S.jsx)(Na,{store:t,type:"right",timelineState:o,scrollerLeftOffset:r,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,paddingLeft:i,format:n,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:h,isInPeekRenderer:this.props.isInPeekRenderer,isFullScreen:p,isRootChild:u,resultStore:f})]}),(0,S.jsx)("div",{style:this.getStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,className:ee.o4s,ref:this.onRefChange,children:y&&(0,S.jsx)(Ea,{store:t,parentStore:this.parentCollectionStore.state,toggleButton:m,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:s,schema:l,timelineState:o,blockPropertyValueOverlayStore:a,disabled:c,showProperties:d,scrollerLeftOffset:r,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:h,isFullScreen:p,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:u,intl:pe.default.getIntl(),ref:this.dateRangeRef,resultStore:f,handleOpenPeekPage:this.props.handleOpenPeekPage})})]})}getPersistedDateValue(){const{store:e,query:t,schema:o}=this.props;return(0,se.bk)({store:e,query:t,schema:o,userId:this.environment.currentUser.id,intl:pe.default.getIntl()})}getStyle(){return{display:"flex",height:os.Z+1,width:"100%",cursor:"default"}}}Wa.displayName="CollectionTimelineViewItem";const Ka=Wa;class Ua extends n.Z{constructor(){super(...arguments),this.clonedStore=void 0,this.handleEditorMouseDown=e=>{this.environment.device.isMobile||(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{e.preventDefault(),E.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}})},this.handleMouseMove=e=>{var t;const{timelineState:o,store:r,parentStore:i,groupFormat:n,disabled:s,query:l,schema:a,isFullScreen:c,canEditTimelineItems:d,subitemPath:h,collectionContextStore:p}=this.props,u=o.drawState.state,m=o.dragState.state,{horizontalScroller:g}=o,S=o.scrollLeft.state,y=o.zoomLevel.state,v=o.currentRange.state,{snapUnit:f,getDateRangePlaceholderDuration:C}=se.BJ[y];if(!u&&Re.Z.state||m||!g||void 0===S||s)return;const x=null===(t=p.groupsStore.getGroupState(n))||void 0===t?void 0:t.resultsStore;if(!x)return;const b=g.getBoundingClientRect(),w=S+(e.clientX-b.left),k=(0,se.x2)(y,w),P=Zi.ou.fromMillis(v.startTimestamp+k),T=(0,se.DS)(P,f),R=(0,se.DS)(C(P),f),M=(0,Ii.hT)(T.valueOf(),(0,rt.r)()),I=(0,se.AZ)({startValue:M,snapUnit:f,desiredStart:T,desiredEnd:R});o.dateRangePlaceholder.setState({active:!0,store:r,parentStore:i,groupFormat:n,date:I,newTimelineItemProps:{query:l,schema:a,resultsStore:x,isFullScreen:c,canEditTimelineItems:d,subitemPath:h},existingTimelineItemProps:void 0})},this.handleMouseLeave=()=>{const{timelineState:e}=this.props;e.dateRangePlaceholder.setState({active:!1})},this.handleClick=e=>{const{parentStore:t,query:o,schema:r,timelineState:i,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:c}=this.props,d=i.dateRangePlaceholder.state;if(d.active){const{date:e}=d,h=c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom";W.createAndCommit({userAction:"CollectionTimelineViewItem.handleClick",environment:this.environment,perform:i=>{const d=Xn.mg({environment:this.environment,transaction:i,date:e,store:this.props.store,parentStore:t,query:o,schema:r,isFullScreen:n,groupFormat:s,canEditTimelineItems:l,collectionContextStore:a,subitemPath:c,from:h});M.W2j(this.environment,{from:h,type:"page",new_page_id:null==d?void 0:d.id,...(0,re.Pn)(a)})}}),i.dateRangePlaceholder.setState({active:!1})}},this.itemPositionStore=this.createComputedStore((()=>{const{timelineState:e}=this.props;return(0,se.HZ)({timelineState:e,dateValue:this.dateValueStore.state,placeholderDate:this.placeholderDateStore.state,subitemPlaceholderDate:void 0})})),this.shouldRenderDateRangeStore=this.createComputedStore((()=>{const e=this.itemPositionStore.state;return Boolean(e)})),this.isDraggingViaTimelineItemStore=this.createComputedStore((()=>!1)),this.placeholderDateStore=this.createComputedStore((()=>{const{store:e,parentStore:t,timelineState:o,groupFormat:r}=this.props,i=o.dateRangePlaceholder.state;if(i.active&&i.store===e&&i.newTimelineItemProps&&i.parentStore===t&&(0,ze.ZH)(i.groupFormat,r))return i.date})),this.dateValueStore=this.createComputedStore((()=>{const e=this.placeholderDateStore.state;if(e)return e}),!0)}willMount(e){super.willMount(e),e.store&&(this.clonedStore=e.store.clone())}renderComponent(){var e;const{store:t,parentStore:o,timelineState:r,scrollerLeftOffset:i,query:n,schema:s,blockPropertyValueOverlayStore:l,disabled:a,showProperties:c,collectionContextStore:d,isFullScreen:h,isRootChild:p,toggleButton:u,groupFormat:m}=this.props,g=this.shouldRenderDateRangeStore.state,y=null===(e=d.groupsStore.getGroupState(m))||void 0===e?void 0:e.reducerResultStore,v=!t&&!g&&d.shouldAllowNewItemCreation();if(y)return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{style:this.getStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onClick:this.handleClick,className:ee.o4s,children:[g&&(0,S.jsx)(Ea,{store:o?void 0:t,parentStore:o,toggleButton:u,clonedStore:this.clonedStore,itemPositionStore:this.itemPositionStore,dateValueStore:this.dateValueStore,query:n,schema:s,timelineState:r,blockPropertyValueOverlayStore:l,disabled:a,showProperties:c,scrollerLeftOffset:i,isDraggingViaTimelineItemStore:this.isDraggingViaTimelineItemStore,collectionContextStore:d,isFullScreen:h,isInPeekRenderer:this.props.isInPeekRenderer,isRootChild:p,intl:pe.default.getIntl(),resultStore:y,handleOpenPeekPage:()=>{}}),v&&this.renderAddRowIndicator()]})})}renderAddRowIndicator(){var e;const{parentStore:t,collectionContextStore:o}=this.props,r=o.currentSubitemFormatStore.state,i=r&&t?null===(e=t.getSchema()[r.property])||void 0===e?void 0:e.name:"";return(0,S.jsx)("div",{style:this.getAddRowIndicatorWrapStyle(),children:(0,S.jsxs)("div",{style:this.getAddRowIndicatorStyle(),children:[(0,Je.R)(this.getNewRowIndicatorIconStyle()),(0,S.jsx)("span",{style:{color:this.theme.mediumTextColor},children:t&&i?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:i}}):(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}getStyle(){return{display:"flex",height:os.Z+1,width:"100%",cursor:"default"}}getNewRowIndicatorIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.mediumIconColor}}getAddRowIndicatorWrapStyle(){const{paddingLeft:e,isFullScreen:t,showTable:o}=this.props;return{position:"sticky",left:t&&!o?e+8:8,display:"flex",alignItems:"center"}}getAddRowIndicatorStyle(){return{display:"flex",alignItems:"center",paddingBottom:2,fontSize:14,height:Ca,lineHeight:P.Z.lineHeight.UIRegular.desktop}}}Ua.displayName="CollectionTimelineViewItemNew";const $a=Ua;class qa extends n.Z{constructor(){super(...arguments),this.resultPropsMemo=new Ba.Uw,this.resultProps=()=>{const{groupFormat:e,disabled:t,query:o,format:r,schema:i,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,isRootChild:a,showTable:c,canEditTimelineItems:d,scrollerLeftOffsetStore:h,timelineState:p,paddingLeft:u,showTimelinePropertiesStore:m,isInPeekRenderer:g}=this.props,S=s.permissionScopes.state;return this.resultPropsMemo.memo((()=>({disabled:t||!("collectionTypedView"===s.contextType||S.canEditContent),timelineState:p,schema:i,query:o,format:r,scrollerLeftOffset:h.state,paddingLeft:u,showProperties:m.state,blockPropertyValueOverlayStore:n,collectionContextStore:s,isFullScreen:l,showTable:c,isRootChild:a,groupFormat:e,canEditTimelineItems:d,isInPeekRenderer:g,handleOpenPeekPage:this.handleOpenPeekPage,isLast:!1})),[t,p,i,o,r,h,S,u,m,n,s,l,c,a,e,d,g,this.handleOpenPeekPage])},this.nestedCreateSubitemButton=e=>(0,S.jsx)(Qa,{...this.props,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:this.handleOpenPeekPage}),this.handleOpenPeekPage=()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);if(!o)return;Se.default.mark("collections.open_item_page_lag");const r=e.collectionViewStore();Z.Xd({collectionContextStore:e,resultsStore:o.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,n=i||ko.Ls.timeline;M.hym(this.environment,{is_peek:!0,from:"timeline",peek_mode:n})},this.resultsReducerStore=this.createComputedStore((()=>{const{collectionContextStore:e,schema:t,groupFormat:o,query:r,showTable:i}=this.props;if(!r.timeline_by)return;const n=e.groupsStore.getGroupState(o);if(!n)return;const s=n.currentLimit.state,l=C.oA([o&&(0,ot.Ko)({schema:t,group:o,timeZone:(0,rt.r)()}),!i&&{property:r.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:l.length>0?{operator:"and",filters:l}:void 0,limit:s}}))}renderComponent(){const{store:e,format:t,groupFormat:o,collectionContextStore:r,isFullScreen:i,paddingLeft:n,showTable:s}=this.props,l=r.groupsStore.getGroupState(o);if(!l)return;const a=o?[o]:[],c=this.resultsReducerStore.state,d=l.reducerResultStore.state,h=le.VM({collectionContextStore:r,reducerResult:d,isFullScreen:i});return(0,S.jsxs)(S.Fragment,{children:[c&&(0,S.jsx)(at.Z,{id:a.length>0?`results:${(0,ze.KW)(a)}`:"timeline_results",reducer:c,groupsPointer:a,collectionContextStore:r,resultStore:l.reducerResultStore}),this.renderCollectionGroupResults(),h&&(0,S.jsx)("div",{style:{width:"100%"},children:s?(0,S.jsx)("div",{style:{height:33}}):(0,S.jsx)(gr,{style:{position:"sticky",left:i?n:3,width:"max-content",height:33},groupsPointer:a,store:e,collectionContextStore:r,format:t,isFullScreen:i,incrementLimitsInRelatedGroups:!1})}),(0,S.jsx)(Qa,{...this.props,store:void 0,indentLevel:0,handleOpenPeekPage:this.handleOpenPeekPage})]})}renderCollectionGroupResults(){const{groupFormat:e,format:t,collectionContextStore:o}=this.props,r=o.groupsStore.getGroupState(e);if(r)return(0,S.jsx)(Do,{disableSelectable:!0,collectionContextStore:o,groupsPointer:r.groupsPointer,format:t,canDrag:!1,disableRequest:!0,resultProps:this.resultProps(),canDrop:!1,resultComponent:Ka,disabled:!0,direction:Fo.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:this.nestedCreateSubitemButton})}}function Qa(e){window.__c={n:"AddRowTimelineItem"};const{store:t,parentStore:o,subitemPath:r,timelineState:i,disabled:n,query:s,format:l,schema:a,collectionContextStore:c,blockPropertyValueOverlayStore:d,isFullScreen:h,isRootChild:p,groupFormat:u,paddingLeft:m,showTimelinePropertiesStore:g,scrollerLeftOffsetStore:y,showTable:v,canEditTimelineItems:f,isInPeekRenderer:C,isReady:x,canEdit:b}=e,w=(0,ct.VK)((()=>c.groupsStore.getGroupState(u)),[c,u]),k=(0,ct.VK)((()=>c.permissionScopes.state),[c.permissionScopes]),P=(0,ct.VK)((()=>y.state),[y]),T=(0,ct.VK)((()=>g.state),[g]);return w&&x&&b&&!k.isSyncedCollection?(0,S.jsx)($a,{store:t,disabled:n||!k.canEditContent,timelineState:i,schema:a,query:s,format:l,scrollerLeftOffset:P,paddingLeft:m,showProperties:T,blockPropertyValueOverlayStore:d,collectionContextStore:c,isFullScreen:h,showTable:v,isRootChild:p,groupFormat:u,canEditTimelineItems:f,isInPeekRenderer:C,parentStore:o,subitemPath:r}):null}qa.displayName="TimelineItemGroupResults";const Ya=(0,R.injectIntl)(qa);function Xa(){window.__c={n:"TimelineTableShimmer"};const e=(0,co.yK)((e=>({rowContainer:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${e.regularDividerColor}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginLeft:12,backgroundColor:e.lightDividerColor}})),[]);return(0,S.jsx)("div",{style:e.rowContainer,children:(0,S.jsx)(Ar.Z,{style:e.rowShimmer})})}class Ja extends n.Z{constructor(){super(...arguments),this.groupsPointerMemo=new Ba.Uw,this.groupsPointer=()=>{const{groupFormat:e}=this.props;return this.groupsPointerMemo.memo((()=>e?[e]:[]),[e])},this.renderGroupResults=e=>{const{device:t}=this.environment,{schema:o,disabled:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,groupFormat:c}=this.props,d=i.collectionViewStore();if(!d)return;const h=this.groupsPointer();if(!i.groupsStore.getGroupState(h))return;const p=s.state,u=!l&&t.isMobile&&!d.isSyncedCollection(),m=this.titleColumnIndexStore.state;return(0,S.jsx)(Do,{collectionContextStore:i,groupsPointer:h,disableRequest:!0,format:a,canDrag:u,resultProps:{schema:o,collectionContextStore:i,propertyFormats:p,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:r,blockPropertyValueOverlayStore:n,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableLastCellBorderRight:!0,disableTableWrap:!0,disableCellBorderRight:!0,onShiftEnter:this.onShiftEnter,titleColumnIndex:m,groupFormat:c},resultComponent:oa,canDrop:!1,disabled:r,direction:Fo.Vertical,getItemSelectableStyle:this.getItemSelectableStyle,shouldShowHoverMenu:!0,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:n,titleColumnIndex:m,nestedCreateSubitemButton:this.nestedCreateSubitemButton})},this.nestedCreateSubitemButton=e=>{const{collectionContextStore:t,disabled:o}=this.props,{store:r,parentStore:i,subitemPath:n,indentLevel:s}=e;if(i)return(0,S.jsx)(ln,{store:r,collectionStore:i,subitemPath:n,indentLevel:s,collectionContextStore:t,disabled:o,groupsPointer:this.groupsPointer(),onSubitemCreate:this.onSubitemCreate})},this.onSubitemCreate=e=>{const{collectionContextStore:t,blockPropertyValueOverlayStore:o}=this.props;o&&s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{Lt.bA({isNewBlock:!0,environment:this.environment,blockPropertyValueOverlayStore:o,store:e,property:"title",format:$t.C.Table,collectionContextStore:t,disableHorizontalEdgeScroll:!0})}))}))},this.handleAddRowClick=()=>{const{collectionContextStore:e,isFullScreen:t,groupFormat:o}=this.props,{device:r}=this.environment,i=o?[o]:[],n=e.groupsStore.getGroupState(i);et.M_(this.environment)&&n&&(e.searchQuery.state&&_.Ug({searchQuery:"",collectionContextStore:e,isFullScreen:t}),W.createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:this.environment,perform:t=>{const i=j.IW({environment:this.environment,collectionContextStore:e,groupsPointer:o?[o]:[],coerce:!0,initializeDefaultTemplate:!0,transaction:t,from:"timeline_table_group_results"});if(i){if(r.isMobile){const e=(0,de.ZP)({store:i.newStore,fullyQualified:!1,pageVisitSource:c.tY.Create});this.navigate(e)}else s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{if(i.coercionSucceeded)Lt.bA({environment:this.environment,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,store:i.newStore,property:"title",format:$t.C.Table,collectionContextStore:e,disableHorizontalEdgeScroll:!0});else{const t=o?[o]:[],r=e.groupsStore.getGroupState(t);O.peekBlock({environment:this.environment,store:i.newStore,peekMode:(0,le.kr)(e.collectionViewStore()),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:e,pageVisitSource:c.tY.Create})}}))}));M.W2j(this.environment,{from:"timeline_add_item_bottom",type:"page",new_page_id:i.newStore.id,...(0,re.Pn)(e)})}}}))},this.handleLoadMoreClick=e=>{const{collectionContextStore:t,groupFormat:o}=this.props,r=t.groupsStore.getGroupState(o);if(!r)return;const i=r.reducerResultStore.state;(0,he.Wi)(e),H.ZH(this.environment),i&&j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:this.props.isFullScreen,currentResultCount:i.blockIds.length,groupsPointer:r.groupsPointer,incrementLimitsInRelatedGroups:!1}}),M.uDZ(this.environment)},this.titleColumnIndexStore=this.createComputedStore((()=>{const{showTablePropertyFormatsStore:e}=this.props;return e.state.findIndex((e=>"title"===e.property))})),this.getItemSelectableStyle=()=>({display:"flex",borderBottom:`1px solid ${this.theme.tableDividerColor}`,width:"fit-content",height:33})}renderComponent(){const{groupFormat:e,isFullScreen:t,collectionContextStore:o,blockPropertyValueOverlayStore:r,isReady:i,store:n,disabled:s,format:l,schema:a,isInPeekRenderer:c,paddingBottom:d,query:h,showTablePropertyFormatsStore:p,showHoverActionsStore:u}=this.props,m=o.groupsStore.getGroupState(this.groupsPointer());if(!m)return;const g=m.reducerResultStore.state,y=(0,le.VM)({collectionContextStore:o,reducerResult:g,isFullScreen:t}),v=o.shouldShowSpinner.state&&"on"===Pe.default.getEligibleGroup({experimentId:"collections_loading_state",defaultGroup:"control"}),f=i&&0===(null==g?void 0:g.blockIds.length)&&!v,C=o.permissionScopes.state;return(0,S.jsxs)(S.Fragment,{children:[this.renderTableHeaderRow(e),(0,S.jsx)("div",{style:{height:(0,se.vX)(Boolean(e)),width:0}}),f&&this.renderEmptyTablePlaceholder(),this.renderTableRows(e),v&&(0,S.jsx)(Xa,{}),y&&this.renderLoadMoreButton(),this.shouldShowAddRowButton()&&this.renderTableAddRowButton(),(0,S.jsx)(Ns,{groupFormat:e,style:this.getAggregationRowStyle(),store:n,disabled:s||!C.canConfigureBlock,format:l,schema:a,query:h,collectionContextStore:o,isInPeekRenderer:c,isFullScreen:t,minWidth:void 0,paddingBottom:d,blockPropertyValueOverlayStore:r,showPropertyFormatsStore:p,showHoverActionsStore:u,showRightActionsSpacer:!1}),(e||t)&&(0,S.jsx)("div",{style:{height:xa,width:0,marginBottom:e?se.y1:void 0}})]})}renderTableHeaderRow(e){const{store:t,format:o,schema:r,query:i,collectionContextStore:n,paddingBottom:s,isInPeekRenderer:l,blockPropertyValueOverlayStore:a,tableStore:c,showTablePropertyFormatsStore:d,timelineState:h,isFullScreen:p,isRootChild:u}=this.props;if(!n.groupsStore.getGroupState(e))return;const m=Boolean(e),g=n.permissionScopes.state,y=n.viewIsFlushToTopbar();return(0,S.jsx)(Nl,{store:t,format:o,schema:r,query:i,collectionContextStore:n,isInPeekRenderer:l,minWidth:void 0,paddingBottom:s,blockPropertyValueOverlayStore:a,showPropertyFormatsStore:d,showRightActions:!1,allowHidingTitle:!0,tableStore:c,formatKey:"timeline_table_properties",disabled:!g.canConfigureCollection,disableHorizontalEdgeScroll:!0,height:(0,se.vX)(m),paddingTop:m?0:se.Ne-se.pe,disableTopBorder:!y||m,disableCellRightBorder:!0,groupFormat:e,children:!m&&g.canConfigureBlock&&(0,S.jsx)(Is,{isGrouped:!1,format:o,collectionContextStore:n,timelineState:h,isFullScreen:p,isRootChild:u})})}renderTableRows(e){const{store:t,schema:o,query:r,collectionContextStore:i,blockPropertyValueOverlayStore:n,showTablePropertyFormatsStore:s,canEdit:l,format:a,tableStore:c,paddingLeft:d}=this.props;if(!i.collectionViewStore())return;return i.groupsStore.getGroupState(e)?(0,S.jsx)(ma,{store:t,format:a,schema:o,query:r,collectionContextStore:i,minWidth:void 0,blockPropertyValueOverlayStore:n,showPropertyFormatsStore:s,disabled:!l,disableHorizontalEdgeScroll:!0,groupFormat:e,render:this.renderGroupResults,tableStore:c,paddingLeft:d}):void 0}onShiftEnter(){}renderEmptyTablePlaceholder(){const{canEdit:e}=this.props;return(0,S.jsx)(Qt.Z,{onClick:this.handleAddRowClick,onMouseDown:he.$0,disabled:!e,style:{display:"flex",alignItems:"center",height:Ca,width:"100%",paddingLeft:8,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,background:this.theme.contentBackground,left:0,right:0,borderBottom:`1px solid ${this.theme.tableDividerColor}`},children:e?(0,S.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Empty. Click to add a row.",id:"database.timelineView.emptyTablePlaceholder"})}):(0,S.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Empty.",id:"database.timelineView.cannotEdit.emptyTablePlaceholder"})})})}renderLoadMoreButton(){const{collectionContextStore:e,format:t,canEdit:o}=this.props,r=this.groupsPointer();if(!e.groupsStore.getGroupState(r))return;const i=qe({collectionContextStore:e,groupsPointer:r});return(0,S.jsxs)(Qt.Z,{onMouseDown:he.$0,onClick:this.handleLoadMoreClick,disabled:i,hoveredStyle:i?{background:this.theme.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:Ca+1,width:"100%",paddingLeft:8,paddingBottom:2,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`,borderBottom:`1px solid ${this.theme.tableDividerColor}`,whiteSpace:"break-spaces"},children:[(0,vo.M)(this.getTableNewRowButtonIconStyle()),(0,S.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),i?(0,S.jsx)("div",{style:{marginTop:1,marginLeft:8,marginRight:8},children:(0,S.jsx)(Mt.Z,{style:{width:12,height:12}})}):o&&(0,S.jsx)(ur,{collectionContextStore:e,format:t})]})}renderTableAddRowButton(){return(0,S.jsxs)(Qt.Z,{onClick:this.handleAddRowClick,style:this.getTableAddRowButtonStyle(),className:ee.tfM,onMouseDown:he.$0,children:[(0,Je.R)(this.getTableNewRowButtonIconStyle()),(0,S.jsx)("span",{style:{color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}shouldShowAddRowButton(){const{collectionContextStore:e,isReady:t,canEdit:o}=this.props,r=e.permissionScopes.state;return Boolean(t&&o&&!r.isSyncedCollection)}getTableAddRowButtonStyle(){return{display:"flex",alignItems:"center",height:Ca,width:"100%",paddingLeft:8,fontSize:14,lineHeight:P.Z.lineHeight.UIRegular.desktop,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground}}getTableNewRowButtonIconStyle(){return{width:14,height:14,marginLeft:-1,marginRight:6,fill:this.theme.lightIconColor}}getAggregationRowStyle(){const{isReady:e,groupFormat:t,isFullScreen:o,paddingLeft:r}=this.props;return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",left:r},...o&&!t&&{left:r}}}}Ja.displayName="TimelineTableGroupResults",Ja.contextTypes={...Y.wK,...n.w};const ec=(0,R.injectIntl)(Ja);class tc extends Oe.Z{constructor(){super(...arguments),this.widthEl=null,this.storeTypes={tableStore:ts,hiddenGroupsVisible:a.default.createClass(!1),groupsReducerResultStore:a.default.createClass(void 0)},this.renderTableGroupHeader=e=>{const{format:t,collectionContextStore:o,isFullScreen:r,isRootChild:i}=this.props,n=o.permissionScopes.state;return(0,S.jsxs)(lr,{...e,height:se.Zn-1,paddingTop:se.xd,toggleClosedMarginBottom:se.xd,getComputedStickyStyle:this.getTableGroupHeaderComputedStickyStyle,style:this.getGroupHeaderStyle(e.index),children:[0===e.index&&n.canConfigureBlock&&(0,S.jsx)(Is,{isGrouped:!0,format:t,collectionContextStore:o,timelineState:this.timelineState,isFullScreen:r,isRootChild:i})," "]})},this.renderTableGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,showHoverActionsStore:a,paddingBottom:c,isRootChild:d,disabled:h}=this.props,p=this.isReady.state,u=this.getPaddingLeft();if(s.groupsStore.getGroupState(e))return(0,S.jsx)(ec,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:this.showTablePropertyFormatsStore,showHoverActionsStore:a,tableStore:this.stores.tableStore,paddingLeft:u,paddingBottom:c,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:d,isReady:p,canEdit:this.canEditCollectionTimeline(),disabled:h&&this.canEditCollectionTimeline()})},this.renderTimelineItemGroupResults=e=>{const{store:t,isFullScreen:o,schema:r,query:i,isInPeekRenderer:n,collectionContextStore:s,blockPropertyValueOverlayStore:l,isRootChild:a,disabled:c}=this.props,d=this.isReady.state,h=this.getPaddingLeft();return(0,S.jsx)(Ya,{store:t,groupFormat:e,schema:r,query:i,isInPeekRenderer:n,timelineState:this.timelineState,collectionContextStore:s,blockPropertyValueOverlayStore:l,showTimelinePropertiesStore:this.showTimelinePropertiesStore,paddingLeft:h,format:this.getCurrentFormat(),isFullScreen:o,isRootChild:a,isReady:d,canEdit:this.canEditCollectionTimeline(),disabled:c,showTable:this.showTableStore.state,canEditTimelineItems:this.canEditTimelineItemsStore.state,scrollerLeftOffsetStore:this.scrollerLeftOffsetStore})},this.renderTimelineItemGroupHeader=e=>{if(this.showTableStore.state)return;const t=this.timelineState.outerSizeObserver.rect.state.width;return(0,S.jsx)("div",{style:{position:"sticky",left:0,width:t,height:se.Zn,zIndex:T.sL},children:(0,S.jsx)(lr,{...e,style:{width:"100%",height:"100%",paddingLeft:this.props.isFullScreen?this.getPaddingLeft():32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},getComputedStickyStyle:this.getTimelineItemGroupHeaderStickyStyle,preventToggleBackground:this.props.isInPeekRenderer})})},this.renderTimelineItemHiddenGroupsButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,S.jsx)("div",{style:{width:"100%",height:34,display:"flex"},children:(0,S.jsx)(jr,{...e,style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderTimelineAddGroupButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t,collectionContextStore:o}=this.props;return"collectionTypedView"!==o.contextType?(0,S.jsx)("div",{style:{width:"100%",height:32,display:"flex"},children:(0,S.jsx)(xr,{...e,style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})}):void 0},this.renderTimelineGroupsLoadMoreButton=e=>{if(this.showTableStore.state)return;const{isFullScreen:t}=this.props;return(0,S.jsx)("div",{style:{width:"100%",height:38,display:"flex"},children:(0,S.jsx)(Br,{...e,style:{position:"sticky",left:t?this.getPaddingLeft():3,width:"max-content",paddingLeft:4,paddingRight:8}})})},this.renderRowDropzoneSelectableGroupResults=e=>{const{collectionContextStore:t,store:o,isFullScreen:r,format:i,disabled:n}=this.props;return(0,S.jsx)(Va,{store:o,groupFormat:e,collectionContextStore:t,isFullScreen:r,canEdit:this.canEditCollectionTimeline(),format:i,disabled:n&&this.canEditCollectionTimeline()})},this.renderDropzoneSelectableGroupHeader=()=>{},this.renderDropzoneSelectableHiddenGroupsButton=()=>{},this.renderDropzoneSelectableAddGroupButton=()=>{},this.renderDropzoneSelectableGroupsLoadMoreButton=()=>{},this.handleScrollOffsetChange=e=>{const{collectionContextStore:t,isFullScreen:o}=this.props,r=t.isLoading.state,i=t.groupsStore.getGroupState([]);if(!i)return;const n=i.reducerResultStore.state;e<be.Z.incrementScrollOffset&&n&&!r&&n.hasMore&&j.ID({collectionContextStore:t,environment:this.environment,incrementLimitArgs:{isFullScreen:o,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})},this.handleHorizontalScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,savePreference:o}=e;if(!t)return;const r=t.scrollLeft,i=e.scrollLeft.state;this.environment.device.isIOS&&void 0!==i&&0===r&&i>se.lx?t.scrollLeft=i:(o&&o(),e.scrollLeft.setState(r),(0,se.rr)(this.environment)?this.resetWindowForScrollDebounced():this.resetWindowForScroll())},this.resetWindowForScroll=()=>{const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o}=e;if(!t)return;const r=e.zoomLevel.state,{startTimestamp:i,endTimestamp:n}=e.currentRange.state,s=t.scrollLeft,l=o.rect.state.width,a=(0,se.e$)(r,n-i),c=(0,se.al)(e);if(s<se.lx){const t=-(0,se.x2)(r,se.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}else if(s+l>a-se.lx){const t=(0,se.x2)(r,se.Ge);e.currentRange.setState({startTimestamp:i+t,endTimestamp:n+t}),Xn.Nf({timelineState:e,environment:this.environment,zoomLevel:r,centerTimestamp:c})}},this.resetWindowForScrollDebounced=C.Ds(this.resetWindowForScroll,200),this.handleWidthElMount=e=>{if(this.widthEl=e,e){const{timelineState:t}=this,{outerSizeObserver:o}=t;o.observe(e);const r=(0,me.xH)(e);r&&(t.horizontalScroller=r,(0,ce.lj)(r,"scroll",this.handleHorizontalScroll),this.scrollToCenteredTimestamp())}},this.handleTimelineElMount=e=>{if(e){const{timelineState:t}=this,{timelineSizeObserver:o}=t;o.observe(e)}},this.scrollToCenteredTimestamp=()=>{const{timelineState:e}=this,{startTimestamp:t,endTimestamp:o}=e.currentRange.state;Xn.KA({timelineState:e,centerTimestamp:(t+o)/2})},this.handleGroupHeaderAddItem=(e,t,o)=>{if(this.environment.device.isMobile)O.navigateToBlock({environment:this.environment,store:e,pageVisitSource:c.tY.Create});else{const{collectionContextStore:t}=this.props,{groupFormat:r}=o,i=r?[r]:[],n=t.groupsStore.getGroupState(i);O.peekBlock({environment:this.environment,store:e,peekMode:le.kr(t.collectionViewStore()),resultsStore:null==n?void 0:n.resultsStore,collectionContextStore:t,pageVisitSource:c.tY.Create})}},this.showTablePropertyFormatsStore=this.createComputedStore((()=>this.getTimelineTableProperties().filter((e=>e.visible))),!0),this.tableWidthStore=this.createComputedStore((()=>this.showTableStore.state?this.showTablePropertyFormatsStore.state.reduce(((e,t)=>e+(t.width||0)),0):0)),this.scrollerLeftOffsetStore=this.createComputedStore((()=>(0,se.xI)({environment:this.environment,paddingLeft:this.getPaddingLeft(),format:this.props.format,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild}))),this.scrollPixelWidthStore=this.createComputedStore((()=>{const{timelineState:e}=this,t=e.zoomLevel.state,{startTimestamp:o,endTimestamp:r}=e.currentRange.state;return(0,se.e$)(t,r-o)})),this.showTimelinePropertiesStore=this.createComputedStore((()=>{const{format:e}=this.props;return(e.timeline_properties||[]).filter((e=>{let{visible:t}=e;return t})).map((e=>{let{property:t}=e;return t}))})),this.showTableStore=this.createComputedStore((()=>{const{format:e,isFullScreen:t,isRootChild:o}=this.props;return(0,se.C1)({environment:this.environment,format:e,isFullScreen:t,isRootChild:o})})),this.canEditTimelineItemsStore=this.createComputedStore((()=>{const{query:e,schema:t}=this.props;return le.D2({query:e,schema:t})})),this.isReady=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return e.groupsStore.anyGroupHasResults()})),this.getTimelineItemGroupStyle=e=>{const t=this.showTableStore.state,o=this.getGroupPaddingState(e);let r=0,i=0;return o.groupHeader&&t&&(r+=se.Zn-1),o.tableHeaderRow&&(r+=se.pe),o.tableEmptyRow&&(r+=Ca),o.tableAggregationRow&&(i+=xa),o.hiddenGroupsButton&&t&&(i+=34),o.groupsLoadMoreButton&&t&&(i+=38),o.addGroupButton&&t&&(i+=32),o.groupPaddingBottom&&(i+=se.y1),o.extraGroupMarginBottom&&(i+=se.xd+1),{paddingTop:r,paddingBottom:i,minHeight:se.Zn,boxShadow:e.index>0&&(!t||o.tableHeaderRow)?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}},this.getRowDropzoneSelectableGroupStyle=e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=this.getGroupPaddingState(e);let o=0,r=0;return t.groupHeader&&(o+=se.Zn),t.tableHeaderRow&&(o+=se.pe),t.tableEmptyRow&&(o+=Ca),t.addItemRow&&(r+=os.Z),t.loadMoreButton&&(r+=33),t.tableAggregationRow&&(r+=xa),t.hiddenGroupsButton&&(r+=34),t.groupsLoadMoreButton&&(r+=38),t.groupPaddingBottom&&(r+=se.y1),t.extraGroupMarginBottom&&(r+=se.xd),t.addGroupButton&&(r+=32),t.dropZoneSelectableGroupExtraBottomPadding&&(r+=1),{paddingTop:o,paddingBottom:r}},this.getTableGroupHeaderComputedStickyStyle=e=>({boxShadow:e?`0 -1px 0 ${this.theme.tableDividerColor}`:void 0}),this.getTimelineItemGroupHeaderStickyStyle=e=>e?{background:this.theme.contentBackground,boxShadow:`0 1px 0 ${this.theme.tableDividerColor}`}:{background:"transparent",boxShadow:void 0}}get registries(){return super.registries.concat(Jn.Z)}willMount(e){super.willMount(e),this.timelineState=(0,se.Gz)({isFullScreen:e.isFullScreen,isRootChild:e.isRootChild});const{collectionContextStore:t}=e,o=t.collectionStore(),r=t.collectionViewStore();o&&r&&Xn.j2({timelineState:this.timelineState,environment:this.environment,collectionViewStore:r,collectionContextStore:t})}willMountOrUpdate(e){super.willMountOrUpdate(e);const{timelineState:t}=this,{query:o,collectionContextStore:r}=e;Re.Z.state&&t.hoveredItem.setState(void 0);const i=r.collectionStore();i&&!o.timeline_by&&i.isDefined()&&this.updateOrCreateTimelineProperty(e)}didMountOrUpdate(){super.didMountOrUpdate();const e=this.timelineState,{collectionContextStore:t,isFullScreen:o,isRootChild:r}=this.props;M.iRP(this.environment,(0,se.Ii)({environment:this.environment,collectionContextStore:t,timelineState:e,isFullScreen:o,isRootChild:r}));const i=e.drawState.state;if(null!=i&&i.tryToCompleteDrawnArrow){(0,se.H5)(t)&&W.createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:this.environment,perform:i=>{Xn.$o({timelineState:e,environment:this.environment,transaction:i,collectionContextStore:t,isFullScreen:o,isRootChild:r})}})}}willUnmount(){super.willUnmount();const{timelineState:e}=this,{horizontalScroller:t,outerSizeObserver:o,timelineSizeObserver:r}=e;o.destroy(),r.destroy(),e.destroyed=!0,t&&(0,ce.ZV)(t,"scroll",this.handleHorizontalScroll)}customizeEdgeScrollRect(e){const t=this.scrollerLeftOffsetStore.state;return Ai.iL.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}addBlockToView(e){const{store:t,transaction:o}=e,{collectionContextStore:r}=this.props,i=r.collectionStore();if(i)return Xn.Fv({environment:this.environment,store:t,timelineState:this.timelineState,query:this.props.query,collectionStore:i,collectionContextStore:this.props.collectionContextStore,groupFormat:void 0,transaction:o})}renderPersisted(){const{store:e,isInPeekRenderer:t,paddingRight:o,isFullScreen:r,isRootChild:i,query:n,schema:s,format:l,collectionContextStore:a,disabled:c}=this.props,{timeline_by:d}=n;if(!d)return this.renderMissingDateProperty();const h=s[d];if(!h||!Bt.Lt(h))return this.renderMissingDateProperty();const{timelineState:p}=this,u=this.scrollerLeftOffsetStore.state,m=this.showTableStore.state,g=this.getPaddingLeft(),y=le.az(a,r),v=l.collection_group_by,f=a.viewIsFlushToTopbar(),C=(0,Qe.Z)((d=>(0,S.jsx)(Rr,{isFullScreen:r,renderEmitter:a.renderEmitter,children:(0,S.jsx)("div",{style:this.getStyle(m),className:ee.kDE,...d,children:(0,S.jsxs)(Po.Z,{store:e,analyticsName:"timeline",shouldShowHalo:!r,canSelect:!r,children:[(0,S.jsx)(Ta,{timelineState:p,isInPeekRenderer:this.props.isInPeekRenderer}),(0,S.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:se.Ne},ref:this.handleTimelineElMount,children:[v?this.renderTimelineItemGroups(v):this.renderTimelineItemGroupResults(void 0),(0,S.jsx)(vs,{timelineState:p,disabled:c,isReady:this.isReady.state,renderEmitter:a.renderEmitter,isFullScreen:r,isRootChild:i})]}),(0,S.jsx)(As,{isInPeekRenderer:t,timelineState:p,query:n,schema:s,scrollerLeftOffset:u,collectionContextStore:a,showTable:m}),(0,S.jsx)(Ts,{timelineState:p,isInPeekRenderer:t,paddingLeft:g,paddingRight:!r&&i?8:o,format:l,scrollerLeftOffset:u,isFullScreen:r,isRootChild:i,showTable:m,collectionContextStore:a,isReady:this.isReady.state}),m&&this.renderTable(v,g),(0,S.jsx)("div",{style:{paddingTop:se.Ne,pointerEvents:"none"},children:v?this.renderRowDropzoneSelectableGroups(v):(0,S.jsx)("div",{style:this.getRowDropzoneSelectableGroupStyle(void 0),children:this.renderRowDropzoneSelectableGroupResults(void 0)})}),!y&&(0,S.jsx)($r.Z,{onChange:this.handleScrollOffsetChange})]})})})));return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{ref:this.handleWidthElMount}),!f&&(0,S.jsx)("div",{style:{height:4}}),C]})}renderMissingDateProperty(){return(0,S.jsx)("div",{style:{paddingLeft:this.getPaddingLeft(),paddingRight:this.props.paddingRight},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Unable to render this view because the database is missing a date property.",id:"database.timelineView.missingDateProperty"})})}renderTable(e,t){const{store:o,isFullScreen:r,collectionContextStore:i}=this.props;return(0,S.jsx)("div",{style:{position:"sticky",left:0,height:0,width:this.tableWidthStore.state,zIndex:T.eU},children:(0,S.jsx)(Po.Z,{style:this.getTableSelectableStyle(t),store:o,shouldShowHalo:!1,canSelect:!r,analyticsName:"timeline",children:e?this.renderTableGroups(e):(0,S.jsx)(Rr,{isFullScreen:r,ignoreAncestorContainer:!0,renderEmitter:i.renderEmitter,children:(0,S.jsx)("div",{children:this.renderTableGroupResults(void 0)})})})})}renderTableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,S.jsx)(Ur,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderTableGroupResults,renderHeader:this.renderTableGroupHeader,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,ignoreAncestorStickyContainer:!0,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!1})}renderTimelineItemGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,S.jsx)(Ur,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderTimelineItemGroupResults,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderTimelineItemGroupHeader,getGroupStyle:this.getTimelineItemGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,renderHiddenGroupsButton:this.renderTimelineItemHiddenGroupsButton,renderAddGroupButton:this.renderTimelineAddGroupButton,renderGroupsLoadMoreButton:this.renderTimelineGroupsLoadMoreButton,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}renderRowDropzoneSelectableGroups(e){const{store:t,format:o,collectionContextStore:r,schema:i,disabled:n,isFullScreen:s,paddingLeft:l,isRootChild:a,isInPeekRenderer:c}=this.props;return(0,S.jsx)(Ur,{store:t,id:"timeline_groups",groupBy:e,groupsFormatKey:ze.Uh,groupAggregationKey:ze.dQ,format:o,schema:i,collectionContextStore:r,disabled:n,isFullScreen:s,renderGroup:this.renderRowDropzoneSelectableGroupResults,onGroupHeaderAddItem:this.handleGroupHeaderAddItem,hiddenGroupsVisible:this.stores.hiddenGroupsVisible,renderHeader:this.renderDropzoneSelectableGroupHeader,getGroupStyle:this.getRowDropzoneSelectableGroupStyle,reducerResultStore:this.stores.groupsReducerResultStore,disableReducerRequest:!0,renderHiddenGroupsButton:this.renderDropzoneSelectableHiddenGroupsButton,renderAddGroupButton:this.renderDropzoneSelectableAddGroupButton,renderGroupsLoadMoreButton:this.renderDropzoneSelectableGroupsLoadMoreButton,paddingLeft:l,isRootChild:a,isInPeekRenderer:c,shouldSurpressShimmer:!0})}getCurrentFormat(){const{format:e}=this.props,{temporaryFormat:t}=this.stores.tableStore.state;return t||e}getTimelineTableProperties(){const e=this.getCurrentFormat();return e&&e.timeline_table_properties?e.timeline_table_properties:[]}updateOrCreateTimelineProperty(e){const{schema:t}=e,{collectionContextStore:o}=this.props,r=o.permissionScopes.state,i=o.collectionStore();if(!i)return;const n=o.collectionViewStore();if(!n||!r.canConfigureBlock)return;const s=(0,R.defineMessages)({date:{id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}});W.createAndCommit({userAction:"CollectionTimelineView.updateOrCreateTimelineProperty",environment:this.environment,perform:e=>{let o,l=le.HI(t);if(!l&&r.canConfigureCollection){l=(0,He.ZP)();o={[l]:{name:pe.default.formatMessage(s.date),type:"date"}}}_.Es({collectionViewStore:n,update:{timeline_by:l},transaction:e}),We.sW({store:n,data:{type:"timeline"},transaction:e}),o&&_.xO({environment:this.environment,collectionStore:i,update:o,transaction:e})}})}canEditCollectionTimeline(){const e=this.props.collectionContextStore.permissionScopes.state;return this.canEdit()&&e.canEditContent&&!e.isSyncedCollection}isInlineFullWidth(){const{isRootChild:e,isFullScreen:t,format:o}=this.props;return(0,se.fj)({environment:this.environment,isRootChild:e,isFullScreen:t,format:o})}getGroupPaddingState(e){const{groupFormat:t,currentGroups:o,visibleGroups:r,hiddenGroups:i,total:n}=e,{collectionContextStore:s,isFullScreen:l,disabled:a,format:c}=this.props,{hiddenGroupsVisible:d}=this.stores,h=c.collection_group_by,p=this.showTableStore.state,u=s.groupsStore.getGroupState(t),m=Boolean(t&&!(null!=u&&u.toggleStateStore.state)),g=this.isFirstNonCollapsedGroup(t,m,o),S=null==u?void 0:u.reducerResultStore.state,y=le.VM({collectionContextStore:s,reducerResult:S,isFullScreen:l}),v=t===i[i.length-1],f=t===r[r.length-1],C=r.length<n,x=d.state?v:f,b=s.permissionScopes.state,w=x&&!a&&b.canConfigureBlock&&h&&(0,ze.Wz)(h,b.canConfigureCollection),k=S&&0===S.blockIds.length;return{groupHeader:Boolean(t&&(!p||!g)),tableHeaderRow:Boolean(p&&!m&&!g),tableAggregationRow:Boolean(p&&!m),addItemRow:Boolean(this.canEditCollectionTimeline()&&!m),hiddenGroupsButton:Boolean(f&&i.length>0),groupsLoadMoreButton:Boolean(f&&C),loadMoreButton:Boolean(!m&&y),groupPaddingBottom:Boolean(!m),tableEmptyRow:Boolean(p&&!m&&k),extraGroupMarginBottom:Boolean(p&&m),addGroupButton:Boolean(w),dropZoneSelectableGroupExtraBottomPadding:Boolean(!p)}}isFirstNonCollapsedGroup(e,t,o){const{collectionContextStore:r}=this.props;if(!e)return!0;const i=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<i){const t=r.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}getPaddingLeft(){return this.isInlineFullWidth()?se.Qw:this.props.paddingLeft}getStyle(e){const{isFullScreen:t,paddingBottom:o}=this.props,r=this.scrollPixelWidthStore.state,i=this.isReady.state;return{position:"relative",float:"left",minWidth:"100%",width:r,background:this.props.isInPeekRenderer?this.theme.peekTimelineBackground:this.theme.timelineBackground,...!t&&!e&&{borderBottom:`1px solid ${this.theme.tableDividerColor}`},...!i&&{minHeight:150},...t&&{paddingBottom:o},height:this.getComputedOuterHeight()}}getTableSelectableStyle(e){return{whiteSpace:"nowrap",background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,paddingLeft:e,borderRight:`1px solid ${this.theme.tableDividerColor}`,boxShadow:this.theme.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:this.tableWidthStore.state+e+1,height:this.getComputedOuterHeight()}}getComputedOuterHeight(){const{device:e}=this.environment,{paddingBottom:t,isFullScreen:o}=this.props,{timelineSizeObserver:r}=this.timelineState,i=r.rect.state.height||120,n=this.showTableStore.state;return i+t+(o?0:72)+(!o&&n?28:0)+(o&&e.isMobile?72:0)}getGroupHeaderStyle(e){const{collectionContextStore:t}=this.props,o=t.viewIsFlushToTopbar();return 0!==e||o?{borderTop:`1px solid ${this.theme.tableDividerColor}`}:{}}}tc.displayName="CollectionTimelineView",tc.contextTypes={...Y.wK,...n.w};const oc=tc;var rc=o(9999),ic=o(39567),nc=o(89086),sc=o(44862);class lc extends n.Z{renderComponent(){const{store:e,titleStyle:t,actionButton:o,collectionContextStore:r}=this.props;return(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{style:{display:"flex"},children:[(0,S.jsx)(zi.Z,{store:e,style:t}),o]}),(0,S.jsx)(sc.Z,{collectionStore:e,collectionContextStore:r})]})}}lc.displayName="CollectionHeader";const ac=lc;var cc=o(19987);const dc=(0,R.defineMessages)({titlePlaceholder:{defaultMessage:"Untitled",id:"database.source.titlePlaceholder"}});class hc extends n.Z{constructor(){super(...arguments),this.getIconSize=()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return 22;return t.isSyncedCollection()?58:22},this.renderActionsPopup=e=>{const{collectionContextStore:t}=this.props,o=t.permissionScopes.state,r=t.collectionStore();if(!r)return;const i=r.isSyncedCollection(),n=C.oA([{key:"view",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,rc.J)(this.getSvgIconStyle())}),action:o=>{const r=this.getHref();if(!r)return;const i=ce.DJ(o.event);O.navigate({environment:this.environment,url:r,openInNew:i}),i||e.close(),I.wd({environment:this.environment,collectionContextStore:t,action:"click_source_view"})}},o.canConfigureCollection&&!i&&{key:"edit_name",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,jt.R)(this.getSvgIconStyle())}),action:()=>{N.mT({environment:this.environment,store:r.getNameStore(),canSelectAllBlocks:!1}),e.close(),I.wd({environment:this.environment,collectionContextStore:t,action:"click_source_edit_title"})}}]),s={key:"show_title",render:e=>(0,S.jsx)(ut.Z,{...e,icon:(0,nl.L)(this.getSvgIconStyle(!0)),title:(0,S.jsx)(R.FormattedMessage,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{const{collectionContextStore:t}=this.props,o=t.collectionViewStore();o&&(W.createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:this.environment,perform:e=>{Ne.FH({stores:[o],update:{hide_linked_collection_name:!0},transaction:e})}}),e.close(),I.wd({environment:this.environment,collectionContextStore:t,action:"click_source_hide_title"}))}};return(0,S.jsx)(St.Z,{type:St.i.Vertical,sections:C.oA([{key:"actions",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:n},o.canConfigureBlock&&{key:"show_title",render:e=>(0,S.jsx)(Ct.Z,{...e,topBorder:!0}),items:[s]}]),initialFocus:void 0})},this.handleRecordIconChange=e=>{const{collectionContextStore:t}=this.props,o=t.collectionStore();if(!o)return;const r=o&&o.getIconStore();r&&W.createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:this.environment,perform:t=>{We.sO({store:r,value:e,transaction:t})}})},this.handleNameBlur=()=>{H.ZH(this.environment)},this.handleNameButtonClick=()=>{const{collectionContextStore:e}=this.props;I.wd({environment:this.environment,collectionContextStore:e,action:"click_collection_name_link_button"})},this.handleNameInputClick=()=>{const{collectionContextStore:e}=this.props;I.wd({environment:this.environment,collectionContextStore:e,action:"click_collection_name_input"})},this.isEditingName=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return!1;const o=t.getNameStore();return Boolean((0,nc.J5)(o))})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>{const{store:e}=this.props,t=Ae.default.state;return(0,le.Ks)(e)||!(0,le.en)(e)&&t.open&&t.isClosing}))}renderComponent(){var e;const{collectionContextStore:t,isFullScreen:o,canEdit:r}=this.props,i=t.collectionStore(),n=t.permissionScopes.state,s=t.collectionViewBlockStore();if(!i||!s)return;const l=Boolean((null===(e=i.getParentBlockStore())||void 0===e?void 0:e.id)===s.id),a=Boolean(i.isSyncedCollection()),c=this.isEditingName.state,d=this.isInFrameWhenSidePeekOpen.state,{WindowSizeStore:h}=this.environment,p=Math.min(X.CC,h.state.width),u=(l||c)&&n.canConfigureCollection&&!a;return(0,S.jsxs)("div",{style:{...(o||d)&&(0,me.eA)(this.environment)&&{position:"sticky",left:0},paddingTop:8,boxSizing:d?"content-box":void 0,width:d?p:"100%",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[u?this.renderNameInput():this.renderLinkButton(),a&&(0,S.jsx)("div",{style:{display:"flex"},children:(0,S.jsx)(cc.Z,{canEdit:r,store:s,buttonStyle:{margin:0}})})]})}renderActionButton(){const{showHoverActionsStore:e}=this.props;return(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:e.state?1:0},render:()=>(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",marginLeft:4},children:(0,S.jsx)(mt.ZP,{popupType:this.environment.device.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,render:this.renderActionsPopup,renderOrigin:e=>(0,S.jsx)(nr.Z,{icon:m.o,...e}),style:{width:240},originGap:4})})})}renderLinkButton(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore();if(t&&o)return(0,S.jsxs)(Xt.Z,{style:{width:"max-content",maxWidth:"100%",marginRight:4,...P.Z.textOverflowStyle},innerStyle:{paddingLeft:4,paddingRight:4,display:"flex",alignItems:"center",borderRadius:3},href:this.getHref(),onClick:this.handleNameButtonClick,children:[this.renderIcon(!0),(0,S.jsx)(ac,{actionButton:this.renderActionButton(),store:t,collectionContextStore:e,titleStyle:this.getTitleStyle()})]})}renderNameInput(){const{collectionContextStore:e}=this.props,t=e.collectionStore(),o=e.collectionViewBlockStore();if(t&&o)return(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",marginLeft:4,marginRight:4},children:[this.renderIcon(!1),(0,S.jsx)(to.Z,{store:t.getNameStore(),style:{...this.getTitleStyle(),marginRight:4},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:pe.default.formatMessage(dc.titlePlaceholder),onEnter:this.handleNameBlur,onEsc:this.handleNameBlur,onClick:this.handleNameInputClick,disableShiftEnter:!0,pasteBehavior:"inline"}),this.renderActionButton()]})}renderIcon(e){var t;const{collectionContextStore:o}=this.props,r=o.collectionStore(),i=o.collectionViewBlockStore();if(!r||!i)return;const n=r.getIcon(),s=Boolean((null===(t=r.getParentBlockStore())||void 0===t?void 0:t.id)===i.id);return n?(0,S.jsxs)("div",{style:{position:"relative",width:this.getIconSize()+2,height:this.getIconSize()+2,marginRight:4},children:[e?(0,S.jsx)(Jt.Z,{disabled:!0,bucket:"secure",store:r,icon:n,isEmptyPage:!1,style:this.getIconStyle(),size:this.getIconSize()}):(0,S.jsx)(Jt.Z,{disabled:!1,bucket:"secure",store:r,icon:n,isEmptyPage:!1,style:this.getIconStyle(),size:this.getIconSize(),iconLoggingData:{recordTable:r.table,source:"inline_collection",block_type:i.getType(),collection_id:r.id},onChange:this.handleRecordIconChange}),!s&&(0,ic.Y)({position:"absolute",width:"50%",height:"50%",right:0,bottom:0,fill:"dark"===this.theme.mode?this.theme.regularTextColor:"#3E3C38",stroke:"dark"===this.theme.mode?this.theme.sidebarBackground:"white",strokeWidth:"dark"===this.theme.mode?"1.85px":"1.5px"})]}):!s&&(0,S.jsx)("div",{style:{width:20,marginRight:4},children:(0,rc.J)({width:20})})}getHref(){const{collectionContextStore:e}=this.props,t=e.collectionStore();if(!t)return;const o=t.getParentBlockStore();return o?(0,de.ZP)({store:o,fullyQualified:!1,pageVisitSource:c.tY.Breadcrumb}):void 0}getTitleStyle(){return{fontWeight:P.Z.fontWeight.bold,fontSize:22}}getIconStyle(){return{width:this.getIconSize(),height:this.getIconSize(),marginRight:4}}getSvgIconStyle(e){return{width:24,height:e?24:16,fill:this.theme.regularIconColor}}}hc.displayName="CollectionViewBlockSource";const pc=(0,R.injectIntl)(hc);var uc=o(34660),mc=o(80503),gc=o(31194);class Sc extends n.Z{constructor(){super(...arguments),this.storeTypes={placementStore:a.default.createClass(void 0),headerRectStore:a.default.createClass(void 0),shouldScrollIntoViewStore:a.default.createClass(!1)},this.lastPlacement=void 0,this.justOpened=!1,this.renderMenu=e=>{const{collectionContextStore:t}=this.props;if(!this.stores.shouldScrollIntoViewStore.state)return(0,S.jsx)($n.P,{context:ie.HV.ViewSettings,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e})},this.handleClose=e=>{(0,he.ZP)({event:e,context:he.Af.CollectionSettingsClick,callback:()=>{const{collectionContextStore:e}=this.props;D.E3({collectionSettingsStore:e.settingsStore})}})},this.captureMouseDown=e=>{(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{N.ZH(this.environment)}})},this.sidebarLayoutStore=this.createComputedStore((()=>{const e=this.props.headerSizeObserver.rect.state,t=this.environment.WindowSizeStore.state.height,o=e.height-40;return{maxHeight:t-(e.top+40),moveUp:o}}))}willMountOrUpdate(e){const{collectionContextStore:t}=e,o=this.settingsOpen(),r=this.stores.placementStore.state;o&&!r&&this.props.headerSizeObserver.recompute();const i=this.props.headerSizeObserver.rect.state;if(o&&!r&&i){const e=this.getPlacement(i);this.stores.placementStore.setState(e),this.justOpened=!0,this.lastPlacement=e}else this.justOpened=!1;o||this.stores.placementStore.setState(void 0),this.justOpened&&(!t.isFullScreen.state&&"popup"!==this.stores.placementStore.state||Ae.default.isSidePeekOpen())&&this.stores.shouldScrollIntoViewStore.setState(!0)}didMountOrUpdate(){const{collectionContextStore:e}=this.props,{shouldScrollIntoViewStore:t}=this.stores;if(t.state){const o=e.collectionViewBlockStore();if(o){const t=An.R.findCollectionViewBlockFromStore(o);if(t){const o=i.findDOMNode(t);if(o){const t=o.getBoundingClientRect(),r=this.environment.WindowSizeStore.state.height-t.bottom,i=t.top;(r<Qn.j9||i<mc.Aj||e.isInPeekRenderer.state)&&((0,me.Wr)(o,{edgeDist:0,animate:!1}),this.props.headerSizeObserver.recompute())}}}t.setState(!1)}}renderComponent(){const{paddingRight:e,collectionContextStore:t}=this.props,o=this.settingsOpen(),r=this.lastPlacement,i=t.isFullScreen.state,n=t.viewIsFlushToTopbar(),s=this.getCurrentViewType(),l=("timeline"===s||"table"===s)&&n;if(r){if("sidebar"===r){const t=this.sidebarLayoutStore.state;if(!t)return;const{maxHeight:r,moveUp:n}=t;return(0,S.jsx)(En.Z,{isVisible:o,enterAnimationStyle:{opacity:0,translateX:12},animationStyle:{opacity:1,translateX:0},exitAnimationStyle:{opacity:0,translateX:12},springConfig:yc,render:()=>(0,S.jsx)(xs.Z,{capture:o,allowMobileAutoScroll:!0,allowUndo:!0,render:t=>(0,S.jsx)("div",{style:{position:"absolute",top:(l?1:0)-n,right:-e,height:`calc(100% + ${n}px)`,background:this.props.isInPeekRenderer?this.theme.cardContentBackground:this.theme.contentBackground,borderLeft:`1px solid ${this.theme.tableDividerColor}`,paddingRight:e,zIndex:T.Nm,...i&&{height:r},...!i&&{maxHeight:r}},className:ee.Dkf,...(0,lt.Z)({onMouseDown:this.captureMouseDown},t),children:(0,S.jsxs)("div",{style:{display:"flex",height:"100%"},children:[(0,S.jsx)("div",{style:{boxShadow:`0 -1px 0 ${this.theme.tableDividerColor}`},children:this.renderMenu(!0)}),(0,S.jsx)("div",{style:{width:e}})]})})})})}return(0,S.jsx)(ft.ZP,{popupType:this.environment.device.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,open:o,placementToOrigin:gc.Iw.Bottom,alignmentToOrigin:gc.lU.End,style:{marginTop:-1},origin:(0,S.jsx)("div",{}),render:this.renderMenu,onDismiss:this.handleClose,originRect:this.props.headerSizeObserver.rect.state})}}settingsOpen(){const{collectionContextStore:e}=this.props,t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}getPlacement(e){const{collectionContextStore:t}=this.props;if(!this.settingsOpen())return;const o=(null==e?void 0:e.width)||0;return this.environment.device.isMobile||Ae.default.isSidePeekOpen()||!(t.isFullScreen.state||o>600)?"popup":"sidebar"}getCurrentViewType(){var e;const{collectionContextStore:t}=this.props,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}}Sc.displayName="CollectionViewSettingsPopup";const yc={translateX:{stiffness:120,damping:12,precision:.1},opacity:{stiffness:120,damping:10,precision:.001}},vc=(0,R.injectIntl)(Sc);let fc;class Cc{constructor(e){this.style=void 0,this.lastResult=void 0,this.style=e.style}measure(e){var t;if(e===(null===(t=this.lastResult)||void 0===t?void 0:t.text))return this.lastResult.rect;fc||(fc=document.createElement("div"),fc.style.position="absolute",fc.style.left="0",fc.style.top="0",fc.style.pointerEvents="none",fc.style.opacity="0",document.body.appendChild(fc)),C.M6(this.style,((e,t)=>{fc&&(fc.style[t]=e)})),fc.textContent=e;const o=fc.getBoundingClientRect();return this.lastResult={text:e,rect:o},o}}var xc=o(1136),bc=o(29798),wc=o(13401),kc=o(73657),Pc=o(55964),Tc=o(27714),Rc=o(53470);class Mc extends n.Z{constructor(){super(...arguments),this.isMyTasksPage=this.createComputedStore((()=>{var e;const t=null===(e=this.props.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return!!t&&(0,X.qG)(t)}))}renderComponent(){const e=this.getMenuSections();return(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:void 0,sections:C.oA(e.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,S.jsx)(Ct.Z,{...e,topBorder:0!==t}),items:e}})))})}getMenuSections(){const{onClose:e,collectionContextStore:t,collectionViewStore:o,intl:r}=this.props,i=t.permissionScopes.state,n=t.collectionViewStore(),s=t.collectionViewBlockStore();if(!n||!s)return[];const l=n.id===o.id,a=o.getAppConfigUri(),c=!(0,vr.$K)(a)||!(0,J.xB)(a),d=[];if(d.push([]),i.canConfigureBlock){if(d[0].push({key:"rename",render:e=>(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Left,disableTooltip:c,render:t=>(0,S.jsx)(ut.Z,{...e,disabled:!c,disabledFeedback:!0,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Rename",id:"database.viewSettings.viewActionMenu.rename"}),icon:(0,Rc.H)(this.getSvgIconStyle(!1)),...t}),renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{id:"database.viewSettings.viewActionMenu.cannotRename",defaultMessage:"This view can’t be renamed."})}),action:()=>{I.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_rename"}),null==e||e(!0),l||_.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state}),D.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore,selectViewNameInitial:!0})}}),"page"===o.getType())return d;d[0].push({key:"edit",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Edit view",id:"database.viewSettings.viewActionMenu.editView"}),icon:(0,dl.W)(this.getSvgIconStyle(!1))}),action:()=>{I.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_edit"}),null==e||e(!0),l||_.f8({environment:this.environment,collectionContextStore:t,collectionViewId:o.id,isFullScreen:t.isFullScreen.state,isRootChild:t.isRootChild.state,isInPeekRenderer:t.isInPeekRenderer.state}),D.r$({collectionContextStore:t,collectionSettingsStore:t.settingsStore})}})}d.push([]),d[1].push({key:"copyLink",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Copy link to view",id:"database.viewSettings.viewActionMenu.copyLink"}),icon:(0,Tc.N)(this.getSvgIconStyle(!1))}),action:async()=>{I.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_copy_link"}),await D.Ol({environment:this.environment,collectionContextStore:t,collectionViewStore:o}),null==e||e(!1)}});return o.getFormat().hide_linked_collection_name&&i.canConfigureBlock&&d[1].push({key:"showDatabaseTitle",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Show database title",id:"database.viewSettings.viewActionMenu.showDatabaseTitle"}),icon:(0,Pc.N)(this.getSvgIconStyle(!0))}),action:()=>{I.wd({environment:this.environment,collectionContextStore:t,action:"click_source_show_title"}),W.createAndCommit({userAction:"CollectionViewActionMenu.getMenuSections",environment:this.environment,perform:e=>{Ne.FH({stores:[o],update:{hide_linked_collection_name:!1},transaction:e})}}),null==e||e(!1)}}),d.push([]),i.canConfigureBlock&&!this.isMyTasksPage.state&&d[2].push({key:"duplicate",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Duplicate",id:"database.viewSettings.viewActionMenu.duplicate"}),icon:(0,il.a)(this.getSvgIconStyle(!1))}),action:()=>{I.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_duplicate"}),D.zt({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,intl:r}),null==e||e(!0)}}),i.canConfigureBlock&&!this.isMyTasksPage.state&&d[2].push({key:"delete",render:e=>(0,S.jsx)(ut.Z,{...e,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Delete",id:"database.viewSettings.viewActionMenu.delete"}),icon:(0,Eo.y)(this.getSvgIconStyle(!1))}),action:async()=>{I.wd({environment:this.environment,collectionContextStore:t,action:"view_action_menu_delete"});await D.TT({environment:this.environment,collectionContextStore:t,collectionViewStore:o,collectionSettingsStore:t.settingsStore,from:"view_action_menu"})&&(null==e||e(!1))}}),d}getSvgIconStyle(e){return{width:24,height:e?24:16,fill:this.theme.regularIconColor}}}Mc.displayName="CollectionViewActionMenu";const Ic=(0,R.injectIntl)(Mc);class Vc extends n.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Ce.Z},this.renderActionMenu=()=>{const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:st.og.ActionSheet}:{menuType:st.og.Popup,width:220},(0,S.jsx)(gt.Z,{...t,children:(0,S.jsx)(Ic,{...this.props,onClose:this.handleClose})})},this.handleClose=e=>{this.stores.buttonPopupStore.setState({open:!1}),e&&this.props.onClose()}}renderComponent(){const{collectionViewStore:e,menuListItemProps:t}=this.props,o=e.getName(),r=e.getType(),i=e.getFormat().collection_view_icon;if(void 0!==r)return(0,S.jsx)(ut.Z,{title:(0,S.jsx)(fn.Z,{collectionViewType:r,collectionViewName:o}),icon:(0,S.jsx)(xc.F,{color:"regular",viewIcon:i,viewType:r}),showDragHandle:this.showDragHandle(),right:this.renderActionsPopup(),rightStyle:{marginRight:8},...t})}renderActionsPopup(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores,{collectionContextStore:o}=this.props;if(o.permissionScopes.state.canConfigureBlock)return(0,S.jsx)(mt.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,renderOrigin:e=>(0,S.jsx)(nr.Z,{icon:m.o,...e}),render:this.renderActionMenu,buttonPopupStore:t})}showDragHandle(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,{device:o}=this.environment;return!o.isMobile&&t.canConfigureBlock}}Vc.displayName="CollectionViewSelectItem";const Bc=(0,R.injectIntl)(Vc);var Fc=o(9284);const jc=(0,R.defineMessages)({suggestedSectionTitle:{defaultMessage:"Suggested",id:"database.collectionViewSuggestedViews.suggestedTitle"}});function Dc(e,t){const o=(0,uo.O7)(),i=(0,ct.VK)((()=>fe.default.state.currentSpaceViewStore),[]),n=(0,ct.VK)((()=>e.collectionViewBlockStore()),[e]),s=(0,ct.VK)((()=>e.collectionStore()),[e]),l=(0,ct.VK)((()=>{var e;if(!s)return;const t=null===(e=s.getFormat())||void 0===e?void 0:e.app_config_uri;return t?(0,J.YB)((0,vl.appConfigs)(),t):void 0}),[s]),a=r.useCallback((r=>{if(!n||!l||!i)return;const s=n.getParentStore();if(!s||"block"!==s.table&&"space"!==s.table&&"team"!==s.table)return;if(1!==r.dependencies.length)return;const a=r.dependencies[0];W.createAndCommit({userAction:"CollectionViewSuggestedViews.createView",environment:o,perform:c=>{var d;Fc.applyFeatures({environment:o,spaceViewStore:i,appParentStore:s,appUri:l.uri,features:[{type:"simple",featureUri:r.uri}],appCollectionViewBlockStores:[n],createOrModify:"modify",transaction:c});const h=((null===(d=n.getFormat())||void 0===d?void 0:d.app_uri_map)??{})[a.uri];_.f8({environment:o,collectionContextStore:e,collectionViewId:h,isFullScreen:e.isFullScreen.state,isRootChild:e.isRootChild.state,isInPeekRenderer:e.isInPeekRenderer.state}),t()}}),I.xb({environment:o,collectionContextStore:e,view_type:a.value.type,view_config_uri:r.uri})}),[n,l,i,o,e,t]);return{renderSuggestedView:r.useCallback((e=>({key:e.uri,render:t=>(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Left,render:o=>((e,t)=>{var o;const r=e.dependencies[0],i=(0,S.jsx)(xc.F,{color:"regular",viewIcon:null===(o=r.value.format)||void 0===o?void 0:o.collection_view_icon,viewType:r.value.type});return(0,S.jsx)(ut.Z,{title:r.value.name?r.value.name:"New View",icon:i,...t})})(e,{...t,...o,onMouseEnter:e=>{var r,i;null===(r=o.onMouseEnter)||void 0===r||r.call(o,e),null===(i=t.onMouseEnter)||void 0===i||i.call(t,e)}}),renderTooltip:()=>e.description}),action:()=>{a(e)}})),[a])}}function Ac(e){window.__c={n:"CollectionViewSuggestedViews"};const t=(0,uo.O7)().device,o=(0,co.yK)((e=>({showMoreLabel:{color:e.mediumTextColor}})),[]),i=e.suggestedViews,{renderSuggestedView:n}=Dc(e.collectionContextStore,e.onClose),[s,l]=(0,r.useState)(!1),{collectionContextStore:a,onClose:c,onNewEmptyViewClick:d}=e,h=(0,ct.VK)((()=>a.permissionScopes.state),[a]),p=(null==i?void 0:i.map((e=>n(e))))??[],u={key:"showMore",render:e=>(0,S.jsx)(ut.Z,{...e,style:o.showMoreLabel,title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Show more...",id:"collectionViewSuggestedViews.showMore.label"})}),action:()=>{l(!0)}},m=(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:0,sections:[{key:"suggested_views",render:e=>(0,S.jsx)(Ct.Z,{...e}),items:s||p.length<=5?p:[...p.slice(0,5),u]}]}),g=h.canConfigureBlock&&(0,S.jsx)(Ct.Z,{topBorder:!0,children:(0,S.jsx)(wc.Z,{title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New empty view",id:"database.collectionViewSuggestedViews.newEmptyViewTitle"}),onClick:()=>{d("CollectionViewSuggestedViews2.handleNewEmptyViewClick"),c()},focused:!1})});return(0,S.jsx)(xs.Z,{capture:!0,allowEsc:!0,render:e=>{let o;return o=t.isMobile?{menuType:st.og.Modal,title:pe.default.formatMessage(jc.suggestedSectionTitle),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:c,...e}:{menuType:st.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...e},(0,S.jsxs)(gt.Z,{...o,children:[p.length&&(0,S.jsx)(Ct.Z,{title:!t.isMobile&&pe.default.formatMessage(jc.suggestedSectionTitle),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:2,marginBottom:2},style:{paddingBottom:0},children:m}),g]})}})}class _c extends n.Z{constructor(){super(...arguments),this.initialMenuListFocus=0,this.storeTypes={menuListStore:bc.Z,viewFilterQueryStore:a.default.createClass("")},this.renderViewsSection=e=>{if(this.isDraggable()){const t=this.getFilteredViewStores().map((e=>e.id));return(0,S.jsx)(Ct.Z,{...e,children:(0,S.jsx)(wi.ZP,{direction:"vertical",keys:t,renderKey:o=>e.children[t.indexOf(o)],onDrop:this.handleViewsDrop})})}return(0,S.jsx)(Ct.Z,{...e})},this.renderViewMenuItem=(e,t)=>{const{collectionContextStore:o,onClose:r}=this.props;return(0,S.jsx)(Bc,{collectionContextStore:o,collectionViewStore:e,onClose:r,menuListItemProps:t})},this.handleViewClick=(e,t)=>{const o=this.props.collectionContextStore.collectionViewStore();o&&this.props.onViewClick({currentCollectionViewStore:o,newCollectionViewStore:e,openInNew:t}),this.setCurrentView(e,t),t||this.props.onClose()},this.handleCreateButtonClick=()=>{this.props.onAddViewClick("CollectionViewSelect2.handleCreateButtonClick"),this.props.onClose()},this.handleViewsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&(W.createAndCommit({userAction:"CollectionViewSelect2.handleViewsDrop",environment:this.environment,perform:t=>{_.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}}),this.stores.menuListStore.reset())},this.handleViewFilterQueryChange=e=>{this.stores.viewFilterQueryStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.filterView=e=>(0,le.D)(e,this.stores.viewFilterQueryStore.state)}willMount(e){var t,o;const{collectionContextStore:r}=e,i=null===(t=r.collectionViewStore())||void 0===t?void 0:t.id,n=((null===(o=r.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())||[]).findIndex((e=>e.id===i));n>=0&&(this.initialMenuListFocus=n),this.stores.viewFilterQueryStore.setState("")}renderComponent(){const{intl:e,collectionContextStore:t,onClose:o,onAddViewClick:r}=this.props,{device:i}=this.environment,n=t.permissionScopes.state,s=(0,S.jsx)(wc.Z,{title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),onClick:this.handleCreateButtonClick,focused:!1});return(0,S.jsx)(xs.Z,{capture:!0,allowEsc:!0,render:l=>{var a,c;let d;d=i.isMobile?{menuType:st.og.Modal,title:this.renderMenuTitle(),right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:this.props.onClose,...l}:{menuType:st.og.Popup,minWidth:290,maxWidth:320,maxHeight:"50vh",...l};const h=n.canConfigureBlock&&(0,S.jsx)(Ct.Z,{topBorder:!0,children:this.props.suggestedViews&&this.props.suggestedViews.length?(0,S.jsx)(mt.ZP,{popupType:this.environment.device.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,alignmentToOrigin:mt.vR.Center,placementToOrigin:mt.pO.Right,renderOrigin:e=>(0,S.jsx)(wc.Z,{title:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Add view",id:"database.collectionViewSelect.addViewButtonTitle"}),focused:!1,...e}),render:()=>(0,S.jsx)(Ac,{collectionContextStore:t,suggestedViews:this.props.suggestedViews??[],onClose:o,onNewEmptyViewClick:r})}):s});return(0,S.jsxs)(gt.Z,{...d,header:!i.isMobile&&!(null!==(a=t.collectionViewBlockStore())&&void 0!==a&&a.isCollectionViewPageWithContent())&&(0,S.jsx)(yi.ZP,{value:this.stores.viewFilterQueryStore.state,focus:!0,style:{marginTop:8,marginBottom:4},textWrapperStyle:{marginLeft:8,marginRight:8},onChange:this.handleViewFilterQueryChange,placeholder:e.formatMessage({defaultMessage:"Search for a view...",id:"collectionViewSelect.viewSearch.label"})}),footer:!i.isMobile&&h,children:[(0,S.jsx)(Ct.Z,{title:!i.isMobile&&!(null!==(c=t.collectionViewBlockStore())&&void 0!==c&&c.isCollectionViewPageWithContent)&&this.renderMenuTitle(),disableMobilePadding:!0,topBorder:!1,desktopTitleStyle:{marginTop:0,marginBottom:0},children:this.renderMenuList()}),this.stores.viewFilterQueryStore.state&&0===this.getFilteredViewStores().length&&(0,S.jsx)(kc.Z,{caption:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No results",id:"database.collectionViewSelect.noResultsTitle"})}),i.isMobile&&h]})}})}renderMenuList(){const e=this.getFilteredViewStores();if(e.length>0)return(0,S.jsx)(St.Z,{type:St.i.Vertical,initialFocus:this.initialMenuListFocus,sections:[{key:"views",render:this.renderViewsSection,items:e.map((e=>({key:e.id,render:t=>this.renderViewMenuItem(e,t),action:t=>{let{event:o}=t;this.handleViewClick(e,ce.DJ(o))}})))}],store:this.stores.menuListStore})}renderMenuTitle(){return(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{numberOfViews, plural, one {{numberOfViews} view} other {{numberOfViews} views}}",id:"database.mobileSelectViewMenu.title",values:{numberOfViews:this.getViewStores().length}})}setCurrentView(e,t){_.f8({environment:this.environment,collectionContextStore:this.props.collectionContextStore,collectionViewId:e.id,openInNew:t,isFullScreen:this.props.isFullScreen,isRootChild:this.props.isRootChild,isInPeekRenderer:this.props.isInPeekRenderer}),I.wd({environment:this.environment,collectionContextStore:this.props.collectionContextStore,action:"click_view_in_dropdown",new_view_type:e.getType(),new_view_id:e.id})}getViewStores(){var e;const{collectionContextStore:t}=this.props;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}getFilteredViewStores(){return this.getViewStores().filter(this.filterView)}isDraggable(){return this.showDragHandle()&&""===this.stores.viewFilterQueryStore.state}showDragHandle(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,{device:o}=this.environment;return!o.isMobile&&t.canConfigureBlock}}_c.displayName="CollectionViewSelect";const Lc=(0,R.injectIntl)(_c);var Zc=o(88990),Ec=o(14976),Oc=o(26991);class zc extends n.Z{constructor(){super(...arguments),this.storeTypes={popupOpen:a.default.createClass(!1)},this.renderPopup=()=>{const{device:e}=this.environment;let t;return t=e.isPhone?{menuType:st.og.Modal,right:(0,S.jsx)(yt.DoneMenuText,{}),onClickRight:this.handleClose}:{menuType:st.og.Popup,minWidth:220},(0,S.jsx)(gt.Z,{...t,children:(0,S.jsx)(Ic,{...this.props,onClose:this.handleClose})})},this.handleClick=e=>{const{collectionViewStore:t,collectionContextStore:o}=this.props,r=o.collectionViewStore();if(!r)return;const i=ce.DJ(e);this.props.onViewClick({currentCollectionViewStore:r,newCollectionViewStore:t,openInNew:i}),r.id===t.id?this.stores.popupOpen.setState(!0):this.setCurrentView(t.id,i),I.wd({environment:this.environment,collectionContextStore:o,action:"click_view_tab",new_view_type:t.getType(),new_view_id:t.id})},this.handleContextMenu=e=>{e.preventDefault(),(0,he.ZP)({event:e,context:he.Af.EditorContextMenu,callback:()=>{this.stores.popupOpen.setState(!0)}})},this.handleClose=()=>{this.stores.popupOpen.setState(!1)}}renderComponent(){var e,t,o;const{collectionViewStore:i,collectionContextStore:n}=this.props,{popupOpen:s}=this.stores,{device:l}=this.environment,a=(0,r.createRef)(),c=this.getCurrentCollectionViewStore();if(!i.isDefined()||!c)return;const h=i.getType(),p=i.getFormat().collection_view_icon,u=c.id===i.id,m=(null===(e=n.inheritedBlockColorStore.state)||void 0===e?void 0:e.background)||"none",g=n.collectionViewBlockStore();if(!g)return(0,S.jsx)(S.Fragment,{});const y=g.getSpaceId()!==(null===(t=fe.default.state.currentSpaceStore)||void 0===t?void 0:t.id),v=i.getFormat().app_config_uri===d.g3&&"sprint_board"===(null===(o=fe.default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch)&&!y;return(0,S.jsx)(ft.ZP,{popupType:l.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,alignmentToOrigin:ft.ZP.Alignment.Start,open:s.state,render:this.renderPopup,onDismiss:this.handleClose,origin:(0,S.jsxs)("div",{className:ee.rTm,style:{display:"flex",alignItems:"center",background:m,height:"100%",...u&&{borderBottom:`2px solid ${this.theme.regularTextColor}`,paddingTop:2}},onContextMenu:this.handleContextMenu,children:[v&&(0,S.jsx)(qt.FF,{origin:a}),(0,S.jsx)(Gc,{collectionViewStore:i,render:e=>(0,S.jsxs)(vt.Z,{"aria-selected":u,role:"tab",ref:a,style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:P.Z.fontWeight.medium,color:u?this.theme.regularTextColor:this.theme.mediumTextColor,maxWidth:$c},hovered:s.state,onClick:this.handleClick,...e,children:[(0,S.jsx)(xc.F,{color:u?"regular":"light",viewIcon:p,viewType:h,style:{marginRight:6}}),(0,S.jsx)("span",{style:{...P.Z.textOverflowStyle,marginTop:1},children:(0,S.jsx)(Nc,{collectionContextStore:n,collectionViewStore:i})})]},i.id)})]})})}setCurrentView(e,t){const{collectionContextStore:o}=this.props;_.f8({environment:this.environment,collectionContextStore:o,collectionViewId:e,openInNew:t,isFullScreen:o.isFullScreen.state,isRootChild:o.isRootChild.state,isInPeekRenderer:o.isInPeekRenderer.state})}getCurrentCollectionViewStore(){return this.props.collectionContextStore.collectionViewStore()}}function Gc(e){window.__c={n:"CollectionViewTabTooltip"};const t=(0,co.Fg)(),o=(0,R.useIntl)(),{collectionViewStore:r,render:i}=e,n=(0,ct.VK)((()=>r.getCollectionStore()),[r]),s=(0,ct.VK)((()=>null==n?void 0:n.getModel()),[n]),l=(0,ct.VK)((()=>r.getModel()),[r]);return l?(0,S.jsx)(xt.Z,{placement:xt.Z.Placement.Bottom,alignment:xt.Z.Alignment.Start,delayThreshold:800,render:i,renderTooltip:()=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{children:(0,le.Cc)({collectionViewName:l.getName(),collectionViewType:l.getType()})}),n&&s&&(0,S.jsx)("div",{style:{color:t.mediumInvertedTextColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:Rt.Bh[l.getType()],collection:(0,Ec.Xh)(n.getName(),n)||s.getEmptyTitlePlaceholder({intl:o})}})})]})}):null}function Hc(e,t,o){var r;const i=e.collectionStore();if(!i)return t.getName();const n=i.getPropertyMapping(),s=t.getName(),l=null==n?void 0:n[d.Es.TaskToSprintRelation];if(!o||!l||s!==pe.default.formatMessage(Zc.sY.tasksCurrentSprintV2ViewName))return t.getName();const a=o[l];if(!a||"relation"!==a.type||!a.collection_pointer)return t.getName();const c=null===(r=(0,Oc.As)(e,"current",a.collection_pointer,i))||void 0===r?void 0:r.getBlockTitleStore().getValue();return c?`${pe.default.formatMessage(Zc.sY.tasksCurrentSprintV2ViewNamePrefix)}: ${c[0]}`:t.getName()}function Nc(e){window.__c={n:"CollectionViewTabTitle"};const{collectionViewStore:t,collectionContextStore:o}=e,[r,i]=(0,ct.VK)((()=>{const e=o.settingsStore.state;return[e.open,C.Z$(e.stack)]}),[o.settingsStore]),n=(0,ct.VK)((()=>o.collectionViewStore()),[o]),s=(0,ct.VK)((()=>t.getCollectionStore()),[t]),l=(0,ct.VK)((()=>{if(t.isDefined()){return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===d.g3&&null!=s&&s.isDefined()?{name:Hc(o,t,s.getSchema()),type:t.getType()}:{name:t.getName(),type:t.getType()}}}),[t,s,o]);return!l||n&&n.id===t.id&&r&&i&&("duplicateExistingView"===i.type||"createViewSource"===i.type||"createView"===i.type)?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,S.jsx)(fn.Z,{collectionViewName:l.name,collectionViewType:l.type})}zc.displayName="CollectionViewTab";const Wc=(0,R.injectIntl)(zc);function Kc(e){window.__c={n:"WikiHomeOnboardingTooltip"};const{origin:t}=e,o=(0,uo.O7)();return(0,S.jsx)(Ll.U,{origin:t,placementToOrigin:"bottom",header:(0,S.jsx)(R.FormattedMessage,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{$s.Rg(o)},shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Ol.EZ,pointerOffset:Ol.rK,style:{width:Ol.G5}})}function Uc(e){window.__c={n:"WikiViewsOnboardingTooltip"};const{origin:t}=e,o=(0,uo.O7)();return(0,S.jsx)(Ll.U,{origin:t,placementToOrigin:"right",header:(0,S.jsx)(R.FormattedMessage,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,S.jsx)("span",{style:{fontWeight:P.Z.fontWeight.semibold},children:e})}}),onCloseClick:()=>{$s.Rg(o)},pointerPosition:"50%",pointerLength:Ol.EZ,pointerOffset:Ol.FD,shouldDismissUponOutsideClick:!0,style:{width:Ol.G5}})}const $c=220;class qc extends n.Z{constructor(){super(...arguments),this.viewSelectContainerSizeObserver=new Ze.E({throttleMs:200}),this.viewIdWidthEstimatorMap=new Map,this.homeViewRef=r.createRef(),this.viewsDropdownRef=r.createRef(),this.storeTypes={buttonPopupStore:Ce.Z},this.renderViewsPopup=(e,t)=>{var o;const{collectionContextStore:r}=this.props,{device:i}=this.environment,n=r.isFullScreen.state,s=r.isRootChild.state,l=r.isInPeekRenderer.state,a=(null===(o=r.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===d.GZ;return(0,S.jsxs)(S.Fragment,{children:[!i.isMobile&&"views"===$s.B1()&&a&&(0,S.jsx)(Uc,{origin:this.viewsDropdownRef}),(0,S.jsx)("div",{ref:this.viewsDropdownRef,children:(0,S.jsx)(Lc,{collectionContextStore:r,onAddViewClick:this.handleAddViewClick,suggestedViews:t,onClose:e.close,isFullScreen:n,isRootChild:s,isInPeekRenderer:l,onViewClick:this.props.onViewClick})})]})},this.renderViewTab=e=>{const{collectionContextStore:t,onViewClick:o}=this.props;return(0,S.jsx)(Wc,{collectionContextStore:t,collectionViewStore:e,onViewClick:o},e.id)},this.handleViewSelectContainerMount=e=>{e&&this.viewSelectContainerSizeObserver.observe(e)},this.handleViewTabsDrop=e=>{const{collectionContextStore:t}=this.props,o=t.collectionViewBlockStore();o&&W.createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:this.environment,perform:t=>{_.Wu({collectionViewBlockStore:o,newViewIds:e,transaction:t})}})},this.renderSuggestedViewsPopup=(e,t)=>{const{collectionContextStore:o}=this.props;return(0,S.jsx)(Ac,{collectionContextStore:o,suggestedViews:t,onClose:e.close,onNewEmptyViewClick:this.handleAddViewClick})},this.handleAddViewClick=e=>{const{collectionContextStore:t}=this.props;W.createAndCommit({userAction:e,environment:this.environment,perform:e=>{_.ME({environment:this.environment,collectionContextStore:t,transaction:e})}}),I.xb({environment:this.environment,collectionContextStore:t,view_type:"table"})},this.handleMoreViewsClick=()=>{const{collectionContextStore:e}=this.props;I.wd({environment:this.environment,collectionContextStore:e,action:"click_views_dropdown"})},this.renderStateStore=this.createComputedStore((()=>{var e;const{collectionContextStore:t,showHoverActionsStore:o}=this.props,{device:r}=this.environment,i=this.getViewStores(),n=this.showViewTabsStore.state,s=(null==n?void 0:n.length)||0,l=i.length-s,a=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent())||r.isPhone||n&&(0===s||1===s&&i.length>1)?"dropdown":l>0?"someTabsNotVisible":"allTabsVisible",c=t.isFullScreen.state||o.state;return{showMoreViewsButton:"someTabsNotVisible"===a||"dropdown"===a,showAddViewButton:this.shouldAttemptToShowAddViewButton()&&"allTabsVisible"===a,addViewButtonAnimatedIn:c,viewSelectState:a,moreViewsCount:l}})),this.showViewTabsStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=this.getViewStores(),o=e.collectionViewStore();if(!o)return;const r=Math.max(100,this.shouldAttemptToShowAddViewButton()?105:0);let i=this.viewSelectContainerSizeObserver.rect.state.width-r;const n=[],s=this.measureViewTabWidth(o);if(!(s<i))return n;n.push(o),i-=s;for(const c of t)if(c.id!==o.id){const e=this.measureViewTabWidth(c);if(!(e<i))break;n.push(c),i-=e}const l=n.filter((e=>e.id!==o.id)),a=t.findIndex((e=>e.id===o.id));return l.splice(a,0,o),l}))}willUnmount(){super.willUnmount(),this.viewSelectContainerSizeObserver.destroy()}renderComponent(){const e=this.renderStateStore.state,t=this.getSuggestedViewsForTypedDB();return(0,S.jsxs)("div",{role:"tablist",style:{display:"flex",alignItems:"center",height:"100%",flexGrow:1},ref:this.handleViewSelectContainerMount,children:[this.renderViewTabs(),e.showMoreViewsButton&&(0,S.jsx)(mt.ZP,{popupType:this.environment.device.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,render:e=>this.renderViewsPopup(e,t),renderOrigin:e=>this.renderViewSelectButton(e),onClick:this.handleMoreViewsClick}),e.showAddViewButton&&(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:e.addViewButtonAnimatedIn?1:0},render:()=>t&&t.length?(0,S.jsx)(mt.ZP,{popupType:mt.Z4.Popup,alignmentToOrigin:U.v2.Center,render:e=>this.renderSuggestedViewsPopup(e,t),renderOrigin:e=>(0,S.jsx)(nr.Z,{className:ee.rVO,icon:Je.R,...e})},"suggested-views"):(0,S.jsx)(nr.Z,{className:ee.rVO,icon:Je.R,onClick:()=>this.handleAddViewClick("CollectionViewTabBar.handleAddViewClick")})})]})}renderViewSelectButton(e){var t;const{collectionContextStore:o}=this.props,{device:r}=this.environment,i=this.renderStateStore.state,n=this.getCurrentCollectionViewStore();if(!n)return;if(!n.isDefined())return;const s=(null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri)===d.GZ&&"page"===n.getType();if("dropdown"===i.viewSelectState){const t=n.getType(),i=n.getFormat().collection_view_icon;return(0,S.jsxs)(S.Fragment,{children:[!r.isMobile&&s&&"home"===$s.B1()&&(0,S.jsx)(Kc,{origin:this.homeViewRef}),(0,S.jsx)(Gc,{collectionViewStore:n,render:r=>(0,S.jsxs)(vt.Z,{ref:this.homeViewRef,style:{display:"flex",alignItems:"center",fontSize:P.Z.fontSize.UIRegular.desktop,fontWeight:P.Z.fontWeight.semibold,color:this.theme.regularTextColor,maxWidth:$c},...e,...r,children:[(0,S.jsx)(xc.F,{color:"regular",viewType:t,viewIcon:i,style:{marginRight:6}}),(0,S.jsx)("span",{style:{...P.Z.textOverflowStyle,marginRight:6,marginTop:1},children:(0,S.jsx)(Nc,{collectionContextStore:o,collectionViewStore:n})}),(0,Fr.i)({marginTop:2,width:10,height:10,fill:this.theme.lightIconColor})]})})]})}return"someTabsNotVisible"===i.viewSelectState?(0,S.jsx)(vt.Z,{style:{display:"flex",alignItems:"center",fontSize:P.Z.fontSize.UIRegular.desktop,color:this.theme.mediumTextColor},...e,children:(0,S.jsx)("span",{style:{marginTop:1},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:i.moreViewsCount}})})}):void 0}renderViewTabs(){const{collectionContextStore:e}=this.props,t=e.permissionScopes.state,o=this.showViewTabsStore.state,r=this.renderStateStore.state;if(o&&"dropdown"!==r.viewSelectState)return t.canConfigureBlock?(0,S.jsx)(wi.ZP,{direction:"horizontal",keys:o.map((e=>e.id)),style:{height:"100%"},disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>{const t=o.find((t=>t.id===e));if(t)return this.renderViewTab(t)},onDrop:this.handleViewTabsDrop}):o.map(this.renderViewTab)}shouldAttemptToShowAddViewButton(){var e;const{collectionContextStore:t,isPlaceholderExternalCollectionStore:o}=this.props,r=t.permissionScopes.state,i=null===(e=this.props.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id,n=i&&(0,X.qG)(i);return r.canConfigureBlock&&!o.state&&!n}measureViewTabWidth(e){const t=e.getName(),o=e.getType();if(!o)return 0;let r=this.viewIdWidthEstimatorMap.get(e.id);r||(r=new Cc({style:{fontSize:`${P.Z.fontSize.UIRegular.desktop}px`,fontWeight:P.Z.fontWeight.medium}}),this.viewIdWidthEstimatorMap.set(e.id,r));const i=(0,le.Cc)({collectionViewName:t,collectionViewType:o}),n=r.measure(i);return Math.min(40+n.width,$c)}getViewStores(){var e;return(null===(e=this.getCurrentCollectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())||[]}getCurrentCollectionViewBlockStore(){return this.props.collectionContextStore.collectionViewBlockStore()}getCurrentCollectionViewStore(){return this.props.collectionContextStore.collectionViewStore()}getSuggestedViewsForTypedDB(){const e=this.props.collectionContextStore.collectionStore(),t=this.props.collectionContextStore.collectionViewBlockStore();if(!e||!t)return;const o=e.getFormat().app_config_uri,r=o?(0,J.YB)((0,vl.appConfigs)(),o):void 0;return r?(0,J.AG)(r,e,t):void 0}}qc.displayName="CollectionViewTabBar";const Qc=(0,R.injectIntl)(qc);var Yc=o(98597),Xc=o(74194),Jc=o(25821),ed=o(53336),td=o(14562),od=o(58493),rd=o(45926),id=o(95691);class nd extends a.default{getInitialState(){return{stage:"NOT_TRACKING"}}}function sd(e){window.__c={n:"SetupInitialDatabaseItemsVisibleTracker"};const{collectionContextStore:t}=e,{handleInitialDatabaseRender:o,handleItemMount:i}=function(e){const t=(0,uo.O7)(),o=(0,ct.qz)(void 0,nd),i=(0,r.useRef)(0),n=(0,r.useCallback)((()=>{"NOT_TRACKING"===o.state.stage&&o.setState({stage:"COUNTING_VISIBLE_ITEMS"})}),[o]),l=(0,r.useCallback)((()=>{if("COUNTING_VISIBLE_ITEMS"===o.state.stage&&(i.current++,1===i.current)){const e=performance.now();s.default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===o.state.stage&&o.setState({stage:"SHOULD_TRACK",endTime:e})}))}}),[o]),a=(0,r.useCallback)((o=>{"SHOULD_TRACK"===o.state.stage&&(Se.default.measureFromAppStart({metricName:"initial_database_items_visible",endTime:o.state.endTime},{environment:t,data:re.Pp({collectionContextStore:e,visibleItemsCount:i.current||0})}),o.reset(),i.current=0)}),[e,t]);return(0,r.useEffect)((()=>(o.addListener(a),()=>{o.removeListener(a)})),[a,o]),{handleInitialDatabaseRender:n,handleItemMount:l}}(t);return t.initialDatabaseItemsVisibleTracker||(t.initialDatabaseItemsVisibleTracker={handleInitialDatabaseRender:o,handleItemMount:i}),null}const ld=["table","board"],ad=["timeline"],cd=180,dd=(0,R.defineMessages)({searchInputPlaceholder:{defaultMessage:"Type to search...",id:"database.searchInputPlaceholder"},openAutomationsSettingsButtonTooltip:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.tooltip"},openAutomationsSettingsButtonAriaLabel:{defaultMessage:"Create and view automations",id:"database.collectionViewBlock.openAutomationsSettingsButton.ariaLabel"},openFullscreenPageButtonTooltip:{defaultMessage:"Open as full page",id:"database.collectionViewBlock.openFullscreenPageButton.tooltip"}});class hd{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=(e,t,o)=>{let r=!0;this.didEmit||(this.didEmit=!0,r=!1),this.lastValue===t?r=!1:this.lastValue=t,r&&this.onEmit(t,o)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=ge.Z.addListener(this.listenerEventKey,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&ge.Z.removeListener(this.listener,this.environment)}}class pd extends Oe.Z{constructor(){super(...arguments),this.isCollectionViewBlock=!0,this.collectionContextStore=new be.Z(this.environment),this.headerSizeObserver=new Ze.E,this.headerEl=null,this.horizontalScrollerEl=null,this.resizeObserver=void 0,this.timelineViewRef=r.createRef(),this.automationsViewRef=r.createRef(),this.parentNode=void 0,this.renderStartTime=void 0,this.subscriptions=new Map,this.collectionTypeChangeSubscription=void 0,this.collectionRefetcher=new In(this.collectionContextStore,this.environment),this.syncStateTimeout=void 0,this.switchViewMetric=void 0,this.storeTypes={collectionContextStore:be.Z,mouseStore:Ve.Z,headerMouseStore:Ve.Z,focusStore:a.default.createClass(!1),automationsTooltipVisibleStore:a.default.createClass(!1),noDateResultStore:a.default.createClass(void 0),templateButtonPopupStore:Ce.Z,filterBarSettingsStore:a.default.createClass({open:!1,stack:[]}),createFilterButtonPopupStore:Ce.Z,createFilterSettingsStore:a.default.createClass({open:!1,stack:[]}),filterBarCreateFilterSettingsStore:a.default.createClass({open:!1,stack:[]}),createSortSettingsStore:a.default.createClass({open:!1,stack:[]}),viewSettingsPlacementStore:a.default.createClass(void 0),saveControlMoreActionsButtonPopupStore:Ce.Z},this.renderCreateFilterPopup=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores;return(0,S.jsx)($n.P,{context:ie.HV.TopbarFilterPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderCreateSortPopup=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;return(0,S.jsx)($n.P,{context:ie.HV.TopbarSortPopup,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.renderViewSettings=()=>{const e=this.isInPeekRenderer(),t=(0,le.Ks)(this.props.store)?{paddingLeft:0,paddingRight:0}:this.leftRightPadding.state;if(t)return(0,S.jsx)(vc,{collectionContextStore:this.collectionContextStore,headerSizeObserver:this.headerSizeObserver,placementStore:this.stores.viewSettingsPlacementStore,isInPeekRenderer:e,...t})},this.renderTemplatesPopup=()=>{const{collectionContextStore:e}=this,{store:t}=this.props,o=e.collectionStore();if(o){if(ke.Z.state.online){const r=e.permissionScopes.state;return(0,S.jsx)(Yn.Z,{isOverlay:!0,collectionStore:o,canConfigureCollection:r.canConfigureCollection,onEmptyPageClick:this.handleTemplateEmptyPageClick,onEmptyEnter:this.handleTemplateEmptyPageClick,onTemplateClick:this.handleTemplateClick,onCancelClick:this.handleTemplateCancelClick,locked:t.isLocked()})}return(0,S.jsx)("div",{style:{fontSize:14,color:this.theme.mediumTextColor,width:280,padding:8},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Please go online to use a template.",id:"collectionViewBlock.actionBar.offlineTemplatePicker.message"})})}},this.renderNoDatePopup=e=>{const{collectionContextStore:t}=this,o=this.noDateTotal.state,r=t.collectionStore(),i=t.collectionViewStore(),n=this.getNoDateProperty();if(!r||!i||!n)return;const s=i.getType(),l=i.getName();return!i.isDefined()||"timeline"!==s&&"calendar"!==s?void 0:(0,S.jsx)(wn,{collectionStore:r,collectionViewId:i.id,property:n,onClose:e.close,onAddPage:this.handleNoDateAddPage,collectionViewType:s,collectionViewName:l,collectionContextStore:t,noDateTotal:o})},this.handleViewSettingsClick=e=>{(0,he.ZP)({event:e,context:he.Af.CollectionSettingsClick,callback:this.handleViewSettingsClickInner}),I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_view_settings"}),this.projManagementTooltipTourComplete()},this.handleViewSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,we.n)(t);o&&"main"===(null==r?void 0:r.type)?D.E3({collectionSettingsStore:t}):D.r$({collectionContextStore:e,collectionSettingsStore:t})},this.handleViewAutomationSettingsClick=e=>{(0,he.ZP)({event:e,context:he.Af.CollectionAutomationSettingsClick,callback:this.handleViewAutomationSettingsClickInner})},this.handleViewAutomationSettingsClickInner=()=>{const{collectionContextStore:e}=this,t=e.settingsStore,o=t.state.open,r=(0,we.n)(t);o&&"automationSettings"===(null==r?void 0:r.type)?D.E3({collectionSettingsStore:t}):(D.r$({collectionContextStore:e,collectionSettingsStore:t}),D.wl({collectionSettingsStore:t,item:{source:"collection_view_settings",type:"automationSettings"}}))},this.handleViewClick=e=>{let{currentCollectionViewStore:t,newCollectionViewStore:o,openInNew:r}=e;if(t.id!==o.id&&!r){const e=t.getType(),r=o.getType();var i;if(e&&r)this.switchViewMetric={from:e,to:r,metric:Se.default.mark("collections.switch_view_lag"),sizeHintAtStart:null===(i=this.collectionContextStore.remoteResult.state)||void 0===i?void 0:i.sizeHint}}},this.handleFilterClick=()=>{const{collectionContextStore:e}=this,{createFilterSettingsStore:t}=this.stores,o=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0,r=e.currentPropertyFiltersStore.state,i=e.filtersBarOpenStore.state;i||r.length>0||o?e.filtersBarOpen.setState(!i):D.wl({collectionSettingsStore:t,item:{type:"createFilter"}}),I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_filter"})},this.handleSortClick=()=>{const{collectionContextStore:e}=this,{createSortSettingsStore:t}=this.stores;this.hasSort.state?(e.filtersBarOpen.setState(!0),D.wl({collectionSettingsStore:e.filterBarSortSettingsStore,item:{type:"sort"}})):D.wl({collectionSettingsStore:t,item:{type:"createSort"}}),I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_sort"})},this.handleCreateFilterPopupDismiss=()=>{const{createFilterSettingsStore:e}=this.stores;D.E3({collectionSettingsStore:e})},this.handleCreateSortPopupDismiss=()=>{const{createSortSettingsStore:e}=this.stores;D.E3({collectionSettingsStore:e})},this.handleCollectionEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!1})},this.handleCollectionTypeChangeEmit=(e,t)=>{this.collectionRefetcher.handleCollectionEmit({src:"msg",passThroughData:t,shouldQueueCollectionEmit:this.shouldQueueCollectionEmit(),isCollectionTypeChange:!0})},this.handlePageVisibilityChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("page_show")},this.handlePeekViewChange=()=>{this.shouldRefetch()&&this.collectionRefetcher.maybeProcessQueuedCollectionEmit("exit_peek")},this.shouldQueueCollectionEmit=()=>{var e;return!je.Z.state.isVisible||!(!Ae.default.isMiniOrCenterPeekOpen()||null!==(e=Ae.default.peekTarget.state)&&void 0!==e&&e.uiContains(this.props.store))},this.shouldRefetch=()=>{if(!Ae.default.isMiniOrCenterPeekOpen()&&je.Z.state.isVisible)return!0},this.handleHeaderMount=e=>{e&&this.headerSizeObserver.observe(e),this.headerEl=e},this.handleHorizontalScrollerMount=e=>{var t,o;var r;(null==e||null===(t=e.scrollerEl())||void 0===t?void 0:t.classList.contains(ee.PBs))?this.horizontalScrollerEl=e:this.horizontalScrollerEl=(null==e||null===(r=e.context.scrollerContext)||void 0===r?void 0:r.horizontalScroller)||null;const i=this.collectionContextStore.collectionViewStore();this.resetFrozoneStore(i);const n=null===(o=this.horizontalScrollerEl)||void 0===o?void 0:o.scrollerEl();"undefined"!=typeof ResizeObserver&&n&&(this.resizeObserver=new ResizeObserver(this.handleHorizontalScrollerResizeDebounced),this.resizeObserver.observe(n))},this.handleHorizontalScrollerResize=()=>{var e,t;const o=null===(e=this.horizontalScrollerEl)||void 0===e||null===(e=e.scrollerEl())||void 0===e?void 0:e.getBoundingClientRect().width,r=this.collectionContextStore.frozoneStore.state.scrollerWidth,i=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.getBoundingClientRect().left,n=this.collectionContextStore.frozoneStore.state.scrollerLeftOffset;if(o===r&&i===n)return;const s=this.collectionContextStore.collectionViewStore(),l=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,scrollerWidth:o,scrollerLeftOffset:i,frozenIndex:null==s?void 0:s.getTableFrozenColumnIndex(o,l),tryShowHiddenFrozenColumn:!1})},this.handleHorizontalScrollerResizeDebounced=C.Ds(this.handleHorizontalScrollerResize,50),this.handleEditorMouseDown=e=>{const{device:t}=this.environment,o=this.getCurrentCollectionViewStore();if(!o||t.isMobile)return;const r=o.getType();r&&(0,he.ZP)({event:e,context:he.Af.EditorMouseDown,callback:()=>{e.preventDefault(),E.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===r||"table"===r})}})},this.handleEditorClick=(e,t)=>{(0,he.ZP)({event:e,context:he.Af.EditorClick,callback:()=>{if(this.isInPeekRenderer()||Z.E5(this.environment),"page"===t&&!ue.X9()){const{clientX:t,clientY:o,target:r}=e;s.default.afterNextFlush((()=>{W.createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:this.environment,perform:e=>{N.jh(this.environment,{x:t,y:o,target:r instanceof Element?r:void 0},e)}})}))}}})},this.handleScroll=e=>{var t,o;const r=null===(t=this.horizontalScrollerEl)||void 0===t||null===(t=t.scrollerEl())||void 0===t?void 0:t.scrollLeft,i=null===(o=this.leftRightPadding.state)||void 0===o?void 0:o.paddingLeft;if(void 0===r||void 0===i)return;const n=r>i;n!==this.collectionContextStore.frozoneStore.state.isScrolled&&(this.collectionContextStore.frozoneStore.setState({...this.collectionContextStore.frozoneStore.state,isScrolled:n}),this.handleHorizontalScrollerResize())},this.handleFocusIn=e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,l.E)(t)&&this.stores.focusStore.setState(!0)},this.handleFocusOut=()=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=()=>{Re.Z.state||this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=()=>{this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1})},this.handleHeaderMouseMove=()=>{Re.Z.state||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleLoadedStoreChange=()=>{if(!this.isLoadedStore.state||!this.componentIsMounted||this.collectionContextStore.wasCreatedThisSession.state||!this.isFullScreen())return;const e=this.environment.RouterStore.state;let t;"page"===e.route.name&&(t=e.route.mobileData);const o=()=>{var e,o,r;return{...re.vS(this.collectionContextStore),is_push:(null===(e=t)||void 0===e?void 0:e.isPush)??!1,collectionViewType:null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType(),initial_route:this.environment.RouterStore.state.initialRoute.name,prefetchCache:null===(r=this.environment.prefetchCache)||void 0===r||null===(r=r.getPrefetchAnalytic("queryCollection"))||void 0===r?void 0:r.type}};var r;Ie.Z.state.initialRenderCompleted?Se.default.measureAfterNextFlush("navigation_database_render",{environment:this.environment,getData:o}):(L.setInitialRenderCompleted(),Se.default.measureFromAppStartAfterNextFlush("initial_database_render",{environment:this.environment,getData:o,shouldSendIfStatsigNotInitialized:!0}),this.renderStartTime&&Se.default.measureAfterNextFlush({metricName:"initial_database_render_from_component_mount",startTime:this.renderStartTime},{environment:this.environment,getData:o}),this.renderStartTime=void 0,null===(r=this.collectionContextStore.initialDatabaseItemsVisibleTracker)||void 0===r||r.handleInitialDatabaseRender())},this.handleSearchButtonClick=()=>{this.collectionContextStore.searchOpen.setState(!0),I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_search"})},this.handleSearchQueryChange=e=>{_.Ug({searchQuery:e.target.value,collectionContextStore:this.collectionContextStore,isFullScreen:Boolean(this.props.isFullScreen)}),M.ikP(this.environment,{view_type:this.getCurrentViewType()})},this.handleSearchBlur=()=>{this.collectionContextStore.searchQuery.state||this.handleClearSearch()},this.handleSearchKeyDown=e=>{27===e.keyCode&&this.handleClearSearch()},this.handleClearSearch=()=>{this.collectionContextStore.searchQuery.setState(""),this.collectionContextStore.searchOpen.setState(!1)},this.handleAddItemClick=()=>{W.createAndCommit({userAction:"CollectionViewBlock.handleAddItemClick",environment:this.environment,perform:e=>{this.createItem({transaction:e,coerce:!0,from:"cvb_add_item"})}}),I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_new_item"}),this.projManagementTooltipTourAssignToSomeone()},this.handleTemplatesDropdownClick=()=>{I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_templates_dropdown"})},this.handleTemplateClick=e=>{W.createAndCommit({userAction:"CollectionViewBlock.handleTemplateClick",environment:this.environment,perform:t=>{const o=this.createItem({transaction:t,coerce:!1,from:"cvb_template"});o&&A.ob({title:"template",environment:this.environment,store:o,templateStore:e.templateStore,isKeyboard:e.isKeyboard,isCreateIn:!1,transaction:t,from:"collection_view_block"})}}),this.projManagementTooltipTourAssignToSomeone(),this.stores.templateButtonPopupStore.reset()},this.handleTemplateEmptyPageClick=()=>{W.createAndCommit({userAction:"CollectionViewBlock.handleTemplateEmptyPageClick",environment:this.environment,perform:e=>{this.createItem({transaction:e,coerce:!1,from:"cvb_template_empty_page"})}}),this.stores.templateButtonPopupStore.reset()},this.handleTemplateCancelClick=()=>{this.stores.templateButtonPopupStore.reset()},this.handleSetSourceClick=()=>{const{collectionContextStore:e}=this,t=e.settingsStore;this.isPlaceholderExternalCollectionStore.state?D.NG({collectionSettingsStore:t}):(D.r$({collectionContextStore:e,collectionSettingsStore:t}),I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_select_data_source"}))},this.handleNoDateAddPage=e=>{const{collectionContextStore:t}=this,o=this.getCollectionStore(),r=this.getCurrentCollectionViewStore(),i=this.timelineViewRef.current;if(!r||!o)return;if(!r.isDefined())return;const{performResult:n}=W.createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:this.environment,perform:n=>"calendar"===r.getType()?F.Fv({environment:this.environment,store:e,collectionStore:o,collectionContextStore:t,startDayOfWeek:X.AK.state,results:this.getDefaultResults(),transaction:n}):i?i.addBlockToView({store:e,transaction:n}):void 0});n&&H.Z5({environment:this.environment,stores:[n]})},this.handleOpenAsPageClick=()=>{M.Jin(this.environment,{view_type:this.getCurrentViewType()})},this.handleNoDateButtonClick=()=>{I.wd({environment:this.environment,collectionContextStore:this.collectionContextStore,action:"click_topbar_no_date"})},this.initializeSyncStatePolling=async()=>{if(this.isSyncingStore.state){const e=this.getCollectionStore(),t=null==e?void 0:e.getFormat().uri,o=null==e?void 0:e.getFormat().bot_id,r=null==e?void 0:e.id;if(!t||!o||!r)return;await this.pollSyncState({uri:t,botId:o,collectionId:r})}},this.pollSyncState=async e=>{const t=await V.getExternalCollectionSyncState(this.environment,e);if("success"===t.type&&t.data.result){const o=t.data.result,r=this.collectionContextStore.numberChildrenReceived,i=this.collectionContextStore.numberChildrenUnfurled;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(this.syncStateTimeout=setTimeout((async()=>{await this.pollSyncState(e)}),1e4))}},this.resetCollectionSubscriptions=e=>{const t=Array.from(this.subscriptions.keys()),o=C.e5(t,e),r=C.e5(e,t);for(const n of o){var i;null===(i=this.subscriptions.get(n))||void 0===i||i.unsubscribe(),this.subscriptions.delete(n)}for(const n of r){const e=new hd(this.environment,(0,x.jY)(n),this.handleCollectionEmit);e.subscribe(),this.subscriptions.set(n,e)}},this.subscribeToTypeChanges=()=>{const e=this.collectionContextStore.contextType,t=this.collectionContextStore.databaseType;if("collectionTypedView"!==e||!t||this.collectionTypeChangeSubscription)return;const o=new hd(this.environment,(0,x.JY)({spaceId:this.props.store.getSpaceId(),databaseType:t}),this.handleCollectionTypeChangeEmit);o.subscribe(),this.collectionTypeChangeSubscription=o},this.isSyncingStore=this.createComputedStore((()=>{var e;const t=this.getCollectionStore(),o=null==t?void 0:t.isSyncedCollection(),r=!0===(null==t||null===(e=t.getFormat().sync_state)||void 0===e?void 0:e.syncing),i=this.environment.device.isMobile;return Boolean(o&&r&&!i)})),this.canShowPmIntroTooltipStore=this.createComputedStore((()=>{if(this.environment.device.isMobile)return!1;const e=fe.default.state.currentUserSettingsStore,t=fe.default.state.currentSpaceStore;if(!(0,J.jH)(e,t)&&(!t||t.getCreatedTime()<J.VL))return!1;if(!this.isTasksDB())return!1;if(this.props.store.pathIsDead())return!1;return!!this.collectionContextStore.permissionScopes.state.canEditContent&&(!!(0,J.Z0)()&&fe.default.state.inAppCalloutStore.canShow("pm_intro_tooltip"))})),this.isFrozenColumnsEnabled=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore();return(0,le.eL)(this.environment.device.isMobile,null==e?void 0:e.getType())})),this.isMyTasksAssignedToMeTileView=this.createComputedStore((()=>(0,X.$A)(this.props.store.id))),this.isTasksDB=()=>{const e=this.collectionContextStore.collectionViewBlockStore();return(null==e?void 0:e.getFormat().app_config_uri)===d.TZ},this.shouldRestrictHeaderWidthForMarginComments=()=>this.isRootOrDirectChild()&&!(0,le._5)(this.props.store)&&this.marginCommentsVisible.state,this.shouldRenderOptions=()=>void 0!==this.collectionContextStore.collectionStore()||"collectionTypedView"===this.collectionContextStore.contextType,this.shouldRestrictWidthForMarginComments=this.createComputedStore((()=>{const e=this.getCurrentCollectionViewStore(),t=null==e?void 0:e.getType();return this.shouldRestrictHeaderWidthForMarginComments()&&t&&(le.bu.has(t)||"timeline"===t&&this.collectionContextStore.collectionStore()&&!(0,se.C1)({environment:this.environment,format:this.collectionContextStore.normalizedFormatStore.state,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild()}))})),this.isPlaceholderExternalCollectionStore=this.createComputedStore((()=>{const e=this.getCollectionStore();return!!e&&(0,h.OY)(e.getValue())})),this.getExternalIntegrationId=this.createComputedStore((()=>{const e=this.getCollectionStore();if(e)return e.getFormat().integration_id})),this.leftRightPadding=this.createComputedStore((()=>{var e;const{store:t,isFullScreen:o,overridePaddingLeft:r,overridePaddingRight:i,experimentalLayout:n}=this.props;if(n)return{paddingLeft:0,paddingRight:0};const s=(0,le.Bs)({environment:this.environment,store:t,isFullScreen:o,sizeObserver:this.headerSizeObserver,viewType:null===(e=this.collectionContextStore.collectionViewStore())||void 0===e?void 0:e.getType()});s&&void 0!==r&&(s.paddingLeft=r),s&&void 0!==i&&(s.paddingRight=i);const l=this.shouldRestrictWidthForMarginComments.state;return s&&l&&(s.paddingRight+=(0,q.gC)(this.environment,(0,le.en)(t),this.isInFrameWhenSidePeekOpen.state)),s})),this.isLoadedStore=this.createComputedStore((()=>this.collectionContextStore.isLoaded.state)),this.leftRightMargin=this.createComputedStore((()=>{if(!this.isRootOrDirectChild()||!this.marginCommentsVisible.state||!(0,le._5)(this.props.store)||this.props.store.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};const e=q.QB/2;return{marginLeft:e,marginRight:-e}})),this.noDateTotal=this.createComputedStore((()=>{if(this.noDateReducerStore.state){const e=this.stores.noDateResultStore.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}return 0})),this.noDateReducerStore=this.createComputedStore((()=>{const e=this.getNoDateProperty();if(e){return{type:"aggregation",filter:{operator:"and",filters:[{property:e,filter:{operator:"is_empty"}}]},aggregation:{aggregator:"count"}}}})),this.hasAppliedFilter=this.createComputedStore((()=>(0,te.RL)({collectionContextStore:this.collectionContextStore,applySubitemFilter:!1}).length>0)),this.hasSort=this.createComputedStore((()=>{const{collectionContextStore:e}=this;return e.currentSortsStore.state.length>0})),this.showHoverActionsStore=this.createComputedStore((()=>{const{device:e}=this.environment,{mouseStore:t,headerMouseStore:o,focusStore:r,createSortSettingsStore:i,createFilterSettingsStore:n,filterBarCreateFilterSettingsStore:s,saveControlMoreActionsButtonPopupStore:l}=this.stores,{collectionContextStore:a}=this,c=this.isFullScreen(),d=r.state,h=a.settingsStore.state.open,p=a.searchOpen.state,u=i.state.open,m=n.state.open,g=s.state.open,S=a.filterBarSortSettingsStore.state.open,y=Array.from(a.filterBarItemSettingsStoreMap.values()),v=l.state.open,f=y.some((e=>e.state.open)),C=this.stores.automationsTooltipVisibleStore.state;return Boolean(t.state.mouseEntered||o.state.mouseEntered||d||c||this.shouldShowProjManagementTooltipTour()||e.isMobile||h||f||u||m||g||p||v||S||C)})),this.showCompactDesktopHeaderStore=this.createComputedStore((()=>{const{device:e}=this.environment,t=this.headerSizeObserver.rect.state;return!e.isMobile&&t.width&&t.width<400})),this.isInFrameWhenSidePeekOpen=this.createComputedStore((()=>(0,le.Ks)(this.props.store))),this.isInPeek=this.createComputedStore((()=>(0,le.en)(this.props.store)))}insertBlocks(e,t){const o=this.getCollectionStore();if(o)for(const r of e)j.mp({environment:this.environment,store:r,collectionStore:o,collectionContextStore:this.collectionContextStore,coerce:!0,groupsPointer:[],transaction:t});return[]}handleCreated(){H.ZH(this.environment),s.default.afterNextFlush((()=>{const{collectionContextStore:e}=this,t=e.collectionStore(),o=e.collectionViewBlockStore(),r=e.settingsStore;if(!o)return;const i=o.getCollectionViewSourceCollectionStore();if(this.isPlaceholderExternalCollectionStore.state)D.NG({collectionSettingsStore:r});else if(i)_.W1({environment:this.environment,collectionContextStore:e});else if(t)D.r$({collectionContextStore:e,collectionSettingsStore:r}),(0,qn.V)({collectionStore:t,collectionContextStore:e,collectionSettingsStore:r});else{const t=Pe.default.checkGate("typed_db_creation");D.r$({collectionContextStore:e,collectionSettingsStore:r}),t?D.wl({collectionSettingsStore:r,item:{type:"createTypedDB"}}):D.wl({collectionSettingsStore:r,item:{type:"createViewSource"}})}}))}willMount(e){super.willMount(e),this.trackRenderTime({isFirstRender:!0}),this.collectionContextStore.isLoaded.addListener(this.handleLoadedStoreChange),this.handleLoadedStoreChange(),this.renderStartTime=performance.now()}willMountOrUpdate(e){super.willMountOrUpdate(e);const{store:t}=e,o=t.id,{collectionContextStore:r}=this,i=this.collectionContextStore.collectionViewStore(),n=this.collectionContextStore.collectionStore(),s=this.environment.currentUser.id,l=i?i.id:void 0,a=n?n.id:void 0,c=this.getViewStores().map((e=>e.id)),d=this.getDefaultCollectionViewStore(),h=f.Z.get({userId:s,key:be.Z.getLocalViewPreferenceKey(o)});let p;if(e.viewId&&c.indexOf(e.viewId)>=0?p=e.viewId:i&&c.indexOf(i.id)>=0?p=i.id:h&&c.indexOf(h)>=0?p=h:d&&c.indexOf(d.id)>=0&&(p=d.id),p){const e=_e.Xr.createChildStore(t,{table:w.n,id:p}),i=e.getCollectionStore(),n=!i||i.isDefined();e.isDefined()&&n&&(p!==h&&f.Z.set({userId:s,key:be.Z.getLocalViewPreferenceKey(o),value:p}),(p!==l||i&&i.id!==a)&&_.mc({environment:this.environment,collectionViewBlockStore:t,collectionViewStore:e,collectionStore:i,collectionContextStore:r,isFullScreen:this.isFullScreen(),isRootChild:this.isRootOrDirectChild(),isInPeekRenderer:this.isInPeekRenderer()}),void 0===r.frozoneStore.state.frozenIndex&&this.resetFrozoneStore(e))}const u=r.collectionStore();if(u){u.getTemplatePageStores().map((e=>e.getValue()))}this.isSyncingStore.addListener(this.initializeSyncStatePolling),this.ensureStoreListeners()}willUpdate(){this.trackRenderTime({isFirstRender:!1})}didMount(){super.didMount(),je.Z.addListener(this.handlePageVisibilityChange),Ae.default.addListener(this.handlePeekViewChange);const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.collectionStore();if(e&&t){const o=e.getType();o&&M.esN(this.environment,{collection_id:t.id,collection_view_id:e.id,collection_view_block_id:this.props.store.id,type:o,is_full_screen:this.isFullScreen(),is_peek:this.isInPeekRenderer(),peek_mode:Ae.default.state.mode})}if(e&&"collectionTypedView"===this.collectionContextStore.contextType){const t=this.collectionContextStore.databaseType,o=Me.Z.state.userHomePageId,r=e.getType();t&&r&&M.Wg6(this.environment,{collection_view_id:e.id,collection_view_block_id:this.props.store.id,type:r,databaseType:t,is_my_tasks:o===this.props.store.id})}}didMountOrUpdate(){var e;const t=this.getCollectionStore();var o;(t&&this.resetCollectionSubscriptions([t.id]),this.collectionContextStore.remoteCollectionIds.addListener((e=>this.resetCollectionSubscriptions(e.state))),this.subscribeToTypeChanges(),this.parentNode)||(this.parentNode=null===(o=i.findDOMNode(this))||void 0===o?void 0:o.parentElement,this.parentNode&&((0,ce.lj)(this.parentNode,"focusin",this.handleFocusIn),(0,ce.lj)(this.parentNode,"focusout",this.handleFocusOut),(0,ce.lj)(this.parentNode,"mousemove",this.handleMouseMove),(0,ce.lj)(this.parentNode,"mouseleave",this.handleMouseLeave)));const r=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();r&&(0,ce.lj)(r,"scroll",this.handleScroll)}didUpdate(e){this.trackSwitchViewLag()}willUnmount(){var e,t;super.willUnmount();const{collectionContextStore:o}=this;_.ob({collectionContextStore:o}),this.unsubscribeAll(),this.headerSizeObserver.destroy(),je.Z.removeListener(this.handlePageVisibilityChange),Ae.default.removeListener(this.handlePeekViewChange),this.collectionContextStore.isLoaded.removeListener(this.handleLoadedStoreChange),this.parentNode&&((0,ce.ZV)(this.parentNode,"focusin",this.handleFocusIn),(0,ce.ZV)(this.parentNode,"focusout",this.handleFocusOut),(0,ce.ZV)(this.parentNode,"mousemove",this.handleMouseMove),(0,ce.ZV)(this.parentNode,"mouseleave",this.handleMouseLeave));const r=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();r&&(0,ce.ZV)(r,"scroll",this.handleScroll),null===(t=this.resizeObserver)||void 0===t||t.disconnect(),this.isSyncingStore.removeListener(this.initializeSyncStatePolling),clearTimeout(this.syncStateTimeout)}renderPersisted(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=this.getCollectionStore(),r=e.normalizedSchemaStore.state,i=e.normalizedQueryStore.state,n=e.normalizedFormatStore.state,s=this.isFullScreen();if(!(t&&r&&i&&n))return;const l=t.getType();if(!l)return;if(o&&!o.isDefined())return;if(this.isCollectionViewOfExternalCollectionWithoutExternalObjectId())return(0,S.jsx)(Q.L1,{value:this.collectionContextStore,children:(0,S.jsx)(Zn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,onClick:this.handleEditorClick,ref:this.handleHeaderMount,children:(0,S.jsx)(Po.Z,{store:this.props.store,shouldShowHoverMenu:!0,analyticsName:this.collectionViewTypeToAnalyticsType(l),shouldShowHalo:!this.isFullScreen(),canSelect:!this.isFullScreen(),children:(0,S.jsx)(td.Z,{store:this.props.store,style:{width:"auto"},disabled:!1})})})});const a=(0,ye.$3)(this.environment)-X.CC,c=this.isInFrameWhenSidePeekOpen.state&&!this.props.isFullScreen&&!(0,le._5)(this.props.store)&&a>0,d=this.renderView(o,t,this.isMyTasksAssignedToMeTileView.state?"list":l,r,i,n),h=this.isMyTasksAssignedToMeTileView.state?ve.Z.Y:this.isInPeek.state?ve.Z.X:(0,X.p5)({environment:this.environment,isFullScreen:this.isFullScreen()}),p=this.props.experimentalLayout&&!ad.includes(l)?d:(0,S.jsx)(ed.Z,{type:h,className:ee.x9t,onMouseDown:this.handleEditorMouseDown,preventType:this.isInPeek.state||this.isMyTasksAssignedToMeTileView.state?ve.Z.None:z.Q7(this.environment),onClick:e=>this.handleEditorClick(e,l),style:this.getScrollerStyle(l,n,c?a/2:void 0),ref:this.handleHorizontalScrollerMount,children:d}),u={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state},m=s?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{style:{position:"sticky",height:0,left:0,zIndex:T.Nm},children:this.renderViewSettings()}),(0,S.jsx)(Zn.p,{allowSelectionWithin:!0,style:{...u,position:"relative"},children:p})]}):(0,S.jsx)(Zn.p,{allowSelectionWithin:!0,style:{flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",...this.leftRightMargin.state,...c&&{marginLeft:-a/2},...this.isMyTasksAssignedToMeTileView.state?{height:"100%",maxHeight:"inherit"}:{}},children:(0,S.jsxs)("div",{style:{position:"relative",...this.isMyTasksAssignedToMeTileView.state?{height:"100%",maxHeight:"inherit"}:{}},children:[p,this.renderViewSettings()]})});return this.props.experimentalLayout?(0,S.jsx)(Q.L1,{value:this.collectionContextStore,children:(0,S.jsxs)(Jc.cx,{children:[(0,S.jsxs)(Jc.bU,{children:[this.renderMultiSelectToolbar(),this.renderHeader(l)]}),ld.includes(l)?(0,S.jsx)(Jc.i2,{children:m}):(0,S.jsx)(Jc.bU,{children:m}),(0,S.jsxs)(Jc.bU,{children:[this.renderBottomBorderForViewSettings(),(0,S.jsx)(sd,{collectionContextStore:this.collectionContextStore})]})]})}):(0,S.jsxs)(Q.L1,{value:this.collectionContextStore,children:[this.renderMultiSelectToolbar(),this.renderHeader(l),m,this.renderBottomBorderForViewSettings(),(0,S.jsx)(sd,{collectionContextStore:this.collectionContextStore})]})}renderHeader(e){var t,o;const{device:r}=this.environment,{store:i,disableHoverMenu:n,experimentalLayout:s}=this.props,l=this.isFullScreen(),a=this.noDateReducerStore.state,c=this.showHoverActionsStore.state,d=this.showCompactDesktopHeaderStore.state,h=this.leftRightPadding.state,p=(null===(t=this.collectionContextStore.collectionViewBlockStore())||void 0===t?void 0:t.isCollectionViewPageWithContent())&&"page"===(null===(o=this.collectionContextStore.collectionViewStore())||void 0===o?void 0:o.getType()),u=this.shouldShowProjManagementTooltipTour()?(0,S.jsx)(Vn.Z,{store:i,origin:this.renderViewSettingsButton(),isFirstTooltip:!1,phase:"click_view_settings"}):this.renderViewSettingsButton();return(0,S.jsxs)(Zn.p,{allowSelectionWithin:!0,style:this.getHeaderWrapStyle(),onMouseDown:this.handleEditorMouseDown,onMouseMove:this.handleHeaderMouseMove,onMouseLeave:this.handleHeaderMouseLeave,ref:this.handleHeaderMount,children:[h&&(0,S.jsxs)(Po.Z,{store:i,shouldShowCopyLinkButton:i.isLocked(),shouldShowHoverMenu:!n&&this.canEdit()&&!l,analyticsName:this.collectionViewTypeToAnalyticsType(e),useGrid:s&&i.isRootOrDirectChild(),children:[r.isPhone?(0,S.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[this.renderLoadingSpinner(),this.renderFullScreenButton(),u,this.renderAddItemButton()]})})]}):(0,S.jsxs)("div",{style:this.getHeaderStyle(),children:[this.renderViewTabBar(),!this.props.hideHeaderActions&&(0,S.jsx)(En.Z,{isVisible:!0,animationStyle:{opacity:c?1:0},render:()=>(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:2},children:[this.renderLoadingSpinner(),!d&&this.renderLockIndicator(),!d&&this.renderNoDateButton(),!d&&"page"!==e&&this.renderFilterButton(),!d&&"page"!==e&&this.renderSortButton(),this.renderAutomationSettingsButton(),!d&&"page"!==e&&this.renderSearch(),p&&this.renderPageViewSearch(),this.renderFullScreenButton(),u,this.renderAddItemButton()]})})]}),a&&(0,S.jsx)(at.Z,{id:"no_date_count",collectionContextStore:this.collectionContextStore,reducer:a,resultStore:this.stores.noDateResultStore})]}),(0,S.jsxs)("div",{style:this.getHeaderPositioningStyle(),children:[this.renderSource(),this.renderFilterBar()]})]})}renderLockIndicator(){const{device:e}=this.environment,{store:t}=this.props;if(!this.isFullScreen()&&!e.isPhone&&t.canEditCollection())return(0,S.jsx)(od.Z,{store:t,isMobile:!1,isInlineCollection:!0,disableTooltip:!0,buttonStyle:{marginLeft:4,marginRight:4}})}renderViewTabBar(){return(0,S.jsx)(Qc,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,isPlaceholderExternalCollectionStore:this.isPlaceholderExternalCollectionStore,onViewClick:this.handleViewClick})}renderFullScreenButton(){const{store:e}=this.props;if(this.isFullScreen())return;const t=(0,de.ZP)({store:e,fullyQualified:!1,pageVisitSource:c.tY.Expand}),o=pe.default.formatMessage(dd.openFullscreenPageButtonTooltip);return(0,S.jsx)(xt.Z,{renderTooltip:()=>o,render:e=>(0,S.jsx)(nr.Z,{ariaLabel:o,href:t,onClick:this.handleOpenAsPageClick,icon:v.Z,style:this.getTopbarIconButtonStyle(),iconStyle:{fill:this.theme.mediumTextColor,width:16},...e})})}renderAutomationSettingsButton(){const{collectionContextStore:e,automationsViewRef:t}=this,o=this.showHoverActionsStore.state,r=this.getCurrentCollectionViewStore(),i=null==r?void 0:r.getType(),n=e.settingsStore,s=n.state.open,l=ud({tab:(0,we.n)(n)}),a=e.aliveAutomationCount.state,c=(0,Ee.sX)(),d=(0,ne.Li)({collectionStore:e.collectionStore()}),{isMobile:h}=this.environment.device;if("page"===i||this.isPlaceholderExternalCollectionStore.state||!(0,ne.cB)(e))return;const u=a>0,m=!h&&c&&d&&o;return(0,S.jsxs)(S.Fragment,{children:[m&&(0,S.jsx)($,{origin:t,displayStore:this.stores.automationsTooltipVisibleStore,onPrimaryButtonClick:this.handleViewAutomationSettingsClick,hasAutomations:u}),(0,S.jsx)(xt.Z,{renderTooltip:()=>pe.default.formatMessage(dd.openAutomationsSettingsButtonTooltip),render:e=>(0,S.jsx)(nr.Z,{ariaLabel:pe.default.formatMessage(dd.openAutomationsSettingsButtonAriaLabel),className:ee.RIA,icon:p.K,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:14,fill:u?this.theme.icon.interactive:this.theme.mediumTextColor},hovered:s&&l,onClick:this.handleViewAutomationSettingsClick,ref:t,...e})})]})}renderViewSettingsButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore(),o=null==t?void 0:t.getType(),r=e.settingsStore,i=r.state.open,n=e.permissionScopes.state,s=!ud({tab:(0,we.n)(r)});if("page"!==o&&(n.canEditContent||"collectionTypedView"===e.contextType)&&!this.isPlaceholderExternalCollectionStore.state)return(0,S.jsx)(xt.Z,{renderTooltip:()=>(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Edit view layout, grouping and more...",id:"database.collectionViewBlock.openViewSettingsButton.tooltip"}),render:e=>(0,S.jsx)(nr.Z,{className:ee.xvU,icon:m.o,style:this.getTopbarIconButtonStyle(),iconStyle:{width:void 0,height:3,fill:this.theme.mediumTextColor},hovered:i&&s,onClick:this.handleViewSettingsClick,...e,onMouseEnter:function(){for(var t,o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];null===(t=e.onMouseEnter)||void 0===t||t.call(e,...r)}})})}renderFilterButton(){const{device:e}=this.environment,{createFilterSettingsStore:t}=this.stores;if(this.shouldRenderOptions()&&!this.isPlaceholderExternalCollectionStore.state)return(0,S.jsx)(ft.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,open:t.state.open,origin:this.renderFilterButtonOrigin(),onDismiss:this.handleCreateFilterPopupDismiss,originGap:4,render:this.renderCreateFilterPopup})}renderFilterButtonOrigin(){const e=this.hasAppliedFilter.state;return(0,S.jsx)(vt.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleFilterClick,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"})})}renderSortButton(){const{device:e}=this.environment;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const{createSortSettingsStore:t}=this.stores;return(0,S.jsx)(ft.ZP,{popupType:e.isMobile?mt.Z4.SlideUp:mt.Z4.Popup,open:t.state.open,origin:this.renderSortButtonOrigin(),onDismiss:this.handleCreateSortPopupDismiss,originGap:4,render:this.renderCreateSortPopup})}renderSortButtonOrigin(){const e=this.hasSort.state;return(0,S.jsx)(vt.Z,{style:this.getTopbarActionButtonStyle(e),isBlue:e,onClick:this.handleSortClick,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"})})}renderSearch(){const{collectionContextStore:e}=this;if(!this.shouldRenderOptions()||this.isPlaceholderExternalCollectionStore.state)return;const t=e.searchOpen.state,o=e.searchQuery.state;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(nr.Z,{icon:u.e,iconStyle:{width:14,height:void 0,fill:this.theme.mediumTextColor},style:this.getTopbarIconButtonStyle(),onClick:this.handleSearchButtonClick}),(0,S.jsx)(En.Z,{isVisible:t,animationStyle:{width:150,opacity:1},enterAnimationStyle:{width:0,opacity:0},exitAnimationStyle:{width:0,opacity:0},render:()=>(0,S.jsx)(xs.Z,{capture:t,allowEsc:!0,render:e=>(0,S.jsx)("div",{...e,children:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",overflow:"hidden"},children:(0,S.jsx)(Xc.Z,{style:this.getSearchInputStyle(),format:Xc.Z.Format.Transparent,value:o,onChange:this.handleSearchQueryChange,placeholder:pe.default.formatMessage(dd.searchInputPlaceholder),focusInitial:t,showClearButton:!0,onBlur:this.handleSearchBlur,onCancel:this.handleClearSearch,onClick:he.Wi,onClearButtonClick:this.handleClearSearch,onKeyDown:this.handleSearchKeyDown})})})})})]})}renderPageViewSearch(){var e;const t=this.getCurrentCollectionViewStore();if("page"!==(null==t?void 0:t.getType()))return null;const o=null===(e=this.collectionContextStore.collectionViewBlockStore())||void 0===e?void 0:e.id;return o?(0,S.jsxs)(vt.Z,{style:{display:"flex",alignItems:"center",fontSize:14,fontWeight:P.Z.fontWeight.medium,color:this.theme.mediumTextColor},onClick:()=>{G.Kf({environment:this.environment,analyticsFrom:"wiki-home-collection-view"}),Le.ZP.updateFilters({ancestors:[o]})},children:[(0,u.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),(0,S.jsx)(R.FormattedMessage,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}renderAddItemButton(){const{collectionContextStore:e}=this,t=this.getCurrentCollectionViewStore();if("page"===(null==t?void 0:t.getType())||this.isPlaceholderExternalCollectionStore.state||!e.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const o="collectionTypedView"===e.contextType?(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New {singleItemName}",id:"collectionViewBlock.action.newItem.typedDatabaseTitle",values:{singleItemName:(0,ae.sN)(e.databaseType)}}):(0,S.jsx)(R.FormattedMessage,{defaultMessage:"New",id:"collectionViewBlock.action.newItem.nonTypedDatabaseTitle"}),r={marginLeft:8,fontSize:14,height:28};if("collectionTypedView"===e.contextType)return(0,S.jsx)(S.Fragment,{});const i=e=>(0,S.jsx)(id.Z,{title:o,color:"blue",onClick:this.handleAddItemClick,dropdownEvents:e,style:r,className:ee.sqL});return(0,S.jsx)(mt.ZP,{popupType:this.environment.device.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,render:this.renderTemplatesPopup,originGap:4,onClick:this.handleTemplatesDropdownClick,renderOrigin:e=>this.shouldShowProjManagementTooltipTour()?(0,S.jsx)(Vn.Z,{store:this.props.store,origin:i(e),isFirstTooltip:!0,phase:"create_a_task"}):i(e),buttonPopupStore:this.stores.templateButtonPopupStore})}renderNoDateButton(){const e=this.noDateTotal.state,{collectionContextStore:t}=this,o=t.permissionScopes.state;if(t.collectionStore()&&0!==e&&o.canEditContent)return(0,S.jsx)(mt.ZP,{popupType:this.environment.device.isMobile?ft.kQ.SlideUp:ft.kQ.Popup,render:this.renderNoDatePopup,onClick:this.handleNoDateButtonClick,renderOrigin:t=>(0,S.jsx)(vt.Z,{isGray:!0,style:this.getTopbarActionButtonStyle(!1),...t,children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No date ({noDateTotal})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{noDateTotal:e}})})})}renderFilterBar(){const{collectionContextStore:e}=this,t=e.filtersBarOpenStore.state,o=this.getCurrentCollectionViewStore();if("page"!==(null==o?void 0:o.getType())){if(!t){const t=e.getCompleteSprintButtonContext.state;if(!t)return;return(0,S.jsxs)("div",{style:{display:"flex",marginTop:9},children:[(0,S.jsx)("div",{style:{flex:1}}),(0,S.jsx)(Yc.v,{collectionContextStore:e,completeSprintAutomationContext:t})]})}return(0,S.jsx)(uc.Z,{collectionContextStore:this.collectionContextStore,showHoverActionsStore:this.showHoverActionsStore,createFilterSettingsStore:this.stores.filterBarCreateFilterSettingsStore,saveControlMoreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}}renderSource(){if(!this.isPlaceholderExternalCollectionStore.state)return this.collectionContextStore.shouldShowSource.state?(0,S.jsx)(pc,{store:this.props.store,collectionContextStore:this.collectionContextStore,isFullScreen:this.isFullScreen(),showHoverActionsStore:this.showHoverActionsStore,canEdit:this.canEdit()}):void 0}renderView(e,t,o,r,i,n){const{store:s}=this.props,{collectionContextStore:l}=this,a=!this.canEdit()||"collectionVirtualView"===l.contextType;"rendered"!==fe.default.state.renderPhase&&fe.default.setState({...fe.default.state,renderPhase:"rendered"});const c=this.isFullScreen(),d=this.isInPeekRenderer(),h=this.getBlockPropertyValueOverlayStore(),p=this.isRootOrDirectChild();let u=this.leftRightPadding.state;if(u){if(!e&&this.collectionContextStore.hasSingleCollection())return this.renderNoSourcePlaceholder(o);if(this.isPlaceholderExternalCollectionStore.state)return this.renderNoSourceExternalCollectionPlaceholder(o);if("table"===o)return(0,S.jsx)(ka,{schema:r,format:n,query:i,store:s,collectionContextStore:l,showHoverActionsStore:this.showHoverActionsStore,isFullScreen:c,isInPeekRenderer:d,...u,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:h,isRootChild:p,viewSettingsPlacementStore:this.stores.viewSettingsPlacementStore},t.id);if("board"===o)return(0,S.jsx)(Pi,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...u,paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:h,isRootChild:p},t.id);if("page"===o){const e=t.getFormat().page_pointer,o=l.settingsStore;if(!e)return(0,S.jsxs)("div",{style:{fontSize:17,fontWeight:P.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginTop:20,display:"inline-block",width:"100%"},children:[(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No page specified",id:"collectionViewBlock.noPagePlaceholder.title"}),(0,S.jsx)("div",{style:{fontSize:11},children:(0,S.jsx)(Qt.Z,{onClick:()=>D.r$({collectionContextStore:l,collectionSettingsStore:o}),children:"Enter a page ID to continue"})})]});const r=this.createComputedStore((()=>s.id===e.id?s:_e.G.createChildStore(s,{table:e.table,id:e.id}))),i=(0,X.ui)(this.environment);return(0,S.jsx)(rd.Z,{context:Fe.S.CollectionPageView,store:r.state,paddingBottom:rd.Z.paddingBottom(this.environment),paddingLeft:i,paddingRight:i,pageCoverHeight:0,disabled:this.props.store.isLocked()||this.props.disabled,loadingContainerStore:void 0,preventDefaultTitleTabBehavior:!0,preventDefaultTitleUntabBehavior:!0})}return"calendar"===o?(0,S.jsx)(en,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...u,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:h,isRootChild:p},t.id):"list"===o?(this.isInFrameWhenSidePeekOpen.state&&!this.isMyTasksAssignedToMeTileView.state&&(u={...u,paddingRight:24}),(0,S.jsx)(pn,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...u,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:h,isRootChild:p},t.id)):"gallery"===o?(0,S.jsx)(ei,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isInPeekRenderer:d,...u,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:h,isRootChild:p},t.id):"timeline"===o?(0,S.jsx)(oc,{schema:r,format:n,query:i,store:s,collectionContextStore:l,isFullScreen:c,isRootChild:p,isInPeekRenderer:d,minWidth:this.getMinWidth(),paddingBottom:this.getPaddingBottom(o),disabled:a,blockPropertyValueOverlayStore:h,showHoverActionsStore:this.showHoverActionsStore,ref:this.timelineViewRef,...u},t.id):void 0}}renderNoSourcePlaceholder(e){const t=this.isFullScreen(),o=this.collectionContextStore.permissionScopes.state,r=this.collectionContextStore.settingsStore.state.open,i={display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"};return(0,S.jsx)("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:t?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,S.jsxs)("div",{style:{paddingRight:r?Qn.nJ:void 0},children:[y({height:48,fill:this.theme.lightIconColor,margin:"0 auto"}),(0,S.jsx)("div",{style:{fontSize:17,fontWeight:P.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"})}),o.canConfigureBlock&&(0,S.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,color:this.theme.lightTextColor},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"<button>Select a data source</button> to continue",id:"collectionViewBlock.setSourceButton.title",values:{button:e=>(0,S.jsx)(Qt.Z,{style:i,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderNoSourceExternalCollectionPlaceholder(e){var t;const o=this.isFullScreen(),r=this.collectionContextStore.permissionScopes.state,i=this.collectionContextStore.settingsStore.state.open,n={display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"},s=this.getExternalIntegrationId.state,l=Te.Z.integrations.state.find((e=>e.id===s)),a=!(this.environment.device.isMobileBrowser&&this.isPlaceholderExternalCollectionStore.state&&!this.isUserAuthenticated());if(l)return(0,S.jsx)("div",{style:{...this.leftRightPadding.state,paddingTop:8,paddingBottom:o?void 0:this.getPaddingBottom(e),height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,S.jsxs)("div",{style:{paddingRight:i?Qn.nJ:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsx)(Jt.Z,{icon:null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.getIcon(),size:48,disabled:!0,isEmptyPage:!1}),(0,S.jsx)("div",{style:{fontSize:17,fontWeight:P.Z.fontWeight.medium,color:this.theme.lightTextColor,textAlign:"center",marginBottom:-2},children:(0,S.jsx)(R.FormattedMessage,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:l.name}})}),r.canConfigureBlock&&(0,S.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:this.theme.lightTextColor},children:a&&(0,S.jsx)(R.FormattedMessage,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:l.name,button:e=>(0,S.jsx)(Qt.Z,{style:n,onClick:this.handleSetSourceClick,children:e})}})})]})})}renderLoadingSpinner(){const e=this.collectionContextStore.shouldShowSpinner.state;return(0,S.jsx)(ks.Z,{show:e,...le.Mq,render:e=>e?(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginRight:4},children:(0,S.jsx)(Mt.Z,{style:{width:14,height:14}})}):void 0},"loading-spinner")}renderBottomBorderForViewSettings(){const{collectionContextStore:e}=this;if(e.settingsStore.state.open&&"sidebar"===this.stores.viewSettingsPlacementStore.state)return(0,S.jsx)("div",{style:{...this.leftRightPadding.state,...this.leftRightMargin.state,borderTop:`1px solid ${this.theme.tableDividerColor}`,height:12}})}renderMultiSelectToolbar(){if((0,le.fk)({environment:this.environment,collectionContextStore:this.collectionContextStore})){var e;const t=(null===(e=this.leftRightPadding.state)||void 0===e?void 0:e.paddingLeft)??0,o=this.leftRightMargin.state.marginLeft??0;return(0,S.jsx)(Hn,{marginLeft:t+o})}}unsubscribeAll(){for(const e of this.subscriptions.values())e.unsubscribe();this.collectionTypeChangeSubscription&&this.collectionTypeChangeSubscription.unsubscribe()}resetFrozoneStore(e){var t,o;const r=null===(t=this.horizontalScrollerEl)||void 0===t?void 0:t.stores.store.state.clientWidth,i=this.collectionContextStore.normalizedFormatStore.state;this.collectionContextStore.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null===(o=this.horizontalScrollerEl)||void 0===o||null===(o=o.stores.store.state.clientRect)||void 0===o?void 0:o.left)??0,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,i),tryShowHiddenFrozenColumn:!1})}isCollectionViewOfExternalCollectionWithoutExternalObjectId(){var e;const t=null===(e=this.getCollectionStore())||void 0===e?void 0:e.getValue();return Boolean(t&&(0,h.Ev)(t))}isUserAuthenticated(){const e=this.collectionContextStore.collectionStore();if(!e)return!1;const t=e.getFormat().integration_id,o=Te.Z.integrations.state.find((e=>e.id===t));return!(!t||!o)&&(0,oe.NP)(t).length>0}createItem(e){const{transaction:t,coerce:o,from:r}=e,{collectionContextStore:i}=this,n=j.IW({environment:this.environment,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,coerce:o,initializeDefaultTemplate:o,transaction:t,from:r});if(!n)return;const s=this.isTasksDB()&&"on"===Pe.default.getEligibleGroup({experimentId:"quick_capture_tasks_with_layer",defaultGroup:"control"})?"mini_peek":(0,le.kr)(i.collectionViewStore());O.peekBlock({environment:this.environment,store:n.newStore,peekMode:s,resultsStore:void 0,collectionContextStore:i,pageVisitSource:c.tY.Create});const l=i.subitemTreeStore.state;return M.W2j(this.environment,{from:l.children?"collection_view_new_parent_item":"collection_view_new_item",type:"page",new_page_id:n.newStore.id,...re.Pn(i)}),n.newStore}getViewStores(){const{store:e}=this.props;return e.getCollectionViewStores()}getCurrentCollectionViewStore(){return this.collectionContextStore.collectionViewStore()}getDefaultCollectionViewStore(){var e;const t=this.getViewStores();if(null!==(e=t[0])&&void 0!==e&&e.isDefined())return t[0]}getCollectionStore(){return this.collectionContextStore.collectionStore()}getMinWidth(){const{store:e}=this.props,{device:t}=this.environment,o=t.isPhone,r=this.isFullScreen(),i=this.getCurrentViewType(),n=("gallery"===i||("calendar"===i||"list"===i)&&r)&&this.isInFrameWhenSidePeekOpen.state,s=(0,ye.ll)(this.environment,this.isInPeekRenderer()),l=Ae.default.state;return this.isMyTasksAssignedToMeTileView.state?void 0:r||this.isRootOrDirectChild()?o?`calc(100% - ${2*(0,X.ui)(this.environment)}px - ${s}px)`:this.isInPeekRenderer()?`calc(100% - ${2*Ae.PeekModePadding.horizontal[l.mode]}px - ${s}px)`:this.isInFrameWhenSidePeekOpen.state?(0,ye.$3)(this.environment)+(n?(0,ye.vJ)(this.environment):0):r?`calc(100% - ${2*(0,X.CP)(this.environment)}px - ${s}px)`:(0,le._5)(e)?`calc(100% - ${2*(0,X.ui)(this.environment)}px - ${s}px)`:X.CC-2*(0,X.ui)(this.environment)-s:`calc(100% - ${s}px)`}isInPeekRenderer(){return(0,le.en)(this.props.store)}getBlockPropertyValueOverlayStore(){return this.isInPeekRenderer()?De.Z:Be.Z}resetLeftScrollAfterFlush(){s.default.afterNextFlush((()=>{var e;const t=null===(e=this.horizontalScrollerEl)||void 0===e?void 0:e.scrollerEl();if(t){t.scrollLeft=0;const e=me.xH(t);e&&(e.scrollLeft=0)}}))}isFullScreen(){return Boolean(this.props.isFullScreen)}getDefaultResults(){const e=this.collectionContextStore.localResultStore.state,t=this.getCollectionStore();if(t&&e&&"reducer"===e.type){const o=C.sE(e.reducerResults,(e=>"results"===e.type));if(o)return o.blockIds.map((e=>_e.G.createChildStore(t,{id:e,table:b.iU})))}return[]}navigate(e){this.context.overrideLinkClick?this.context.overrideLinkClick(e):O.navigate({environment:this.environment,url:e})}getCurrentViewType(){var e;const{collectionContextStore:t}=this,o=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType();if(!o)throw new Error("View type was not defined.");return o}getNoDateProperty(){const e=this.collectionContextStore.collectionViewStore(),t=this.collectionContextStore.normalizedQueryStore.state;if(!e||!t)return;const o=e.getType();return"timeline"===o&&t.timeline_by?t.timeline_by:"calendar"===o&&t.calendar_by?t.calendar_by:void 0}ensureStoreListeners(){const{collectionContextStore:e}=this,{store:t}=this.props;e.blockIsPrivateStore.state;for(const o of t.getCollectionViewStores())o.getValue()}getScrollerStyle(e,t,o){const{store:r}=this.props,i=this.isFullScreen(),n=this.isRootOrDirectChild(),s=this.leftRightPadding.state,l=this.getPaddingBottom(e),a=this.collectionContextStore.settingsStore.state.open;return{flexGrow:1,flexShrink:0,...r.isLocked()&&{cursor:"default"},..."timeline"===e&&this.collectionContextStore.collectionStore()&&!i&&!(0,se.fj)({environment:this.environment,isFullScreen:i,isRootChild:n,format:t})&&s&&{marginLeft:s.paddingLeft,marginRight:s.paddingRight,marginBottom:l},...a&&!i&&"sidebar"===this.stores.viewSettingsPlacementStore.state&&{minHeight:Qn.j9},...this.isInFrameWhenSidePeekOpen.state&&"timeline"!==e&&!this.isMyTasksAssignedToMeTileView.state?{position:"sticky",left:0,paddingLeft:this.isFrozenColumnsEnabled.state?0:o,width:(0,ye.$3)(this.environment)}:{},..."page"===e?{zIndex:T.y}:{},...this.isMyTasksAssignedToMeTileView.state?{height:"100%",maxHeight:"inherit",paddingRight:16}:{}}}getPaddingBottom(e){return this.props.isFullScreen?"timeline"===e?96:cd:"timeline"===e||"gallery"===e?0:xe.Z.state}getHeaderWrapStyle(){const{hideHeader:e}=this.props,t=this.leftRightPadding.state,o=(0,ye.$3)(this.environment),r=(0,le._5)(this.props.store)||this.isFullScreen()?o:Math.min(X.CC,o),i=this.isInFrameWhenSidePeekOpen.state&&!Ae.default.isSidePeekOpening.state;return{minHeight:40,paddingLeft:null==t?void 0:t.paddingLeft,paddingRight:i?0:null==t?void 0:t.paddingRight,flexShrink:0,...(this.isFullScreen()||i)&&{position:"sticky",zIndex:86,left:0,width:i&&t?r-(t.paddingLeft/2??0):void 0},...this.props.store.isLocked()&&{cursor:"default"},...this.leftRightMargin.state,...e?{opacity:0,height:0,minHeight:void 0}:{}}}getHeaderStyle(){const{collectionContextStore:e}=this,t=this.getCurrentViewType(),o=e.viewIsFlushToTopbar();return{display:"flex",alignItems:"center",height:40,boxShadow:("timeline"===t||"table"===t)&&o?void 0:`inset 0 -1px 0 ${this.theme.tableDividerColor}`,...this.getHeaderPositioningStyle()}}getHeaderPositioningStyle(){const e=this.leftRightPadding.state;return{left:null==e?void 0:e.paddingLeft,width:"100%"}}getSearchInputStyle(){return{fontSize:14,lineHeight:1,paddingRight:4,color:this.theme.regularTextColor,marginBottom:1}}getTopbarActionButtonStyle(e){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:e?this.theme.blueColor:this.theme.mediumTextColor,fontWeight:P.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}getTopbarIconButtonStyle(){return{display:"flex",alignItems:"center",fontSize:14,height:28,width:28,padding:6,color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor,fontWeight:P.Z.fontWeight.regular,lineHeight:1,borderRadius:3}}collectionViewTypeToAnalyticsType(e){return"page"===e?"page_view":e}shouldShowProjManagementTooltipTour(){return this.canShowPmIntroTooltipStore.state}projManagementTooltipTourAssignToSomeone(){const e=fe.default.state.currentUserSettingsStore,t=fe.default.state.currentSpaceStore;e&&t&&B.uR({environment:this.environment,requiredCurrPhase:"create_a_task",nextPhase:"assign_to_someone",currentUserSettingsStore:e,currentSpaceStore:t})}projManagementTooltipTourComplete(){const e=fe.default.state.currentUserSettingsStore,t=fe.default.state.currentSpaceStore;if(e&&t){"click_view_settings"===(0,J.jH)(e,t)&&B.uR({environment:this.environment,requiredCurrPhase:void 0,nextPhase:"complete",currentUserSettingsStore:e,currentSpaceStore:t})}}trackRenderTime(e){let{isFirstRender:t}=e;const o=Se.default.mark("collections.collection_view_block_render");Se.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>({...re.vS(this.collectionContextStore),is_first_render:t})})}trackSwitchViewLag(){if(!this.switchViewMetric)return;const{from:e,to:t,metric:o,sizeHintAtStart:r}=this.switchViewMetric;Se.default.measureAfterNextFlush(o,{environment:this.environment,getData:()=>{const o=re.vS(this.collectionContextStore),{view_type:i,row_count_category:n,...s}=o;return{from:e,to:t,did_trigger_fetch:this.collectionContextStore.isLoading.state,row_count_category:re.ZO(r),...s}}}),this.switchViewMetric=void 0}}function ud(e){const{tab:t}=e;return"automationSettings"===(null==t?void 0:t.type)||"automationCreateSettings"===(null==t?void 0:t.type)||"automationEditSettings"===(null==t?void 0:t.type)}pd.displayName="CollectionViewBlock",pd.contextTypes={...Y.wK,...n.w};class md extends n.Z{componentDidCatch(e){throw k.vd("collections"),e}renderComponent(){return(0,S.jsx)(pd,{...this.props})}}const gd=pd},95550:(e,t,o)=>{o.d(t,{G:()=>s});o(67294);var r=o(24405),i=o(36596),n=o(85893);function s(e){window.__c={n:"ListItemShimmer"};const{widthPercentage:t}=e,o=(0,r.yK)((e=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:e.lightDividerColor},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginLeft:2,backgroundColor:e.lightDividerColor},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t]);return(0,n.jsx)("div",{style:o.rowContainer,children:(0,n.jsxs)("div",{style:o.column,children:[(0,n.jsx)(i.Z,{style:o.circleShimmer}),(0,n.jsx)(i.Z,{style:o.rowShimmer})]})})}},21547:(e,t,o)=>{o.d(t,{h:()=>l});o(67294);var r=o(72126),i=o(34232),n=o(95550),s=o(85893);function l(e){window.__c={n:"ListShimmer"};const{isFullScreen:t,hasGroups:o,hasPartialResults:l,hasSearchQuery:a}=e;if(!(0,i.Z)(!0,0,100))return null;let c=1;o||l||a||(c=t?10:3);const d=c>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=r.DZ(c).map((e=>(0,s.jsx)(n.G,{widthPercentage:e<d.length?d[e]:void 0},e)));return(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginLeft:3},children:h})}},8597:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("arrowUp",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M8 14.5586C8.44434 14.5586 8.74512 14.251 8.74512 13.7998V5.30957L8.69043 3.83984L10.4951 5.84961L12.0469 7.38086C12.1836 7.51074 12.3682 7.59961 12.5801 7.59961C12.9902 7.59961 13.291 7.28516 13.291 6.86816C13.291 6.66992 13.2158 6.49219 13.0586 6.32812L8.55371 1.81641C8.40332 1.66602 8.20508 1.57715 8 1.57715C7.79492 1.57715 7.59668 1.66602 7.44629 1.81641L2.94141 6.32812C2.78418 6.49219 2.70898 6.66992 2.70898 6.86816C2.70898 7.28516 3.0166 7.59961 3.42676 7.59961C3.63184 7.59961 3.82324 7.51074 3.95312 7.38086L5.50488 5.84961L7.30957 3.83301L7.25488 5.30957V13.7998C7.25488 14.251 7.5625 14.5586 8 14.5586Z"})})},2585:(e,t,o)=>{o.d(t,{f:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("chevronLeft",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M3.61816 8.06445C3.61816 8.29688 3.70703 8.49512 3.8916 8.67285L9.22363 13.8887C9.36719 14.0391 9.55859 14.1143 9.77734 14.1143C10.2217 14.1143 10.5703 13.7725 10.5703 13.3213C10.5703 13.1025 10.4814 12.9043 10.3311 12.7539L5.52539 8.06445L10.3311 3.375C10.4814 3.21777 10.5703 3.01953 10.5703 2.80078C10.5703 2.35645 10.2217 2.01465 9.77734 2.01465C9.55859 2.01465 9.36719 2.08984 9.22363 2.24023L3.8916 7.45605C3.70703 7.63379 3.625 7.83203 3.61816 8.06445Z"})})},45453:(e,t,o)=>{o.d(t,{p:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionHide",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M12.6172 12.9492C12.8047 13.1309 13.0918 13.1426 13.2793 12.9492C13.4727 12.75 13.4609 12.4688 13.2793 12.2871L3.35352 2.37305C3.17773 2.19141 2.87305 2.18555 2.69141 2.37305C2.51562 2.54883 2.51562 2.85352 2.69141 3.0293L12.6172 12.9492ZM8 2.70703C6.98047 2.70703 6.05469 2.88281 5.19336 3.16406L6.13086 4.10156C6.72266 3.93164 7.33789 3.83203 8 3.83203C11.7441 3.83203 14.7207 7.08984 14.7207 7.77539C14.7207 8.23828 13.7715 9.43359 12.2656 10.377L13.1328 11.25C14.9727 10.043 16.0449 8.4668 16.0449 7.77539C16.0449 6.57422 12.8047 2.70703 8 2.70703ZM8 12.8496C9.08398 12.8496 10.0742 12.6621 10.9707 12.3516L10.0391 11.4199C9.40039 11.6074 8.72656 11.7246 8 11.7246C4.25586 11.7246 1.2793 8.5957 1.2793 7.77539C1.2793 7.38281 2.27539 6.11133 3.88086 5.12695L2.99609 4.24219C1.08008 5.46094 -0.0507812 7.07227 -0.0507812 7.77539C-0.0507812 8.97656 3.25977 12.8496 8 12.8496ZM10.9238 8.90625C11.0762 8.56055 11.1641 8.17383 11.1641 7.77539C11.1641 6.01172 9.75781 4.62305 8 4.62305C7.5957 4.62305 7.21484 4.69922 6.86328 4.8457L10.9238 8.90625ZM8 10.9336C8.45703 10.9336 8.88477 10.8281 9.26562 10.6465L5.12305 6.49805C4.93555 6.88477 4.83008 7.3125 4.83008 7.78125C4.83594 9.49805 6.23633 10.9336 8 10.9336Z"})})},9056:(e,t,o)=>{o.d(t,{g:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionShow",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},31505:(e,t,o)=>{o.d(t,{Y:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},39301:(e,t,o)=>{o.d(t,{n:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},4635:(e,t,o)=>{o.d(t,{W:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("options",{viewBox:"0 0 17 15",svg:(0,i.jsx)("path",{d:"M11.2871 4.48438C12.1309 4.48438 12.8574 3.95312 13.1621 3.21875H15.7324C16.123 3.21875 16.4512 2.875 16.4512 2.46094C16.4512 2.04688 16.123 1.71094 15.7324 1.71094H13.1621C12.8652 0.96875 12.1387 0.4375 11.2871 0.4375C10.4355 0.4375 9.70898 0.96875 9.41211 1.71094H1.04492C0.630859 1.71094 0.302734 2.04688 0.302734 2.46094C0.302734 2.875 0.630859 3.21875 1.04492 3.21875H9.41211C9.7168 3.95312 10.4434 4.48438 11.2871 4.48438ZM11.2871 3.42188C10.748 3.42188 10.3262 2.99219 10.3262 2.46094C10.3262 1.91406 10.748 1.49219 11.2871 1.49219C11.834 1.49219 12.248 1.91406 12.248 2.46094C12.248 2.99219 11.834 3.42188 11.2871 3.42188ZM1.02148 6.58594C0.630859 6.58594 0.302734 6.92188 0.302734 7.33594C0.302734 7.74219 0.630859 8.08594 1.02148 8.08594H3.67773C3.98242 8.83594 4.70898 9.35938 5.56055 9.35938C6.4043 9.35938 7.13086 8.83594 7.43555 8.08594H15.709C16.123 8.08594 16.4512 7.75 16.4512 7.33594C16.4512 6.92188 16.123 6.58594 15.709 6.58594H7.43555C7.13086 5.84375 6.4043 5.32031 5.56055 5.32031C4.70898 5.32031 3.98242 5.84375 3.67773 6.58594H1.02148ZM5.56055 8.30469C5.02148 8.30469 4.5918 7.875 4.5918 7.33594C4.5918 6.78906 5.02148 6.375 5.56055 6.375C6.09961 6.375 6.52148 6.78906 6.52148 7.33594C6.52148 7.875 6.09961 8.30469 5.56055 8.30469ZM11.2871 14.2344C12.1387 14.2344 12.8652 13.7031 13.1621 12.9609H15.7324C16.123 12.9609 16.4512 12.625 16.4512 12.2109C16.4512 11.7891 16.123 11.4609 15.7324 11.4609H13.1621C12.8652 10.7188 12.1387 10.1875 11.2871 10.1875C10.4434 10.1875 9.70898 10.7188 9.41211 11.4609H1.04492C0.630859 11.4609 0.302734 11.7969 0.302734 12.2109C0.302734 12.6172 0.630859 12.9609 1.04492 12.9609H9.41211C9.70898 13.7031 10.4355 14.2344 11.2871 14.2344ZM11.2871 13.1719C10.748 13.1719 10.3262 12.7422 10.3262 12.2109C10.3262 11.6641 10.748 11.25 11.2871 11.25C11.834 11.25 12.248 11.6641 12.248 12.2109C12.248 12.7422 11.834 13.1719 11.2871 13.1719Z"})})},23903:(e,t,o)=>{o.d(t,{P:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("pin",{viewBox:"0 0 13 19",svg:(0,i.jsx)("path",{d:"M1.25 12.875h4.227v3.648c0 1.196.5 2.188.695 2.188.187 0 .687-.992.687-2.188v-3.648h4.227c.703 0 1.148-.438 1.148-1.102 0-1.648-1.32-3.304-3.359-4.109L8.617 4c.992-.648 1.93-1.383 2.328-1.914.211-.266.305-.531.305-.758 0-.476-.367-.828-.914-.828H2.008c-.555 0-.914.352-.914.828 0 .227.093.492.297.758.398.531 1.343 1.266 2.328 1.914L3.46 7.664C1.42 8.47.1 10.125.1 11.774c0 .664.446 1.101 1.149 1.101zm4.922-5.719c-.5 0-.984.047-1.438.14l.235-3.874c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102 0-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.969.867-2.14 1.468-.071.04-.095.079-.079.188l.234 3.875a7.177 7.177 0 00-1.437-.14zm-4.61 4.54c-.18 0-.257-.102-.226-.313.172-1.406 1.969-3.086 4.836-3.086 2.86 0 4.656 1.68 4.828 3.086.031.21-.047.312-.227.312h-9.21z"})})},79310:(e,t,o)=>{o.d(t,{A:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("pinStrikethrough",{viewBox:"0 0 15 19",svg:(0,i.jsx)("path",{d:"M3.094 1.328c0 .227.094.492.297.758.398.531 1.343 1.266 2.328 1.914l-.055.86 1.149 1.156.156-2.594c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102.007-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.961.867-2.14 1.468-.071.04-.087.079-.079.188l.234 3.875a7.12 7.12 0 00-1.437-.14h-.203l1.203 1.226c2.164.219 3.758 1.984 3.758 3.234 0 .04-.008.078-.008.117l.844.97c.257-.157.468-.477.468-.93 0-1.649-1.32-3.313-3.359-4.11L10.617 4c.992-.648 1.93-1.383 2.336-1.914.203-.266.297-.531.297-.758 0-.476-.367-.828-.914-.828H4.008c-.555 0-.914.352-.914.828zM.367 2.656l14.125 14.11a.603.603 0 00.852 0 .597.597 0 000-.852L1.227 1.804a.606.606 0 00-.86 0 .618.618 0 000 .852zm1.735 9.117c0 .665.445 1.102 1.148 1.102h4.234v3.648c0 1.196.493 2.188.688 2.188.195 0 .687-.992.687-2.188V12.97h.446L8.03 11.695H3.562c-.171 0-.257-.101-.226-.312.094-.875.828-1.805 1.984-2.399l-.82-.82c-1.477.867-2.398 2.234-2.398 3.61z"})})}}]);